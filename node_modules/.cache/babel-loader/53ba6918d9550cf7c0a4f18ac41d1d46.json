{"remainingRequest":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/thread-loader/dist/cjs.js!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/babel-loader/lib/index.js!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/eslint-loader/index.js??ref--13-0!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/GameScene.js","dependencies":[{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/GameScene.js","mtime":1617962987673},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/cache-loader/dist/cjs.js","mtime":1616495189815},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/thread-loader/dist/cjs.js","mtime":1616495190967},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/babel-loader/lib/index.js","mtime":1616495189787},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/eslint-loader/index.js","mtime":1616495190059}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICIvbWVkaWEvamFjb3BvL1ZvbHVtZURhdGkvRG9jdW1lbnRpL3BhcGVyby50ay9jb3Ntb3MucGFwZXJvLm1lL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiL21lZGlhL2phY29wby9Wb2x1bWVEYXRpL0RvY3VtZW50aS9wYXBlcm8udGsvY29zbW9zLnBhcGVyby5tZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgX2luaGVyaXRzIGZyb20gIi9tZWRpYS9qYWNvcG8vVm9sdW1lRGF0aS9Eb2N1bWVudGkvcGFwZXJvLnRrL2Nvc21vcy5wYXBlcm8ubWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2luaGVyaXRzIjsKaW1wb3J0IF9jcmVhdGVTdXBlciBmcm9tICIvbWVkaWEvamFjb3BvL1ZvbHVtZURhdGkvRG9jdW1lbnRpL3BhcGVyby50ay9jb3Ntb3MucGFwZXJvLm1lL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVTdXBlciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZW50cmllcy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC52YWx1ZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIucGFyc2UtaW50LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLnBhcnNlLWZsb2F0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLnRvLWZpeGVkLmpzIjsKaW1wb3J0ICogYXMgUGhhc2VyIGZyb20gInBoYXNlciI7CmltcG9ydCB3ZWJzb2NrZXRFdmVudHMgZnJvbSAiLi4vY29uc3RhbnRzL3dlYnNvY2tldEV2ZW50cyI7CmltcG9ydCB7IGdhbWVEaW1lbnNpb25zLCBub3JtYWxpemVycywgc2NlbmVLZXlzIH0gZnJvbSAiLi4vY29uc3RhbnRzL2dhbWVTZXR0aW5ncyI7CmltcG9ydCB7IGRldGVjdFRvdWNoU2NyZWVuIH0gZnJvbSAiLi4vY29uc3RhbnRzL2NvbnN0YW50cyI7CmltcG9ydCBfIGZyb20gImxvZGFzaCI7CmltcG9ydCBjcmVhdGVNYXAgZnJvbSAiLi4vcGhhc2VyL21hcHMiOwoKdmFyIEdhbWVTY2VuZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX1BoYXNlciRTY2VuZSkgewogIF9pbmhlcml0cyhHYW1lU2NlbmUsIF9QaGFzZXIkU2NlbmUpOwoKICB2YXIgX3N1cGVyID0gX2NyZWF0ZVN1cGVyKEdhbWVTY2VuZSk7CgogIGZ1bmN0aW9uIEdhbWVTY2VuZShzb2NrZXQsIGdhbWUpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgR2FtZVNjZW5lKTsKCiAgICBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHsKICAgICAga2V5OiBzY2VuZUtleXMuZ2FtZQogICAgfSk7CiAgICBfdGhpcy5zb2NrZXQgPSBzb2NrZXQ7CgogICAgX3RoaXMuc2V0VXBHYW1lKGdhbWUpOwoKICAgIF90aGlzLnVwZGF0ZUZwcyA9IDEwOwogICAgX3RoaXMudG91Y2hTY3JlZW4gPSBkZXRlY3RUb3VjaFNjcmVlbigpOwoKICAgIFBoYXNlci5QaHlzaWNzLkFyY2FkZS5Hcm91cC5wcm90b3R5cGUua2lsbEFsbCA9IGZ1bmN0aW9uICgpIHsKICAgICAgd2hpbGUgKHRoaXMuY291bnRBY3RpdmUoKSA+IDApIHsKICAgICAgICB0aGlzLmdldEZpcnN0QWxpdmUoKS5zZXRBY3RpdmUoZmFsc2UpLnNldFZpc2libGUoZmFsc2UpOwogICAgICB9CiAgICB9OwoKICAgIFBoYXNlci5QaHlzaWNzLkFyY2FkZS5Hcm91cC5wcm90b3R5cGUuZW5hYmxlQWxsID0gZnVuY3Rpb24gKCkgewogICAgICB3aGlsZSAodGhpcy5jb3VudEFjdGl2ZSgpIDwgMykgewogICAgICAgIHRoaXMuZ2V0Rmlyc3REZWFkKCkuc2V0QWN0aXZlKHRydWUpLnNldFZpc2libGUodHJ1ZSk7CiAgICAgIH0KICAgIH07CgogICAgX3RoaXMuc29ja2V0Lm9uKHdlYnNvY2tldEV2ZW50cy5VUERBVEVfU0hJUCwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIF90aGlzLnVwZGF0ZVNoaXAoZGF0YSk7CiAgICB9KTsKCiAgICBfdGhpcy5zb2NrZXQub24od2Vic29ja2V0RXZlbnRzLlNIT09ULCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gX3RoaXMuY3JlYXRlQnVsbGV0KGRhdGEpOwogICAgfSk7CgogICAgX3RoaXMuc29ja2V0Lm9uKHdlYnNvY2tldEV2ZW50cy5DSEFOR0VfU1RBVEUsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBfdGhpcy51cGRhdGVTdGF0ZShkYXRhKTsKICAgIH0pOwoKICAgIF90aGlzLnNvY2tldC5vbih3ZWJzb2NrZXRFdmVudHMuUkVMT0FELCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gX3RoaXMucmVsb2FkKGRhdGEpOwogICAgfSk7CgogICAgX3RoaXMuc29ja2V0Lm9uKHdlYnNvY2tldEV2ZW50cy5FTkRfVFVSTiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgY2xlYXJJbnRlcnZhbChfdGhpcy51cGRhdGVTaGlwSW50ZXJ2YWwpOwogICAgICAgIGNsZWFySW50ZXJ2YWwoX3RoaXMucmVsb2FkSW50ZXJ2YWwpOwoKICAgICAgICBfdGhpcy5zY2VuZS5zdGFydChzY2VuZUtleXMucmFua2luZywgXy5jbG9uZURlZXAoZGF0YSkpOwogICAgICB9LCAyMDAwKTsKICAgIH0pOwoKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhHYW1lU2NlbmUsIFt7CiAgICBrZXk6ICJzZXRVcEdhbWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFVwR2FtZShnYW1lKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdGhpcy50aW1lciA9IGdhbWUudGltZXI7CiAgICAgIHRoaXMuc2V0dGluZ3MgPSBnYW1lLnNldHRpbmdzOwogICAgICB0aGlzLmN1cnJlbnRQbGF5ZXIgPSBnYW1lLmN1cnJlbnRQbGF5ZXI7CiAgICAgIHRoaXMuc2V0dGluZ3MubWF4VmVsb2NpdHlMaXR0bGUgPSBnYW1lLnNldHRpbmdzLnZlbG9jaXR5ICsgMC4yOwogICAgICB0aGlzLnNldHRpbmdzLmFjY2VsZXJhdGlvbkxpdHRsZSA9IDAuNDsKICAgICAgdGhpcy5zZXR0aW5ncy5yZXNwYXduVGltZSA9IDgwMDA7CiAgICAgIHRoaXMuc2V0dGluZ3MuZnJpY3Rpb25BaXIgPSAwLjE7CiAgICAgIHRoaXMucGxheWVycyA9IHt9OwogICAgICBnYW1lLnBsYXllcnMuZm9yRWFjaChmdW5jdGlvbiAocGxheWVyKSB7CiAgICAgICAgX3RoaXMyLnBsYXllcnNbcGxheWVyLmxvY2FsSWRdID0gXy5jbG9uZURlZXAocGxheWVyKTsKICAgICAgICBfdGhpczIucGxheWVyc1twbGF5ZXIubG9jYWxJZF0uYXZhaWxhYmxlQnVsbGV0cyA9IDM7CiAgICAgICAgX3RoaXMyLnBsYXllcnNbcGxheWVyLmxvY2FsSWRdLmxhc3RUaW1lc3RhbXAgPSAwOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJpbml0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0KGdhbWUpIHsKICAgICAgaWYgKE9iamVjdC5lbnRyaWVzKGdhbWUpLmxlbmd0aCA+IDApIHRoaXMuc2V0VXBHYW1lKGdhbWUpOwogICAgfQogIH0sIHsKICAgIGtleTogInByZWxvYWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHByZWxvYWQoKSB7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgic2hpcDAiLCAiLi9zaGlwcy9zaGlwMC5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJzaGlwMSIsICIuL3NoaXBzL3NoaXAxLnBuZyIpOwogICAgICB0aGlzLmxvYWQuaW1hZ2UoInNoaXAyIiwgIi4vc2hpcHMvc2hpcDIucG5nIik7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgic2hpcDMiLCAiLi9zaGlwcy9zaGlwMy5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJsaXR0bGUwIiwgIi4vbGl0dGxlcy9saXR0bGUwLnBuZyIpOwogICAgICB0aGlzLmxvYWQuaW1hZ2UoImxpdHRsZTEiLCAiLi9saXR0bGVzL2xpdHRsZTEucG5nIik7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgibGl0dGxlMiIsICIuL2xpdHRsZXMvbGl0dGxlMi5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJsaXR0bGUzIiwgIi4vbGl0dGxlcy9saXR0bGUzLnBuZyIpOwogICAgICB0aGlzLmxvYWQuaW1hZ2UoImJ1bGxldCIsICIuL2J1bGxldC5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJidWxsZXQtbG9hZGVkIiwgIi4vYnVsbGV0LWxvYWRlZC5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJibG9jazEiLCAiLi9ibG9jazEucG5nIik7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgiYmxvY2syIiwgIi4vYmxvY2syLnBuZyIpOyAvL3RoaXMubG9hZC5pbWFnZSgiYmxvY2szIiwgIi4vYmxvY2szLnBuZyIpOwogICAgfQogIH0sIHsKICAgIGtleTogImNyZWF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlKCkgewogICAgICAvKmlmKHRoaXMudGltZXIgPiBEYXRlLm5vdygpKXsKICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy51cGRhdGVTaGlwSW50ZXJ2YWwpOwogICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnJlbG9hZEludGVydmFsKTsKICAgICAgICAgIHRoaXMuc2NlbmUuc3RhcnQoc2NlbmVLZXlzLnJhbmtpbmcsIF8uY2xvbmVEZWVwKHsKICAgICAgICAgICAgICBwbGF5ZXJzOiBfLmNsb25lRGVlcCh0aGlzLnBsYXllcnMpLAogICAgICAgICAgICAgIHRpbWVyOiB0aGlzLnRpbWVyCiAgICAgICAgICB9KSk7CiAgICAgIH0qLwogICAgICB0aGlzLmNyZWF0ZUdyb3VwcygpOwogICAgICB0aGlzLmNyZWF0ZVNoaXBzKCk7CiAgICAgIGNyZWF0ZU1hcCh0aGlzKTsKICAgICAgdGhpcy5zZXRLZXlJbnB1dEhhbmRsZXJzKCk7CiAgICAgIGlmICh0aGlzLnRvdWNoU2NyZWVuKSB0aGlzLnNldFRvdWNoSW5wdXRIYW5kbGVycygpOwogICAgICB0aGlzLnBoeXNpY3Mud29ybGQub24oIndvcmxkYm91bmRzIiwgZnVuY3Rpb24gKGJ1bGxldCkgewogICAgICAgIGJ1bGxldC5nYW1lT2JqZWN0LmRlc3Ryb3koKTsKICAgICAgfSk7CiAgICAgIHRoaXMuc2V0UmVsb2FkSW50ZXJ2YWwoKTsKICAgICAgdGhpcy5zZXRVcGRhdGVTaGlwSW50ZXJ2YWwoKTsKICAgICAgdGhpcy5zZXRPbkRlc3Ryb3koKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ1cGRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZSh0aW1lLCBkZWx0YSkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmN1cnJlbnRQbGF5ZXIgIT09IG51bGwpIHsKICAgICAgICBpZiAodGhpcy5yb3RhdGlvbktleS5pc0Rvd24gfHwgdGhpcy5yb3RhdGluZykgdGhpcy5yb3RhdGUoZGVsdGEpOwogICAgICAgIGlmICh0aGlzLmFjY2VsZXJhdGVMaXR0bGVLZXkuaXNEb3duIHx8IHRoaXMuYWNjZWxlcmF0aW5nKSB0aGlzLm1vdmVMaXR0bGUoZGVsdGEpOwogICAgICAgIHRoaXMuc2V0Q3VycmVudFBsYXllck5ld1ZlbG9jaXR5KCk7CiAgICAgICAgaWYgKHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdLnN0YXRlID09PSAxKSB0aGlzLmRlY2VsZXJhdGVMaXR0bGUoZGVsdGEpOwogICAgICB9CgogICAgICBPYmplY3QudmFsdWVzKHRoaXMucGxheWVycykuZm9yRWFjaChmdW5jdGlvbiAocGxheWVyKSB7CiAgICAgICAgdmFyIHRvcExlZnQgPSBwbGF5ZXIuc2hpcC5nZXRUb3BMZWZ0KCk7CiAgICAgICAgdmFyIGJvdHRvbUxlZnQgPSBwbGF5ZXIuc2hpcC5nZXRCb3R0b21MZWZ0KCk7CiAgICAgICAgdmFyIGNlbnRlckxlZnQgPSB7CiAgICAgICAgICB4OiAodG9wTGVmdC54ICsgYm90dG9tTGVmdC54KSAvIDIsCiAgICAgICAgICB5OiAodG9wTGVmdC55ICsgYm90dG9tTGVmdC55KSAvIDIKICAgICAgICB9OwogICAgICAgIHBsYXllci5idWxsZXRzTG9hZGVkLmNoaWxkcmVuLml0ZXJhdGUoZnVuY3Rpb24gKGJ1bGxldCwgaW5kZXgpIHsKICAgICAgICAgIHZhciBfdGhpczMkZ2V0TG9hZGVkQnVsbGUgPSBfdGhpczMuZ2V0TG9hZGVkQnVsbGV0UG9zaXRpb24oaW5kZXgsIHRvcExlZnQsIGJvdHRvbUxlZnQsIGNlbnRlckxlZnQsIHBsYXllciksCiAgICAgICAgICAgICAgeCA9IF90aGlzMyRnZXRMb2FkZWRCdWxsZS54LAogICAgICAgICAgICAgIHkgPSBfdGhpczMkZ2V0TG9hZGVkQnVsbGUueTsKCiAgICAgICAgICBidWxsZXQueCA9IHg7CiAgICAgICAgICBidWxsZXQueSA9IHk7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChwbGF5ZXIubG9jYWxJZCAhPT0gX3RoaXMzLmN1cnJlbnRQbGF5ZXIpIHsKICAgICAgICAgIHBsYXllci5zaGlwLmF1dG9ub215VGltZSAtPSBkZWx0YTsKCiAgICAgICAgICBpZiAocGxheWVyLnNoaXAuYXV0b25vbXlUaW1lIDwgMCkgewogICAgICAgICAgICBwbGF5ZXIuc2hpcC5zZXRWZWxvY2l0eSgwKTsKICAgICAgICAgICAgcGxheWVyLnNoaXAuc2V0QW5ndWxhclZlbG9jaXR5KDApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9IC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vQ3JlYXRpbmcgdGhpbmdzCgogIH0sIHsKICAgIGtleTogImNyZWF0ZUdyb3VwcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlR3JvdXBzKCkgewogICAgICB0aGlzLnNoaXBzID0gdGhpcy5waHlzaWNzLmFkZC5ncm91cCgpOwogICAgICB0aGlzLmJ1bGxldHMgPSB0aGlzLnBoeXNpY3MuYWRkLmdyb3VwKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY3JlYXRlU2hpcHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZVNoaXBzKCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIHZhciBpbmRleCA9IDA7CiAgICAgIHZhciB0ZXh0dXJlcyA9IFsiIiwgImxpdHRsZSIsICJzaGlwIl07CiAgICAgIE9iamVjdC52YWx1ZXModGhpcy5wbGF5ZXJzKS5mb3JFYWNoKGZ1bmN0aW9uIChwbGF5ZXIpIHsKICAgICAgICBwbGF5ZXIuc2hpcCA9IF90aGlzNC5zaGlwcy5jcmVhdGUoaW5kZXggPCAyID8gMzAgOiAxMTcwLCBpbmRleCAlIDIgPT09IDAgPyAzMCA6IDExNzAsIHRleHR1cmVzW3BsYXllci5zdGF0ZV0gKyBwbGF5ZXIuY29sb3IpOwoKICAgICAgICBpZiAocGxheWVyLnN0YXRlID09PSAwKSB7CiAgICAgICAgICBfdGhpczQuc2hpcHMua2lsbEFuZEhpZGUocGxheWVyLnNoaXApOwoKICAgICAgICAgIF90aGlzNC5zaGlwcy5yZW1vdmUocGxheWVyLnNoaXApOwogICAgICAgIH0KCiAgICAgICAgcGxheWVyLmJ1bGxldHNMb2FkZWQgPSBfdGhpczQucGh5c2ljcy5hZGQuZ3JvdXAoewogICAgICAgICAga2V5OiAiYnVsbGV0LWxvYWRlZCIsCiAgICAgICAgICBxdWFudGl0eTogMywKICAgICAgICAgIHZpc2libGU6IHBsYXllci5zdGF0ZSAhPT0gMCwKICAgICAgICAgIGFjdGl2ZTogcGxheWVyLnN0YXRlICE9PSAwCiAgICAgICAgfSk7CiAgICAgICAgcGxheWVyLnNoaXAubG9jYWxJZCA9IHBsYXllci5sb2NhbElkOwogICAgICAgIHBsYXllci5zaGlwLnNldEFuZ2xlKC00NSAqIChpbmRleCA8IDIgPyAxIDogMykgKiAoaW5kZXggJSAyICogMiAtIDEpKTsKICAgICAgICBwbGF5ZXIuc2hpcC52ZWxvY2l0eU1hZ25pdHVkZSA9IF90aGlzNC5zZXR0aW5ncy52ZWxvY2l0eSAqIG5vcm1hbGl6ZXJzLnZlbG9jaXR5OwogICAgICAgIHBsYXllci5zaGlwLmF1dG9ub215VGltZSA9IDA7CiAgICAgICAgcGxheWVyLnNoaXAuc2V0Q29sbGlkZVdvcmxkQm91bmRzKHRydWUpOwoKICAgICAgICBpZiAocGxheWVyLmxvY2FsSWQgPT09IF90aGlzNC5jdXJyZW50UGxheWVyKSB7CiAgICAgICAgICBfdGhpczQucGh5c2ljcy5hZGQub3ZlcmxhcChwbGF5ZXIuc2hpcCwgX3RoaXM0LmJ1bGxldHMsIGZ1bmN0aW9uIChzaGlwLCBidWxsZXQpIHsKICAgICAgICAgICAgX3RoaXM0Lm9uQnVsbGV0Q29sbGlzaW9uKHNoaXAsIGJ1bGxldCk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBfdGhpczQucGh5c2ljcy5hZGQuY29sbGlkZXIocGxheWVyLnNoaXAsIF90aGlzNC5zaGlwcywgZnVuY3Rpb24gKGN1cnJlbnRTaGlwLCBzaGlwKSB7CiAgICAgICAgICAgIGlmIChfdGhpczQucGxheWVyc1tfdGhpczQuY3VycmVudFBsYXllcl0uc3RhdGUgPT09IDEgJiYgX3RoaXM0LnBsYXllcnNbc2hpcC5sb2NhbElkXS5zdGF0ZSA+PSAyKSB7CiAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7CiAgICAgICAgICAgICAgICBsb2NhbElkOiBfdGhpczQuY3VycmVudFBsYXllciwKICAgICAgICAgICAgICAgIHN0YXRlOiAwLAogICAgICAgICAgICAgICAga2lsbGVkQnk6IHNoaXAubG9jYWxJZAogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIF90aGlzNC5zb2NrZXQuZW1pdCh3ZWJzb2NrZXRFdmVudHMuQ0hBTkdFX1NUQVRFLCBkYXRhKTsKCiAgICAgICAgICAgICAgX3RoaXM0LnVwZGF0ZVN0YXRlKGRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGluZGV4Kys7CiAgICAgIH0pOwogICAgICB0aGlzLnBoeXNpY3MuYWRkLmNvbGxpZGVyKHRoaXMuc2hpcHMsIHRoaXMuc2hpcHMpOwogICAgfQogIH0sIHsKICAgIGtleTogImNyZWF0ZUJ1bGxldCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlQnVsbGV0KGRhdGEpIHsKICAgICAgdmFyIF90aGlzJHBoeXNpY3MkdmVsb2NpdCA9IHRoaXMucGh5c2ljcy52ZWxvY2l0eUZyb21BbmdsZShkYXRhLmFuZ2xlLCB0aGlzLnNldHRpbmdzLmJ1bGxldFZlbG9jaXR5ICogbm9ybWFsaXplcnMuYnVsbGV0VmVsb2NpdHkpLAogICAgICAgICAgeCA9IF90aGlzJHBoeXNpY3MkdmVsb2NpdC54LAogICAgICAgICAgeSA9IF90aGlzJHBoeXNpY3MkdmVsb2NpdC55OwoKICAgICAgdmFyIGJ1bGxldCA9IHRoaXMuYnVsbGV0cy5jcmVhdGUoZGF0YS5wb3NpdGlvbi54LCBkYXRhLnBvc2l0aW9uLnksICJidWxsZXQiKTsKICAgICAgYnVsbGV0LmFuZ2xlID0gZGF0YS5hbmdsZTsKICAgICAgYnVsbGV0LnNldFZlbG9jaXR5KHgsIHkpOwogICAgICBidWxsZXQuc2hvdEJ5ID0gZGF0YS5sb2NhbElkOwogICAgICBidWxsZXQuc2V0Q29sbGlkZVdvcmxkQm91bmRzKHRydWUpOwogICAgICBidWxsZXQuYm9keS5vbldvcmxkQm91bmRzID0gdHJ1ZTsKICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uYXZhaWxhYmxlQnVsbGV0cy0tOwogICAgICB2YXIgZmlyc3RBbGl2ZSA9IHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmJ1bGxldHNMb2FkZWQuZ2V0Rmlyc3RBbGl2ZSgpOwoKICAgICAgaWYgKGZpcnN0QWxpdmUpIHsKICAgICAgICBmaXJzdEFsaXZlLnNldEFjdGl2ZShmYWxzZSkuc2V0VmlzaWJsZShmYWxzZSk7CiAgICAgIH0KICAgIH0gLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy9PdGhlcnMgZG8gdGhpbmdzIHZpYSB0aGUgd2Vic29ja2V0CgogIH0sIHsKICAgIGtleTogInVwZGF0ZVNoaXAiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZVNoaXAoZGF0YSkgewogICAgICB2YXIgcGxheWVyID0gdGhpcy5wbGF5ZXJzW2RhdGFbMF1dOwogICAgICB2YXIgZGVsdGFUaW1lID0gKGRhdGFbM10gLSBwbGF5ZXIubGFzdFRpbWVzdGFtcCkgLyAxMDAwOwogICAgICBpZiAoZGVsdGFUaW1lIDw9IDApIHJldHVybjsKICAgICAgdmFyIGRlbHRhVGhldGEgPSBkYXRhWzFdIC0gTnVtYmVyLnBhcnNlSW50KHBsYXllci5zaGlwLmFuZ2xlKTsKICAgICAgaWYgKGRlbHRhVGhldGEgPCAtMTApIGRlbHRhVGhldGEgKz0gMzYwO2Vsc2UgaWYgKGRlbHRhVGhldGEgPCAwKSBkZWx0YVRoZXRhID0gMDsKICAgICAgdmFyIGFuZ3VsYXJWZWxvY2l0eSA9IGRlbHRhVGhldGEgLyBkZWx0YVRpbWU7CiAgICAgIHBsYXllci5zaGlwLnNldEFuZ3VsYXJWZWxvY2l0eShhbmd1bGFyVmVsb2NpdHkpOwogICAgICBwbGF5ZXIuc2hpcC5zZXRWZWxvY2l0eSgoZGF0YVsyXVswXSAtIHBsYXllci5zaGlwLngpIC8gZGVsdGFUaW1lLCAoZGF0YVsyXVsxXSAtIHBsYXllci5zaGlwLnkpIC8gZGVsdGFUaW1lKTsKICAgICAgcGxheWVyLmxhc3RUaW1lc3RhbXAgPSBkYXRhWzNdOwogICAgICBwbGF5ZXIuc2hpcC5hdXRvbm9teVRpbWUgPSBkZWx0YVRpbWUgKiAxMDAwOwogICAgfSAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAvL0N1cnJlbnQgcGxheWVycyBkb2VzIHRoaW5ncwoKICB9LCB7CiAgICBrZXk6ICJyb3RhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJvdGF0ZShkZWx0YSkgewogICAgICB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwLmFuZ2xlICs9IGRlbHRhICogdGhpcy5zZXR0aW5ncy5hbmd1bGFyVmVsb2NpdHkgKiBub3JtYWxpemVycy5hbmd1bGFyVmVsb2NpdHk7CiAgICB9CiAgfSwgewogICAga2V5OiAibW92ZUxpdHRsZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbW92ZUxpdHRsZShkZWx0YSkgewogICAgICB2YXIgY3VycmVudFBsYXllciA9IHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdOwoKICAgICAgaWYgKGN1cnJlbnRQbGF5ZXIuc3RhdGUgPT09IDEpIHsKICAgICAgICB2YXIgc2hpcCA9IGN1cnJlbnRQbGF5ZXIuc2hpcDsKICAgICAgICB2YXIgcHJldmlvdXNNYWcgPSBzaGlwLnZlbG9jaXR5TWFnbml0dWRlOwoKICAgICAgICBpZiAocHJldmlvdXNNYWcgPCB0aGlzLnNldHRpbmdzLm1heFZlbG9jaXR5TGl0dGxlICogbm9ybWFsaXplcnMudmVsb2NpdHkpIHsKICAgICAgICAgIGN1cnJlbnRQbGF5ZXIuc2hpcC52ZWxvY2l0eU1hZ25pdHVkZSArPSBkZWx0YSAqIHRoaXMuc2V0dGluZ3MuYWNjZWxlcmF0aW9uTGl0dGxlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjdXJyZW50UGxheWVyLnNoaXAudmVsb2NpdHlNYWduaXR1ZGUgPSB0aGlzLnNldHRpbmdzLm1heFZlbG9jaXR5TGl0dGxlICogbm9ybWFsaXplcnMudmVsb2NpdHk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAic2hvb3QiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNob290KCkgewogICAgICB2YXIgY3VycmVudFBsYXllciA9IHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdOwoKICAgICAgaWYgKGN1cnJlbnRQbGF5ZXIuYXZhaWxhYmxlQnVsbGV0cyA+IDApIHsKICAgICAgICB2YXIgc2hpcCA9IGN1cnJlbnRQbGF5ZXIuc2hpcDsKICAgICAgICB2YXIgYW5nbGUgPSBzaGlwLmFuZ2xlOwogICAgICAgIHZhciBkYXRhID0gewogICAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgICAgeDogc2hpcC54ICsgc2hpcC53aWR0aCAqIE1hdGguY29zKGFuZ2xlICogTWF0aC5QSSAvIDE4MCksCiAgICAgICAgICAgIHk6IHNoaXAueSArIHNoaXAuaGVpZ2h0ICogTWF0aC5zaW4oYW5nbGUgKiBNYXRoLlBJIC8gMTgwKQogICAgICAgICAgfSwKICAgICAgICAgIGFuZ2xlOiBhbmdsZSwKICAgICAgICAgIGxvY2FsSWQ6IHRoaXMuY3VycmVudFBsYXllcgogICAgICAgIH07CiAgICAgICAgdGhpcy5zb2NrZXQuZW1pdCh3ZWJzb2NrZXRFdmVudHMuU0hPT1QsIGRhdGEpOwogICAgICAgIHRoaXMuY3JlYXRlQnVsbGV0KGRhdGEpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAidXBkYXRlU3RhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZVN0YXRlKGRhdGEpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICB0aGlzLnBsYXllcnNbZGF0YS5sb2NhbElkXS5zdGF0ZSA9IGRhdGEuc3RhdGU7CiAgICAgIHZhciBwbGF5ZXIgPSB0aGlzLnBsYXllcnNbZGF0YS5sb2NhbElkXTsKCiAgICAgIHN3aXRjaCAoZGF0YS5zdGF0ZSkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIHRoaXMuc2hpcHMua2lsbEFuZEhpZGUocGxheWVyLnNoaXApOwogICAgICAgICAgdGhpcy5zaGlwcy5yZW1vdmUocGxheWVyLnNoaXApOwogICAgICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uYnVsbGV0c0xvYWRlZC5raWxsQWxsKCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAxOgogICAgICAgICAgcGxheWVyLnNoaXAuc2V0VGV4dHVyZSgibGl0dGxlIiArIHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmNvbG9yKTsKICAgICAgICAgIHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmJ1bGxldHNMb2FkZWQua2lsbEFsbCgpOwoKICAgICAgICAgIGlmIChkYXRhLmxvY2FsSWQgPT09IHRoaXMuY3VycmVudFBsYXllcikgewogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBpZiAoX3RoaXM1LnBsYXllcnNbZGF0YS5sb2NhbElkXS5zdGF0ZSA9PT0gMSkgewogICAgICAgICAgICAgICAgdmFyIF9kYXRhID0gewogICAgICAgICAgICAgICAgICBsb2NhbElkOiBfdGhpczUuY3VycmVudFBsYXllciwKICAgICAgICAgICAgICAgICAgc3RhdGU6IDIKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgX3RoaXM1LnVwZGF0ZVN0YXRlKF9kYXRhKTsKCiAgICAgICAgICAgICAgICBfdGhpczUuc29ja2V0LmVtaXQod2Vic29ja2V0RXZlbnRzLkNIQU5HRV9TVEFURSwgX2RhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgdGhpcy5zZXR0aW5ncy5yZXNwYXduVGltZSk7CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgMjoKICAgICAgICAgIHBsYXllci5zaGlwLnZlbG9jaXR5TWFnbml0dWRlID0gdGhpcy5zZXR0aW5ncy52ZWxvY2l0eSAqIG5vcm1hbGl6ZXJzLnZlbG9jaXR5OwogICAgICAgICAgcGxheWVyLnNoaXAuc2V0VGV4dHVyZSgic2hpcCIgKyB0aGlzLnBsYXllcnNbZGF0YS5sb2NhbElkXS5jb2xvcik7CiAgICAgICAgICBwbGF5ZXIuYnVsbGV0c0xvYWRlZC5lbmFibGVBbGwoKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAib25CdWxsZXRDb2xsaXNpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uQnVsbGV0Q29sbGlzaW9uKHNoaXAsIGJ1bGxldCkgewogICAgICBidWxsZXQuZGVzdHJveSgpOwogICAgICB2YXIgc3RhdGUgPSB0aGlzLnBsYXllcnNbc2hpcC5sb2NhbElkXS5zdGF0ZSAtIDE7CiAgICAgIHZhciBkYXRhID0gewogICAgICAgIGxvY2FsSWQ6IHNoaXAubG9jYWxJZCwKICAgICAgICBzdGF0ZTogc3RhdGUKICAgICAgfTsKCiAgICAgIGlmIChzdGF0ZSA9PT0gMCkgewogICAgICAgIGRhdGEua2lsbGVkQnkgPSBidWxsZXQuc2hvdEJ5OwogICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5yZWxvYWRJbnRlcnZhbCk7CiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnVwZGF0ZVNoaXBJbnRlcnZhbCk7CiAgICAgIH0KCiAgICAgIHRoaXMuc29ja2V0LmVtaXQod2Vic29ja2V0RXZlbnRzLkNIQU5HRV9TVEFURSwgZGF0YSk7CiAgICAgIHRoaXMudXBkYXRlU3RhdGUoZGF0YSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVsb2FkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZWxvYWQoZGF0YSkgewogICAgICB0aGlzLnBsYXllcnNbZGF0YS5sb2NhbElkXS5hdmFpbGFibGVCdWxsZXRzID0gZGF0YS5hdmFpbGFibGVCdWxsZXRzOwoKICAgICAgdHJ5IHsKICAgICAgICB3aGlsZSAodGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uYnVsbGV0c0xvYWRlZC5jb3VudEFjdGl2ZSgpIDwgZGF0YS5hdmFpbGFibGVCdWxsZXRzKSB7CiAgICAgICAgICB0aGlzLnBsYXllcnNbZGF0YS5sb2NhbElkXS5idWxsZXRzTG9hZGVkLmdldEZpcnN0RGVhZCgpLnNldEFjdGl2ZSh0cnVlKS5zZXRWaXNpYmxlKHRydWUpOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICB9CiAgICB9IC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vR2FtZSBsb29wIGZ1bmN0aW9ucwoKICB9LCB7CiAgICBrZXk6ICJzZXRDdXJyZW50UGxheWVyTmV3VmVsb2NpdHkiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldEN1cnJlbnRQbGF5ZXJOZXdWZWxvY2l0eSgpIHsKICAgICAgdmFyIF90aGlzJHBoeXNpY3MkdmVsb2NpdDIgPSB0aGlzLnBoeXNpY3MudmVsb2NpdHlGcm9tQW5nbGUodGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc2hpcC5hbmdsZSwgdGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc2hpcC52ZWxvY2l0eU1hZ25pdHVkZSksCiAgICAgICAgICB4ID0gX3RoaXMkcGh5c2ljcyR2ZWxvY2l0Mi54LAogICAgICAgICAgeSA9IF90aGlzJHBoeXNpY3MkdmVsb2NpdDIueTsKCiAgICAgIHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdLnNoaXAuc2V0VmVsb2NpdHkoeCwgeSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZGVjZWxlcmF0ZUxpdHRsZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGVjZWxlcmF0ZUxpdHRsZShkZWx0YSkgewogICAgICB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwLnZlbG9jaXR5TWFnbml0dWRlID0gTWF0aC5tYXgoMCwgdGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc2hpcC52ZWxvY2l0eU1hZ25pdHVkZSAtIHRoaXMuc2V0dGluZ3MuZnJpY3Rpb25BaXIgKiBkZWx0YSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0TG9hZGVkQnVsbGV0UG9zaXRpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldExvYWRlZEJ1bGxldFBvc2l0aW9uKGluZGV4LCB0b3BMZWZ0LCBib3R0b21MZWZ0LCBjZW50ZXJMZWZ0LCBwbGF5ZXIpIHsKICAgICAgc3dpdGNoIChpbmRleCkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHg6IGJvdHRvbUxlZnQueCAtIHBsYXllci5zaGlwLndpZHRoIC8gNCAqIE1hdGguY29zKHBsYXllci5zaGlwLnJvdGF0aW9uKSwKICAgICAgICAgICAgeTogYm90dG9tTGVmdC55IC0gcGxheWVyLnNoaXAuaGVpZ2h0IC8gNCAqIE1hdGguc2luKHBsYXllci5zaGlwLnJvdGF0aW9uKQogICAgICAgICAgfTsKCiAgICAgICAgY2FzZSAxOgogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgeDogdG9wTGVmdC54IC0gcGxheWVyLnNoaXAud2lkdGggLyA0ICogTWF0aC5jb3MocGxheWVyLnNoaXAucm90YXRpb24pLAogICAgICAgICAgICB5OiB0b3BMZWZ0LnkgLSBwbGF5ZXIuc2hpcC5oZWlnaHQgLyA0ICogTWF0aC5zaW4ocGxheWVyLnNoaXAucm90YXRpb24pCiAgICAgICAgICB9OwoKICAgICAgICBjYXNlIDI6CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB4OiBjZW50ZXJMZWZ0LnggLSBwbGF5ZXIuc2hpcC53aWR0aCAvIDQgKiBNYXRoLmNvcyhwbGF5ZXIuc2hpcC5yb3RhdGlvbiksCiAgICAgICAgICAgIHk6IGNlbnRlckxlZnQueSAtIHBsYXllci5zaGlwLmhlaWdodCAvIDQgKiBNYXRoLnNpbihwbGF5ZXIuc2hpcC5yb3RhdGlvbikKICAgICAgICAgIH07CiAgICAgIH0KICAgIH0gLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy9PbiBjcmVhdGUgc2V0dXAKCiAgfSwgewogICAga2V5OiAic2V0S2V5SW5wdXRIYW5kbGVycyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0S2V5SW5wdXRIYW5kbGVycygpIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CgogICAgICBpZiAodGhpcy5jdXJyZW50UGxheWVyID09PSBudWxsKSByZXR1cm47CiAgICAgIHRoaXMucm90YXRpb25LZXkgPSB0aGlzLmlucHV0LmtleWJvYXJkLmFkZEtleShQaGFzZXIuSW5wdXQuS2V5Ym9hcmQuS2V5Q29kZXMuU1BBQ0UpOwogICAgICB0aGlzLmFjY2VsZXJhdGVMaXR0bGVLZXkgPSB0aGlzLmlucHV0LmtleWJvYXJkLmFkZEtleShQaGFzZXIuSW5wdXQuS2V5Ym9hcmQuS2V5Q29kZXMuRU5URVIpOwogICAgICB0aGlzLmlucHV0LmtleWJvYXJkLm9uKCJrZXl1cC1FTlRFUiIsIGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoX3RoaXM2LnBsYXllcnNbX3RoaXM2LmN1cnJlbnRQbGF5ZXJdLnN0YXRlID49IDIpIF90aGlzNi5zaG9vdCgpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRUb3VjaElucHV0SGFuZGxlcnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFRvdWNoSW5wdXRIYW5kbGVycygpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICBpZiAodGhpcy5jdXJyZW50UGxheWVyID09PSBudWxsKSByZXR1cm47CiAgICAgIHRoaXMuaW5wdXQuYWRkUG9pbnRlcigxKTsKICAgICAgdGhpcy5pbnB1dC5vbigicG9pbnRlcmRvd24iLCBmdW5jdGlvbiAocG9pbnRlcikgewogICAgICAgIGlmIChwb2ludGVyLnggPCBnYW1lRGltZW5zaW9ucy53aWR0aCAvIDIpIHsKICAgICAgICAgIF90aGlzNy5yb3RhdGluZyA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChfdGhpczcucGxheWVyc1tfdGhpczcuY3VycmVudFBsYXllcl0uc3RhdGUgPj0gMikgX3RoaXM3LnNob290KCk7ZWxzZSB7CiAgICAgICAgICAgIF90aGlzNy5hY2NlbGVyYXRpbmcgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMuaW5wdXQub24oInBvaW50ZXJ1cCIsIGZ1bmN0aW9uIChwb2ludGVyKSB7CiAgICAgICAgaWYgKHBvaW50ZXIueCA8IGdhbWVEaW1lbnNpb25zLndpZHRoIC8gMikgewogICAgICAgICAgX3RoaXM3LnJvdGF0aW5nID0gZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF90aGlzNy5hY2NlbGVyYXRpbmcgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogInNldFVwZGF0ZVNoaXBJbnRlcnZhbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0VXBkYXRlU2hpcEludGVydmFsKCkgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmN1cnJlbnRQbGF5ZXIgPT09IG51bGwpIHJldHVybjsKICAgICAgdmFyIGN1cnJlbnRQbGF5ZXIgPSB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXTsKICAgICAgdGhpcy51cGRhdGVTaGlwSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXM4LnNvY2tldC5lbWl0KHdlYnNvY2tldEV2ZW50cy5VUERBVEVfU0hJUCwgW190aGlzOC5jdXJyZW50UGxheWVyLCBOdW1iZXIucGFyc2VJbnQoY3VycmVudFBsYXllci5zaGlwLmFuZ2xlKSwgW051bWJlci5wYXJzZUZsb2F0KGN1cnJlbnRQbGF5ZXIuc2hpcC54LnRvRml4ZWQoMikpLCBOdW1iZXIucGFyc2VGbG9hdChjdXJyZW50UGxheWVyLnNoaXAueS50b0ZpeGVkKDIpKV0sIF90aGlzOC50aW1lLm5vd10pOwogICAgICB9LCAxMDAwIC8gdGhpcy51cGRhdGVGcHMpOwogICAgfQogIH0sIHsKICAgIGtleTogInNldFJlbG9hZEludGVydmFsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRSZWxvYWRJbnRlcnZhbCgpIHsKICAgICAgdmFyIF90aGlzOSA9IHRoaXM7CgogICAgICBpZiAodGhpcy5jdXJyZW50UGxheWVyID09PSBudWxsKSByZXR1cm47CiAgICAgIHRoaXMucmVsb2FkSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKF90aGlzOS5wbGF5ZXJzW190aGlzOS5jdXJyZW50UGxheWVyXS5zdGF0ZSA8IDIpIHJldHVybjsKICAgICAgICB2YXIgYXZhaWxhYmxlQnVsbGV0cyA9IE1hdGgubWluKDMsIF90aGlzOS5wbGF5ZXJzW190aGlzOS5jdXJyZW50UGxheWVyXS5hdmFpbGFibGVCdWxsZXRzICsgMSk7CiAgICAgICAgdmFyIGRhdGEgPSB7CiAgICAgICAgICBsb2NhbElkOiBfdGhpczkuY3VycmVudFBsYXllciwKICAgICAgICAgIGF2YWlsYWJsZUJ1bGxldHM6IGF2YWlsYWJsZUJ1bGxldHMKICAgICAgICB9OwoKICAgICAgICBfdGhpczkuc29ja2V0LmVtaXQod2Vic29ja2V0RXZlbnRzLlJFTE9BRCwgZGF0YSk7CgogICAgICAgIF90aGlzOS5yZWxvYWQoZGF0YSk7CiAgICAgIH0sIDEgLyAodGhpcy5zZXR0aW5ncy5yZWxvYWRpbmdWZWxvY2l0eSAqIG5vcm1hbGl6ZXJzLnJlbG9hZGluZ1ZlbG9jaXR5KSk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0T25EZXN0cm95IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRPbkRlc3Ryb3koKSB7CiAgICAgIHZhciBfdGhpczEwID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmN1cnJlbnRQbGF5ZXIgPT09IG51bGwpIHJldHVybjsKICAgICAgdGhpcy5ldmVudHMub24oImRlc3Ryb3kiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgY2xlYXJJbnRlcnZhbChfdGhpczEwLnVwZGF0ZVNoaXBJbnRlcnZhbCk7CiAgICAgICAgY2xlYXJJbnRlcnZhbChfdGhpczEwLnJlbG9hZEludGVydmFsKTsKICAgICAgfSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gR2FtZVNjZW5lOwp9KFBoYXNlci5TY2VuZSk7CgpleHBvcnQgeyBHYW1lU2NlbmUgYXMgZGVmYXVsdCB9Ow=="},{"version":3,"sources":["/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/GameScene.js"],"names":["Phaser","websocketEvents","gameDimensions","normalizers","sceneKeys","detectTouchScreen","_","createMap","GameScene","socket","game","key","setUpGame","updateFps","touchScreen","Physics","Arcade","Group","prototype","killAll","countActive","getFirstAlive","setActive","setVisible","enableAll","getFirstDead","on","UPDATE_SHIP","data","updateShip","SHOOT","createBullet","CHANGE_STATE","updateState","RELOAD","reload","END_TURN","setTimeout","clearInterval","updateShipInterval","reloadInterval","scene","start","ranking","cloneDeep","timer","settings","currentPlayer","maxVelocityLittle","velocity","accelerationLittle","respawnTime","frictionAir","players","forEach","player","localId","availableBullets","lastTimestamp","Object","entries","length","load","image","createGroups","createShips","setKeyInputHandlers","setTouchInputHandlers","physics","world","bullet","gameObject","destroy","setReloadInterval","setUpdateShipInterval","setOnDestroy","time","delta","rotationKey","isDown","rotating","rotate","accelerateLittleKey","accelerating","moveLittle","setCurrentPlayerNewVelocity","state","decelerateLittle","values","topLeft","ship","getTopLeft","bottomLeft","getBottomLeft","centerLeft","x","y","bulletsLoaded","children","iterate","index","getLoadedBulletPosition","autonomyTime","setVelocity","setAngularVelocity","ships","add","group","bullets","textures","create","color","killAndHide","remove","quantity","visible","active","setAngle","velocityMagnitude","setCollideWorldBounds","overlap","onBulletCollision","collider","currentShip","killedBy","emit","velocityFromAngle","angle","bulletVelocity","position","shotBy","body","onWorldBounds","firstAlive","deltaTime","deltaTheta","Number","parseInt","angularVelocity","previousMag","width","Math","cos","PI","height","sin","setTexture","e","console","log","max","rotation","input","keyboard","addKey","Input","Keyboard","KeyCodes","SPACE","ENTER","shoot","addPointer","pointer","setInterval","parseFloat","toFixed","now","min","reloadingVelocity","events","Scene"],"mappings":"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","sourcesContent":["import * as Phaser from \"phaser\";\nimport websocketEvents from \"../constants/websocketEvents\";\nimport {gameDimensions, normalizers, sceneKeys} from \"../constants/gameSettings\";\nimport {detectTouchScreen} from \"../constants/constants\";\nimport _ from \"lodash\";\nimport createMap from \"../phaser/maps\";\n\n\nexport default class GameScene extends Phaser.Scene {\n\n    setUpGame(game){\n        this.timer = game.timer;\n        this.settings = game.settings;\n        this.currentPlayer = game.currentPlayer;\n        this.settings.maxVelocityLittle = game.settings.velocity+0.2;\n        this.settings.accelerationLittle = 0.4;\n        this.settings.respawnTime = 8000;\n        this.settings.frictionAir = 0.1;\n        this.players = {};\n        game.players.forEach(player => {\n            this.players[player.localId] = _.cloneDeep(player);\n            this.players[player.localId].availableBullets = 3;\n            this.players[player.localId].lastTimestamp = 0;\n        });\n    }\n\n    constructor(socket, game) {\n        super({key: sceneKeys.game});\n\n        this.socket = socket;\n        this.setUpGame(game);\n\n        this.updateFps = 10;\n        this.touchScreen = detectTouchScreen();\n        \n        Phaser.Physics.Arcade.Group.prototype.killAll = function () {\n            while(this.countActive()>0){\n                this.getFirstAlive().setActive(false).setVisible(false);\n            }\n        }\n\n        Phaser.Physics.Arcade.Group.prototype.enableAll = function () {\n            while(this.countActive()<3){\n                this.getFirstDead().setActive(true).setVisible(true);\n            }\n        }\n\n        this.socket.on(websocketEvents.UPDATE_SHIP, data => this.updateShip(data));\n        this.socket.on(websocketEvents.SHOOT, data => this.createBullet(data));\n        this.socket.on(websocketEvents.CHANGE_STATE, data => this.updateState(data));\n        this.socket.on(websocketEvents.RELOAD, data => this.reload(data));\n        this.socket.on(websocketEvents.END_TURN, data => {\n            setTimeout(()=>{\n                clearInterval(this.updateShipInterval);\n                clearInterval(this.reloadInterval);\n                this.scene.start(sceneKeys.ranking, _.cloneDeep(data));\n            }, 2000);\n        });\n    }\n\n    init(game){\n        if(Object.entries(game).length>0) this.setUpGame(game);\n    }\n\n    preload(){\n\n        this.load.image(\"ship0\", \"./ships/ship0.png\");\n        this.load.image(\"ship1\", \"./ships/ship1.png\");\n        this.load.image(\"ship2\", \"./ships/ship2.png\");\n        this.load.image(\"ship3\", \"./ships/ship3.png\");\n        this.load.image(\"little0\", \"./littles/little0.png\");\n        this.load.image(\"little1\", \"./littles/little1.png\");\n        this.load.image(\"little2\", \"./littles/little2.png\");\n        this.load.image(\"little3\", \"./littles/little3.png\");\n        this.load.image(\"bullet\", \"./bullet.png\");\n        this.load.image(\"bullet-loaded\", \"./bullet-loaded.png\");\n\n        this.load.image(\"block1\", \"./block1.png\");\n        this.load.image(\"block2\", \"./block2.png\");\n        //this.load.image(\"block3\", \"./block3.png\");\n    }\n\n    create(){\n        /*if(this.timer > Date.now()){\n            clearInterval(this.updateShipInterval);\n            clearInterval(this.reloadInterval);\n            this.scene.start(sceneKeys.ranking, _.cloneDeep({\n                players: _.cloneDeep(this.players),\n                timer: this.timer\n            }));\n        }*/\n\n        this.createGroups();\n        this.createShips();\n        createMap(this);\n\n        this.setKeyInputHandlers();\n        if(this.touchScreen) this.setTouchInputHandlers();\n\n        this.physics.world.on(\"worldbounds\", (bullet)=>{bullet.gameObject.destroy()});\n\n        this.setReloadInterval();\n        this.setUpdateShipInterval();\n\n        this.setOnDestroy();\n    }\n\n    update(time, delta){\n        if(this.currentPlayer !== null) {\n            if (this.rotationKey.isDown || this.rotating) this.rotate(delta);\n            if (this.accelerateLittleKey.isDown || this.accelerating) this.moveLittle(delta);\n\n            this.setCurrentPlayerNewVelocity();\n            if (this.players[this.currentPlayer].state === 1) this.decelerateLittle(delta);\n        }\n\n        Object.values(this.players).forEach(player => {\n            const topLeft = player.ship.getTopLeft();\n            const bottomLeft = player.ship.getBottomLeft();\n            const centerLeft = {\n                x: (topLeft.x + bottomLeft.x) / 2,\n                y: (topLeft.y + bottomLeft.y) / 2\n            }\n            player.bulletsLoaded.children.iterate((bullet, index)=>{\n                const {x, y} = this.getLoadedBulletPosition(index, topLeft, bottomLeft, centerLeft, player);\n                bullet.x = x;\n                bullet.y = y;\n\n            });\n           if(player.localId!==this.currentPlayer){\n               player.ship.autonomyTime -= delta;\n               if(player.ship.autonomyTime<0) {\n                   player.ship.setVelocity(0);\n                   player.ship.setAngularVelocity(0);\n               }\n           }\n        });\n    }\n\n\n\n\n    //=============================================================================\n    //Creating things\n    createGroups(){\n        this.ships = this.physics.add.group();\n        this.bullets = this.physics.add.group();\n    }\n\n    createShips(){\n        let index = 0;\n        const textures = [\"\", \"little\", \"ship\"];\n        Object.values(this.players).forEach(player => {\n            player.ship = this.ships.create(\n                (index<2 ? 30 : 1170),\n                ( index%2 === 0 ? 30 : 1170 ),\n                textures[player.state]+player.color\n            );\n            \n            if(player.state === 0) {\n                this.ships.killAndHide(player.ship);\n                this.ships.remove(player.ship);\n            }\n\n            player.bulletsLoaded = this.physics.add.group({\n                key: \"bullet-loaded\",\n                quantity: 3,\n                visible: player.state!==0,\n                active: player.state!==0\n            });\n\n            player.ship.localId = player.localId;\n            player.ship.setAngle(-45  * ( index < 2 ? 1 : 3) * ( ( index % 2 ) * 2 - 1 ));\n            player.ship.velocityMagnitude = this.settings.velocity*normalizers.velocity;\n            player.ship.autonomyTime = 0;\n            player.ship.setCollideWorldBounds(true);\n\n            if(player.localId===this.currentPlayer){\n                this.physics.add.overlap(player.ship, this.bullets, (ship, bullet) => {\n                    this.onBulletCollision(ship, bullet);\n                });\n                this.physics.add.collider(player.ship, this.ships, (currentShip, ship)=>{\n                    if(this.players[this.currentPlayer].state === 1 && this.players[ship.localId].state >= 2){\n                        const data = {\n                            localId: this.currentPlayer,\n                            state: 0,\n                            killedBy: ship.localId\n                        };\n                        this.socket.emit(websocketEvents.CHANGE_STATE, data);\n                        this.updateState(data);\n                    }\n                });\n            }\n\n            index++;\n        });\n\n        this.physics.add.collider(this.ships, this.ships);\n    }\n\n    createBullet(data){\n        const {x, y} = this.physics.velocityFromAngle(data.angle, this.settings.bulletVelocity*normalizers.bulletVelocity);\n        const bullet = this.bullets.create(data.position.x, data.position.y, \"bullet\");\n        bullet.angle = data.angle;\n        bullet.setVelocity(x, y);\n        bullet.shotBy = data.localId;\n        bullet.setCollideWorldBounds(true);\n        bullet.body.onWorldBounds = true;\n        this.players[data.localId].availableBullets--;\n        const firstAlive = this.players[data.localId].bulletsLoaded.getFirstAlive();\n        if(firstAlive){\n            firstAlive.setActive(false).setVisible(false);\n        }\n    }\n\n\n\n\n\n\n    //=============================================================================\n    //Others do things via the websocket\n    updateShip(data){\n        const player = this.players[data[0]];\n        const deltaTime = (data[3]-player.lastTimestamp)/1000;\n        if(deltaTime<=0) return;\n\n        let deltaTheta = data[1] - Number.parseInt(player.ship.angle);\n\n        if(deltaTheta < -10) deltaTheta += 360;\n        else if(deltaTheta < 0) deltaTheta = 0;\n        const angularVelocity = deltaTheta / deltaTime;\n        player.ship.setAngularVelocity(angularVelocity);\n\n        player.ship.setVelocity( ( data[2][0]-player.ship.x ) / deltaTime, ( data[2][1]-player.ship.y ) / deltaTime );\n\n        player.lastTimestamp = data[3];\n        player.ship.autonomyTime = deltaTime*1000;\n    }\n\n\n\n    //=============================================================================\n    //Current players does things\n    rotate(delta){\n        this.players[this.currentPlayer].ship.angle += delta * this.settings.angularVelocity * normalizers.angularVelocity;\n    }\n\n    moveLittle(delta){\n        const currentPlayer = this.players[this.currentPlayer];\n        if(currentPlayer.state === 1){\n            const ship = currentPlayer.ship;\n            const previousMag = ship.velocityMagnitude;\n            if(previousMag < this.settings.maxVelocityLittle * normalizers.velocity){\n                currentPlayer.ship.velocityMagnitude += delta*this.settings.accelerationLittle;\n            } else {\n                currentPlayer.ship.velocityMagnitude = this.settings.maxVelocityLittle * normalizers.velocity;\n            }\n        }\n    }\n\n    shoot(){\n        const currentPlayer = this.players[this.currentPlayer];\n        if(currentPlayer.availableBullets>0){\n            const ship = currentPlayer.ship;\n            const angle = ship.angle;\n            const data = {\n                position: {\n                    x: ship.x + ship.width*Math.cos(angle * Math.PI / 180),\n                    y: ship.y + ship.height*Math.sin(angle * Math.PI / 180)\n                },\n                angle: angle,\n                localId: this.currentPlayer\n            };\n            this.socket.emit(websocketEvents.SHOOT, data);\n            this.createBullet(data);\n        }\n    }\n\n\n    updateState(data){\n        this.players[data.localId].state = data.state;\n        const player = this.players[data.localId];\n        switch (data.state) {\n            case 0:\n                this.ships.killAndHide(player.ship);\n                this.ships.remove(player.ship);\n                this.players[data.localId].bulletsLoaded.killAll();\n                break;\n            case 1:\n                player.ship.setTexture(\"little\" + this.players[data.localId].color);\n                this.players[data.localId].bulletsLoaded.killAll();\n                if(data.localId === this.currentPlayer) {\n                    setTimeout(() => {\n                        if (this.players[data.localId].state === 1) {\n                            const data = {\n                                localId: this.currentPlayer,\n                                state: 2\n                            };\n                            this.updateState(data);\n                            this.socket.emit(websocketEvents.CHANGE_STATE, data);\n                        }\n                    }, this.settings.respawnTime);\n                }\n                break;\n            case 2:\n                player.ship.velocityMagnitude = this.settings.velocity * normalizers.velocity;\n                player.ship.setTexture(\"ship\" + this.players[data.localId].color);\n                player.bulletsLoaded.enableAll();\n                break;\n        }\n    }\n\n    onBulletCollision(ship, bullet){\n        bullet.destroy();\n        const state = this.players[ship.localId].state-1;\n        const data = {\n            localId: ship.localId,\n            state\n        };\n        if(state === 0) {\n            data.killedBy = bullet.shotBy;\n            clearInterval(this.reloadInterval);\n            clearInterval(this.updateShipInterval);\n        }\n        this.socket.emit(websocketEvents.CHANGE_STATE, data);\n        this.updateState(data);\n    }\n\n\n    reload(data){\n        this.players[data.localId].availableBullets = data.availableBullets;\n        try{\n            while(this.players[data.localId].bulletsLoaded.countActive() < data.availableBullets){\n                this.players[data.localId].bulletsLoaded.getFirstDead().setActive(true).setVisible(true);\n            }\n        } catch (e) {\n            console.log(e);\n        }\n    }\n\n\n    //=============================================================================\n    //Game loop functions\n    setCurrentPlayerNewVelocity(){\n        const {x, y} = this.physics.velocityFromAngle(\n            this.players[this.currentPlayer].ship.angle,\n            this.players[this.currentPlayer].ship.velocityMagnitude\n        );\n        this.players[this.currentPlayer].ship.setVelocity(x, y);\n    }\n\n    decelerateLittle(delta){\n        this.players[this.currentPlayer].ship.velocityMagnitude = Math.max(\n            0, this.players[this.currentPlayer].ship.velocityMagnitude - this.settings.frictionAir * delta\n        );\n    }\n\n    getLoadedBulletPosition(index, topLeft, bottomLeft, centerLeft, player){\n        switch (index){\n            case 0:\n                return {\n                    x: bottomLeft.x - (player.ship.width/4)*Math.cos(player.ship.rotation),\n                    y: bottomLeft.y - (player.ship.height/4)*Math.sin(player.ship.rotation)\n                };\n            case 1:\n                return{\n                    x: topLeft.x - (player.ship.width/4)*Math.cos(player.ship.rotation),\n                    y: topLeft.y - (player.ship.height/4)*Math.sin(player.ship.rotation)\n                };\n            case 2:\n                return {\n                    x: centerLeft.x - (player.ship.width/4)*Math.cos(player.ship.rotation),\n                    y: centerLeft.y - (player.ship.height/4)*Math.sin(player.ship.rotation)\n                };\n        }\n    }\n\n\n\n    //=============================================================================\n    //On create setup\n\n    setKeyInputHandlers(){\n        if(this.currentPlayer === null) return;\n\n        this.rotationKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);\n        this.accelerateLittleKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ENTER);\n        this.input.keyboard.on(\"keyup-ENTER\", ()=>{\n            if(this.players[this.currentPlayer].state>=2) this.shoot();\n        });\n    }\n\n    setTouchInputHandlers(){\n        if(this.currentPlayer === null) return;\n\n        this.input.addPointer(1);\n\n        this.input.on(\"pointerdown\", (pointer) => {\n            if (pointer.x < gameDimensions.width / 2) {\n                this.rotating = true;\n            } else {\n                if (this.players[this.currentPlayer].state >= 2) this.shoot();\n                else {\n                    this.accelerating = true;\n                }\n            }\n        });\n\n        this.input.on(\"pointerup\", (pointer) => {\n            if (pointer.x < gameDimensions.width / 2) {\n                this.rotating = false;\n            } else {\n                this.accelerating = false;\n            }\n        });\n    }\n\n    setUpdateShipInterval(){\n        if(this.currentPlayer === null) return;\n\n        const currentPlayer = this.players[this.currentPlayer];\n        this.updateShipInterval = setInterval(()=>{\n            this.socket.emit(websocketEvents.UPDATE_SHIP, [\n                this.currentPlayer,\n                Number.parseInt(currentPlayer.ship.angle),\n                [\n                    Number.parseFloat(currentPlayer.ship.x.toFixed(2)),\n                    Number.parseFloat(currentPlayer.ship.y.toFixed(2))\n                ],\n                this.time.now\n            ]);\n        }, 1000/this.updateFps);\n    }\n\n    setReloadInterval(){\n        if(this.currentPlayer === null) return;\n\n        this.reloadInterval = setInterval(() => {\n            if(this.players[this.currentPlayer].state<2) return;\n            const availableBullets = Math.min(3, this.players[this.currentPlayer].availableBullets + 1);\n            const data = {\n                localId: this.currentPlayer,\n                availableBullets\n            };\n            this.socket.emit(websocketEvents.RELOAD, data);\n            this.reload(data);\n        }, 1/(this.settings.reloadingVelocity * normalizers.reloadingVelocity));\n    }\n\n    setOnDestroy(){\n        if(this.currentPlayer === null) return;\n\n        this.events.on(\"destroy\", ()=>{\n            clearInterval(this.updateShipInterval);\n            clearInterval(this.reloadInterval);\n        });\n    }\n}"]}]}