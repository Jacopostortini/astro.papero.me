{"remainingRequest":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/thread-loader/dist/cjs.js!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/babel-loader/lib/index.js!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/eslint-loader/index.js??ref--13-0!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/GameScene.js","dependencies":[{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/GameScene.js","mtime":1618311328876},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/cache-loader/dist/cjs.js","mtime":1618298483685},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/thread-loader/dist/cjs.js","mtime":1618298485037},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/babel-loader/lib/index.js","mtime":1618298483657},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/eslint-loader/index.js","mtime":1618298483941}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIGZyb20gIi9tZWRpYS9qYWNvcG8vVm9sdW1lRGF0aS9Eb2N1bWVudGkvcGFwZXJvLnRrL2Nvc21vcy5wYXBlcm8ubWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIi9tZWRpYS9qYWNvcG8vVm9sdW1lRGF0aS9Eb2N1bWVudGkvcGFwZXJvLnRrL2Nvc21vcy5wYXBlcm8ubWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICIvbWVkaWEvamFjb3BvL1ZvbHVtZURhdGkvRG9jdW1lbnRpL3BhcGVyby50ay9jb3Ntb3MucGFwZXJvLm1lL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcyI7CmltcG9ydCBfaW5oZXJpdHMgZnJvbSAiL21lZGlhL2phY29wby9Wb2x1bWVEYXRpL0RvY3VtZW50aS9wYXBlcm8udGsvY29zbW9zLnBhcGVyby5tZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vaW5oZXJpdHMiOwppbXBvcnQgX2NyZWF0ZVN1cGVyIGZyb20gIi9tZWRpYS9qYWNvcG8vVm9sdW1lRGF0aS9Eb2N1bWVudGkvcGFwZXJvLnRrL2Nvc21vcy5wYXBlcm8ubWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZVN1cGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5lbnRyaWVzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnZhbHVlcy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm1hdGguc2lnbi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci5wYXJzZS1mbG9hdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci5jb25zdHJ1Y3Rvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci50by1maXhlZC5qcyI7CmltcG9ydCAqIGFzIFBoYXNlciBmcm9tICJwaGFzZXIiOwppbXBvcnQgd2Vic29ja2V0RXZlbnRzIGZyb20gIi4uL2NvbnN0YW50cy93ZWJzb2NrZXRFdmVudHMiOwppbXBvcnQgeyBnYW1lRGltZW5zaW9ucywgYXJjYWRlTm9ybWFsaXplcnMsIHBvd2VyVXBzLCBzY2VuZUtleXMsIG1hdHRlck5vcm1hbGl6ZXJzIH0gZnJvbSAiLi4vY29uc3RhbnRzL2dhbWVTZXR0aW5ncyI7CmltcG9ydCB7IGRldGVjdFRvdWNoU2NyZWVuLCByZW1vdmVGcm9tQXJyYXkgfSBmcm9tICIuLi9jb25zdGFudHMvY29uc3RhbnRzIjsKaW1wb3J0IF8gZnJvbSAibG9kYXNoIjsgLy9pbXBvcnQgY3JlYXRlTWFwIGZyb20gIi4uL3BoYXNlci9tYXBzIjsKCmltcG9ydCB7IGNyZWF0ZUJ1bGxldHNMb2FkZWRPYmplY3QsIGdldEJvZHlGcm9tQ29sbGlzaW9uLCBsb2FkSW1hZ2VzLCBzZXRJbnB1dEhhbmRsZXJzLCB2ZWxvY2l0eUZyb21BbmdsZSB9IGZyb20gIi4vc2NlbmUiOwoKdmFyIEdhbWVTY2VuZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX1BoYXNlciRTY2VuZSkgewogIF9pbmhlcml0cyhHYW1lU2NlbmUsIF9QaGFzZXIkU2NlbmUpOwoKICB2YXIgX3N1cGVyID0gX2NyZWF0ZVN1cGVyKEdhbWVTY2VuZSk7CgogIGZ1bmN0aW9uIEdhbWVTY2VuZShzb2NrZXQsIGdhbWUpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgR2FtZVNjZW5lKTsKCiAgICBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHsKICAgICAga2V5OiBzY2VuZUtleXMuZ2FtZQogICAgfSk7CiAgICBfdGhpcy5zb2NrZXQgPSBzb2NrZXQ7CgogICAgX3RoaXMuc2V0VXBHYW1lKGdhbWUpOwoKICAgIF90aGlzLnVwZGF0ZUZwcyA9IDEwOwogICAgX3RoaXMudG91Y2hTY3JlZW4gPSBkZXRlY3RUb3VjaFNjcmVlbigpOwogICAgX3RoaXMuZGVmYXVsdEltYWdlT3B0aW9ucyA9IHsKICAgICAgZnJpY3Rpb246IDAsCiAgICAgIGZyaWN0aW9uQWlyOiAwLAogICAgICBmcmljdGlvblN0YXRpYzogMCwKICAgICAgaWdub3JlR3Jhdml0eTogdHJ1ZQogICAgfTsKICAgIF90aGlzLm1heEJ1bGxldHMgPSAzOwogICAgX3RoaXMucG93ZXJVcElkcyA9IDA7CiAgICBfdGhpcy5wb3dlclVwR2VuZXJhdGlvblRpbWUgPSAxMDAwMDsKCiAgICBfdGhpcy5zb2NrZXQub24od2Vic29ja2V0RXZlbnRzLlVQREFURV9TSElQLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gX3RoaXMudXBkYXRlU2hpcChkYXRhKTsKICAgIH0pOwoKICAgIF90aGlzLnNvY2tldC5vbih3ZWJzb2NrZXRFdmVudHMuU0hPT1QsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBfdGhpcy5jcmVhdGVCdWxsZXQoZGF0YSk7CiAgICB9KTsKCiAgICBfdGhpcy5zb2NrZXQub24od2Vic29ja2V0RXZlbnRzLkNIQU5HRV9TVEFURSwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIF90aGlzLnVwZGF0ZVN0YXRlKGRhdGEpOwogICAgfSk7CgogICAgX3RoaXMuc29ja2V0Lm9uKHdlYnNvY2tldEV2ZW50cy5SRUxPQUQsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBfdGhpcy5yZWxvYWQoZGF0YSk7CiAgICB9KTsKCiAgICBfdGhpcy5zb2NrZXQub24od2Vic29ja2V0RXZlbnRzLlBPV0VSX1VQLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gX3RoaXMucG93ZXJVcEV2ZW50KGRhdGEpOwogICAgfSk7CgogICAgX3RoaXMuc29ja2V0Lm9uKHdlYnNvY2tldEV2ZW50cy5FTkRfVFVSTiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMuY2xlYXJJbnRlcnZhbHModHJ1ZSk7CgogICAgICAgIF90aGlzLnNjZW5lLnN0YXJ0KHNjZW5lS2V5cy5yYW5raW5nLCBfLmNsb25lRGVlcChkYXRhKSk7CiAgICAgIH0sIDIwMDApOwogICAgfSk7CgogICAgcmV0dXJuIF90aGlzOwogIH0KCiAgX2NyZWF0ZUNsYXNzKEdhbWVTY2VuZSwgW3sKICAgIGtleTogInNldFVwR2FtZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0VXBHYW1lKGdhbWUpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB0aGlzLnRpbWVyID0gZ2FtZS50aW1lcjsKICAgICAgdGhpcy5zZXR0aW5ncyA9IGdhbWUuc2V0dGluZ3M7CiAgICAgIHRoaXMuY3VycmVudFBsYXllciA9IGdhbWUuY3VycmVudFBsYXllcjsKICAgICAgdGhpcy5hZG1pbiA9IGdhbWUuYWRtaW47CiAgICAgIHRoaXMubWFwID0gZ2FtZS5tYXA7CiAgICAgIHRoaXMuc2V0dGluZ3MubWF4VmVsb2NpdHlMaXR0bGUgPSBnYW1lLnNldHRpbmdzLnZlbG9jaXR5ICsgMC4yOwogICAgICB0aGlzLnNldHRpbmdzLmFjY2VsZXJhdGlvbkxpdHRsZSA9IDAuNDsKICAgICAgdGhpcy5zZXR0aW5ncy5yZXNwYXduVGltZSA9IDgwMDA7CiAgICAgIHRoaXMuc2V0dGluZ3MuZnJpY3Rpb25BaXIgPSAwLjE7CiAgICAgIHRoaXMuc2V0dGluZ3MucG93ZXJVcFZlbG9jaXR5ID0gNTsKICAgICAgdGhpcy5zZXR0aW5ncy5wb3dlclVwQW5ndWxhclZlbG9jaXR5ID0gMjA7CiAgICAgIHRoaXMucGxheWVycyA9IHt9OwogICAgICBnYW1lLnBsYXllcnMuZm9yRWFjaChmdW5jdGlvbiAocGxheWVyKSB7CiAgICAgICAgX3RoaXMyLnBsYXllcnNbcGxheWVyLmxvY2FsSWRdID0gXy5jbG9uZURlZXAocGxheWVyKTsKICAgICAgICBfdGhpczIucGxheWVyc1twbGF5ZXIubG9jYWxJZF0uYXZhaWxhYmxlQnVsbGV0cyA9IF90aGlzMi5tYXhCdWxsZXRzOwogICAgICAgIF90aGlzMi5wbGF5ZXJzW3BsYXllci5sb2NhbElkXS5sYXN0VGltZXN0YW1wID0gMDsKICAgICAgfSk7CiAgICAgIHRoaXMucG93ZXJVcHNPYmplY3RzID0gW107CiAgICB9CiAgfSwgewogICAga2V5OiAiaW5pdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdChnYW1lKSB7CiAgICAgIGlmIChPYmplY3QuZW50cmllcyhnYW1lKS5sZW5ndGggPiAwKSB0aGlzLnNldFVwR2FtZShnYW1lKTtlbHNlIHsKICAgICAgICBpZiAodGhpcy50aW1lciA+IERhdGUubm93KCkpIHsKICAgICAgICAgIHRoaXMuc2NlbmUuc3RhcnQoc2NlbmVLZXlzLnJhbmtpbmcsIF8uY2xvbmVEZWVwKHsKICAgICAgICAgICAgcGxheWVyczogXy5jbG9uZURlZXAodGhpcy5wbGF5ZXJzKSwKICAgICAgICAgICAgdGltZXI6IHRoaXMudGltZXIKICAgICAgICAgIH0pKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJwcmVsb2FkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwcmVsb2FkKCkgewogICAgICBsb2FkSW1hZ2VzKHRoaXMsIHNjZW5lS2V5cy5nYW1lKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjcmVhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZSgpIHsKICAgICAgUGhhc2VyLlBoeXNpY3MuTWF0dGVyLkltYWdlLnByb3RvdHlwZS5zaGFwZWRTZXRPbkNvbGxpZGUgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHsKICAgICAgICBpZiAodGhpcy5ib2R5ICYmIHRoaXMuYm9keS5wYXJ0cyAmJiB0aGlzLmJvZHkucGFydHMubGVuZ3RoKSB7CiAgICAgICAgICB2YXIgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGhpcy5ib2R5LnBhcnRzKSwKICAgICAgICAgICAgICBfc3RlcDsKCiAgICAgICAgICB0cnkgewogICAgICAgICAgICBmb3IgKF9pdGVyYXRvci5zKCk7ICEoX3N0ZXAgPSBfaXRlcmF0b3IubigpKS5kb25lOykgewogICAgICAgICAgICAgIHZhciBwYXJ0ID0gX3N0ZXAudmFsdWU7CiAgICAgICAgICAgICAgcGFydC5vbkNvbGxpZGVDYWxsYmFjayA9IGNhbGxiYWNrOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgX2l0ZXJhdG9yLmUoZXJyKTsKICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9pdGVyYXRvci5mKCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGhpcy5zZXRPbkNvbGxpZGUoY2FsbGJhY2spOwogICAgICB9OwoKICAgICAgdGhpcy5jcmVhdGVDYXRlZ29yaWVzKCk7CiAgICAgIHRoaXMuY3JlYXRlU2hpcHMoKTsgLy9jcmVhdGVNYXAodGhpcyk7IFRPRE86IFJFRE8gTUFQUwoKICAgICAgc2V0SW5wdXRIYW5kbGVycyh0aGlzLCBzY2VuZUtleXMuZ2FtZSk7CiAgICAgIHRoaXMuc2V0UmVsb2FkSW50ZXJ2YWwoKTsKICAgICAgdGhpcy5zZXRVcGRhdGVTaGlwSW50ZXJ2YWwoKTsKICAgICAgaWYgKHRoaXMuYWRtaW4gPT09IHRoaXMuY3VycmVudFBsYXllcikgdGhpcy5zZXRQb3dlclVwSW50ZXJ2YWwoKTsKICAgICAgdGhpcy5zZXRPbkRlc3Ryb3koKTsKICAgICAgdGhpcy5nZW5lcmF0ZVBvd2VyVXAoewogICAgICAgIHg6IGdhbWVEaW1lbnNpb25zLndpZHRoIC8gMiwKICAgICAgICB5OiBnYW1lRGltZW5zaW9ucy5oZWlnaHQgLyAyCiAgICAgIH0sIDIpOwogICAgfQogIH0sIHsKICAgIGtleTogInVwZGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlKHRpbWUsIGRlbHRhKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuY3VycmVudFBsYXllciAhPT0gbnVsbCkgewogICAgICAgIGlmICh0aGlzLnJvdGF0aW9uS2V5LmlzRG93biB8fCB0aGlzLnJvdGF0aW5nKSB0aGlzLnJvdGF0ZShkZWx0YSk7CiAgICAgICAgaWYgKHRoaXMuYWNjZWxlcmF0ZUxpdHRsZUtleS5pc0Rvd24gfHwgdGhpcy5hY2NlbGVyYXRpbmcpIHRoaXMubW92ZUxpdHRsZShkZWx0YSk7CiAgICAgICAgdGhpcy5zZXRDdXJyZW50UGxheWVyTmV3VmVsb2NpdHkoKTsKICAgICAgICBpZiAodGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc3RhdGUgPT09IDEpIHRoaXMuZGVjZWxlcmF0ZUxpdHRsZShkZWx0YSk7CiAgICAgIH0KCiAgICAgIE9iamVjdC52YWx1ZXModGhpcy5wbGF5ZXJzKS5mb3JFYWNoKGZ1bmN0aW9uIChwbGF5ZXIpIHsKICAgICAgICB2YXIgdG9wTGVmdCA9IHBsYXllci5zaGlwLmdldFRvcExlZnQoKTsKICAgICAgICB2YXIgYm90dG9tTGVmdCA9IHBsYXllci5zaGlwLmdldEJvdHRvbUxlZnQoKTsKICAgICAgICB2YXIgY2VudGVyTGVmdCA9IHsKICAgICAgICAgIHg6ICh0b3BMZWZ0LnggKyBib3R0b21MZWZ0LngpIC8gMiwKICAgICAgICAgIHk6ICh0b3BMZWZ0LnkgKyBib3R0b21MZWZ0LnkpIC8gMgogICAgICAgIH07CiAgICAgICAgcGxheWVyLmJ1bGxldHNMb2FkZWQuZ2FtZU9iamVjdHMuZm9yRWFjaChmdW5jdGlvbiAoYnVsbGV0LCBpbmRleCkgewogICAgICAgICAgdmFyIF90aGlzMyRnZXRMb2FkZWRCdWxsZSA9IF90aGlzMy5nZXRMb2FkZWRCdWxsZXRQb3NpdGlvbihpbmRleCwgdG9wTGVmdCwgYm90dG9tTGVmdCwgY2VudGVyTGVmdCwgcGxheWVyKSwKICAgICAgICAgICAgICB4ID0gX3RoaXMzJGdldExvYWRlZEJ1bGxlLngsCiAgICAgICAgICAgICAgeSA9IF90aGlzMyRnZXRMb2FkZWRCdWxsZS55OwoKICAgICAgICAgIGJ1bGxldC54ID0geDsKICAgICAgICAgIGJ1bGxldC55ID0geTsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKHBsYXllci5sb2NhbElkICE9PSBfdGhpczMuY3VycmVudFBsYXllcikgewogICAgICAgICAgcGxheWVyLnNoaXAuYXV0b25vbXlUaW1lIC09IGRlbHRhOwoKICAgICAgICAgIGlmIChwbGF5ZXIuc2hpcC5hdXRvbm9teVRpbWUgPCAwKSB7CiAgICAgICAgICAgIHBsYXllci5zaGlwLnNldFZlbG9jaXR5KDApOwogICAgICAgICAgICBwbGF5ZXIuc2hpcC5zZXRBbmd1bGFyVmVsb2NpdHkoMCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0gLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy9DcmVhdGluZyB0aGluZ3MKCiAgfSwgewogICAga2V5OiAiY3JlYXRlQ2F0ZWdvcmllcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlQ2F0ZWdvcmllcygpIHsKICAgICAgdGhpcy5zaGlwc0NhdGVnb3J5ID0gdGhpcy5tYXR0ZXIud29ybGQubmV4dENhdGVnb3J5KCk7CiAgICAgIHRoaXMuYnVsbGV0c0NhdGVnb3J5ID0gdGhpcy5tYXR0ZXIud29ybGQubmV4dENhdGVnb3J5KCk7CiAgICAgIHRoaXMucG93ZXJVcHNDYXRlZ29yeSA9IHRoaXMubWF0dGVyLndvcmxkLm5leHRDYXRlZ29yeSgpOwogICAgICB0aGlzLmtpbGxhYmxlTWFwT2JqZWN0Q2F0ZWdvcnkgPSB0aGlzLm1hdHRlci53b3JsZC5uZXh0Q2F0ZWdvcnkoKTsKICAgICAgdGhpcy5ub3RLaWxsYWJsZU1hcE9iamVjdENhdGVnb3J5ID0gdGhpcy5tYXR0ZXIud29ybGQubmV4dENhdGVnb3J5KCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY3JlYXRlU2hpcHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZVNoaXBzKCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIHZhciBvcmRlciA9IFswLCAzLCAyLCAxXTsKICAgICAgdmFyIGluZGV4ID0gMDsKICAgICAgdmFyIHRleHR1cmVzID0gWyIiLCAibGl0dGxlIiwgInNoaXAiLCAic2hpZWxkZWQiXTsKICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLnBsYXllcnMpLmZvckVhY2goZnVuY3Rpb24gKHBsYXllcikgewogICAgICAgIGlmIChwbGF5ZXIuc3RhdGUgPT09IDApIHJldHVybjsKICAgICAgICBwbGF5ZXIuc2hpcCA9IF90aGlzNC5tYXR0ZXIuYWRkLmltYWdlKG9yZGVyW2luZGV4XSA8IDIgPyAzMCA6IGdhbWVEaW1lbnNpb25zLndpZHRoIC0gMzAsIG9yZGVyW2luZGV4XSAlIDIgPT09IDAgPyAzMCA6IGdhbWVEaW1lbnNpb25zLmhlaWdodCAtIDMwLCB0ZXh0dXJlc1twbGF5ZXIuc3RhdGVdICsgcGxheWVyLmNvbG9yLCBudWxsLCBfdGhpczQuZGVmYXVsdEltYWdlT3B0aW9ucyk7CiAgICAgICAgcGxheWVyLnNoaXAuc2V0Q29sbGlzaW9uQ2F0ZWdvcnkoX3RoaXM0LnNoaXBzQ2F0ZWdvcnkpOwogICAgICAgIHBsYXllci5zaGlwLnNldEFuZ2xlKC00NSAqIChvcmRlcltpbmRleF0gPCAyID8gMSA6IDMpICogKG9yZGVyW2luZGV4XSAlIDIgKiAyIC0gMSkpOwogICAgICAgIHBsYXllci5zaGlwLnZlbG9jaXR5TWFnbml0dWRlID0gX3RoaXM0LnNldHRpbmdzLnZlbG9jaXR5ICogbWF0dGVyTm9ybWFsaXplcnMudmVsb2NpdHk7CiAgICAgICAgcGxheWVyLnNoaXAubG9jYWxJZCA9IHBsYXllci5sb2NhbElkOwogICAgICAgIHBsYXllci5zaGlwLmF1dG9ub215VGltZSA9IDA7CgogICAgICAgIF90aGlzNC5tYXR0ZXIuYm9keS5zZXRJbmVydGlhKHBsYXllci5zaGlwLmJvZHksIEluZmluaXR5KTsKCiAgICAgICAgcGxheWVyLmJ1bGxldHNMb2FkZWQgPSBjcmVhdGVCdWxsZXRzTG9hZGVkT2JqZWN0KF90aGlzNCk7CgogICAgICAgIGlmIChwbGF5ZXIubG9jYWxJZCA9PT0gX3RoaXM0LmN1cnJlbnRQbGF5ZXIpIHsKICAgICAgICAgIHBsYXllci5zaGlwLnNoYXBlZFNldE9uQ29sbGlkZShmdW5jdGlvbiAoY29sbGlzaW9uKSB7CiAgICAgICAgICAgIF90aGlzNC5vbkN1cnJlbnRTaGlwQ29sbGlzaW9uKGNvbGxpc2lvbik7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGluZGV4Kys7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImNyZWF0ZUJ1bGxldCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlQnVsbGV0KGRhdGEpIHsKICAgICAgY29uc29sZS5sb2coImNyZWF0ZUJ1bGxldCgiLCBkYXRhKTsKCiAgICAgIHZhciBfdmVsb2NpdHlGcm9tQW5nbGUgPSB2ZWxvY2l0eUZyb21BbmdsZShkYXRhLmFuZ2xlLCB0aGlzLnNldHRpbmdzLmJ1bGxldFZlbG9jaXR5ICogbWF0dGVyTm9ybWFsaXplcnMuYnVsbGV0VmVsb2NpdHkpLAogICAgICAgICAgeCA9IF92ZWxvY2l0eUZyb21BbmdsZS54LAogICAgICAgICAgeSA9IF92ZWxvY2l0eUZyb21BbmdsZS55OwoKICAgICAgdmFyIGJ1bGxldCA9IHRoaXMubWF0dGVyLmFkZC5pbWFnZShkYXRhLnBvc2l0aW9uLngsIGRhdGEucG9zaXRpb24ueSwgImJ1bGxldCIsIG51bGwsIHRoaXMuZGVmYXVsdEltYWdlT3B0aW9ucyk7CiAgICAgIGJ1bGxldC5zZXRDb2xsaXNpb25DYXRlZ29yeSh0aGlzLmJ1bGxldHNDYXRlZ29yeSk7CiAgICAgIGJ1bGxldC5zZXRDb2xsaWRlc1dpdGgoW3RoaXMuc2hpcHNDYXRlZ29yeSwgdGhpcy5raWxsYWJsZU1hcE9iamVjdENhdGVnb3J5LCB0aGlzLm5vdEtpbGxhYmxlTWFwT2JqZWN0Q2F0ZWdvcnldKTsKICAgICAgYnVsbGV0LnNldEFuZ2xlKGRhdGEuYW5nbGUpOwogICAgICBidWxsZXQuc2V0VmVsb2NpdHkoeCwgeSk7CiAgICAgIGJ1bGxldC5zaG90QnkgPSBkYXRhLmxvY2FsSWQ7CiAgICAgIHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmF2YWlsYWJsZUJ1bGxldHMtLTsKICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uYnVsbGV0c0xvYWRlZC5raWxsRmlyc3RBbGl2ZSgpOwogICAgICB0aGlzLm1hdHRlci5ib2R5LnNldEluZXJ0aWEoYnVsbGV0LmJvZHksIEluZmluaXR5KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjcmVhdGVQb3dlclVwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVQb3dlclVwKGRhdGEpIHsKICAgICAgdmFyIG5ld1Bvd2VyVXAgPSB0aGlzLm1hdHRlci5hZGQuaW1hZ2UoZGF0YS5wb3NpdGlvbi54LCBkYXRhLnBvc2l0aW9uLnksIGRhdGEucG93ZXJVcCwgbnVsbCwgdGhpcy5kZWZhdWx0SW1hZ2VPcHRpb25zKTsKCiAgICAgIHZhciBfdmVsb2NpdHlGcm9tQW5nbGUyID0gdmVsb2NpdHlGcm9tQW5nbGUoZGF0YS5hbmdsZSwgdGhpcy5zZXR0aW5ncy5wb3dlclVwVmVsb2NpdHkpLAogICAgICAgICAgeCA9IF92ZWxvY2l0eUZyb21BbmdsZTIueCwKICAgICAgICAgIHkgPSBfdmVsb2NpdHlGcm9tQW5nbGUyLnk7CgogICAgICBuZXdQb3dlclVwLnNldFZlbG9jaXR5KHgsIHkpOwogICAgICBuZXdQb3dlclVwLnNldEFuZ3VsYXJWZWxvY2l0eSh0aGlzLnNldHRpbmdzLnBvd2VyVXBBbmd1bGFyVmVsb2NpdHkpOwogICAgICBuZXdQb3dlclVwLnBvd2VyVXAgPSBkYXRhLnBvd2VyVXA7CiAgICAgIG5ld1Bvd2VyVXAuc2V0Q29sbGlzaW9uQ2F0ZWdvcnkodGhpcy5wb3dlclVwc0NhdGVnb3J5KTsKICAgICAgbmV3UG93ZXJVcC5pZCA9IGRhdGEuaWQ7CiAgICAgIHRoaXMubWF0dGVyLmJvZHkuc2V0SW5lcnRpYShuZXdQb3dlclVwLmJvZHksIEluZmluaXR5KTsKICAgICAgdGhpcy5wb3dlclVwc09iamVjdHMucHVzaChuZXdQb3dlclVwKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjcmVhdGVMYXNlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlTGFzZXIoKSB7Ly9jb25zdCBtYXhMZW5ndGggPSBNYXRoLnNxcnQoIE1hdGgucG93KGdhbWVEaW1lbnNpb25zLndpZHRoLCAyKSArIE1hdGgucG93KGdhbWVEaW1lbnNpb25zLmhlaWdodCwgMikgKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZW5lcmF0ZVBvd2VyVXAiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdlbmVyYXRlUG93ZXJVcChfcmVmKSB7CiAgICAgIHZhciB4ID0gX3JlZi54LAogICAgICAgICAgeSA9IF9yZWYueTsKICAgICAgdmFyIG4gPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IDE7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG47IGkrKykgewogICAgICAgIHZhciBkYXRhID0gewogICAgICAgICAgdHlwZTogImNyZWF0ZSIsCiAgICAgICAgICBwb3dlclVwOiBwb3dlclVwc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBwb3dlclVwcy5sZW5ndGgpXSwKICAgICAgICAgIHBvc2l0aW9uOiB7CiAgICAgICAgICAgIHg6IHggfHwgUGhhc2VyLk1hdGguRmxvYXRCZXR3ZWVuKDAsIGdhbWVEaW1lbnNpb25zLndpZHRoKSwKICAgICAgICAgICAgeTogeSB8fCBQaGFzZXIuTWF0aC5GbG9hdEJldHdlZW4oMCwgZ2FtZURpbWVuc2lvbnMuaGVpZ2h0KQogICAgICAgICAgfSwKICAgICAgICAgIGFuZ2xlOiBQaGFzZXIuTWF0aC5GbG9hdEJldHdlZW4oMCwgMzYwKSwKICAgICAgICAgIGlkOiArK3RoaXMucG93ZXJVcElkcwogICAgICAgIH07CiAgICAgICAgdGhpcy5zb2NrZXQuZW1pdCh3ZWJzb2NrZXRFdmVudHMuUE9XRVJfVVAsIGRhdGEpOwogICAgICAgIHRoaXMucG93ZXJVcEV2ZW50KGRhdGEpOwogICAgICB9CiAgICB9IC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vT3RoZXJzIGRvIHRoaW5ncyB2aWEgdGhlIHdlYnNvY2tldAoKICB9LCB7CiAgICBrZXk6ICJ1cGRhdGVTaGlwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVTaGlwKGRhdGEpIHsKICAgICAgdmFyIHBsYXllciA9IHRoaXMucGxheWVyc1tkYXRhWzBdXTsKICAgICAgdmFyIGRlbHRhVGltZSA9IChkYXRhWzNdIC0gcGxheWVyLmxhc3RUaW1lc3RhbXApIC8gMTAwMDsKICAgICAgaWYgKGRlbHRhVGltZSA8PSAwKSByZXR1cm47CiAgICAgIHZhciBkZWx0YVRoZXRhID0gZGF0YVsxXSAtIE1hdGguZmxvb3IocGxheWVyLnNoaXAuYW5nbGUpOwogICAgICBpZiAoZGVsdGFUaGV0YSAqIE1hdGguc2lnbih0aGlzLnNldHRpbmdzLmFuZ3VsYXJWZWxvY2l0eSkgPCAtMTApIGRlbHRhVGhldGEgKz0gMzYwICogTWF0aC5zaWduKHRoaXMuc2V0dGluZ3MuYW5ndWxhclZlbG9jaXR5KTtlbHNlIGlmIChkZWx0YVRoZXRhICogTWF0aC5zaWduKHRoaXMuc2V0dGluZ3MuYW5ndWxhclZlbG9jaXR5KSA8IDApIGRlbHRhVGhldGEgPSAwOwogICAgICB2YXIgYW5ndWxhclZlbG9jaXR5ID0gZGVsdGFUaGV0YSAvIGRlbHRhVGltZTsKICAgICAgcGxheWVyLnNoaXAuc2V0QW5ndWxhclZlbG9jaXR5KGFuZ3VsYXJWZWxvY2l0eSk7CiAgICAgIHBsYXllci5zaGlwLnNldFZlbG9jaXR5KChkYXRhWzJdWzBdIC0gcGxheWVyLnNoaXAueCkgLyBkZWx0YVRpbWUsIChkYXRhWzJdWzFdIC0gcGxheWVyLnNoaXAueSkgLyBkZWx0YVRpbWUpOwogICAgICBwbGF5ZXIubGFzdFRpbWVzdGFtcCA9IGRhdGFbM107CiAgICAgIHBsYXllci5zaGlwLmF1dG9ub215VGltZSA9IGRlbHRhVGltZSAqIDEwMDA7CiAgICB9CiAgfSwgewogICAga2V5OiAicG93ZXJVcEV2ZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwb3dlclVwRXZlbnQoZGF0YSkgewogICAgICAvL0NyZWF0ZSBwb3dlciB1cCBpdGVtCiAgICAgIGlmIChkYXRhLnR5cGUgPT09ICJjcmVhdGUiKSB0aGlzLmNyZWF0ZVBvd2VyVXAoZGF0YSk7IC8vUGxheWVyIGdldHMgcG93ZXIgdXAKICAgICAgZWxzZSBpZiAoZGF0YS50eXBlID09PSAiZ2V0IikgewogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnBvd2VyVXBzT2JqZWN0cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgY2hpbGQgPSB0aGlzLnBvd2VyVXBzT2JqZWN0c1tpXTsKCiAgICAgICAgICAgIGlmIChjaGlsZC5pZCA9PT0gZGF0YS5pZCkgewogICAgICAgICAgICAgIHRoaXMucG93ZXJVcHNPYmplY3RzID0gcmVtb3ZlRnJvbUFycmF5KHRoaXMucG93ZXJVcHNPYmplY3RzLCBpKTsKICAgICAgICAgICAgICBjaGlsZC5kZXN0cm95KCk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZGF0YVRvU2VuZDsKCiAgICAgICAgICBzd2l0Y2ggKGRhdGEucG93ZXJVcCkgewogICAgICAgICAgICBjYXNlICJyZXZlcnNlIjoKICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLmFuZ3VsYXJWZWxvY2l0eSAqPSAtMTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgInNoaWVsZCI6CiAgICAgICAgICAgICAgZGF0YVRvU2VuZCA9IHsKICAgICAgICAgICAgICAgIGxvY2FsSWQ6IGRhdGEubG9jYWxJZCwKICAgICAgICAgICAgICAgIHN0YXRlOiAzCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB0aGlzLnNvY2tldC5lbWl0KHdlYnNvY2tldEV2ZW50cy5DSEFOR0VfU1RBVEUsIGRhdGFUb1NlbmQpOwogICAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGUoZGF0YVRvU2VuZCk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICJyZWxvYWQiOgogICAgICAgICAgICAgIGRhdGFUb1NlbmQgPSB7CiAgICAgICAgICAgICAgICBsb2NhbElkOiBkYXRhLmxvY2FsSWQsCiAgICAgICAgICAgICAgICBhdmFpbGFibGVCdWxsZXRzOiB0aGlzLm1heEJ1bGxldHMKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIHRoaXMuc29ja2V0LmVtaXQod2Vic29ja2V0RXZlbnRzLlJFTE9BRCwgZGF0YVRvU2VuZCk7CiAgICAgICAgICAgICAgdGhpcy5yZWxvYWQoZGF0YVRvU2VuZCk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICJsYXNlciI6CiAgICAgICAgICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uc2hpcC5oYXNMYXNlciA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSAvL1BsYXllciB1c2VzIHBvd2VyIHVwCiAgICAgICAgZWxzZSBpZiAoZGF0YS50eXBlID09PSAidXNlIikgewogICAgICAgICAgICBpZiAoZGF0YS5wb3dlclVwID09PSAibGFzZXIiKSB0aGlzLmNyZWF0ZUxhc2VyKGRhdGEpOwogICAgICAgICAgfQogICAgfSAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAvL0N1cnJlbnQgcGxheWVycyBkb2VzIHRoaW5ncwoKICB9LCB7CiAgICBrZXk6ICJyb3RhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJvdGF0ZShkZWx0YSkgewogICAgICB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwLnNldEFuZ2xlKHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdLnNoaXAuYW5nbGUgKyBkZWx0YSAqIHRoaXMuc2V0dGluZ3MuYW5ndWxhclZlbG9jaXR5ICogbWF0dGVyTm9ybWFsaXplcnMuYW5ndWxhclZlbG9jaXR5KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJtb3ZlTGl0dGxlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBtb3ZlTGl0dGxlKGRlbHRhKSB7CiAgICAgIHZhciBjdXJyZW50UGxheWVyID0gdGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl07CgogICAgICBpZiAoY3VycmVudFBsYXllci5zdGF0ZSA9PT0gMSkgewogICAgICAgIHZhciBzaGlwID0gY3VycmVudFBsYXllci5zaGlwOwogICAgICAgIHZhciBwcmV2aW91c01hZyA9IHNoaXAudmVsb2NpdHlNYWduaXR1ZGU7CgogICAgICAgIGlmIChwcmV2aW91c01hZyA8IHRoaXMuc2V0dGluZ3MubWF4VmVsb2NpdHlMaXR0bGUgKiBtYXR0ZXJOb3JtYWxpemVycy52ZWxvY2l0eSkgewogICAgICAgICAgY3VycmVudFBsYXllci5zaGlwLnZlbG9jaXR5TWFnbml0dWRlICs9IGRlbHRhICogdGhpcy5zZXR0aW5ncy5hY2NlbGVyYXRpb25MaXR0bGU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGN1cnJlbnRQbGF5ZXIuc2hpcC52ZWxvY2l0eU1hZ25pdHVkZSA9IHRoaXMuc2V0dGluZ3MubWF4VmVsb2NpdHlMaXR0bGUgKiBtYXR0ZXJOb3JtYWxpemVycy52ZWxvY2l0eTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJzaG9vdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2hvb3QoKSB7CiAgICAgIHZhciBjdXJyZW50UGxheWVyID0gdGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl07CiAgICAgIHZhciBzaGlwID0gY3VycmVudFBsYXllci5zaGlwOwogICAgICB2YXIgYW5nbGUgPSBzaGlwLmFuZ2xlOwogICAgICB2YXIgZGF0YSA9IHsKICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgeDogc2hpcC54ICsgc2hpcC53aWR0aCAqIE1hdGguY29zKGFuZ2xlICogTWF0aC5QSSAvIDE4MCksCiAgICAgICAgICB5OiBzaGlwLnkgKyBzaGlwLmhlaWdodCAqIE1hdGguc2luKGFuZ2xlICogTWF0aC5QSSAvIDE4MCkKICAgICAgICB9LAogICAgICAgIGFuZ2xlOiBhbmdsZSwKICAgICAgICBsb2NhbElkOiB0aGlzLmN1cnJlbnRQbGF5ZXIKICAgICAgfTsKICAgICAgLyppZihjdXJyZW50UGxheWVyLnNoaXAuaGFzTGFzZXIpewogICAgICAgICAgZGF0YS50eXBlID0gInVzZSI7CiAgICAgICAgICBkYXRhLnBvd2VyVXAgPSAibGFzZXIiOwogICAgICAgICAgdGhpcy5zb2NrZXQuZW1pdCh3ZWJzb2NrZXRFdmVudHMuUE9XRVJfVVAsIGRhdGEpOwogICAgICAgICAgdGhpcy5jcmVhdGVMYXNlcihkYXRhKTsKICAgICAgfSBlbHNlIHsqLwoKICAgICAgaWYgKGN1cnJlbnRQbGF5ZXIuYXZhaWxhYmxlQnVsbGV0cyA+IDApIHsKICAgICAgICB0aGlzLnNvY2tldC5lbWl0KHdlYnNvY2tldEV2ZW50cy5TSE9PVCwgZGF0YSk7CiAgICAgICAgdGhpcy5jcmVhdGVCdWxsZXQoZGF0YSk7CiAgICAgIH0gLy99CgogICAgfQogIH0sIHsKICAgIGtleTogInVwZGF0ZVN0YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVTdGF0ZShkYXRhKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uc3RhdGUgPSBkYXRhLnN0YXRlOwogICAgICB2YXIgcGxheWVyID0gdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF07CgogICAgICBzd2l0Y2ggKGRhdGEuc3RhdGUpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBwbGF5ZXIuc2hpcC5kZXN0cm95KCk7CiAgICAgICAgICB0aGlzLnBsYXllcnNbZGF0YS5sb2NhbElkXS5idWxsZXRzTG9hZGVkLmtpbGxBbGwoKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIDE6CiAgICAgICAgICBwbGF5ZXIuc2hpcC5zZXRUZXh0dXJlKCJsaXR0bGUiICsgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uY29sb3IpOwogICAgICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uYnVsbGV0c0xvYWRlZC5raWxsQWxsKCk7CgogICAgICAgICAgaWYgKGRhdGEubG9jYWxJZCA9PT0gdGhpcy5jdXJyZW50UGxheWVyKSB7CiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIGlmIChfdGhpczUucGxheWVyc1tkYXRhLmxvY2FsSWRdLnN0YXRlID09PSAxKSB7CiAgICAgICAgICAgICAgICB2YXIgX2RhdGEgPSB7CiAgICAgICAgICAgICAgICAgIGxvY2FsSWQ6IF90aGlzNS5jdXJyZW50UGxheWVyLAogICAgICAgICAgICAgICAgICBzdGF0ZTogMgogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBfdGhpczUudXBkYXRlU3RhdGUoX2RhdGEpOwoKICAgICAgICAgICAgICAgIF90aGlzNS5zb2NrZXQuZW1pdCh3ZWJzb2NrZXRFdmVudHMuQ0hBTkdFX1NUQVRFLCBfZGF0YSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB0aGlzLnNldHRpbmdzLnJlc3Bhd25UaW1lKTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAyOgogICAgICAgICAgcGxheWVyLnNoaXAudmVsb2NpdHlNYWduaXR1ZGUgPSB0aGlzLnNldHRpbmdzLnZlbG9jaXR5ICogbWF0dGVyTm9ybWFsaXplcnMudmVsb2NpdHk7CiAgICAgICAgICBwbGF5ZXIuc2hpcC5zZXRUZXh0dXJlKCJzaGlwIiArIHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmNvbG9yKTsKICAgICAgICAgIHBsYXllci5idWxsZXRzTG9hZGVkLmVuYWJsZUFsbCgpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgMzoKICAgICAgICAgIHBsYXllci5zaGlwLnZlbG9jaXR5TWFnbml0dWRlID0gdGhpcy5zZXR0aW5ncy52ZWxvY2l0eSAqIG1hdHRlck5vcm1hbGl6ZXJzLnZlbG9jaXR5OwogICAgICAgICAgcGxheWVyLnNoaXAuc2V0VGV4dHVyZSgic2hpZWxkZWQiICsgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uY29sb3IpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJvbkN1cnJlbnRTaGlwQ29sbGlzaW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvbkN1cnJlbnRTaGlwQ29sbGlzaW9uKGNvbGxpc2lvbikgewogICAgICB2YXIgcGxheWVyID0gdGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl07CiAgICAgIHZhciBib2R5ID0gZ2V0Qm9keUZyb21Db2xsaXNpb24ocGxheWVyLnNoaXAsIGNvbGxpc2lvbik7CgogICAgICBpZiAoYm9keS5jb2xsaXNpb25GaWx0ZXIuY2F0ZWdvcnkgPT09IHRoaXMuYnVsbGV0c0NhdGVnb3J5KSB7CiAgICAgICAgLy9jb2xsaXNpb24gd2l0aCBhIGJ1bGxldAogICAgICAgIHRoaXMub25CdWxsZXRDb2xsaXNpb24ocGxheWVyLnNoaXAsIGJvZHkuZ2FtZU9iamVjdCk7CiAgICAgIH0gZWxzZSBpZiAoYm9keS5jb2xsaXNpb25GaWx0ZXIuY2F0ZWdvcnkgPT09IHRoaXMucG93ZXJVcHNDYXRlZ29yeSkgewogICAgICAgIC8vQ29sbGlzaW9uIHdpdGggcG93ZXIgdXAKICAgICAgICB0aGlzLm9uUG93ZXJVcENvbGxpc2lvbihwbGF5ZXIuc2hpcCwgYm9keS5nYW1lT2JqZWN0KTsKICAgICAgfSBlbHNlIGlmIChib2R5LmNvbGxpc2lvbkZpbHRlci5jYXRlZ29yeSA9PT0gdGhpcy5zaGlwc0NhdGVnb3J5KSB7CiAgICAgICAgLy9Db2xsaXNpb24gd2l0aCBzaGlwCiAgICAgICAgaWYgKHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdLnN0YXRlID09PSAxICYmIHRoaXMucGxheWVyc1tib2R5LmdhbWVPYmplY3QubG9jYWxJZF0uc3RhdGUgPj0gMikgewogICAgICAgICAgdmFyIGRhdGEgPSB7CiAgICAgICAgICAgIGxvY2FsSWQ6IHRoaXMuY3VycmVudFBsYXllciwKICAgICAgICAgICAgc3RhdGU6IDAsCiAgICAgICAgICAgIGtpbGxlZEJ5OiBib2R5LmdhbWVPYmplY3QubG9jYWxJZAogICAgICAgICAgfTsKICAgICAgICAgIHRoaXMuc29ja2V0LmVtaXQod2Vic29ja2V0RXZlbnRzLkNIQU5HRV9TVEFURSwgZGF0YSk7CiAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKGRhdGEpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogIm9uQnVsbGV0Q29sbGlzaW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvbkJ1bGxldENvbGxpc2lvbihzaGlwLCBidWxsZXQpIHsKICAgICAgYnVsbGV0LmRlc3Ryb3koKTsKICAgICAgdmFyIHN0YXRlID0gdGhpcy5wbGF5ZXJzW3NoaXAubG9jYWxJZF0uc3RhdGUgLSAxOwogICAgICB2YXIgZGF0YSA9IHsKICAgICAgICBsb2NhbElkOiBzaGlwLmxvY2FsSWQsCiAgICAgICAgc3RhdGU6IHN0YXRlCiAgICAgIH07CgogICAgICBpZiAoc3RhdGUgPT09IDApIHsKICAgICAgICBkYXRhLmtpbGxlZEJ5ID0gYnVsbGV0LnNob3RCeTsKICAgICAgICB0aGlzLmNsZWFySW50ZXJ2YWxzKGZhbHNlKTsKICAgICAgfQoKICAgICAgdGhpcy5zb2NrZXQuZW1pdCh3ZWJzb2NrZXRFdmVudHMuQ0hBTkdFX1NUQVRFLCBkYXRhKTsKICAgICAgdGhpcy51cGRhdGVTdGF0ZShkYXRhKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZWxvYWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbG9hZChkYXRhKSB7CiAgICAgIHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmF2YWlsYWJsZUJ1bGxldHMgPSBkYXRhLmF2YWlsYWJsZUJ1bGxldHM7CiAgICAgIHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmJ1bGxldHNMb2FkZWQuZW5hYmxlVG8oZGF0YS5hdmFpbGFibGVCdWxsZXRzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJvblBvd2VyVXBDb2xsaXNpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uUG93ZXJVcENvbGxpc2lvbihzaGlwLCBwb3dlclVwKSB7CiAgICAgIGlmICh0aGlzLnBsYXllcnNbc2hpcC5sb2NhbElkXS5zdGF0ZSA8IDIpIHJldHVybjsKICAgICAgdmFyIGRhdGEgPSB7CiAgICAgICAgdHlwZTogImdldCIsCiAgICAgICAgbG9jYWxJZDogc2hpcC5sb2NhbElkLAogICAgICAgIHBvd2VyVXA6IHBvd2VyVXAucG93ZXJVcCwKICAgICAgICBpZDogcG93ZXJVcC5pZAogICAgICB9OwogICAgICB0aGlzLnNvY2tldC5lbWl0KHdlYnNvY2tldEV2ZW50cy5QT1dFUl9VUCwgZGF0YSk7CiAgICAgIHRoaXMucG93ZXJVcEV2ZW50KGRhdGEpOwogICAgfSAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAvL0dhbWUgbG9vcCBmdW5jdGlvbnMKCiAgfSwgewogICAga2V5OiAic2V0Q3VycmVudFBsYXllck5ld1ZlbG9jaXR5IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRDdXJyZW50UGxheWVyTmV3VmVsb2NpdHkoKSB7CiAgICAgIHZhciBfdmVsb2NpdHlGcm9tQW5nbGUzID0gdmVsb2NpdHlGcm9tQW5nbGUodGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc2hpcC5hbmdsZSwgdGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc2hpcC52ZWxvY2l0eU1hZ25pdHVkZSksCiAgICAgICAgICB4ID0gX3ZlbG9jaXR5RnJvbUFuZ2xlMy54LAogICAgICAgICAgeSA9IF92ZWxvY2l0eUZyb21BbmdsZTMueTsKCiAgICAgIHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdLnNoaXAuc2V0VmVsb2NpdHkoeCwgeSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZGVjZWxlcmF0ZUxpdHRsZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGVjZWxlcmF0ZUxpdHRsZShkZWx0YSkgewogICAgICB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwLnZlbG9jaXR5TWFnbml0dWRlID0gTWF0aC5tYXgoMCwgdGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc2hpcC52ZWxvY2l0eU1hZ25pdHVkZSAtIHRoaXMuc2V0dGluZ3MuZnJpY3Rpb25BaXIgKiBkZWx0YSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0TG9hZGVkQnVsbGV0UG9zaXRpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldExvYWRlZEJ1bGxldFBvc2l0aW9uKGluZGV4LCB0b3BMZWZ0LCBib3R0b21MZWZ0LCBjZW50ZXJMZWZ0LCBwbGF5ZXIpIHsKICAgICAgc3dpdGNoIChpbmRleCkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHg6IGJvdHRvbUxlZnQueCAtIHBsYXllci5zaGlwLndpZHRoIC8gNCAqIE1hdGguY29zKHBsYXllci5zaGlwLnJvdGF0aW9uKSwKICAgICAgICAgICAgeTogYm90dG9tTGVmdC55IC0gcGxheWVyLnNoaXAuaGVpZ2h0IC8gNCAqIE1hdGguc2luKHBsYXllci5zaGlwLnJvdGF0aW9uKQogICAgICAgICAgfTsKCiAgICAgICAgY2FzZSAxOgogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgeDogdG9wTGVmdC54IC0gcGxheWVyLnNoaXAud2lkdGggLyA0ICogTWF0aC5jb3MocGxheWVyLnNoaXAucm90YXRpb24pLAogICAgICAgICAgICB5OiB0b3BMZWZ0LnkgLSBwbGF5ZXIuc2hpcC5oZWlnaHQgLyA0ICogTWF0aC5zaW4ocGxheWVyLnNoaXAucm90YXRpb24pCiAgICAgICAgICB9OwoKICAgICAgICBjYXNlIDI6CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB4OiBjZW50ZXJMZWZ0LnggLSBwbGF5ZXIuc2hpcC53aWR0aCAvIDQgKiBNYXRoLmNvcyhwbGF5ZXIuc2hpcC5yb3RhdGlvbiksCiAgICAgICAgICAgIHk6IGNlbnRlckxlZnQueSAtIHBsYXllci5zaGlwLmhlaWdodCAvIDQgKiBNYXRoLnNpbihwbGF5ZXIuc2hpcC5yb3RhdGlvbikKICAgICAgICAgIH07CiAgICAgIH0KICAgIH0gLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy9PbiBjcmVhdGUgc2V0dXAKCiAgfSwgewogICAga2V5OiAic2V0VXBkYXRlU2hpcEludGVydmFsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRVcGRhdGVTaGlwSW50ZXJ2YWwoKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuY3VycmVudFBsYXllciA9PT0gbnVsbCkgcmV0dXJuOwogICAgICB2YXIgY3VycmVudFBsYXllciA9IHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdOwogICAgICB0aGlzLnVwZGF0ZVNoaXBJbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczYuc29ja2V0LmVtaXQod2Vic29ja2V0RXZlbnRzLlVQREFURV9TSElQLCBbX3RoaXM2LmN1cnJlbnRQbGF5ZXIsIE1hdGguZmxvb3IoY3VycmVudFBsYXllci5zaGlwLmFuZ2xlKSwgW051bWJlci5wYXJzZUZsb2F0KGN1cnJlbnRQbGF5ZXIuc2hpcC54LnRvRml4ZWQoMikpLCBOdW1iZXIucGFyc2VGbG9hdChjdXJyZW50UGxheWVyLnNoaXAueS50b0ZpeGVkKDIpKV0sIF90aGlzNi50aW1lLm5vd10pOwogICAgICB9LCAxMDAwIC8gdGhpcy51cGRhdGVGcHMpOwogICAgfQogIH0sIHsKICAgIGtleTogInNldFJlbG9hZEludGVydmFsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRSZWxvYWRJbnRlcnZhbCgpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICBpZiAodGhpcy5jdXJyZW50UGxheWVyID09PSBudWxsKSByZXR1cm47CiAgICAgIHRoaXMucmVsb2FkSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKF90aGlzNy5wbGF5ZXJzW190aGlzNy5jdXJyZW50UGxheWVyXS5zdGF0ZSA8IDIpIHJldHVybjsKICAgICAgICB2YXIgYXZhaWxhYmxlQnVsbGV0cyA9IE1hdGgubWluKF90aGlzNy5tYXhCdWxsZXRzLCBfdGhpczcucGxheWVyc1tfdGhpczcuY3VycmVudFBsYXllcl0uYXZhaWxhYmxlQnVsbGV0cyArIDEpOwogICAgICAgIHZhciBkYXRhID0gewogICAgICAgICAgbG9jYWxJZDogX3RoaXM3LmN1cnJlbnRQbGF5ZXIsCiAgICAgICAgICBhdmFpbGFibGVCdWxsZXRzOiBhdmFpbGFibGVCdWxsZXRzCiAgICAgICAgfTsKCiAgICAgICAgX3RoaXM3LnNvY2tldC5lbWl0KHdlYnNvY2tldEV2ZW50cy5SRUxPQUQsIGRhdGEpOwoKICAgICAgICBfdGhpczcucmVsb2FkKGRhdGEpOwogICAgICB9LCAxIC8gKHRoaXMuc2V0dGluZ3MucmVsb2FkaW5nVmVsb2NpdHkgKiBhcmNhZGVOb3JtYWxpemVycy5yZWxvYWRpbmdWZWxvY2l0eSkpOwogICAgfQogIH0sIHsKICAgIGtleTogInNldFBvd2VyVXBJbnRlcnZhbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0UG93ZXJVcEludGVydmFsKCkgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKCiAgICAgIHRoaXMucG93ZXJVcEludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzOC5nZW5lcmF0ZVBvd2VyVXAoe30sIDIpOwogICAgICB9LCB0aGlzLnBvd2VyVXBHZW5lcmF0aW9uVGltZSk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0T25EZXN0cm95IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRPbkRlc3Ryb3koKSB7CiAgICAgIHZhciBfdGhpczkgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuY3VycmVudFBsYXllciA9PT0gbnVsbCkgcmV0dXJuOwogICAgICB0aGlzLmV2ZW50cy5vbigiZGVzdHJveSIsIGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczkuY2xlYXJJbnRlcnZhbHModHJ1ZSk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImNsZWFySW50ZXJ2YWxzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjbGVhckludGVydmFscyhwb3dlclVwKSB7CiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy51cGRhdGVTaGlwSW50ZXJ2YWwpOwogICAgICBjbGVhckludGVydmFsKHRoaXMucmVsb2FkSW50ZXJ2YWwpOwogICAgICBpZiAocG93ZXJVcCkgY2xlYXJJbnRlcnZhbCh0aGlzLnBvd2VyVXBJbnRlcnZhbCk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gR2FtZVNjZW5lOwp9KFBoYXNlci5TY2VuZSk7CgpleHBvcnQgeyBHYW1lU2NlbmUgYXMgZGVmYXVsdCB9Ow=="},{"version":3,"sources":["/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/GameScene.js"],"names":["Phaser","websocketEvents","gameDimensions","arcadeNormalizers","powerUps","sceneKeys","matterNormalizers","detectTouchScreen","removeFromArray","_","createBulletsLoadedObject","getBodyFromCollision","loadImages","setInputHandlers","velocityFromAngle","GameScene","socket","game","key","setUpGame","updateFps","touchScreen","defaultImageOptions","friction","frictionAir","frictionStatic","ignoreGravity","maxBullets","powerUpIds","powerUpGenerationTime","on","UPDATE_SHIP","data","updateShip","SHOOT","createBullet","CHANGE_STATE","updateState","RELOAD","reload","POWER_UP","powerUpEvent","END_TURN","setTimeout","clearIntervals","scene","start","ranking","cloneDeep","timer","settings","currentPlayer","admin","map","maxVelocityLittle","velocity","accelerationLittle","respawnTime","powerUpVelocity","powerUpAngularVelocity","players","forEach","player","localId","availableBullets","lastTimestamp","powerUpsObjects","Object","entries","length","Date","now","Physics","Matter","Image","prototype","shapedSetOnCollide","callback","body","parts","part","onCollideCallback","setOnCollide","createCategories","createShips","setReloadInterval","setUpdateShipInterval","setPowerUpInterval","setOnDestroy","generatePowerUp","x","width","y","height","time","delta","rotationKey","isDown","rotating","rotate","accelerateLittleKey","accelerating","moveLittle","setCurrentPlayerNewVelocity","state","decelerateLittle","values","topLeft","ship","getTopLeft","bottomLeft","getBottomLeft","centerLeft","bulletsLoaded","gameObjects","bullet","index","getLoadedBulletPosition","autonomyTime","setVelocity","setAngularVelocity","shipsCategory","matter","world","nextCategory","bulletsCategory","powerUpsCategory","killableMapObjectCategory","notKillableMapObjectCategory","order","textures","add","image","color","setCollisionCategory","setAngle","velocityMagnitude","setInertia","Infinity","collision","onCurrentShipCollision","console","log","angle","bulletVelocity","position","setCollidesWith","shotBy","killFirstAlive","newPowerUp","powerUp","id","push","n","i","type","Math","floor","random","FloatBetween","emit","deltaTime","deltaTheta","sign","angularVelocity","createPowerUp","child","destroy","dataToSend","hasLaser","createLaser","previousMag","cos","PI","sin","killAll","setTexture","enableAll","collisionFilter","category","onBulletCollision","gameObject","onPowerUpCollision","killedBy","enableTo","max","rotation","updateShipInterval","setInterval","Number","parseFloat","toFixed","reloadInterval","min","reloadingVelocity","powerUpInterval","events","clearInterval","Scene"],"mappings":"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","sourcesContent":["import * as Phaser from \"phaser\";\nimport websocketEvents from \"../constants/websocketEvents\";\nimport {gameDimensions, arcadeNormalizers, powerUps, sceneKeys, matterNormalizers} from \"../constants/gameSettings\";\nimport {detectTouchScreen, removeFromArray} from \"../constants/constants\";\nimport _ from \"lodash\";\n//import createMap from \"../phaser/maps\";\nimport {\n    createBulletsLoadedObject,\n    getBodyFromCollision,\n    loadImages,\n    setInputHandlers,\n    velocityFromAngle\n} from \"./scene\";\n\n\nexport default class GameScene extends Phaser.Scene {\n\n    setUpGame(game){\n        this.timer = game.timer;\n        this.settings = game.settings;\n        this.currentPlayer = game.currentPlayer;\n        this.admin = game.admin;\n        this.map = game.map;\n        this.settings.maxVelocityLittle = game.settings.velocity+0.2;\n        this.settings.accelerationLittle = 0.4;\n        this.settings.respawnTime = 8000;\n        this.settings.frictionAir = 0.1;\n        this.settings.powerUpVelocity = 5;\n        this.settings.powerUpAngularVelocity = 20;\n        this.players = {};\n        game.players.forEach(player => {\n            this.players[player.localId] = _.cloneDeep(player);\n            this.players[player.localId].availableBullets = this.maxBullets;\n            this.players[player.localId].lastTimestamp = 0;\n        });\n        this.powerUpsObjects = [];\n    }\n\n    constructor(socket, game) {\n        super({key: sceneKeys.game});\n\n        this.socket = socket;\n        this.setUpGame(game);\n\n        this.updateFps = 10;\n        this.touchScreen = detectTouchScreen();\n        this.defaultImageOptions = {friction: 0, frictionAir: 0, frictionStatic: 0, ignoreGravity: true};\n        this.maxBullets = 3;\n        this.powerUpIds = 0;\n        this.powerUpGenerationTime = 10000;\n\n\n        this.socket.on(websocketEvents.UPDATE_SHIP, data => this.updateShip(data));\n        this.socket.on(websocketEvents.SHOOT, data => this.createBullet(data));\n        this.socket.on(websocketEvents.CHANGE_STATE, data => this.updateState(data));\n        this.socket.on(websocketEvents.RELOAD, data => this.reload(data));\n        this.socket.on(websocketEvents.POWER_UP, data => this.powerUpEvent(data));\n        this.socket.on(websocketEvents.END_TURN, data => {\n            setTimeout(()=>{\n                this.clearIntervals(true);\n                this.scene.start(sceneKeys.ranking, _.cloneDeep(data));\n            }, 2000);\n        });\n    }\n\n    init(game){\n        if(Object.entries(game).length>0) this.setUpGame(game);\n        else {\n            if(this.timer > Date.now()){\n                this.scene.start(sceneKeys.ranking, _.cloneDeep({\n                    players: _.cloneDeep(this.players),\n                    timer: this.timer\n                }));\n            }\n        }\n    }\n\n    preload(){\n        loadImages(this, sceneKeys.game);\n    }\n\n    create(){\n        Phaser.Physics.Matter.Image.prototype.shapedSetOnCollide = function (callback) {\n            if (this.body && this.body.parts && this.body.parts.length) {\n                for (let part of this.body.parts) {\n                    part.onCollideCallback = callback;\n                }\n            }\n            return this.setOnCollide(callback);\n        }\n\n        this.createCategories();\n        this.createShips();\n        //createMap(this); TODO: REDO MAPS\n\n        setInputHandlers(this, sceneKeys.game);\n\n        this.setReloadInterval();\n        this.setUpdateShipInterval();\n        if(this.admin === this.currentPlayer) this.setPowerUpInterval();\n\n        this.setOnDestroy();\n\n        this.generatePowerUp({x: gameDimensions.width/2, y: gameDimensions.height/2}, 2);\n    }\n\n    update(time, delta){\n        if(this.currentPlayer !== null) {\n            if (this.rotationKey.isDown || this.rotating) this.rotate(delta);\n            if (this.accelerateLittleKey.isDown || this.accelerating) this.moveLittle(delta);\n\n            this.setCurrentPlayerNewVelocity();\n            if (this.players[this.currentPlayer].state === 1) this.decelerateLittle(delta);\n        }\n\n        Object.values(this.players).forEach(player => {\n            const topLeft = player.ship.getTopLeft();\n            const bottomLeft = player.ship.getBottomLeft();\n            const centerLeft = {\n                x: (topLeft.x + bottomLeft.x) / 2,\n                y: (topLeft.y + bottomLeft.y) / 2\n            }\n            player.bulletsLoaded.gameObjects.forEach((bullet, index)=>{\n                const {x, y} = this.getLoadedBulletPosition(index, topLeft, bottomLeft, centerLeft, player);\n                bullet.x = x;\n                bullet.y = y;\n            });\n            if(player.localId!==this.currentPlayer){\n                player.ship.autonomyTime -= delta;\n                if(player.ship.autonomyTime<0) {\n                    player.ship.setVelocity(0);\n                    player.ship.setAngularVelocity(0);\n                }\n            }\n        });\n    }\n\n\n\n\n    //=============================================================================\n    //Creating things\n    createCategories(){\n        this.shipsCategory = this.matter.world.nextCategory();\n        this.bulletsCategory = this.matter.world.nextCategory();\n\n        this.powerUpsCategory = this.matter.world.nextCategory();\n\n        this.killableMapObjectCategory = this.matter.world.nextCategory();\n        this.notKillableMapObjectCategory = this.matter.world.nextCategory();\n    }\n\n    createShips(){\n        const order = [0, 3, 2, 1];\n        let index = 0;\n        const textures = [\"\", \"little\", \"ship\", \"shielded\"];\n        Object.values(this.players).forEach(player => {\n            if(player.state === 0) return;\n\n            player.ship = this.matter.add.image(\n                (order[index]<2 ? 30 : gameDimensions.width-30),\n                ( order[index]%2 === 0 ? 30 : gameDimensions.height-30 ),\n                textures[player.state]+player.color,\n                null,\n                this.defaultImageOptions\n            );\n            player.ship.setCollisionCategory(this.shipsCategory);\n            player.ship.setAngle(-45  * ( order[index] < 2 ? 1 : 3) * ( ( order[index] % 2 ) * 2 - 1 ));\n            player.ship.velocityMagnitude = this.settings.velocity*matterNormalizers.velocity;\n            player.ship.localId = player.localId;\n            player.ship.autonomyTime = 0;\n            this.matter.body.setInertia(player.ship.body, Infinity);\n\n            player.bulletsLoaded = createBulletsLoadedObject(this);\n\n            if(player.localId===this.currentPlayer){\n                player.ship.shapedSetOnCollide(collision => {\n                   this.onCurrentShipCollision(collision);\n                });\n            }\n\n            index++;\n        });\n    }\n\n    createBullet(data){\n        console.log(\"createBullet(\", data);\n        const {x, y} = velocityFromAngle(data.angle, this.settings.bulletVelocity*matterNormalizers.bulletVelocity);\n        const bullet = this.matter.add.image(\n            data.position.x,\n            data.position.y,\n            \"bullet\",\n            null,\n            this.defaultImageOptions\n        );\n        bullet.setCollisionCategory(this.bulletsCategory);\n        bullet.setCollidesWith([this.shipsCategory, this.killableMapObjectCategory, this.notKillableMapObjectCategory]);\n        bullet.setAngle(data.angle);\n        bullet.setVelocity(x, y);\n        bullet.shotBy = data.localId;\n        this.players[data.localId].availableBullets--;\n        this.players[data.localId].bulletsLoaded.killFirstAlive();\n        this.matter.body.setInertia(bullet.body, Infinity);\n    }\n\n    createPowerUp(data){\n        const newPowerUp = this.matter.add.image(data.position.x, data.position.y, data.powerUp, null, this.defaultImageOptions);\n        const {x, y} = velocityFromAngle(data.angle, this.settings.powerUpVelocity);\n        newPowerUp.setVelocity(x, y);\n        newPowerUp.setAngularVelocity(this.settings.powerUpAngularVelocity);\n        newPowerUp.powerUp = data.powerUp;\n        newPowerUp.setCollisionCategory(this.powerUpsCategory);\n        newPowerUp.id = data.id;\n        this.matter.body.setInertia(newPowerUp.body, Infinity);\n\n        this.powerUpsObjects.push(newPowerUp);\n    }\n\n    createLaser(){\n        //const maxLength = Math.sqrt( Math.pow(gameDimensions.width, 2) + Math.pow(gameDimensions.height, 2) );\n\n\n    }\n\n    generatePowerUp({x, y}, n=1){\n        for(let i = 0; i < n; i++){\n            const data = {\n                type: \"create\",\n                powerUp: powerUps[Math.floor(Math.random()*powerUps.length)],\n                position: {\n                    x: x || Phaser.Math.FloatBetween(0, gameDimensions.width),\n                    y: y || Phaser.Math.FloatBetween(0, gameDimensions.height)\n                },\n                angle: Phaser.Math.FloatBetween(0, 360),\n                id: ++this.powerUpIds\n            }\n            this.socket.emit(websocketEvents.POWER_UP, data);\n            this.powerUpEvent(data);\n        }\n    }\n\n\n\n\n    //=============================================================================\n    //Others do things via the websocket\n    updateShip(data){\n        const player = this.players[data[0]];\n        const deltaTime = (data[3]-player.lastTimestamp)/1000;\n        if(deltaTime<=0) return;\n\n        let deltaTheta = data[1] - Math.floor(player.ship.angle);\n\n        if(deltaTheta*Math.sign(this.settings.angularVelocity) < -10) deltaTheta += 360*Math.sign(this.settings.angularVelocity);\n        else if(deltaTheta*Math.sign(this.settings.angularVelocity) < 0) deltaTheta = 0;\n        const angularVelocity = deltaTheta / deltaTime;\n        player.ship.setAngularVelocity(angularVelocity);\n\n        player.ship.setVelocity( ( data[2][0]-player.ship.x ) / deltaTime, ( data[2][1]-player.ship.y ) / deltaTime );\n\n        player.lastTimestamp = data[3];\n        player.ship.autonomyTime = deltaTime*1000;\n    }\n\n    powerUpEvent(data){\n        //Create power up item\n        if(data.type === \"create\") this.createPowerUp(data);\n        //Player gets power up\n        else if(data.type === \"get\") {\n            for(let i=0; i<this.powerUpsObjects.length; i++){\n                const child = this.powerUpsObjects[i];\n                if(child.id === data.id){\n                    this.powerUpsObjects = removeFromArray(this.powerUpsObjects, i);\n                    child.destroy();\n                    break;\n                }\n            }\n            let dataToSend;\n            switch (data.powerUp){\n                case \"reverse\":\n                    this.settings.angularVelocity *= -1;\n                    break;\n                case \"shield\":\n                    dataToSend = {\n                        localId: data.localId,\n                        state: 3\n                    }\n                    this.socket.emit(websocketEvents.CHANGE_STATE, dataToSend);\n                    this.updateState(dataToSend);\n                    break;\n                case \"reload\":\n                    dataToSend = {\n                        localId: data.localId,\n                        availableBullets: this.maxBullets\n                    };\n                    this.socket.emit(websocketEvents.RELOAD, dataToSend);\n                    this.reload(dataToSend);\n                    break;\n                case \"laser\":\n                    this.players[data.localId].ship.hasLaser = true;\n            }\n        }\n        //Player uses power up\n        else if(data.type === \"use\") {\n            if (data.powerUp === \"laser\") this.createLaser(data);\n        }\n    }\n\n\n\n    //=============================================================================\n    //Current players does things\n    rotate(delta){\n        this.players[this.currentPlayer].ship.setAngle(\n            this.players[this.currentPlayer].ship.angle + delta * this.settings.angularVelocity * matterNormalizers.angularVelocity\n        );\n    }\n\n    moveLittle(delta){\n        const currentPlayer = this.players[this.currentPlayer];\n        if(currentPlayer.state === 1){\n            const ship = currentPlayer.ship;\n            const previousMag = ship.velocityMagnitude;\n            if(previousMag < this.settings.maxVelocityLittle * matterNormalizers.velocity){\n                currentPlayer.ship.velocityMagnitude += delta*this.settings.accelerationLittle;\n            } else {\n                currentPlayer.ship.velocityMagnitude = this.settings.maxVelocityLittle * matterNormalizers.velocity;\n            }\n        }\n    }\n\n    shoot(){\n        const currentPlayer = this.players[this.currentPlayer];\n        const ship = currentPlayer.ship;\n        const angle = ship.angle;\n        const data = {\n            position: {\n                x: ship.x + ship.width*Math.cos(angle * Math.PI / 180),\n                y: ship.y + ship.height*Math.sin(angle * Math.PI / 180)\n            },\n            angle: angle,\n            localId: this.currentPlayer\n        };\n        /*if(currentPlayer.ship.hasLaser){\n            data.type = \"use\";\n            data.powerUp = \"laser\";\n            this.socket.emit(websocketEvents.POWER_UP, data);\n            this.createLaser(data);\n        } else {*/\n            if(currentPlayer.availableBullets>0){\n                this.socket.emit(websocketEvents.SHOOT, data);\n                this.createBullet(data);\n            }\n        //}\n    }\n\n\n    updateState(data){\n        this.players[data.localId].state = data.state;\n        const player = this.players[data.localId];\n        switch (data.state) {\n            case 0:\n                player.ship.destroy();\n                this.players[data.localId].bulletsLoaded.killAll();\n                break;\n            case 1:\n                player.ship.setTexture(\"little\" + this.players[data.localId].color);\n                this.players[data.localId].bulletsLoaded.killAll();\n                if(data.localId === this.currentPlayer) {\n                    setTimeout(() => {\n                        if (this.players[data.localId].state === 1) {\n                            const data = {\n                                localId: this.currentPlayer,\n                                state: 2\n                            };\n                            this.updateState(data);\n                            this.socket.emit(websocketEvents.CHANGE_STATE, data);\n                        }\n                    }, this.settings.respawnTime);\n                }\n                break;\n            case 2:\n                player.ship.velocityMagnitude = this.settings.velocity * matterNormalizers.velocity;\n                player.ship.setTexture(\"ship\" + this.players[data.localId].color);\n                player.bulletsLoaded.enableAll();\n                break;\n            case 3:\n                player.ship.velocityMagnitude = this.settings.velocity * matterNormalizers.velocity;\n                player.ship.setTexture(\"shielded\" + this.players[data.localId].color);\n                break;\n        }\n    }\n\n    onCurrentShipCollision(collision) {\n        const player = this.players[this.currentPlayer];\n        const body = getBodyFromCollision(player.ship, collision);\n        if(body.collisionFilter.category === this.bulletsCategory){\n            //collision with a bullet\n            this.onBulletCollision(player.ship, body.gameObject);\n        } else if(body.collisionFilter.category === this.powerUpsCategory){\n            //Collision with power up\n            this.onPowerUpCollision(player.ship, body.gameObject);\n        } else if(body.collisionFilter.category === this.shipsCategory){\n            //Collision with ship\n            if(this.players[this.currentPlayer].state === 1 && this.players[body.gameObject.localId].state >= 2){\n                const data = {\n                    localId: this.currentPlayer,\n                    state: 0,\n                    killedBy: body.gameObject.localId\n                };\n                this.socket.emit(websocketEvents.CHANGE_STATE, data);\n                this.updateState(data);\n            }\n        }\n    }\n\n    onBulletCollision(ship, bullet){\n        bullet.destroy();\n        const state = this.players[ship.localId].state-1;\n        const data = {\n            localId: ship.localId,\n            state\n        };\n        if(state === 0) {\n            data.killedBy = bullet.shotBy;\n            this.clearIntervals(false);\n        }\n        this.socket.emit(websocketEvents.CHANGE_STATE, data);\n        this.updateState(data);\n    }\n\n\n    reload(data){\n        this.players[data.localId].availableBullets = data.availableBullets;\n        this.players[data.localId].bulletsLoaded.enableTo(data.availableBullets);\n    }\n\n    onPowerUpCollision(ship, powerUp){\n        if(this.players[ship.localId].state < 2 ) return;\n        const data = {\n            type: \"get\",\n            localId: ship.localId,\n            powerUp: powerUp.powerUp,\n            id: powerUp.id\n        }\n        this.socket.emit(websocketEvents.POWER_UP, data);\n        this.powerUpEvent(data);\n    }\n\n\n    //=============================================================================\n    //Game loop functions\n    setCurrentPlayerNewVelocity(){\n        const {x, y} = velocityFromAngle(\n            this.players[this.currentPlayer].ship.angle,\n            this.players[this.currentPlayer].ship.velocityMagnitude\n        );\n        this.players[this.currentPlayer].ship.setVelocity(x, y);\n    }\n\n    decelerateLittle(delta){\n        this.players[this.currentPlayer].ship.velocityMagnitude = Math.max(\n            0, this.players[this.currentPlayer].ship.velocityMagnitude - this.settings.frictionAir * delta\n        );\n    }\n\n    getLoadedBulletPosition(index, topLeft, bottomLeft, centerLeft, player){\n        switch (index){\n            case 0:\n                return {\n                    x: bottomLeft.x - (player.ship.width/4)*Math.cos(player.ship.rotation),\n                    y: bottomLeft.y - (player.ship.height/4)*Math.sin(player.ship.rotation)\n                };\n            case 1:\n                return{\n                    x: topLeft.x - (player.ship.width/4)*Math.cos(player.ship.rotation),\n                    y: topLeft.y - (player.ship.height/4)*Math.sin(player.ship.rotation)\n                };\n            case 2:\n                return {\n                    x: centerLeft.x - (player.ship.width/4)*Math.cos(player.ship.rotation),\n                    y: centerLeft.y - (player.ship.height/4)*Math.sin(player.ship.rotation)\n                };\n        }\n    }\n\n\n\n    //=============================================================================\n    //On create setup\n    setUpdateShipInterval(){\n        if(this.currentPlayer === null) return;\n\n        const currentPlayer = this.players[this.currentPlayer];\n        this.updateShipInterval = setInterval(()=>{\n            this.socket.emit(websocketEvents.UPDATE_SHIP, [\n                this.currentPlayer,\n                Math.floor(currentPlayer.ship.angle),\n                [\n                    Number.parseFloat(currentPlayer.ship.x.toFixed(2)),\n                    Number.parseFloat(currentPlayer.ship.y.toFixed(2))\n                ],\n                this.time.now\n            ]);\n        }, 1000/this.updateFps);\n    }\n\n    setReloadInterval(){\n        if(this.currentPlayer === null) return;\n\n        this.reloadInterval = setInterval(() => {\n            if(this.players[this.currentPlayer].state<2) return;\n            const availableBullets = Math.min(this.maxBullets, this.players[this.currentPlayer].availableBullets + 1);\n            const data = {\n                localId: this.currentPlayer,\n                availableBullets\n            };\n            this.socket.emit(websocketEvents.RELOAD, data);\n            this.reload(data);\n        }, 1/(this.settings.reloadingVelocity * arcadeNormalizers.reloadingVelocity));\n    }\n\n    setPowerUpInterval(){\n        this.powerUpInterval = setInterval(()=>{\n            this.generatePowerUp({}, 2);\n        }, this.powerUpGenerationTime);\n    }\n\n    setOnDestroy(){\n        if(this.currentPlayer === null) return;\n\n        this.events.on(\"destroy\", ()=>{\n            this.clearIntervals(true);\n        });\n    }\n\n    clearIntervals(powerUp){\n        clearInterval(this.updateShipInterval);\n        clearInterval(this.reloadInterval);\n        if(powerUp) clearInterval(this.powerUpInterval);\n    }\n}"]}]}