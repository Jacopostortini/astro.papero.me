{"remainingRequest":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/thread-loader/dist/cjs.js!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/babel-loader/lib/index.js!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/eslint-loader/index.js??ref--13-0!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/GameScene.js","dependencies":[{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/GameScene.js","mtime":1618057441118},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/cache-loader/dist/cjs.js","mtime":1616495189815},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/thread-loader/dist/cjs.js","mtime":1616495190967},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/babel-loader/lib/index.js","mtime":1616495189787},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/eslint-loader/index.js","mtime":1616495190059}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICIvbWVkaWEvamFjb3BvL1ZvbHVtZURhdGkvRG9jdW1lbnRpL3BhcGVyby50ay9jb3Ntb3MucGFwZXJvLm1lL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiL21lZGlhL2phY29wby9Wb2x1bWVEYXRpL0RvY3VtZW50aS9wYXBlcm8udGsvY29zbW9zLnBhcGVyby5tZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgX2luaGVyaXRzIGZyb20gIi9tZWRpYS9qYWNvcG8vVm9sdW1lRGF0aS9Eb2N1bWVudGkvcGFwZXJvLnRrL2Nvc21vcy5wYXBlcm8ubWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2luaGVyaXRzIjsKaW1wb3J0IF9jcmVhdGVTdXBlciBmcm9tICIvbWVkaWEvamFjb3BvL1ZvbHVtZURhdGkvRG9jdW1lbnRpL3BhcGVyby50ay9jb3Ntb3MucGFwZXJvLm1lL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVTdXBlciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZW50cmllcy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC52YWx1ZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIucGFyc2UtaW50LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubWF0aC5zaWduLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLnBhcnNlLWZsb2F0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLnRvLWZpeGVkLmpzIjsKaW1wb3J0ICogYXMgUGhhc2VyIGZyb20gInBoYXNlciI7CmltcG9ydCB3ZWJzb2NrZXRFdmVudHMgZnJvbSAiLi4vY29uc3RhbnRzL3dlYnNvY2tldEV2ZW50cyI7CmltcG9ydCB7IGdhbWVEaW1lbnNpb25zLCBub3JtYWxpemVycywgcG93ZXJVcHMsIHNjZW5lS2V5cyB9IGZyb20gIi4uL2NvbnN0YW50cy9nYW1lU2V0dGluZ3MiOwppbXBvcnQgeyBkZXRlY3RUb3VjaFNjcmVlbiB9IGZyb20gIi4uL2NvbnN0YW50cy9jb25zdGFudHMiOwppbXBvcnQgXyBmcm9tICJsb2Rhc2giOwppbXBvcnQgY3JlYXRlTWFwIGZyb20gIi4uL3BoYXNlci9tYXBzIjsKCnZhciBHYW1lU2NlbmUgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9QaGFzZXIkU2NlbmUpIHsKICBfaW5oZXJpdHMoR2FtZVNjZW5lLCBfUGhhc2VyJFNjZW5lKTsKCiAgdmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcihHYW1lU2NlbmUpOwoKICBmdW5jdGlvbiBHYW1lU2NlbmUoc29ja2V0LCBnYW1lKSB7CiAgICB2YXIgX3RoaXM7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEdhbWVTY2VuZSk7CgogICAgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCB7CiAgICAgIGtleTogc2NlbmVLZXlzLmdhbWUKICAgIH0pOwogICAgX3RoaXMuc29ja2V0ID0gc29ja2V0OwoKICAgIF90aGlzLnNldFVwR2FtZShnYW1lKTsKCiAgICBfdGhpcy51cGRhdGVGcHMgPSAxMDsKICAgIF90aGlzLnRvdWNoU2NyZWVuID0gZGV0ZWN0VG91Y2hTY3JlZW4oKTsKICAgIF90aGlzLnBvd2VyVXBJZHMgPSAwOwoKICAgIFBoYXNlci5QaHlzaWNzLkFyY2FkZS5Hcm91cC5wcm90b3R5cGUua2lsbEFsbCA9IGZ1bmN0aW9uICgpIHsKICAgICAgd2hpbGUgKHRoaXMuY291bnRBY3RpdmUoKSA+IDApIHsKICAgICAgICB0aGlzLmdldEZpcnN0QWxpdmUoKS5zZXRBY3RpdmUoZmFsc2UpLnNldFZpc2libGUoZmFsc2UpOwogICAgICB9CiAgICB9OwoKICAgIFBoYXNlci5QaHlzaWNzLkFyY2FkZS5Hcm91cC5wcm90b3R5cGUuZW5hYmxlQWxsID0gZnVuY3Rpb24gKCkgewogICAgICB3aGlsZSAodGhpcy5jb3VudEFjdGl2ZSgpIDwgMykgewogICAgICAgIHRoaXMuZ2V0Rmlyc3REZWFkKCkuc2V0QWN0aXZlKHRydWUpLnNldFZpc2libGUodHJ1ZSk7CiAgICAgIH0KICAgIH07CgogICAgX3RoaXMuc29ja2V0Lm9uKHdlYnNvY2tldEV2ZW50cy5VUERBVEVfU0hJUCwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIF90aGlzLnVwZGF0ZVNoaXAoZGF0YSk7CiAgICB9KTsKCiAgICBfdGhpcy5zb2NrZXQub24od2Vic29ja2V0RXZlbnRzLlNIT09ULCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gX3RoaXMuY3JlYXRlQnVsbGV0KGRhdGEpOwogICAgfSk7CgogICAgX3RoaXMuc29ja2V0Lm9uKHdlYnNvY2tldEV2ZW50cy5DSEFOR0VfU1RBVEUsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBfdGhpcy51cGRhdGVTdGF0ZShkYXRhKTsKICAgIH0pOwoKICAgIF90aGlzLnNvY2tldC5vbih3ZWJzb2NrZXRFdmVudHMuUkVMT0FELCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gX3RoaXMucmVsb2FkKGRhdGEpOwogICAgfSk7CgogICAgX3RoaXMuc29ja2V0Lm9uKHdlYnNvY2tldEV2ZW50cy5QT1dFUl9VUCwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIF90aGlzLnBvd2VyVXBFdmVudChkYXRhKTsKICAgIH0pOwoKICAgIF90aGlzLnNvY2tldC5vbih3ZWJzb2NrZXRFdmVudHMuRU5EX1RVUk4sIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzLmNsZWFySW50ZXJ2YWxzKHRydWUpOwoKICAgICAgICBfdGhpcy5zY2VuZS5zdGFydChzY2VuZUtleXMucmFua2luZywgXy5jbG9uZURlZXAoZGF0YSkpOwogICAgICB9LCAyMDAwKTsKICAgIH0pOwoKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhHYW1lU2NlbmUsIFt7CiAgICBrZXk6ICJzZXRVcEdhbWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFVwR2FtZShnYW1lKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdGhpcy50aW1lciA9IGdhbWUudGltZXI7CiAgICAgIHRoaXMuc2V0dGluZ3MgPSBnYW1lLnNldHRpbmdzOwogICAgICB0aGlzLmN1cnJlbnRQbGF5ZXIgPSBnYW1lLmN1cnJlbnRQbGF5ZXI7CiAgICAgIHRoaXMuYWRtaW4gPSBnYW1lLmFkbWluOwogICAgICB0aGlzLm1hcCA9IGdhbWUubWFwOwogICAgICB0aGlzLnNldHRpbmdzLm1heFZlbG9jaXR5TGl0dGxlID0gZ2FtZS5zZXR0aW5ncy52ZWxvY2l0eSArIDAuMjsKICAgICAgdGhpcy5zZXR0aW5ncy5hY2NlbGVyYXRpb25MaXR0bGUgPSAwLjQ7CiAgICAgIHRoaXMuc2V0dGluZ3MucmVzcGF3blRpbWUgPSA4MDAwOwogICAgICB0aGlzLnNldHRpbmdzLmZyaWN0aW9uQWlyID0gMC4xOwogICAgICB0aGlzLnNldHRpbmdzLnBvd2VyVXBWZWxvY2l0eSA9IDMwOwogICAgICB0aGlzLnNldHRpbmdzLnBvd2VyVXBBbmd1bGFyVmVsb2NpdHkgPSAyMDsKICAgICAgdGhpcy5wbGF5ZXJzID0ge307CiAgICAgIGdhbWUucGxheWVycy5mb3JFYWNoKGZ1bmN0aW9uIChwbGF5ZXIpIHsKICAgICAgICBfdGhpczIucGxheWVyc1twbGF5ZXIubG9jYWxJZF0gPSBfLmNsb25lRGVlcChwbGF5ZXIpOwogICAgICAgIF90aGlzMi5wbGF5ZXJzW3BsYXllci5sb2NhbElkXS5hdmFpbGFibGVCdWxsZXRzID0gMzsKICAgICAgICBfdGhpczIucGxheWVyc1twbGF5ZXIubG9jYWxJZF0ubGFzdFRpbWVzdGFtcCA9IDA7CiAgICAgIH0pOwogICAgICB0aGlzLnBvd2VyVXBzT2JqZWN0cyA9IHt9OwogICAgfQogIH0sIHsKICAgIGtleTogImluaXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGluaXQoZ2FtZSkgewogICAgICBpZiAoT2JqZWN0LmVudHJpZXMoZ2FtZSkubGVuZ3RoID4gMCkgdGhpcy5zZXRVcEdhbWUoZ2FtZSk7ZWxzZSB7CiAgICAgICAgaWYgKHRoaXMudGltZXIgPiBEYXRlLm5vdygpKSB7CiAgICAgICAgICB0aGlzLnNjZW5lLnN0YXJ0KHNjZW5lS2V5cy5yYW5raW5nLCBfLmNsb25lRGVlcCh7CiAgICAgICAgICAgIHBsYXllcnM6IF8uY2xvbmVEZWVwKHRoaXMucGxheWVycyksCiAgICAgICAgICAgIHRpbWVyOiB0aGlzLnRpbWVyCiAgICAgICAgICB9KSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAicHJlbG9hZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcHJlbG9hZCgpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA0OyBpKyspIHsKICAgICAgICB0aGlzLmxvYWQuaW1hZ2UoInNoaXAiICsgaSwgIi4vc2hpcHMvc2hpcCIgKyBpICsgIi5wbmciKTsKICAgICAgICB0aGlzLmxvYWQuaW1hZ2UoImxpdHRsZSIgKyBpLCAiLi9saXR0bGVzL2xpdHRsZSIgKyBpICsgIi5wbmciKTsKICAgICAgICB0aGlzLmxvYWQuaW1hZ2UoInNoaWVsZGVkIiArIGksICIuL3NoaWVsZGVkL3NoaWVsZGVkIiArIGkgKyAiLnBuZyIpOwogICAgICB9CgogICAgICB0aGlzLmxvYWQuaW1hZ2UoImJ1bGxldCIsICIuL2J1bGxldC5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJidWxsZXQtbG9hZGVkIiwgIi4vYnVsbGV0LWxvYWRlZC5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJibG9jazEiLCAiLi9ibG9ja3MvYmxvY2sxLnBuZyIpOwogICAgICB0aGlzLmxvYWQuaW1hZ2UoImJsb2NrMiIsICIuL2Jsb2Nrcy9ibG9jazIucG5nIik7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgiYmxvY2szIiwgIi4vYmxvY2tzL2Jsb2NrMy5wbmciKTsKCiAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBwb3dlclVwcy5sZW5ndGg7IF9pKyspIHsKICAgICAgICB0aGlzLmxvYWQuaW1hZ2UocG93ZXJVcHNbX2ldLCAiLi9wb3dlclVwcy8iICsgcG93ZXJVcHNbX2ldICsgIi5wbmciKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImNyZWF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlKCkgewogICAgICB0aGlzLmNyZWF0ZUdyb3VwcygpOwogICAgICB0aGlzLmNyZWF0ZVNoaXBzKCk7CiAgICAgIGNyZWF0ZU1hcCh0aGlzKTsKICAgICAgdGhpcy5zZXRLZXlJbnB1dEhhbmRsZXJzKCk7CiAgICAgIGlmICh0aGlzLnRvdWNoU2NyZWVuKSB0aGlzLnNldFRvdWNoSW5wdXRIYW5kbGVycygpOwogICAgICB0aGlzLnBoeXNpY3Mud29ybGQub24oIndvcmxkYm91bmRzIiwgZnVuY3Rpb24gKGJ1bGxldCkgewogICAgICAgIGJ1bGxldC5nYW1lT2JqZWN0LmRlc3Ryb3koKTsKICAgICAgfSk7CiAgICAgIHRoaXMuc2V0UmVsb2FkSW50ZXJ2YWwoKTsKICAgICAgdGhpcy5zZXRVcGRhdGVTaGlwSW50ZXJ2YWwoKTsKICAgICAgaWYgKHRoaXMuYWRtaW4gPT09IHRoaXMuY3VycmVudFBsYXllcikgdGhpcy5zZXRQb3dlclVwSW50ZXJ2YWwoKTsKICAgICAgdGhpcy5zZXRPbkRlc3Ryb3koKTsKICAgICAgdGhpcy5nZW5lcmF0ZVBvd2VyVXAoewogICAgICAgIHg6IGdhbWVEaW1lbnNpb25zLndpZHRoIC8gMiwKICAgICAgICB5OiBnYW1lRGltZW5zaW9ucy5oZWlnaHQgLyAyCiAgICAgIH0sIDIpOwogICAgfQogIH0sIHsKICAgIGtleTogInVwZGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlKHRpbWUsIGRlbHRhKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuY3VycmVudFBsYXllciAhPT0gbnVsbCkgewogICAgICAgIGlmICh0aGlzLnJvdGF0aW9uS2V5LmlzRG93biB8fCB0aGlzLnJvdGF0aW5nKSB0aGlzLnJvdGF0ZShkZWx0YSk7CiAgICAgICAgaWYgKHRoaXMuYWNjZWxlcmF0ZUxpdHRsZUtleS5pc0Rvd24gfHwgdGhpcy5hY2NlbGVyYXRpbmcpIHRoaXMubW92ZUxpdHRsZShkZWx0YSk7CiAgICAgICAgdGhpcy5zZXRDdXJyZW50UGxheWVyTmV3VmVsb2NpdHkoKTsKICAgICAgICBpZiAodGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc3RhdGUgPT09IDEpIHRoaXMuZGVjZWxlcmF0ZUxpdHRsZShkZWx0YSk7CiAgICAgIH0KCiAgICAgIE9iamVjdC52YWx1ZXModGhpcy5wbGF5ZXJzKS5mb3JFYWNoKGZ1bmN0aW9uIChwbGF5ZXIpIHsKICAgICAgICB2YXIgdG9wTGVmdCA9IHBsYXllci5zaGlwLmdldFRvcExlZnQoKTsKICAgICAgICB2YXIgYm90dG9tTGVmdCA9IHBsYXllci5zaGlwLmdldEJvdHRvbUxlZnQoKTsKICAgICAgICB2YXIgY2VudGVyTGVmdCA9IHsKICAgICAgICAgIHg6ICh0b3BMZWZ0LnggKyBib3R0b21MZWZ0LngpIC8gMiwKICAgICAgICAgIHk6ICh0b3BMZWZ0LnkgKyBib3R0b21MZWZ0LnkpIC8gMgogICAgICAgIH07CiAgICAgICAgcGxheWVyLmJ1bGxldHNMb2FkZWQuY2hpbGRyZW4uaXRlcmF0ZShmdW5jdGlvbiAoYnVsbGV0LCBpbmRleCkgewogICAgICAgICAgdmFyIF90aGlzMyRnZXRMb2FkZWRCdWxsZSA9IF90aGlzMy5nZXRMb2FkZWRCdWxsZXRQb3NpdGlvbihpbmRleCwgdG9wTGVmdCwgYm90dG9tTGVmdCwgY2VudGVyTGVmdCwgcGxheWVyKSwKICAgICAgICAgICAgICB4ID0gX3RoaXMzJGdldExvYWRlZEJ1bGxlLngsCiAgICAgICAgICAgICAgeSA9IF90aGlzMyRnZXRMb2FkZWRCdWxsZS55OwoKICAgICAgICAgIGJ1bGxldC54ID0geDsKICAgICAgICAgIGJ1bGxldC55ID0geTsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKHBsYXllci5sb2NhbElkICE9PSBfdGhpczMuY3VycmVudFBsYXllcikgewogICAgICAgICAgcGxheWVyLnNoaXAuYXV0b25vbXlUaW1lIC09IGRlbHRhOwoKICAgICAgICAgIGlmIChwbGF5ZXIuc2hpcC5hdXRvbm9teVRpbWUgPCAwKSB7CiAgICAgICAgICAgIHBsYXllci5zaGlwLnNldFZlbG9jaXR5KDApOwogICAgICAgICAgICBwbGF5ZXIuc2hpcC5zZXRBbmd1bGFyVmVsb2NpdHkoMCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0gLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy9DcmVhdGluZyB0aGluZ3MKCiAgfSwgewogICAga2V5OiAiY3JlYXRlR3JvdXBzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVHcm91cHMoKSB7CiAgICAgIHRoaXMuc2hpcHMgPSB0aGlzLnBoeXNpY3MuYWRkLmdyb3VwKHsKICAgICAgICBjb2xsaWRlV29ybGRCb3VuZHM6IHRydWUKICAgICAgfSk7CiAgICAgIHRoaXMuYnVsbGV0cyA9IHRoaXMucGh5c2ljcy5hZGQuZ3JvdXAoewogICAgICAgIGNvbGxpZGVXb3JsZEJvdW5kczogdHJ1ZQogICAgICB9KTsKICAgICAgdGhpcy5wb3dlclVwcyA9IHRoaXMucGh5c2ljcy5hZGQuZ3JvdXAoewogICAgICAgIGNvbGxpZGVXb3JsZEJvdW5kczogdHJ1ZSwKICAgICAgICBib3VuY2VYOiAxLAogICAgICAgIGJvdW5jZVk6IDEKICAgICAgfSk7CiAgICAgIHRoaXMua2lsbGFibGVNYXBPYmplY3RzID0gdGhpcy5waHlzaWNzLmFkZC5ncm91cCh7CiAgICAgICAgY29sbGlkZVdvcmxkQm91bmRzOiB0cnVlLAogICAgICAgIGltbW92YWJsZTogdHJ1ZQogICAgICB9KTsKICAgICAgdGhpcy5ub3RLaWxsYWJsZU1hcE9iamVjdHMgPSB0aGlzLnBoeXNpY3MuYWRkLmdyb3VwKHsKICAgICAgICBjb2xsaWRlV29ybGRCb3VuZHM6IHRydWUsCiAgICAgICAgaW1tb3ZhYmxlOiB0cnVlCiAgICAgIH0pOwogICAgICB0aGlzLnBoeXNpY3MuYWRkLmNvbGxpZGVyKHRoaXMucG93ZXJVcHMsIHRoaXMucG93ZXJVcHMpOwogICAgfQogIH0sIHsKICAgIGtleTogImNyZWF0ZVNoaXBzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVTaGlwcygpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICB2YXIgb3JkZXIgPSBbMCwgMywgMiwgMV07CiAgICAgIHZhciBpbmRleCA9IDA7CiAgICAgIHZhciB0ZXh0dXJlcyA9IFsiIiwgImxpdHRsZSIsICJzaGlwIl07CiAgICAgIE9iamVjdC52YWx1ZXModGhpcy5wbGF5ZXJzKS5mb3JFYWNoKGZ1bmN0aW9uIChwbGF5ZXIpIHsKICAgICAgICBwbGF5ZXIuc2hpcCA9IF90aGlzNC5zaGlwcy5jcmVhdGUob3JkZXJbaW5kZXhdIDwgMiA/IDMwIDogZ2FtZURpbWVuc2lvbnMud2lkdGggLSAzMCwgb3JkZXJbaW5kZXhdICUgMiA9PT0gMCA/IDMwIDogZ2FtZURpbWVuc2lvbnMuaGVpZ2h0IC0gMzAsIHRleHR1cmVzW3BsYXllci5zdGF0ZV0gKyBwbGF5ZXIuY29sb3IpOwoKICAgICAgICBpZiAocGxheWVyLnN0YXRlID09PSAwKSB7CiAgICAgICAgICBfdGhpczQuc2hpcHMua2lsbEFuZEhpZGUocGxheWVyLnNoaXApOwoKICAgICAgICAgIF90aGlzNC5zaGlwcy5yZW1vdmUocGxheWVyLnNoaXApOwogICAgICAgIH0KCiAgICAgICAgcGxheWVyLmJ1bGxldHNMb2FkZWQgPSBfdGhpczQucGh5c2ljcy5hZGQuZ3JvdXAoewogICAgICAgICAga2V5OiAiYnVsbGV0LWxvYWRlZCIsCiAgICAgICAgICBxdWFudGl0eTogMywKICAgICAgICAgIHZpc2libGU6IHBsYXllci5zdGF0ZSAhPT0gMCwKICAgICAgICAgIGFjdGl2ZTogcGxheWVyLnN0YXRlICE9PSAwCiAgICAgICAgfSk7CiAgICAgICAgcGxheWVyLnNoaXAubG9jYWxJZCA9IHBsYXllci5sb2NhbElkOwogICAgICAgIHBsYXllci5zaGlwLnNldEFuZ2xlKC00NSAqIChvcmRlcltpbmRleF0gPCAyID8gMSA6IDMpICogKG9yZGVyW2luZGV4XSAlIDIgKiAyIC0gMSkpOwogICAgICAgIHBsYXllci5zaGlwLnZlbG9jaXR5TWFnbml0dWRlID0gX3RoaXM0LnNldHRpbmdzLnZlbG9jaXR5ICogbm9ybWFsaXplcnMudmVsb2NpdHk7CiAgICAgICAgcGxheWVyLnNoaXAuYXV0b25vbXlUaW1lID0gMDsKCiAgICAgICAgaWYgKHBsYXllci5sb2NhbElkID09PSBfdGhpczQuY3VycmVudFBsYXllcikgewogICAgICAgICAgX3RoaXM0LnBoeXNpY3MuYWRkLm92ZXJsYXAocGxheWVyLnNoaXAsIF90aGlzNC5idWxsZXRzLCBmdW5jdGlvbiAoc2hpcCwgYnVsbGV0KSB7CiAgICAgICAgICAgIF90aGlzNC5vbkJ1bGxldENvbGxpc2lvbihzaGlwLCBidWxsZXQpOwogICAgICAgICAgfSk7CgogICAgICAgICAgX3RoaXM0LnBoeXNpY3MuYWRkLm92ZXJsYXAocGxheWVyLnNoaXAsIF90aGlzNC5wb3dlclVwcywgZnVuY3Rpb24gKHNoaXAsIHBvd2VyVXApIHsKICAgICAgICAgICAgX3RoaXM0Lm9uUG93ZXJVcE92ZXJsYXAoc2hpcCwgcG93ZXJVcCk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBfdGhpczQucGh5c2ljcy5hZGQuY29sbGlkZXIocGxheWVyLnNoaXAsIF90aGlzNC5zaGlwcywgZnVuY3Rpb24gKGN1cnJlbnRTaGlwLCBzaGlwKSB7CiAgICAgICAgICAgIGlmIChfdGhpczQucGxheWVyc1tfdGhpczQuY3VycmVudFBsYXllcl0uc3RhdGUgPT09IDEgJiYgX3RoaXM0LnBsYXllcnNbc2hpcC5sb2NhbElkXS5zdGF0ZSA+PSAyKSB7CiAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7CiAgICAgICAgICAgICAgICBsb2NhbElkOiBfdGhpczQuY3VycmVudFBsYXllciwKICAgICAgICAgICAgICAgIHN0YXRlOiAwLAogICAgICAgICAgICAgICAga2lsbGVkQnk6IHNoaXAubG9jYWxJZAogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIF90aGlzNC5zb2NrZXQuZW1pdCh3ZWJzb2NrZXRFdmVudHMuQ0hBTkdFX1NUQVRFLCBkYXRhKTsKCiAgICAgICAgICAgICAgX3RoaXM0LnVwZGF0ZVN0YXRlKGRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGluZGV4Kys7CiAgICAgIH0pOwogICAgICB0aGlzLnBoeXNpY3MuYWRkLmNvbGxpZGVyKHRoaXMuc2hpcHMsIHRoaXMuc2hpcHMpOwogICAgfQogIH0sIHsKICAgIGtleTogImNyZWF0ZUJ1bGxldCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlQnVsbGV0KGRhdGEpIHsKICAgICAgdmFyIF90aGlzJHBoeXNpY3MkdmVsb2NpdCA9IHRoaXMucGh5c2ljcy52ZWxvY2l0eUZyb21BbmdsZShkYXRhLmFuZ2xlLCB0aGlzLnNldHRpbmdzLmJ1bGxldFZlbG9jaXR5ICogbm9ybWFsaXplcnMuYnVsbGV0VmVsb2NpdHkpLAogICAgICAgICAgeCA9IF90aGlzJHBoeXNpY3MkdmVsb2NpdC54LAogICAgICAgICAgeSA9IF90aGlzJHBoeXNpY3MkdmVsb2NpdC55OwoKICAgICAgdmFyIGJ1bGxldCA9IHRoaXMuYnVsbGV0cy5jcmVhdGUoZGF0YS5wb3NpdGlvbi54LCBkYXRhLnBvc2l0aW9uLnksICJidWxsZXQiKTsKICAgICAgYnVsbGV0LmFuZ2xlID0gZGF0YS5hbmdsZTsKICAgICAgYnVsbGV0LnNldFZlbG9jaXR5KHgsIHkpOwogICAgICBidWxsZXQuc2hvdEJ5ID0gZGF0YS5sb2NhbElkOwogICAgICBidWxsZXQuYm9keS5vbldvcmxkQm91bmRzID0gdHJ1ZTsKICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uYXZhaWxhYmxlQnVsbGV0cy0tOwogICAgICB2YXIgZmlyc3RBbGl2ZSA9IHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmJ1bGxldHNMb2FkZWQuZ2V0Rmlyc3RBbGl2ZSgpOwoKICAgICAgaWYgKGZpcnN0QWxpdmUpIHsKICAgICAgICBmaXJzdEFsaXZlLnNldEFjdGl2ZShmYWxzZSkuc2V0VmlzaWJsZShmYWxzZSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJjcmVhdGVQb3dlclVwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVQb3dlclVwKGRhdGEpIHsKICAgICAgdGhpcy5wb3dlclVwc09iamVjdHNbZGF0YS5pZF0gPSB0aGlzLnBvd2VyVXBzLmNyZWF0ZShkYXRhLnBvc2l0aW9uLngsIGRhdGEucG9zaXRpb24ueSwgZGF0YS5wb3dlclVwKTsKCiAgICAgIHZhciBfdGhpcyRwaHlzaWNzJHZlbG9jaXQyID0gdGhpcy5waHlzaWNzLnZlbG9jaXR5RnJvbUFuZ2xlKGRhdGEuYW5nbGUsIHRoaXMuc2V0dGluZ3MucG93ZXJVcFZlbG9jaXR5KSwKICAgICAgICAgIHggPSBfdGhpcyRwaHlzaWNzJHZlbG9jaXQyLngsCiAgICAgICAgICB5ID0gX3RoaXMkcGh5c2ljcyR2ZWxvY2l0Mi55OwoKICAgICAgdGhpcy5wb3dlclVwc09iamVjdHNbZGF0YS5pZF0uc2V0VmVsb2NpdHkoeCwgeSk7CiAgICAgIHRoaXMucG93ZXJVcHNPYmplY3RzW2RhdGEuaWRdLnNldEFuZ3VsYXJWZWxvY2l0eSh0aGlzLnNldHRpbmdzLnBvd2VyVXBBbmd1bGFyVmVsb2NpdHkpOwogICAgICB0aGlzLnBvd2VyVXBzT2JqZWN0c1tkYXRhLmlkXS5pZCA9IGRhdGEuaWQ7CiAgICAgIHRoaXMucG93ZXJVcHNPYmplY3RzW2RhdGEuaWRdLnBvd2VyVXAgPSBkYXRhLnBvd2VyVXA7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2VuZXJhdGVQb3dlclVwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZW5lcmF0ZVBvd2VyVXAoX3JlZikgewogICAgICB2YXIgeCA9IF9yZWYueCwKICAgICAgICAgIHkgPSBfcmVmLnk7CiAgICAgIHZhciBuID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAxOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICB2YXIgZGF0YSA9IHsKICAgICAgICAgIHR5cGU6ICJjcmVhdGUiLAogICAgICAgICAgcG93ZXJVcDogcG93ZXJVcHNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogcG93ZXJVcHMubGVuZ3RoKV0sCiAgICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgICB4OiB4IHx8IFBoYXNlci5NYXRoLkZsb2F0QmV0d2VlbigwLCBnYW1lRGltZW5zaW9ucy53aWR0aCksCiAgICAgICAgICAgIHk6IHkgfHwgUGhhc2VyLk1hdGguRmxvYXRCZXR3ZWVuKDAsIGdhbWVEaW1lbnNpb25zLmhlaWdodCkKICAgICAgICAgIH0sCiAgICAgICAgICBhbmdsZTogUGhhc2VyLk1hdGguRmxvYXRCZXR3ZWVuKDAsIDM2MCksCiAgICAgICAgICBpZDogKyt0aGlzLnBvd2VyVXBJZHMKICAgICAgICB9OwogICAgICAgIHRoaXMuc29ja2V0LmVtaXQod2Vic29ja2V0RXZlbnRzLlBPV0VSX1VQLCBkYXRhKTsKICAgICAgICB0aGlzLnBvd2VyVXBFdmVudChkYXRhKTsKICAgICAgfQogICAgfSAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAvL090aGVycyBkbyB0aGluZ3MgdmlhIHRoZSB3ZWJzb2NrZXQKCiAgfSwgewogICAga2V5OiAidXBkYXRlU2hpcCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlU2hpcChkYXRhKSB7CiAgICAgIHZhciBwbGF5ZXIgPSB0aGlzLnBsYXllcnNbZGF0YVswXV07CiAgICAgIHZhciBkZWx0YVRpbWUgPSAoZGF0YVszXSAtIHBsYXllci5sYXN0VGltZXN0YW1wKSAvIDEwMDA7CiAgICAgIGlmIChkZWx0YVRpbWUgPD0gMCkgcmV0dXJuOwogICAgICB2YXIgZGVsdGFUaGV0YSA9IGRhdGFbMV0gLSBOdW1iZXIucGFyc2VJbnQocGxheWVyLnNoaXAuYW5nbGUpOwogICAgICBpZiAoZGVsdGFUaGV0YSAqIE1hdGguc2lnbih0aGlzLnNldHRpbmdzLmFuZ3VsYXJWZWxvY2l0eSkgPCAtMTApIGRlbHRhVGhldGEgKz0gMzYwICogTWF0aC5zaWduKHRoaXMuc2V0dGluZ3MuYW5ndWxhclZlbG9jaXR5KTtlbHNlIGlmIChkZWx0YVRoZXRhICogTWF0aC5zaWduKHRoaXMuc2V0dGluZ3MuYW5ndWxhclZlbG9jaXR5KSA8IDApIGRlbHRhVGhldGEgPSAwOwogICAgICB2YXIgYW5ndWxhclZlbG9jaXR5ID0gZGVsdGFUaGV0YSAvIGRlbHRhVGltZTsKICAgICAgcGxheWVyLnNoaXAuc2V0QW5ndWxhclZlbG9jaXR5KGFuZ3VsYXJWZWxvY2l0eSk7CiAgICAgIHBsYXllci5zaGlwLnNldFZlbG9jaXR5KChkYXRhWzJdWzBdIC0gcGxheWVyLnNoaXAueCkgLyBkZWx0YVRpbWUsIChkYXRhWzJdWzFdIC0gcGxheWVyLnNoaXAueSkgLyBkZWx0YVRpbWUpOwogICAgICBwbGF5ZXIubGFzdFRpbWVzdGFtcCA9IGRhdGFbM107CiAgICAgIHBsYXllci5zaGlwLmF1dG9ub215VGltZSA9IGRlbHRhVGltZSAqIDEwMDA7CiAgICB9CiAgfSwgewogICAga2V5OiAicG93ZXJVcEV2ZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwb3dlclVwRXZlbnQoZGF0YSkgewogICAgICBpZiAoZGF0YS50eXBlID09PSAiY3JlYXRlIikgdGhpcy5jcmVhdGVQb3dlclVwKGRhdGEpO2Vsc2UgaWYgKGRhdGEudHlwZSA9PT0gImdldCIpIHsKICAgICAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLnBvd2VyVXBzLmdldENoaWxkcmVuKCk7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBjaGlsZCA9IGNoaWxkcmVuW2ldOwoKICAgICAgICAgIGlmIChjaGlsZC5pZCA9PT0gZGF0YS5pZCkgewogICAgICAgICAgICB0aGlzLnBvd2VyVXBzLnJlbW92ZShjaGlsZCk7CiAgICAgICAgICAgIGNoaWxkLmRlc3Ryb3koKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZGF0YS5wb3dlclVwID09PSAicmV2ZXJzZSIpIHRoaXMuc2V0dGluZ3MuYW5ndWxhclZlbG9jaXR5ICo9IC0xO2Vsc2UgaWYgKGRhdGEucG93ZXJVcCA9PT0gInNoaWVsZCIpIHsKICAgICAgICAgIHZhciBkYXRhU3RhdGUgPSB7CiAgICAgICAgICAgIGxvY2FsSWQ6IGRhdGEubG9jYWxJZCwKICAgICAgICAgICAgc3RhdGU6IDMKICAgICAgICAgIH07CiAgICAgICAgICB0aGlzLnNvY2tldC5lbWl0KHdlYnNvY2tldEV2ZW50cy5DSEFOR0VfU1RBVEUsIGRhdGFTdGF0ZSk7CiAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKGRhdGFTdGF0ZSk7CiAgICAgICAgfSBlbHNlIGlmIChkYXRhLnBvd2VyVXAgPT09ICJyZWxvYWQiKSB7CiAgICAgICAgICB2YXIgZGF0YVJlbG9hZCA9IHsKICAgICAgICAgICAgbG9jYWxJZDogZGF0YS5sb2NhbElkLAogICAgICAgICAgICBhdmFpbGFibGVCdWxsZXRzOiAzCiAgICAgICAgICB9OwogICAgICAgICAgdGhpcy5zb2NrZXQuZW1pdCh3ZWJzb2NrZXRFdmVudHMuUkVMT0FELCBkYXRhUmVsb2FkKTsKICAgICAgICAgIHRoaXMucmVsb2FkKGRhdGFSZWxvYWQpOwogICAgICAgIH0KICAgICAgfQogICAgfSAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAvL0N1cnJlbnQgcGxheWVycyBkb2VzIHRoaW5ncwoKICB9LCB7CiAgICBrZXk6ICJyb3RhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJvdGF0ZShkZWx0YSkgewogICAgICB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwLmFuZ2xlICs9IGRlbHRhICogdGhpcy5zZXR0aW5ncy5hbmd1bGFyVmVsb2NpdHkgKiBub3JtYWxpemVycy5hbmd1bGFyVmVsb2NpdHk7CiAgICB9CiAgfSwgewogICAga2V5OiAibW92ZUxpdHRsZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbW92ZUxpdHRsZShkZWx0YSkgewogICAgICB2YXIgY3VycmVudFBsYXllciA9IHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdOwoKICAgICAgaWYgKGN1cnJlbnRQbGF5ZXIuc3RhdGUgPT09IDEpIHsKICAgICAgICB2YXIgc2hpcCA9IGN1cnJlbnRQbGF5ZXIuc2hpcDsKICAgICAgICB2YXIgcHJldmlvdXNNYWcgPSBzaGlwLnZlbG9jaXR5TWFnbml0dWRlOwoKICAgICAgICBpZiAocHJldmlvdXNNYWcgPCB0aGlzLnNldHRpbmdzLm1heFZlbG9jaXR5TGl0dGxlICogbm9ybWFsaXplcnMudmVsb2NpdHkpIHsKICAgICAgICAgIGN1cnJlbnRQbGF5ZXIuc2hpcC52ZWxvY2l0eU1hZ25pdHVkZSArPSBkZWx0YSAqIHRoaXMuc2V0dGluZ3MuYWNjZWxlcmF0aW9uTGl0dGxlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjdXJyZW50UGxheWVyLnNoaXAudmVsb2NpdHlNYWduaXR1ZGUgPSB0aGlzLnNldHRpbmdzLm1heFZlbG9jaXR5TGl0dGxlICogbm9ybWFsaXplcnMudmVsb2NpdHk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAic2hvb3QiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNob290KCkgewogICAgICB2YXIgY3VycmVudFBsYXllciA9IHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdOwoKICAgICAgaWYgKGN1cnJlbnRQbGF5ZXIuYXZhaWxhYmxlQnVsbGV0cyA+IDApIHsKICAgICAgICB2YXIgc2hpcCA9IGN1cnJlbnRQbGF5ZXIuc2hpcDsKICAgICAgICB2YXIgYW5nbGUgPSBzaGlwLmFuZ2xlOwogICAgICAgIHZhciBkYXRhID0gewogICAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgICAgeDogc2hpcC54ICsgc2hpcC53aWR0aCAqIE1hdGguY29zKGFuZ2xlICogTWF0aC5QSSAvIDE4MCksCiAgICAgICAgICAgIHk6IHNoaXAueSArIHNoaXAuaGVpZ2h0ICogTWF0aC5zaW4oYW5nbGUgKiBNYXRoLlBJIC8gMTgwKQogICAgICAgICAgfSwKICAgICAgICAgIGFuZ2xlOiBhbmdsZSwKICAgICAgICAgIGxvY2FsSWQ6IHRoaXMuY3VycmVudFBsYXllcgogICAgICAgIH07CiAgICAgICAgdGhpcy5zb2NrZXQuZW1pdCh3ZWJzb2NrZXRFdmVudHMuU0hPT1QsIGRhdGEpOwogICAgICAgIHRoaXMuY3JlYXRlQnVsbGV0KGRhdGEpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAidXBkYXRlU3RhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZVN0YXRlKGRhdGEpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICB0aGlzLnBsYXllcnNbZGF0YS5sb2NhbElkXS5zdGF0ZSA9IGRhdGEuc3RhdGU7CiAgICAgIHZhciBwbGF5ZXIgPSB0aGlzLnBsYXllcnNbZGF0YS5sb2NhbElkXTsKCiAgICAgIHN3aXRjaCAoZGF0YS5zdGF0ZSkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIHRoaXMuc2hpcHMua2lsbEFuZEhpZGUocGxheWVyLnNoaXApOwogICAgICAgICAgdGhpcy5zaGlwcy5yZW1vdmUocGxheWVyLnNoaXApOwogICAgICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uYnVsbGV0c0xvYWRlZC5raWxsQWxsKCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAxOgogICAgICAgICAgcGxheWVyLnNoaXAuc2V0VGV4dHVyZSgibGl0dGxlIiArIHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmNvbG9yKTsKICAgICAgICAgIHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmJ1bGxldHNMb2FkZWQua2lsbEFsbCgpOwoKICAgICAgICAgIGlmIChkYXRhLmxvY2FsSWQgPT09IHRoaXMuY3VycmVudFBsYXllcikgewogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBpZiAoX3RoaXM1LnBsYXllcnNbZGF0YS5sb2NhbElkXS5zdGF0ZSA9PT0gMSkgewogICAgICAgICAgICAgICAgdmFyIF9kYXRhID0gewogICAgICAgICAgICAgICAgICBsb2NhbElkOiBfdGhpczUuY3VycmVudFBsYXllciwKICAgICAgICAgICAgICAgICAgc3RhdGU6IDIKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgX3RoaXM1LnVwZGF0ZVN0YXRlKF9kYXRhKTsKCiAgICAgICAgICAgICAgICBfdGhpczUuc29ja2V0LmVtaXQod2Vic29ja2V0RXZlbnRzLkNIQU5HRV9TVEFURSwgX2RhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgdGhpcy5zZXR0aW5ncy5yZXNwYXduVGltZSk7CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgMjoKICAgICAgICAgIHBsYXllci5zaGlwLnZlbG9jaXR5TWFnbml0dWRlID0gdGhpcy5zZXR0aW5ncy52ZWxvY2l0eSAqIG5vcm1hbGl6ZXJzLnZlbG9jaXR5OwogICAgICAgICAgcGxheWVyLnNoaXAuc2V0VGV4dHVyZSgic2hpcCIgKyB0aGlzLnBsYXllcnNbZGF0YS5sb2NhbElkXS5jb2xvcik7CiAgICAgICAgICBwbGF5ZXIuYnVsbGV0c0xvYWRlZC5lbmFibGVBbGwoKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIDM6CiAgICAgICAgICBwbGF5ZXIuc2hpcC52ZWxvY2l0eU1hZ25pdHVkZSA9IHRoaXMuc2V0dGluZ3MudmVsb2NpdHkgKiBub3JtYWxpemVycy52ZWxvY2l0eTsKICAgICAgICAgIHBsYXllci5zaGlwLnNldFRleHR1cmUoInNoaWVsZGVkIiArIHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmNvbG9yKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAib25CdWxsZXRDb2xsaXNpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uQnVsbGV0Q29sbGlzaW9uKHNoaXAsIGJ1bGxldCkgewogICAgICBidWxsZXQuZGVzdHJveSgpOwogICAgICB2YXIgc3RhdGUgPSB0aGlzLnBsYXllcnNbc2hpcC5sb2NhbElkXS5zdGF0ZSAtIDE7CiAgICAgIHZhciBkYXRhID0gewogICAgICAgIGxvY2FsSWQ6IHNoaXAubG9jYWxJZCwKICAgICAgICBzdGF0ZTogc3RhdGUKICAgICAgfTsKCiAgICAgIGlmIChzdGF0ZSA9PT0gMCkgewogICAgICAgIGRhdGEua2lsbGVkQnkgPSBidWxsZXQuc2hvdEJ5OwogICAgICAgIHRoaXMuY2xlYXJJbnRlcnZhbHMoZmFsc2UpOwogICAgICB9CgogICAgICB0aGlzLnNvY2tldC5lbWl0KHdlYnNvY2tldEV2ZW50cy5DSEFOR0VfU1RBVEUsIGRhdGEpOwogICAgICB0aGlzLnVwZGF0ZVN0YXRlKGRhdGEpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbG9hZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVsb2FkKGRhdGEpIHsKICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uYXZhaWxhYmxlQnVsbGV0cyA9IGRhdGEuYXZhaWxhYmxlQnVsbGV0czsKCiAgICAgIHRyeSB7CiAgICAgICAgd2hpbGUgKHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmJ1bGxldHNMb2FkZWQuY291bnRBY3RpdmUoKSA8IGRhdGEuYXZhaWxhYmxlQnVsbGV0cykgewogICAgICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uYnVsbGV0c0xvYWRlZC5nZXRGaXJzdERlYWQoKS5zZXRBY3RpdmUodHJ1ZSkuc2V0VmlzaWJsZSh0cnVlKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogIm9uUG93ZXJVcE92ZXJsYXAiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uUG93ZXJVcE92ZXJsYXAoc2hpcCwgcG93ZXJVcCkgewogICAgICBpZiAodGhpcy5wbGF5ZXJzW3NoaXAubG9jYWxJZF0uc3RhdGUgPCAyKSByZXR1cm47CiAgICAgIHZhciBkYXRhID0gewogICAgICAgIHR5cGU6ICJnZXQiLAogICAgICAgIGxvY2FsSWQ6IHNoaXAubG9jYWxJZCwKICAgICAgICBwb3dlclVwOiBwb3dlclVwLnBvd2VyVXAsCiAgICAgICAgaWQ6IHBvd2VyVXAuaWQKICAgICAgfTsKICAgICAgdGhpcy5zb2NrZXQuZW1pdCh3ZWJzb2NrZXRFdmVudHMuUE9XRVJfVVAsIGRhdGEpOwogICAgICB0aGlzLnBvd2VyVXBFdmVudChkYXRhKTsKICAgIH0gLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy9HYW1lIGxvb3AgZnVuY3Rpb25zCgogIH0sIHsKICAgIGtleTogInNldEN1cnJlbnRQbGF5ZXJOZXdWZWxvY2l0eSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Q3VycmVudFBsYXllck5ld1ZlbG9jaXR5KCkgewogICAgICB2YXIgX3RoaXMkcGh5c2ljcyR2ZWxvY2l0MyA9IHRoaXMucGh5c2ljcy52ZWxvY2l0eUZyb21BbmdsZSh0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwLmFuZ2xlLCB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwLnZlbG9jaXR5TWFnbml0dWRlKSwKICAgICAgICAgIHggPSBfdGhpcyRwaHlzaWNzJHZlbG9jaXQzLngsCiAgICAgICAgICB5ID0gX3RoaXMkcGh5c2ljcyR2ZWxvY2l0My55OwoKICAgICAgdGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc2hpcC5zZXRWZWxvY2l0eSh4LCB5KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJkZWNlbGVyYXRlTGl0dGxlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZWNlbGVyYXRlTGl0dGxlKGRlbHRhKSB7CiAgICAgIHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdLnNoaXAudmVsb2NpdHlNYWduaXR1ZGUgPSBNYXRoLm1heCgwLCB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwLnZlbG9jaXR5TWFnbml0dWRlIC0gdGhpcy5zZXR0aW5ncy5mcmljdGlvbkFpciAqIGRlbHRhKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRMb2FkZWRCdWxsZXRQb3NpdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TG9hZGVkQnVsbGV0UG9zaXRpb24oaW5kZXgsIHRvcExlZnQsIGJvdHRvbUxlZnQsIGNlbnRlckxlZnQsIHBsYXllcikgewogICAgICBzd2l0Y2ggKGluZGV4KSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgeDogYm90dG9tTGVmdC54IC0gcGxheWVyLnNoaXAud2lkdGggLyA0ICogTWF0aC5jb3MocGxheWVyLnNoaXAucm90YXRpb24pLAogICAgICAgICAgICB5OiBib3R0b21MZWZ0LnkgLSBwbGF5ZXIuc2hpcC5oZWlnaHQgLyA0ICogTWF0aC5zaW4ocGxheWVyLnNoaXAucm90YXRpb24pCiAgICAgICAgICB9OwoKICAgICAgICBjYXNlIDE6CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB4OiB0b3BMZWZ0LnggLSBwbGF5ZXIuc2hpcC53aWR0aCAvIDQgKiBNYXRoLmNvcyhwbGF5ZXIuc2hpcC5yb3RhdGlvbiksCiAgICAgICAgICAgIHk6IHRvcExlZnQueSAtIHBsYXllci5zaGlwLmhlaWdodCAvIDQgKiBNYXRoLnNpbihwbGF5ZXIuc2hpcC5yb3RhdGlvbikKICAgICAgICAgIH07CgogICAgICAgIGNhc2UgMjoKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHg6IGNlbnRlckxlZnQueCAtIHBsYXllci5zaGlwLndpZHRoIC8gNCAqIE1hdGguY29zKHBsYXllci5zaGlwLnJvdGF0aW9uKSwKICAgICAgICAgICAgeTogY2VudGVyTGVmdC55IC0gcGxheWVyLnNoaXAuaGVpZ2h0IC8gNCAqIE1hdGguc2luKHBsYXllci5zaGlwLnJvdGF0aW9uKQogICAgICAgICAgfTsKICAgICAgfQogICAgfSAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAvL09uIGNyZWF0ZSBzZXR1cAoKICB9LCB7CiAgICBrZXk6ICJzZXRLZXlJbnB1dEhhbmRsZXJzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRLZXlJbnB1dEhhbmRsZXJzKCkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmN1cnJlbnRQbGF5ZXIgPT09IG51bGwpIHJldHVybjsKICAgICAgdGhpcy5yb3RhdGlvbktleSA9IHRoaXMuaW5wdXQua2V5Ym9hcmQuYWRkS2V5KFBoYXNlci5JbnB1dC5LZXlib2FyZC5LZXlDb2Rlcy5TUEFDRSk7CiAgICAgIHRoaXMuYWNjZWxlcmF0ZUxpdHRsZUtleSA9IHRoaXMuaW5wdXQua2V5Ym9hcmQuYWRkS2V5KFBoYXNlci5JbnB1dC5LZXlib2FyZC5LZXlDb2Rlcy5FTlRFUik7CiAgICAgIHRoaXMuaW5wdXQua2V5Ym9hcmQub24oImtleXVwLUVOVEVSIiwgZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChfdGhpczYucGxheWVyc1tfdGhpczYuY3VycmVudFBsYXllcl0uc3RhdGUgPj0gMikgX3RoaXM2LnNob290KCk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogInNldFRvdWNoSW5wdXRIYW5kbGVycyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0VG91Y2hJbnB1dEhhbmRsZXJzKCkgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmN1cnJlbnRQbGF5ZXIgPT09IG51bGwpIHJldHVybjsKICAgICAgdGhpcy5pbnB1dC5hZGRQb2ludGVyKDEpOwogICAgICB0aGlzLmlucHV0Lm9uKCJwb2ludGVyZG93biIsIGZ1bmN0aW9uIChwb2ludGVyKSB7CiAgICAgICAgaWYgKHBvaW50ZXIueCA8IGdhbWVEaW1lbnNpb25zLndpZHRoIC8gMikgewogICAgICAgICAgX3RoaXM3LnJvdGF0aW5nID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKF90aGlzNy5wbGF5ZXJzW190aGlzNy5jdXJyZW50UGxheWVyXS5zdGF0ZSA+PSAyKSBfdGhpczcuc2hvb3QoKTtlbHNlIHsKICAgICAgICAgICAgX3RoaXM3LmFjY2VsZXJhdGluZyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5pbnB1dC5vbigicG9pbnRlcnVwIiwgZnVuY3Rpb24gKHBvaW50ZXIpIHsKICAgICAgICBpZiAocG9pbnRlci54IDwgZ2FtZURpbWVuc2lvbnMud2lkdGggLyAyKSB7CiAgICAgICAgICBfdGhpczcucm90YXRpbmcgPSBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXM3LmFjY2VsZXJhdGluZyA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0VXBkYXRlU2hpcEludGVydmFsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRVcGRhdGVTaGlwSW50ZXJ2YWwoKSB7CiAgICAgIHZhciBfdGhpczggPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuY3VycmVudFBsYXllciA9PT0gbnVsbCkgcmV0dXJuOwogICAgICB2YXIgY3VycmVudFBsYXllciA9IHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdOwogICAgICB0aGlzLnVwZGF0ZVNoaXBJbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczguc29ja2V0LmVtaXQod2Vic29ja2V0RXZlbnRzLlVQREFURV9TSElQLCBbX3RoaXM4LmN1cnJlbnRQbGF5ZXIsIE51bWJlci5wYXJzZUludChjdXJyZW50UGxheWVyLnNoaXAuYW5nbGUpLCBbTnVtYmVyLnBhcnNlRmxvYXQoY3VycmVudFBsYXllci5zaGlwLngudG9GaXhlZCgyKSksIE51bWJlci5wYXJzZUZsb2F0KGN1cnJlbnRQbGF5ZXIuc2hpcC55LnRvRml4ZWQoMikpXSwgX3RoaXM4LnRpbWUubm93XSk7CiAgICAgIH0sIDEwMDAgLyB0aGlzLnVwZGF0ZUZwcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0UmVsb2FkSW50ZXJ2YWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFJlbG9hZEludGVydmFsKCkgewogICAgICB2YXIgX3RoaXM5ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmN1cnJlbnRQbGF5ZXIgPT09IG51bGwpIHJldHVybjsKICAgICAgdGhpcy5yZWxvYWRJbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoX3RoaXM5LnBsYXllcnNbX3RoaXM5LmN1cnJlbnRQbGF5ZXJdLnN0YXRlIDwgMikgcmV0dXJuOwogICAgICAgIHZhciBhdmFpbGFibGVCdWxsZXRzID0gTWF0aC5taW4oMywgX3RoaXM5LnBsYXllcnNbX3RoaXM5LmN1cnJlbnRQbGF5ZXJdLmF2YWlsYWJsZUJ1bGxldHMgKyAxKTsKICAgICAgICB2YXIgZGF0YSA9IHsKICAgICAgICAgIGxvY2FsSWQ6IF90aGlzOS5jdXJyZW50UGxheWVyLAogICAgICAgICAgYXZhaWxhYmxlQnVsbGV0czogYXZhaWxhYmxlQnVsbGV0cwogICAgICAgIH07CgogICAgICAgIF90aGlzOS5zb2NrZXQuZW1pdCh3ZWJzb2NrZXRFdmVudHMuUkVMT0FELCBkYXRhKTsKCiAgICAgICAgX3RoaXM5LnJlbG9hZChkYXRhKTsKICAgICAgfSwgMSAvICh0aGlzLnNldHRpbmdzLnJlbG9hZGluZ1ZlbG9jaXR5ICogbm9ybWFsaXplcnMucmVsb2FkaW5nVmVsb2NpdHkpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRQb3dlclVwSW50ZXJ2YWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFBvd2VyVXBJbnRlcnZhbCgpIHsKICAgICAgdmFyIF90aGlzMTAgPSB0aGlzOwoKICAgICAgdGhpcy5wb3dlclVwSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMxMC5nZW5lcmF0ZVBvd2VyVXAoe30sIDIpOwogICAgICB9LCAxMDAwMCk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0T25EZXN0cm95IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRPbkRlc3Ryb3koKSB7CiAgICAgIHZhciBfdGhpczExID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmN1cnJlbnRQbGF5ZXIgPT09IG51bGwpIHJldHVybjsKICAgICAgdGhpcy5ldmVudHMub24oImRlc3Ryb3kiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMxMS5jbGVhckludGVydmFscyh0cnVlKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY2xlYXJJbnRlcnZhbHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNsZWFySW50ZXJ2YWxzKHBvd2VyVXApIHsKICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnVwZGF0ZVNoaXBJbnRlcnZhbCk7CiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5yZWxvYWRJbnRlcnZhbCk7CiAgICAgIGlmIChwb3dlclVwKSBjbGVhckludGVydmFsKHRoaXMucG93ZXJVcEludGVydmFsKTsKICAgIH0KICB9XSk7CgogIHJldHVybiBHYW1lU2NlbmU7Cn0oUGhhc2VyLlNjZW5lKTsKCmV4cG9ydCB7IEdhbWVTY2VuZSBhcyBkZWZhdWx0IH07"},{"version":3,"sources":["/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/GameScene.js"],"names":["Phaser","websocketEvents","gameDimensions","normalizers","powerUps","sceneKeys","detectTouchScreen","_","createMap","GameScene","socket","game","key","setUpGame","updateFps","touchScreen","powerUpIds","Physics","Arcade","Group","prototype","killAll","countActive","getFirstAlive","setActive","setVisible","enableAll","getFirstDead","on","UPDATE_SHIP","data","updateShip","SHOOT","createBullet","CHANGE_STATE","updateState","RELOAD","reload","POWER_UP","powerUpEvent","END_TURN","setTimeout","clearIntervals","scene","start","ranking","cloneDeep","timer","settings","currentPlayer","admin","map","maxVelocityLittle","velocity","accelerationLittle","respawnTime","frictionAir","powerUpVelocity","powerUpAngularVelocity","players","forEach","player","localId","availableBullets","lastTimestamp","powerUpsObjects","Object","entries","length","Date","now","i","load","image","createGroups","createShips","setKeyInputHandlers","setTouchInputHandlers","physics","world","bullet","gameObject","destroy","setReloadInterval","setUpdateShipInterval","setPowerUpInterval","setOnDestroy","generatePowerUp","x","width","y","height","time","delta","rotationKey","isDown","rotating","rotate","accelerateLittleKey","accelerating","moveLittle","setCurrentPlayerNewVelocity","state","decelerateLittle","values","topLeft","ship","getTopLeft","bottomLeft","getBottomLeft","centerLeft","bulletsLoaded","children","iterate","index","getLoadedBulletPosition","autonomyTime","setVelocity","setAngularVelocity","ships","add","group","collideWorldBounds","bullets","bounceX","bounceY","killableMapObjects","immovable","notKillableMapObjects","collider","order","textures","create","color","killAndHide","remove","quantity","visible","active","setAngle","velocityMagnitude","overlap","onBulletCollision","powerUp","onPowerUpOverlap","currentShip","killedBy","emit","velocityFromAngle","angle","bulletVelocity","position","shotBy","body","onWorldBounds","firstAlive","id","n","type","Math","floor","random","FloatBetween","deltaTime","deltaTheta","Number","parseInt","sign","angularVelocity","createPowerUp","getChildren","child","dataState","dataReload","previousMag","cos","PI","sin","setTexture","e","console","log","max","rotation","input","keyboard","addKey","Input","Keyboard","KeyCodes","SPACE","ENTER","shoot","addPointer","pointer","updateShipInterval","setInterval","parseFloat","toFixed","reloadInterval","min","reloadingVelocity","powerUpInterval","events","clearInterval","Scene"],"mappings":"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","sourcesContent":["import * as Phaser from \"phaser\";\nimport websocketEvents from \"../constants/websocketEvents\";\nimport {gameDimensions, normalizers, powerUps, sceneKeys} from \"../constants/gameSettings\";\nimport {detectTouchScreen} from \"../constants/constants\";\nimport _ from \"lodash\";\nimport createMap from \"../phaser/maps\";\n\n\nexport default class GameScene extends Phaser.Scene {\n\n    setUpGame(game){\n        this.timer = game.timer;\n        this.settings = game.settings;\n        this.currentPlayer = game.currentPlayer;\n        this.admin = game.admin;\n        this.map = game.map;\n        this.settings.maxVelocityLittle = game.settings.velocity+0.2;\n        this.settings.accelerationLittle = 0.4;\n        this.settings.respawnTime = 8000;\n        this.settings.frictionAir = 0.1;\n        this.settings.powerUpVelocity = 30;\n        this.settings.powerUpAngularVelocity = 20;\n        this.players = {};\n        game.players.forEach(player => {\n            this.players[player.localId] = _.cloneDeep(player);\n            this.players[player.localId].availableBullets = 3;\n            this.players[player.localId].lastTimestamp = 0;\n        });\n        this.powerUpsObjects = {};\n    }\n\n    constructor(socket, game) {\n        super({key: sceneKeys.game});\n\n        this.socket = socket;\n        this.setUpGame(game);\n\n        this.updateFps = 10;\n        this.touchScreen = detectTouchScreen();\n        this.powerUpIds = 0;\n        \n        Phaser.Physics.Arcade.Group.prototype.killAll = function () {\n            while(this.countActive()>0){\n                this.getFirstAlive().setActive(false).setVisible(false);\n            }\n        }\n\n        Phaser.Physics.Arcade.Group.prototype.enableAll = function () {\n            while(this.countActive()<3){\n                this.getFirstDead().setActive(true).setVisible(true);\n            }\n        }\n\n        this.socket.on(websocketEvents.UPDATE_SHIP, data => this.updateShip(data));\n        this.socket.on(websocketEvents.SHOOT, data => this.createBullet(data));\n        this.socket.on(websocketEvents.CHANGE_STATE, data => this.updateState(data));\n        this.socket.on(websocketEvents.RELOAD, data => this.reload(data));\n        this.socket.on(websocketEvents.POWER_UP, data => this.powerUpEvent(data));\n        this.socket.on(websocketEvents.END_TURN, data => {\n            setTimeout(()=>{\n                this.clearIntervals(true);\n                this.scene.start(sceneKeys.ranking, _.cloneDeep(data));\n            }, 2000);\n        });\n    }\n\n    init(game){\n        if(Object.entries(game).length>0) this.setUpGame(game);\n        else {\n            if(this.timer > Date.now()){\n                this.scene.start(sceneKeys.ranking, _.cloneDeep({\n                    players: _.cloneDeep(this.players),\n                    timer: this.timer\n                }));\n            }\n        }\n    }\n\n    preload(){\n        for(let i = 0; i < 4; i++){\n            this.load.image(\"ship\"+i, \"./ships/ship\"+i+\".png\");\n            this.load.image(\"little\"+i, \"./littles/little\"+i+\".png\");\n            this.load.image(\"shielded\"+i, \"./shielded/shielded\"+i+\".png\");\n        }\n\n        this.load.image(\"bullet\", \"./bullet.png\");\n        this.load.image(\"bullet-loaded\", \"./bullet-loaded.png\");\n\n        this.load.image(\"block1\", \"./blocks/block1.png\");\n        this.load.image(\"block2\", \"./blocks/block2.png\");\n        this.load.image(\"block3\", \"./blocks/block3.png\");\n\n        for(let i = 0; i < powerUps.length; i++){\n            this.load.image(powerUps[i], \"./powerUps/\"+ powerUps[i] +\".png\");\n        }\n    }\n\n    create(){\n        this.createGroups();\n        this.createShips();\n        createMap(this);\n\n        this.setKeyInputHandlers();\n        if(this.touchScreen) this.setTouchInputHandlers();\n\n        this.physics.world.on(\"worldbounds\", (bullet)=>{bullet.gameObject.destroy()});\n\n        this.setReloadInterval();\n        this.setUpdateShipInterval();\n        if(this.admin === this.currentPlayer) this.setPowerUpInterval();\n\n        this.setOnDestroy();\n\n        this.generatePowerUp({x: gameDimensions.width/2, y: gameDimensions.height/2}, 2);\n    }\n\n    update(time, delta){\n        if(this.currentPlayer !== null) {\n            if (this.rotationKey.isDown || this.rotating) this.rotate(delta);\n            if (this.accelerateLittleKey.isDown || this.accelerating) this.moveLittle(delta);\n\n            this.setCurrentPlayerNewVelocity();\n            if (this.players[this.currentPlayer].state === 1) this.decelerateLittle(delta);\n        }\n\n        Object.values(this.players).forEach(player => {\n            const topLeft = player.ship.getTopLeft();\n            const bottomLeft = player.ship.getBottomLeft();\n            const centerLeft = {\n                x: (topLeft.x + bottomLeft.x) / 2,\n                y: (topLeft.y + bottomLeft.y) / 2\n            }\n            player.bulletsLoaded.children.iterate((bullet, index)=>{\n                const {x, y} = this.getLoadedBulletPosition(index, topLeft, bottomLeft, centerLeft, player);\n                bullet.x = x;\n                bullet.y = y;\n\n            });\n           if(player.localId!==this.currentPlayer){\n               player.ship.autonomyTime -= delta;\n               if(player.ship.autonomyTime<0) {\n                   player.ship.setVelocity(0);\n                   player.ship.setAngularVelocity(0);\n               }\n           }\n        });\n    }\n\n\n\n\n    //=============================================================================\n    //Creating things\n    createGroups(){\n        this.ships = this.physics.add.group({\n            collideWorldBounds: true\n        });\n        this.bullets = this.physics.add.group({\n            collideWorldBounds: true\n        });\n        this.powerUps = this.physics.add.group({\n            collideWorldBounds: true,\n            bounceX: 1,\n            bounceY: 1\n        });\n        this.killableMapObjects = this.physics.add.group({\n            collideWorldBounds: true,\n            immovable: true\n        });\n        this.notKillableMapObjects = this.physics.add.group({\n            collideWorldBounds: true,\n            immovable: true\n        });\n\n        this.physics.add.collider(this.powerUps, this.powerUps);\n    }\n\n    createShips(){\n        const order = [0, 3, 2, 1];\n        let index = 0;\n        const textures = [\"\", \"little\", \"ship\"];\n        Object.values(this.players).forEach(player => {\n            player.ship = this.ships.create(\n                (order[index]<2 ? 30 : gameDimensions.width-30),\n                ( order[index]%2 === 0 ? 30 : gameDimensions.height-30 ),\n                textures[player.state]+player.color\n            );\n            \n            if(player.state === 0) {\n                this.ships.killAndHide(player.ship);\n                this.ships.remove(player.ship);\n            }\n\n            player.bulletsLoaded = this.physics.add.group({\n                key: \"bullet-loaded\",\n                quantity: 3,\n                visible: player.state!==0,\n                active: player.state!==0\n            });\n\n            player.ship.localId = player.localId;\n            player.ship.setAngle(-45  * ( order[index] < 2 ? 1 : 3) * ( ( order[index] % 2 ) * 2 - 1 ));\n            player.ship.velocityMagnitude = this.settings.velocity*normalizers.velocity;\n            player.ship.autonomyTime = 0;\n\n            if(player.localId===this.currentPlayer){\n                this.physics.add.overlap(player.ship, this.bullets, (ship, bullet) => {\n                    this.onBulletCollision(ship, bullet);\n                });\n\n                this.physics.add.overlap(player.ship, this.powerUps, (ship, powerUp)=>{\n                    this.onPowerUpOverlap(ship, powerUp);\n                });\n\n                this.physics.add.collider(player.ship, this.ships, (currentShip, ship)=>{\n                    if(this.players[this.currentPlayer].state === 1 && this.players[ship.localId].state >= 2){\n                        const data = {\n                            localId: this.currentPlayer,\n                            state: 0,\n                            killedBy: ship.localId\n                        };\n                        this.socket.emit(websocketEvents.CHANGE_STATE, data);\n                        this.updateState(data);\n                    }\n                });\n            }\n\n            index++;\n        });\n\n        this.physics.add.collider(this.ships, this.ships);\n    }\n\n    createBullet(data){\n        const {x, y} = this.physics.velocityFromAngle(data.angle, this.settings.bulletVelocity*normalizers.bulletVelocity);\n        const bullet = this.bullets.create(data.position.x, data.position.y, \"bullet\");\n        bullet.angle = data.angle;\n        bullet.setVelocity(x, y);\n        bullet.shotBy = data.localId;\n        bullet.body.onWorldBounds = true;\n        this.players[data.localId].availableBullets--;\n        const firstAlive = this.players[data.localId].bulletsLoaded.getFirstAlive();\n        if(firstAlive){\n            firstAlive.setActive(false).setVisible(false);\n        }\n    }\n\n    createPowerUp(data){\n        this.powerUpsObjects[data.id] = this.powerUps.create(data.position.x, data.position.y, data.powerUp);\n        const {x, y} = this.physics.velocityFromAngle(data.angle, this.settings.powerUpVelocity);\n        this.powerUpsObjects[data.id].setVelocity(x, y);\n        this.powerUpsObjects[data.id].setAngularVelocity(this.settings.powerUpAngularVelocity);\n        this.powerUpsObjects[data.id].id = data.id;\n        this.powerUpsObjects[data.id].powerUp = data.powerUp;\n    }\n\n    generatePowerUp({x, y}, n=1){\n        for(let i = 0; i < n; i++){\n            const data = {\n                type: \"create\",\n                powerUp: powerUps[Math.floor(Math.random()*powerUps.length)],\n                position: {\n                    x: x || Phaser.Math.FloatBetween(0, gameDimensions.width),\n                    y: y || Phaser.Math.FloatBetween(0, gameDimensions.height)\n                },\n                angle: Phaser.Math.FloatBetween(0, 360),\n                id: ++this.powerUpIds\n            }\n            this.socket.emit(websocketEvents.POWER_UP, data);\n            this.powerUpEvent(data);\n        }\n    }\n\n\n\n\n    //=============================================================================\n    //Others do things via the websocket\n    updateShip(data){\n        const player = this.players[data[0]];\n        const deltaTime = (data[3]-player.lastTimestamp)/1000;\n        if(deltaTime<=0) return;\n\n        let deltaTheta = data[1] - Number.parseInt(player.ship.angle);\n\n        if(deltaTheta*Math.sign(this.settings.angularVelocity) < -10) deltaTheta += 360*Math.sign(this.settings.angularVelocity);\n        else if(deltaTheta*Math.sign(this.settings.angularVelocity) < 0) deltaTheta = 0;\n        const angularVelocity = deltaTheta / deltaTime;\n        player.ship.setAngularVelocity(angularVelocity);\n\n        player.ship.setVelocity( ( data[2][0]-player.ship.x ) / deltaTime, ( data[2][1]-player.ship.y ) / deltaTime );\n\n        player.lastTimestamp = data[3];\n        player.ship.autonomyTime = deltaTime*1000;\n    }\n\n    powerUpEvent(data){\n        if(data.type === \"create\") this.createPowerUp(data);\n        else if(data.type === \"get\") {\n            const children = this.powerUps.getChildren();\n            for(let i=0; i<children.length; i++){\n                const child = children[i];\n                if(child.id === data.id){\n                    this.powerUps.remove(child);\n                    child.destroy();\n                    break;\n                }\n            }\n            if(data.powerUp === \"reverse\") this.settings.angularVelocity *= -1;\n            else if(data.powerUp === \"shield\") {\n                const dataState = {\n                    localId: data.localId,\n                    state: 3\n                }\n                this.socket.emit(websocketEvents.CHANGE_STATE, dataState);\n                this.updateState(dataState);\n            } else if(data.powerUp === \"reload\"){\n                const dataReload = {\n                    localId: data.localId,\n                    availableBullets: 3\n                };\n                this.socket.emit(websocketEvents.RELOAD, dataReload);\n                this.reload(dataReload);\n            }\n        }\n    }\n\n\n\n    //=============================================================================\n    //Current players does things\n    rotate(delta){\n        this.players[this.currentPlayer].ship.angle += delta * this.settings.angularVelocity * normalizers.angularVelocity;\n    }\n\n    moveLittle(delta){\n        const currentPlayer = this.players[this.currentPlayer];\n        if(currentPlayer.state === 1){\n            const ship = currentPlayer.ship;\n            const previousMag = ship.velocityMagnitude;\n            if(previousMag < this.settings.maxVelocityLittle * normalizers.velocity){\n                currentPlayer.ship.velocityMagnitude += delta*this.settings.accelerationLittle;\n            } else {\n                currentPlayer.ship.velocityMagnitude = this.settings.maxVelocityLittle * normalizers.velocity;\n            }\n        }\n    }\n\n    shoot(){\n        const currentPlayer = this.players[this.currentPlayer];\n        if(currentPlayer.availableBullets>0){\n            const ship = currentPlayer.ship;\n            const angle = ship.angle;\n            const data = {\n                position: {\n                    x: ship.x + ship.width*Math.cos(angle * Math.PI / 180),\n                    y: ship.y + ship.height*Math.sin(angle * Math.PI / 180)\n                },\n                angle: angle,\n                localId: this.currentPlayer\n            };\n            this.socket.emit(websocketEvents.SHOOT, data);\n            this.createBullet(data);\n        }\n    }\n\n\n    updateState(data){\n        this.players[data.localId].state = data.state;\n        const player = this.players[data.localId];\n        switch (data.state) {\n            case 0:\n                this.ships.killAndHide(player.ship);\n                this.ships.remove(player.ship);\n                this.players[data.localId].bulletsLoaded.killAll();\n                break;\n            case 1:\n                player.ship.setTexture(\"little\" + this.players[data.localId].color);\n                this.players[data.localId].bulletsLoaded.killAll();\n                if(data.localId === this.currentPlayer) {\n                    setTimeout(() => {\n                        if (this.players[data.localId].state === 1) {\n                            const data = {\n                                localId: this.currentPlayer,\n                                state: 2\n                            };\n                            this.updateState(data);\n                            this.socket.emit(websocketEvents.CHANGE_STATE, data);\n                        }\n                    }, this.settings.respawnTime);\n                }\n                break;\n            case 2:\n                player.ship.velocityMagnitude = this.settings.velocity * normalizers.velocity;\n                player.ship.setTexture(\"ship\" + this.players[data.localId].color);\n                player.bulletsLoaded.enableAll();\n                break;\n            case 3:\n                player.ship.velocityMagnitude = this.settings.velocity * normalizers.velocity;\n                player.ship.setTexture(\"shielded\" + this.players[data.localId].color);\n                break;\n        }\n    }\n\n    onBulletCollision(ship, bullet){\n        bullet.destroy();\n        const state = this.players[ship.localId].state-1;\n        const data = {\n            localId: ship.localId,\n            state\n        };\n        if(state === 0) {\n            data.killedBy = bullet.shotBy;\n            this.clearIntervals(false);\n        }\n        this.socket.emit(websocketEvents.CHANGE_STATE, data);\n        this.updateState(data);\n    }\n\n\n    reload(data){\n        this.players[data.localId].availableBullets = data.availableBullets;\n        try{\n            while(this.players[data.localId].bulletsLoaded.countActive() < data.availableBullets){\n                this.players[data.localId].bulletsLoaded.getFirstDead().setActive(true).setVisible(true);\n            }\n        } catch (e) {\n            console.log(e);\n        }\n    }\n\n    onPowerUpOverlap(ship, powerUp){\n        if(this.players[ship.localId].state < 2 ) return;\n        const data = {\n            type: \"get\",\n            localId: ship.localId,\n            powerUp: powerUp.powerUp,\n            id: powerUp.id\n        }\n        this.socket.emit(websocketEvents.POWER_UP, data);\n        this.powerUpEvent(data);\n    }\n\n\n    //=============================================================================\n    //Game loop functions\n    setCurrentPlayerNewVelocity(){\n        const {x, y} = this.physics.velocityFromAngle(\n            this.players[this.currentPlayer].ship.angle,\n            this.players[this.currentPlayer].ship.velocityMagnitude\n        );\n        this.players[this.currentPlayer].ship.setVelocity(x, y);\n    }\n\n    decelerateLittle(delta){\n        this.players[this.currentPlayer].ship.velocityMagnitude = Math.max(\n            0, this.players[this.currentPlayer].ship.velocityMagnitude - this.settings.frictionAir * delta\n        );\n    }\n\n    getLoadedBulletPosition(index, topLeft, bottomLeft, centerLeft, player){\n        switch (index){\n            case 0:\n                return {\n                    x: bottomLeft.x - (player.ship.width/4)*Math.cos(player.ship.rotation),\n                    y: bottomLeft.y - (player.ship.height/4)*Math.sin(player.ship.rotation)\n                };\n            case 1:\n                return{\n                    x: topLeft.x - (player.ship.width/4)*Math.cos(player.ship.rotation),\n                    y: topLeft.y - (player.ship.height/4)*Math.sin(player.ship.rotation)\n                };\n            case 2:\n                return {\n                    x: centerLeft.x - (player.ship.width/4)*Math.cos(player.ship.rotation),\n                    y: centerLeft.y - (player.ship.height/4)*Math.sin(player.ship.rotation)\n                };\n        }\n    }\n\n\n\n    //=============================================================================\n    //On create setup\n\n    setKeyInputHandlers(){\n        if(this.currentPlayer === null) return;\n\n        this.rotationKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);\n        this.accelerateLittleKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ENTER);\n        this.input.keyboard.on(\"keyup-ENTER\", ()=>{\n            if(this.players[this.currentPlayer].state>=2) this.shoot();\n        });\n    }\n\n    setTouchInputHandlers(){\n        if(this.currentPlayer === null) return;\n\n        this.input.addPointer(1);\n\n        this.input.on(\"pointerdown\", (pointer) => {\n            if (pointer.x < gameDimensions.width / 2) {\n                this.rotating = true;\n            } else {\n                if (this.players[this.currentPlayer].state >= 2) this.shoot();\n                else {\n                    this.accelerating = true;\n                }\n            }\n        });\n\n        this.input.on(\"pointerup\", (pointer) => {\n            if (pointer.x < gameDimensions.width / 2) {\n                this.rotating = false;\n            } else {\n                this.accelerating = false;\n            }\n        });\n    }\n\n    setUpdateShipInterval(){\n        if(this.currentPlayer === null) return;\n\n        const currentPlayer = this.players[this.currentPlayer];\n        this.updateShipInterval = setInterval(()=>{\n            this.socket.emit(websocketEvents.UPDATE_SHIP, [\n                this.currentPlayer,\n                Number.parseInt(currentPlayer.ship.angle),\n                [\n                    Number.parseFloat(currentPlayer.ship.x.toFixed(2)),\n                    Number.parseFloat(currentPlayer.ship.y.toFixed(2))\n                ],\n                this.time.now\n            ]);\n        }, 1000/this.updateFps);\n    }\n\n    setReloadInterval(){\n        if(this.currentPlayer === null) return;\n\n        this.reloadInterval = setInterval(() => {\n            if(this.players[this.currentPlayer].state<2) return;\n            const availableBullets = Math.min(3, this.players[this.currentPlayer].availableBullets + 1);\n            const data = {\n                localId: this.currentPlayer,\n                availableBullets\n            };\n            this.socket.emit(websocketEvents.RELOAD, data);\n            this.reload(data);\n        }, 1/(this.settings.reloadingVelocity * normalizers.reloadingVelocity));\n    }\n\n    setPowerUpInterval(){\n        this.powerUpInterval = setInterval(()=>{\n            this.generatePowerUp({}, 2);\n        }, 10000);\n    }\n\n    setOnDestroy(){\n        if(this.currentPlayer === null) return;\n\n        this.events.on(\"destroy\", ()=>{\n            this.clearIntervals(true);\n        });\n    }\n\n    clearIntervals(powerUp){\n        clearInterval(this.updateShipInterval);\n        clearInterval(this.reloadInterval);\n        if(powerUp) clearInterval(this.powerUpInterval);\n    }\n}"]}]}