{"remainingRequest":"C:\\Users\\matte\\Desktop\\papero\\cosmos.papero.me\\node_modules\\thread-loader\\dist\\cjs.js!C:\\Users\\matte\\Desktop\\papero\\cosmos.papero.me\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\matte\\Desktop\\papero\\cosmos.papero.me\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\Users\\matte\\Desktop\\papero\\cosmos.papero.me\\src\\phaser\\LobbyScene.js","dependencies":[{"path":"C:\\Users\\matte\\Desktop\\papero\\cosmos.papero.me\\src\\phaser\\LobbyScene.js","mtime":1616862982900},{"path":"C:\\Users\\matte\\Desktop\\papero\\cosmos.papero.me\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1616506645671},{"path":"C:\\Users\\matte\\Desktop\\papero\\cosmos.papero.me\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1616506657299},{"path":"C:\\Users\\matte\\Desktop\\papero\\cosmos.papero.me\\node_modules\\babel-loader\\lib\\index.js","mtime":1616506645397},{"path":"C:\\Users\\matte\\Desktop\\papero\\cosmos.papero.me\\node_modules\\eslint-loader\\index.js","mtime":1616506648427}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiQzovVXNlcnMvbWF0dGUvRGVza3RvcC9wYXBlcm8vY29zbW9zLnBhcGVyby5tZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vb2JqZWN0U3ByZWFkMiI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiQzovVXNlcnMvbWF0dGUvRGVza3RvcC9wYXBlcm8vY29zbW9zLnBhcGVyby5tZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY2xhc3NDYWxsQ2hlY2siOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIkM6L1VzZXJzL21hdHRlL0Rlc2t0b3AvcGFwZXJvL2Nvc21vcy5wYXBlcm8ubWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKaW1wb3J0IF9pbmhlcml0cyBmcm9tICJDOi9Vc2Vycy9tYXR0ZS9EZXNrdG9wL3BhcGVyby9jb3Ntb3MucGFwZXJvLm1lL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9pbmhlcml0cyI7CmltcG9ydCBfY3JlYXRlU3VwZXIgZnJvbSAiQzovVXNlcnMvbWF0dGUvRGVza3RvcC9wYXBlcm8vY29zbW9zLnBhcGVyby5tZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlU3VwZXIiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMuanMiOwppbXBvcnQgKiBhcyBQaGFzZXIgZnJvbSAicGhhc2VyIjsKaW1wb3J0IHsgc2NlbmVLZXlzIH0gZnJvbSAiLi4vY29uc3RhbnRzL2NvbnN0YW50cyI7CmltcG9ydCB3ZWJzb2NrZXRFdmVudHMgZnJvbSAiLi4vY29uc3RhbnRzL3dlYnNvY2tldEV2ZW50cyI7Cgp2YXIgTG9iYnlTY2VuZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX1BoYXNlciRTY2VuZSkgewogIF9pbmhlcml0cyhMb2JieVNjZW5lLCBfUGhhc2VyJFNjZW5lKTsKCiAgdmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcihMb2JieVNjZW5lKTsKCiAgZnVuY3Rpb24gTG9iYnlTY2VuZShzb2NrZXQpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTG9iYnlTY2VuZSk7CgogICAgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCB7CiAgICAgIGtleTogc2NlbmVLZXlzLmxvYmJ5CiAgICB9KTsKICAgIF90aGlzLnNvY2tldCA9IHNvY2tldDsKICAgIF90aGlzLmxvYmJ5ID0gewogICAgICBwbGF5ZXJzOiBbXSwKICAgICAgY3VycmVudFBsYXllcjogbnVsbCwKICAgICAgc2V0dGluZ3M6IHsKICAgICAgICB0b3RhbFR1cm5zOiA1LAogICAgICAgIHZlbG9jaXR5OiAyLAogICAgICAgIGFuZ3VsYXJWZWxvY2l0eTogMiwKICAgICAgICByZWxvYWRpbmdWZWxvY2l0eTogMiwKICAgICAgICBidWxsZXRWZWxvY2l0eTogMgogICAgICB9CiAgICB9OwogICAgX3RoaXMubm9ybWFsaXplcnMgPSB7CiAgICAgIHZlbG9jaXR5OiAxMDAsCiAgICAgIGFuZ3VsYXJWZWxvY2l0eTogTWF0aC5QSSAvIDEyMDAsCiAgICAgIHJlbG9hZGluZ1ZlbG9jaXR5OiAxIC8gMjAwMCwKICAgICAgYnVsbGV0VmVsb2NpdHk6IDIwMAogICAgfTsKICAgIF90aGlzLnNoaXBzID0ge307CiAgICBfdGhpcy5hdmFpbGFibGVCdWxsZXRzID0gMzsKICAgIHZhciBpbnRlcnZhbDsKCiAgICB2YXIgaGFuZGxlciA9IGZ1bmN0aW9uIGhhbmRsZXIoKSB7CiAgICAgIF90aGlzLmF2YWlsYWJsZUJ1bGxldHMgPSBfdGhpcy5hdmFpbGFibGVCdWxsZXRzID49IDMgPyBfdGhpcy5hdmFpbGFibGVCdWxsZXRzIDogX3RoaXMuYXZhaWxhYmxlQnVsbGV0cyArIDE7CiAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpOwogICAgICBpbnRlcnZhbCA9IHNldEludGVydmFsKGhhbmRsZXIsIDIwMDAgLyBfdGhpcy5sb2JieS5zZXR0aW5ncy5yZWxvYWRpbmdWZWxvY2l0eSk7CiAgICB9OwoKICAgIGludGVydmFsID0gc2V0SW50ZXJ2YWwoaGFuZGxlciwgMjAwMCAvIF90aGlzLmxvYmJ5LnNldHRpbmdzLnJlbG9hZGluZ1ZlbG9jaXR5KTsKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhMb2JieVNjZW5lLCBbewogICAga2V5OiAiZ2V0QW5nbGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEFuZ2xlKHgsIHkpIHsKICAgICAgdmFyIGFuZ2xlOwoKICAgICAgaWYgKHggIT09IDApIHsKICAgICAgICBhbmdsZSA9IE1hdGguYXRhbih5IC8geCk7CiAgICAgICAgYW5nbGUgPSB4IDwgMCA/IGFuZ2xlICsgTWF0aC5QSSA6IGFuZ2xlOwogICAgICB9IGVsc2UgaWYgKHkgPj0gMCkgYW5nbGUgPSBNYXRoLlBJIC8gMjtlbHNlIGlmICh5IDwgMCkgYW5nbGUgPSAtTWF0aC5QSSAvIDI7CgogICAgICByZXR1cm4gYW5nbGU7CiAgICB9CiAgfSwgewogICAga2V5OiAiY3JlYXRlTmV3U2hpcCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlTmV3U2hpcChjb2xvciwgYm91bmNlKSB7CiAgICAgIHZhciB4ID0gUGhhc2VyLk1hdGguQmV0d2VlbigwLCB0aGlzLndpZHRoKTsKICAgICAgdmFyIHkgPSBQaGFzZXIuTWF0aC5CZXR3ZWVuKDAsIHRoaXMuaGVpZ2h0KTsKICAgICAgdmFyIHNoaXAgPSB0aGlzLnBoeXNpY3MuYWRkLmltYWdlKHgsIHksICJzaGlwIiArIGNvbG9yKTsKICAgICAgdmFyIGFuZ2xlID0gUGhhc2VyLk1hdGguQmV0d2VlbihNYXRoLlBJIC8gNCwgTWF0aC5QSSAqIDMgLyA0KTsKICAgICAgc2hpcC5zZXRWZWxvY2l0eSh0aGlzLmxvYmJ5LnNldHRpbmdzLnZlbG9jaXR5ICogdGhpcy5ub3JtYWxpemVycy52ZWxvY2l0eSAqIE1hdGguY29zKGFuZ2xlKSwgdGhpcy5sb2JieS5zZXR0aW5ncy52ZWxvY2l0eSAqIHRoaXMubm9ybWFsaXplcnMudmVsb2NpdHkgKiBNYXRoLnNpbihhbmdsZSkpOwogICAgICBzaGlwLnJvdGF0aW9uID0gYW5nbGU7CiAgICAgIHNoaXAuc2V0Q29sbGlkZVdvcmxkQm91bmRzKHRydWUpOwogICAgICBpZiAoYm91bmNlKSBzaGlwLnNldEJvdW5jZSgxLCAxKTsKICAgICAgcmV0dXJuIHNoaXA7CiAgICB9CiAgfSwgewogICAga2V5OiAiZmluZFBsYXllckJ5SWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZpbmRQbGF5ZXJCeUlkKGlkKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sb2JieS5wbGF5ZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMubG9iYnkucGxheWVyc1tpXS5sb2NhbElkID09PSBpZCkgcmV0dXJuIHRoaXMubG9iYnkucGxheWVyc1tpXTsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfSwgewogICAga2V5OiAicHJlbG9hZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcHJlbG9hZCgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICAvL2xvYWQgaW1hZ2VzCiAgICAgIHRoaXMud2lkdGggPSB0aGlzLnN5cy5nYW1lLmNhbnZhcy53aWR0aDsKICAgICAgdGhpcy5oZWlnaHQgPSB0aGlzLnN5cy5nYW1lLmNhbnZhcy5oZWlnaHQ7CiAgICAgIHRoaXMudGV4dHVyZXMuYWRkQmFzZTY0KCJzaGlwMCIsIHJlcXVpcmUoIkAvYXNzZXRzL3NoaXBzL3NoaXAwLnBuZyIpKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJzaGlwMSIsIHJlcXVpcmUoIkAvYXNzZXRzL3NoaXBzL3NoaXAxLnBuZyIpKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJzaGlwMiIsIHJlcXVpcmUoIkAvYXNzZXRzL3NoaXBzL3NoaXAyLnBuZyIpKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJzaGlwMyIsIHJlcXVpcmUoIkAvYXNzZXRzL3NoaXBzL3NoaXAzLnBuZyIpKTsKICAgICAgdGhpcy50ZXh0dXJlcy5hZGRCYXNlNjQoImJ1bGxldCIsIHJlcXVpcmUoIkAvYXNzZXRzL2J1bGxldC5wbmciKSk7CgogICAgICB2YXIgb25yZXNpemUgPSBmdW5jdGlvbiBvbnJlc2l6ZSgpIHsKICAgICAgICB2YXIgcGFyZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBsYXllcnMtd3JhcHBlciIpOwogICAgICAgIHZhciBkaW0gPSBNYXRoLm1pbihwYXJlbnQub2Zmc2V0V2lkdGgsIHBhcmVudC5vZmZzZXRIZWlnaHQpOwoKICAgICAgICBfdGhpczIuZ2FtZS5zY2FsZS5yZXNpemUoZGltLCBkaW0pOwoKICAgICAgICBfdGhpczIucGh5c2ljcy53b3JsZC5zZXRCb3VuZHMoMCwgMCwgZGltLCBkaW0pOwogICAgICB9OwoKICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInJlc2l6ZSIsIG9ucmVzaXplKTsKICAgICAgdGhpcy5ldmVudHMub24oImRlc3Ryb3kiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInJlc2l6ZSIsIG9ucmVzaXplKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY3JlYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGUoKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgLy9FdmVudCBsb2JieS1tb2RpZmllZAogICAgICB0aGlzLnNvY2tldC5vbih3ZWJzb2NrZXRFdmVudHMuTE9CQllfTU9ESUZJRUQsIGZ1bmN0aW9uIChnYW1lKSB7CiAgICAgICAgdmFyIGN1cnJlbnRseVBsYXlpbmdJZHMgPSBbXTsKICAgICAgICBnYW1lLnBsYXllcnMuZm9yRWFjaChmdW5jdGlvbiAocGxheWVyKSB7CiAgICAgICAgICBjdXJyZW50bHlQbGF5aW5nSWRzLnB1c2gocGxheWVyLmxvY2FsSWQpOwogICAgICAgIH0pOwogICAgICAgIHZhciBwcmV2aW91c1BsYXlpbmdJZHMgPSBbXTsKCiAgICAgICAgX3RoaXMzLmxvYmJ5LnBsYXllcnMuZm9yRWFjaChmdW5jdGlvbiAocGxheWVyKSB7CiAgICAgICAgICBwcmV2aW91c1BsYXlpbmdJZHMucHVzaChwbGF5ZXIubG9jYWxJZCk7CiAgICAgICAgfSk7CgogICAgICAgIF90aGlzMy5sb2JieSA9IF9vYmplY3RTcHJlYWQoe30sIGdhbWUpOwogICAgICAgIHZhciBuZXdTaGlwcyA9IHt9OwogICAgICAgIGN1cnJlbnRseVBsYXlpbmdJZHMuZm9yRWFjaChmdW5jdGlvbiAoaWQpIHsKICAgICAgICAgIGlmIChwcmV2aW91c1BsYXlpbmdJZHMuaW5jbHVkZXMoaWQpKSB7CiAgICAgICAgICAgIG5ld1NoaXBzW2lkXSA9IF90aGlzMy5zaGlwc1tpZF07CiAgICAgICAgICAgIG5ld1NoaXBzW2lkXS5zZXRWZWxvY2l0eShfdGhpczMubG9iYnkuc2V0dGluZ3MudmVsb2NpdHkgKiBfdGhpczMubm9ybWFsaXplcnMudmVsb2NpdHkgKiBNYXRoLmNvcyhuZXdTaGlwc1tpZF0ucm90YXRpb24pLCBfdGhpczMubG9iYnkuc2V0dGluZ3MudmVsb2NpdHkgKiBfdGhpczMubm9ybWFsaXplcnMudmVsb2NpdHkgKiBNYXRoLnNpbihuZXdTaGlwc1tpZF0ucm90YXRpb24pKTsKICAgICAgICAgICAgbmV3U2hpcHNbaWRdLnNldFRleHR1cmUoInNoaXAiICsgX3RoaXMzLmZpbmRQbGF5ZXJCeUlkKGlkKS5jb2xvcik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBuZXdTaGlwc1tpZF0gPSBfdGhpczMuY3JlYXRlTmV3U2hpcChfdGhpczMuZmluZFBsYXllckJ5SWQoaWQpLmNvbG9yLCBpZCAhPT0gZ2FtZS5jdXJyZW50UGxheWVyKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBfdGhpczMuc2hpcHMgPSBuZXdTaGlwczsKICAgICAgfSk7IC8vU2V0dGluZyB1cCByb3RhdGlvbiBhbmQgc2hvb3RpbmcKCiAgICAgIHRoaXMua2V5U3BhY2UgPSB0aGlzLmlucHV0LmtleWJvYXJkLmFkZEtleShQaGFzZXIuSW5wdXQuS2V5Ym9hcmQuS2V5Q29kZXMuU1BBQ0UpOwogICAgICB0aGlzLmlucHV0LmtleWJvYXJkLm9uKCJrZXl1cC1FTlRFUiIsIGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoX3RoaXMzLmF2YWlsYWJsZUJ1bGxldHMgPiAwKSB7CiAgICAgICAgICB2YXIgYnVsbGV0ID0gX3RoaXMzLnBoeXNpY3MuYWRkLmltYWdlKF90aGlzMy5zaGlwc1tfdGhpczMubG9iYnkuY3VycmVudFBsYXllcl0ueCwgX3RoaXMzLnNoaXBzW190aGlzMy5sb2JieS5jdXJyZW50UGxheWVyXS55LCAiYnVsbGV0Iik7CgogICAgICAgICAgYnVsbGV0LnJvdGF0aW9uID0gX3RoaXMzLnNoaXBzW190aGlzMy5sb2JieS5jdXJyZW50UGxheWVyXS5yb3RhdGlvbjsKICAgICAgICAgIGJ1bGxldC5zZXRWZWxvY2l0eShfdGhpczMubG9iYnkuc2V0dGluZ3MuYnVsbGV0VmVsb2NpdHkgKiBfdGhpczMubm9ybWFsaXplcnMuYnVsbGV0VmVsb2NpdHkgKiBNYXRoLmNvcyhidWxsZXQucm90YXRpb24pLCBfdGhpczMubG9iYnkuc2V0dGluZ3MuYnVsbGV0VmVsb2NpdHkgKiBfdGhpczMubm9ybWFsaXplcnMuYnVsbGV0VmVsb2NpdHkgKiBNYXRoLnNpbihidWxsZXQucm90YXRpb24pKTsKICAgICAgICAgIF90aGlzMy5hdmFpbGFibGVCdWxsZXRzLS07CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ1cGRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZSh0aW1lLCBkZWx0YSkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIGlmIChBcnJheS5pc0FycmF5KHRoaXMubG9iYnkucGxheWVycykgJiYgdGhpcy5sb2JieS5wbGF5ZXJzLmxlbmd0aCA+IDApIHsKICAgICAgICB0aGlzLmxvYmJ5LnBsYXllcnMuZm9yRWFjaChmdW5jdGlvbiAocGxheWVyKSB7CiAgICAgICAgICBpZiAocGxheWVyLmxvY2FsSWQgIT09IF90aGlzNC5sb2JieS5jdXJyZW50UGxheWVyKSB7CiAgICAgICAgICAgIHZhciBfdGhpczQkc2hpcHMkcGxheWVyJGwgPSBfdGhpczQuc2hpcHNbcGxheWVyLmxvY2FsSWRdLmJvZHkudmVsb2NpdHksCiAgICAgICAgICAgICAgICB4ID0gX3RoaXM0JHNoaXBzJHBsYXllciRsLngsCiAgICAgICAgICAgICAgICB5ID0gX3RoaXM0JHNoaXBzJHBsYXllciRsLnk7CiAgICAgICAgICAgIF90aGlzNC5zaGlwc1twbGF5ZXIubG9jYWxJZF0ucm90YXRpb24gPSBfdGhpczQuZ2V0QW5nbGUoeCwgeSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmxvYmJ5LmN1cnJlbnRQbGF5ZXIgIT09IG51bGwgJiYgdGhpcy5rZXlTcGFjZS5pc0Rvd24pIHsKICAgICAgICB0aGlzLnNoaXBzW3RoaXMubG9iYnkuY3VycmVudFBsYXllcl0ucm90YXRpb24gKz0gdGhpcy5sb2JieS5zZXR0aW5ncy5hbmd1bGFyVmVsb2NpdHkgKiB0aGlzLm5vcm1hbGl6ZXJzLmFuZ3VsYXJWZWxvY2l0eSAqIGRlbHRhOwogICAgICAgIHRoaXMuc2hpcHNbdGhpcy5sb2JieS5jdXJyZW50UGxheWVyXS5zZXRWZWxvY2l0eSh0aGlzLmxvYmJ5LnNldHRpbmdzLnZlbG9jaXR5ICogdGhpcy5ub3JtYWxpemVycy52ZWxvY2l0eSAqIE1hdGguY29zKHRoaXMuc2hpcHNbdGhpcy5sb2JieS5jdXJyZW50UGxheWVyXS5yb3RhdGlvbiksIHRoaXMubG9iYnkuc2V0dGluZ3MudmVsb2NpdHkgKiB0aGlzLm5vcm1hbGl6ZXJzLnZlbG9jaXR5ICogTWF0aC5zaW4odGhpcy5zaGlwc1t0aGlzLmxvYmJ5LmN1cnJlbnRQbGF5ZXJdLnJvdGF0aW9uKSk7CiAgICAgIH0KICAgIH0KICB9XSk7CgogIHJldHVybiBMb2JieVNjZW5lOwp9KFBoYXNlci5TY2VuZSk7CgpleHBvcnQgeyBMb2JieVNjZW5lIGFzIGRlZmF1bHQgfTs="},{"version":3,"sources":["C:/Users/matte/Desktop/papero/cosmos.papero.me/src/phaser/LobbyScene.js"],"names":["Phaser","sceneKeys","websocketEvents","LobbyScene","socket","key","lobby","players","currentPlayer","settings","totalTurns","velocity","angularVelocity","reloadingVelocity","bulletVelocity","normalizers","Math","PI","ships","availableBullets","interval","handler","clearInterval","setInterval","x","y","angle","atan","color","bounce","Between","width","height","ship","physics","add","image","setVelocity","cos","sin","rotation","setCollideWorldBounds","setBounce","id","i","length","localId","sys","game","canvas","textures","addBase64","require","load","onresize","parent","document","getElementById","dim","min","offsetWidth","offsetHeight","scale","resize","world","setBounds","window","addEventListener","events","on","removeEventListener","LOBBY_MODIFIED","currentlyPlayingIds","forEach","player","push","previousPlayingIds","newShips","includes","setTexture","findPlayerById","createNewShip","keySpace","input","keyboard","addKey","Input","Keyboard","KeyCodes","SPACE","bullet","time","delta","Array","isArray","body","getAngle","isDown","Scene"],"mappings":"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","sourcesContent":["import * as Phaser from \"phaser\";\r\nimport {sceneKeys} from \"../constants/constants\";\r\nimport websocketEvents from \"../constants/websocketEvents\";\r\n\r\nexport default class LobbyScene extends Phaser.Scene {\r\n\r\n    constructor(socket) {\r\n        super({key: sceneKeys.lobby});\r\n        this.socket = socket;\r\n        this.lobby = {\r\n            players: [],\r\n            currentPlayer: null,\r\n            settings: {\r\n                totalTurns: 5,\r\n                velocity: 2,\r\n                angularVelocity: 2,\r\n                reloadingVelocity: 2,\r\n                bulletVelocity: 2\r\n            }\r\n        }\r\n\r\n        this.normalizers = {\r\n            velocity: 100,\r\n            angularVelocity: Math.PI/1200,\r\n            reloadingVelocity: 1/2000,\r\n            bulletVelocity: 200\r\n        }\r\n        this.ships = {};\r\n        this.availableBullets = 3;\r\n        let interval;\r\n        let handler = () => {\r\n            this.availableBullets = this.availableBullets>=3 ? this.availableBullets : this.availableBullets+1;\r\n            clearInterval(interval)\r\n            interval = setInterval(handler, 2000/this.lobby.settings.reloadingVelocity);\r\n        }\r\n        interval = setInterval(handler, 2000/this.lobby.settings.reloadingVelocity);\r\n    }\r\n\r\n    getAngle(x, y){\r\n        let angle;\r\n        if(x!==0) {\r\n            angle = Math.atan(y / x);\r\n            angle = x < 0 ? angle + Math.PI : angle;\r\n        } else if(y>=0) angle = Math.PI / 2;\r\n        else if(y<0) angle = -Math.PI / 2;\r\n        return angle;\r\n    }\r\n\r\n    createNewShip(color, bounce){\r\n        let x = Phaser.Math.Between(0, this.width);\r\n        let y = Phaser.Math.Between(0, this.height);\r\n        let ship = this.physics.add.image(x, y, \"ship\"+color);\r\n        let angle = Phaser.Math.Between(Math.PI/4, Math.PI*3/4);\r\n        ship.setVelocity(\r\n            this.lobby.settings.velocity*this.normalizers.velocity*Math.cos(angle),\r\n            this.lobby.settings.velocity*this.normalizers.velocity*Math.sin(angle)\r\n        );\r\n        ship.rotation = angle;\r\n        ship.setCollideWorldBounds(true);\r\n        if(bounce) ship.setBounce(1, 1);\r\n        return ship;\r\n    }\r\n\r\n    findPlayerById(id){\r\n        for(let i = 0; i < this.lobby.players.length; i++){\r\n            if(this.lobby.players[i].localId === id) return this.lobby.players[i];\r\n        }\r\n        return null;\r\n    }\r\n\r\n    preload(){\r\n\r\n        //load images\r\n        this.width = this.sys.game.canvas.width;\r\n        this.height = this.sys.game.canvas.height;\r\n\r\n        this.textures.addBase64(\"ship0\", require(\"@/assets/ships/ship0.png\"));\r\n        this.load.image(\"ship1\", require(\"@/assets/ships/ship1.png\"));\r\n        this.load.image(\"ship2\", require(\"@/assets/ships/ship2.png\"));\r\n        this.load.image(\"ship3\", require(\"@/assets/ships/ship3.png\"));\r\n\r\n        this.textures.addBase64(\"bullet\", require(\"@/assets/bullet.png\"));\r\n\r\n        let onresize = () => {\r\n            let parent = document.getElementById(\"players-wrapper\");\r\n            let dim = Math.min(parent.offsetWidth, parent.offsetHeight);\r\n            this.game.scale.resize(dim, dim);\r\n            this.physics.world.setBounds(0, 0, dim, dim);\r\n        };\r\n        window.addEventListener(\"resize\", onresize);\r\n        this.events.on(\"destroy\", ()=>{\r\n            window.removeEventListener(\"resize\", onresize);\r\n        });\r\n\r\n    }\r\n\r\n    create(){\r\n        //Event lobby-modified\r\n        this.socket.on(websocketEvents.LOBBY_MODIFIED, game => {\r\n            let currentlyPlayingIds = [];\r\n            game.players.forEach(player => {currentlyPlayingIds.push(player.localId)});\r\n\r\n            let previousPlayingIds = [];\r\n            this.lobby.players.forEach(player => {previousPlayingIds.push(player.localId)});\r\n\r\n            this.lobby = {...game};\r\n\r\n            let newShips = {};\r\n            currentlyPlayingIds.forEach(id => {\r\n                if(previousPlayingIds.includes(id)){\r\n                    newShips[id] = this.ships[id];\r\n                    newShips[id].setVelocity(\r\n                        this.lobby.settings.velocity* this.normalizers.velocity * Math.cos(newShips[id].rotation),\r\n                        this.lobby.settings.velocity* this.normalizers.velocity * Math.sin(newShips[id].rotation)\r\n                    );\r\n                    newShips[id].setTexture(\"ship\"+this.findPlayerById(id).color);\r\n                } else {\r\n                    newShips[id] = this.createNewShip(this.findPlayerById(id).color, id!==game.currentPlayer);\r\n                }\r\n            });\r\n\r\n            this.ships = newShips;\r\n        });\r\n\r\n        //Setting up rotation and shooting\r\n        this.keySpace = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);\r\n        this.input.keyboard.on(\"keyup-ENTER\", ()=>{\r\n            if(this.availableBullets>0){\r\n                let bullet = this.physics.add.image(\r\n                    this.ships[this.lobby.currentPlayer].x,\r\n                    this.ships[this.lobby.currentPlayer].y,\r\n                    \"bullet\"\r\n                );\r\n                bullet.rotation = this.ships[this.lobby.currentPlayer].rotation;\r\n                bullet.setVelocity(\r\n                    this.lobby.settings.bulletVelocity*this.normalizers.bulletVelocity*Math.cos(bullet.rotation),\r\n                    this.lobby.settings.bulletVelocity*this.normalizers.bulletVelocity*Math.sin(bullet.rotation)\r\n                );\r\n                this.availableBullets--;\r\n            }\r\n        });\r\n    }\r\n\r\n    update(time, delta){\r\n        if(Array.isArray(this.lobby.players) && this.lobby.players.length>0) {\r\n            this.lobby.players.forEach(player => {\r\n                if(player.localId !== this.lobby.currentPlayer) {\r\n                    let {x, y} = this.ships[player.localId].body.velocity;\r\n                    this.ships[player.localId].rotation = this.getAngle(x, y);\r\n                }\r\n            });\r\n        }\r\n        if(this.lobby.currentPlayer!==null && this.keySpace.isDown){\r\n            this.ships[this.lobby.currentPlayer].rotation += this.lobby.settings.angularVelocity* this.normalizers.angularVelocity *delta;\r\n            this.ships[this.lobby.currentPlayer].setVelocity(\r\n                this.lobby.settings.velocity* this.normalizers.velocity * Math.cos(this.ships[this.lobby.currentPlayer].rotation),\r\n                this.lobby.settings.velocity* this.normalizers.velocity * Math.sin(this.ships[this.lobby.currentPlayer].rotation)\r\n            );\r\n        }\r\n    }\r\n}"]}]}