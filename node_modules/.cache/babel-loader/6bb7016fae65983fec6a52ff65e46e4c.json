{"remainingRequest":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/babel-loader/lib/index.js!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/eslint-loader/index.js??ref--13-0!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/LobbyScene.js","dependencies":[{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/LobbyScene.js","mtime":1617881493748},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/cache-loader/dist/cjs.js","mtime":1616495189815},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/babel-loader/lib/index.js","mtime":1616495189787},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/eslint-loader/index.js","mtime":1616495190059}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL21lZGlhL2phY29wby9Wb2x1bWVEYXRpL0RvY3VtZW50aS9wYXBlcm8udGsvY29zbW9zLnBhcGVyby5tZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vb2JqZWN0U3ByZWFkMiI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiL21lZGlhL2phY29wby9Wb2x1bWVEYXRpL0RvY3VtZW50aS9wYXBlcm8udGsvY29zbW9zLnBhcGVyby5tZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY2xhc3NDYWxsQ2hlY2siOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIi9tZWRpYS9qYWNvcG8vVm9sdW1lRGF0aS9Eb2N1bWVudGkvcGFwZXJvLnRrL2Nvc21vcy5wYXBlcm8ubWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKaW1wb3J0IF9pbmhlcml0cyBmcm9tICIvbWVkaWEvamFjb3BvL1ZvbHVtZURhdGkvRG9jdW1lbnRpL3BhcGVyby50ay9jb3Ntb3MucGFwZXJvLm1lL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9pbmhlcml0cyI7CmltcG9ydCBfY3JlYXRlU3VwZXIgZnJvbSAiL21lZGlhL2phY29wby9Wb2x1bWVEYXRpL0RvY3VtZW50aS9wYXBlcm8udGsvY29zbW9zLnBhcGVyby5tZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlU3VwZXIiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIuanMiOwppbXBvcnQgUGhhc2VyIGZyb20gInBoYXNlciI7CmltcG9ydCB3ZWJzb2NrZXRFdmVudHMgZnJvbSAiLi4vY29uc3RhbnRzL3dlYnNvY2tldEV2ZW50cyI7CmltcG9ydCB7IGRlZmF1bHRTZXR0aW5ncywgbm9ybWFsaXplcnMsIHNjZW5lS2V5cyB9IGZyb20gIi4uL2NvbnN0YW50cy9nYW1lU2V0dGluZ3MiOwppbXBvcnQgeyBkZXRlY3RUb3VjaFNjcmVlbiB9IGZyb20gIi4uL2NvbnN0YW50cy9jb25zdGFudHMiOwoKdmFyIExvYmJ5U2NlbmUgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9QaGFzZXIkU2NlbmUpIHsKICBfaW5oZXJpdHMoTG9iYnlTY2VuZSwgX1BoYXNlciRTY2VuZSk7CgogIHZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIoTG9iYnlTY2VuZSk7CgogIGZ1bmN0aW9uIExvYmJ5U2NlbmUoc29ja2V0KSB7CiAgICB2YXIgX3RoaXM7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIExvYmJ5U2NlbmUpOwoKICAgIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgewogICAgICBrZXk6IHNjZW5lS2V5cy5sb2JieQogICAgfSk7CiAgICBfdGhpcy5zb2NrZXQgPSBzb2NrZXQ7CiAgICBfdGhpcy5sb2JieSA9IHsKICAgICAgcGxheWVyczogW10sCiAgICAgIGN1cnJlbnRQbGF5ZXI6IG51bGwsCiAgICAgIHNldHRpbmdzOiBkZWZhdWx0U2V0dGluZ3MKICAgIH07CiAgICBfdGhpcy50b3VjaFNjcmVlbiA9IGRldGVjdFRvdWNoU2NyZWVuKCk7CiAgICBfdGhpcy5zaGlwcyA9IHt9OwogICAgX3RoaXMuYXZhaWxhYmxlQnVsbGV0cyA9IDM7CiAgICByZXR1cm4gX3RoaXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoTG9iYnlTY2VuZSwgW3sKICAgIGtleTogInByZWxvYWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHByZWxvYWQoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgLy9sb2FkIGltYWdlcwogICAgICB0aGlzLndpZHRoID0gdGhpcy5zeXMuZ2FtZS5jYW52YXMud2lkdGg7CiAgICAgIHRoaXMuaGVpZ2h0ID0gdGhpcy5zeXMuZ2FtZS5jYW52YXMuaGVpZ2h0OwogICAgICB0aGlzLmxvYWQuaW1hZ2UoInNoaXAwIiwgIi4vc2hpcHMvc2hpcDAucG5nIik7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgic2hpcDEiLCAiLi9zaGlwcy9zaGlwMS5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJzaGlwMiIsICIuL3NoaXBzL3NoaXAyLnBuZyIpOwogICAgICB0aGlzLmxvYWQuaW1hZ2UoInNoaXAzIiwgIi4vc2hpcHMvc2hpcDMucG5nIik7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgiYnVsbGV0IiwgIi4vYnVsbGV0LnBuZyIpOwogICAgICB0aGlzLmxvYWQuaW1hZ2UoImJ1bGxldC1sb2FkZWQiLCAiLi9idWxsZXQtbG9hZGVkLnBuZyIpOwogICAgICB0aGlzLmxvYWQuaW1hZ2UoImJsb2NrMSIsICIuL2Jsb2NrLnBuZyIpOwogICAgICB0aGlzLmxvYWQuaW1hZ2UoImJsb2NrMiIsICIuL2Jsb2NrLnBuZyIpOwoKICAgICAgaWYgKHRoaXMudG91Y2hTY3JlZW4pIHsKICAgICAgICB0aGlzLmxvYWQuaW1hZ2UoInJvdGF0ZS1idXR0b24iLCAiLi9yb3RhdGUtYnV0dG9uLnBuZyIpOwogICAgICAgIHRoaXMubG9hZC5pbWFnZSgic2hvb3QtYnV0dG9uIiwgIi4vc2hvb3QtYnV0dG9uLnBuZyIpOwogICAgICB9CgogICAgICB2YXIgb25yZXNpemUgPSBmdW5jdGlvbiBvbnJlc2l6ZSgpIHsKICAgICAgICB2YXIgcGFyZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBsYXllcnMtd3JhcHBlciIpOwogICAgICAgIHZhciBoZWlnaHQgPSBNYXRoLm1pbihwYXJlbnQub2Zmc2V0V2lkdGgsIHBhcmVudC5vZmZzZXRIZWlnaHQpOwogICAgICAgIHZhciB3aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoID4gNzUwID8gaGVpZ2h0IDogd2luZG93LmlubmVyV2lkdGggKiAwLjg7CgogICAgICAgIF90aGlzMi5nYW1lLnNjYWxlLnJlc2l6ZSh3aWR0aCwgaGVpZ2h0KTsKCiAgICAgICAgX3RoaXMyLnBoeXNpY3Mud29ybGQuc2V0Qm91bmRzKDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICB9OwoKICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInJlc2l6ZSIsIG9ucmVzaXplKTsKICAgICAgdGhpcy5ldmVudHMub24oImRlc3Ryb3kiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInJlc2l6ZSIsIG9ucmVzaXplKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY3JlYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGUoKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgLy9FdmVudCBsb2JieS1tb2RpZmllZAogICAgICB0aGlzLnNvY2tldC5lbWl0KHdlYnNvY2tldEV2ZW50cy5MT0JCWV9NT0RJRklFRCk7CiAgICAgIHRoaXMuc29ja2V0Lm9uKHdlYnNvY2tldEV2ZW50cy5MT0JCWV9NT0RJRklFRCwgZnVuY3Rpb24gKGdhbWUpIHsKICAgICAgICByZXR1cm4gX3RoaXMzLm9uTG9iYnlNb2RpZmllZChnYW1lKTsKICAgICAgfSk7IC8vU2V0dGluZyB1cCByb3RhdGlvbiBhbmQgc2hvb3RpbmcKCiAgICAgIHRoaXMuc2V0S2V5SW5wdXRIYW5kbGVycygpOwoKICAgICAgaWYgKHRoaXMudG91Y2hTY3JlZW4pIHsKICAgICAgICB0aGlzLmFkZC5pbWFnZSgwLCB0aGlzLmhlaWdodCAvIDIsICJyb3RhdGUtYnV0dG9uIikuc2V0T3JpZ2luKDAsIDAuNSk7CiAgICAgICAgdGhpcy5hZGQuaW1hZ2UodGhpcy53aWR0aCwgdGhpcy5oZWlnaHQgLyAyLCAic2hvb3QtYnV0dG9uIikuc2V0T3JpZ2luKDEsIDAuNSk7CiAgICAgICAgdGhpcy5zZXRUb3VjaElucHV0SGFuZGxlcnMoKTsKICAgICAgfQoKICAgICAgdGhpcy5zZXRSZWxvYWRJbnRlcnZhbCgpOwogICAgICB0aGlzLnNldE9uRGVzdHJveSgpOwogICAgICB0aGlzLm9uTG9iYnlNb2RpZmllZCh7CiAgICAgICAgLy9UT0RPOiBDSEFOR0UgSEVSRQogICAgICAgIHNldHRpbmdzOiBkZWZhdWx0U2V0dGluZ3MsCiAgICAgICAgY3VycmVudFBsYXllcjogMCwKICAgICAgICBwbGF5ZXJzOiBbewogICAgICAgICAgbG9jYWxJZDogMCwKICAgICAgICAgIGNvbG9yOiAwCiAgICAgICAgfSwgewogICAgICAgICAgbG9jYWxJZDogMSwKICAgICAgICAgIGNvbG9yOiAxCiAgICAgICAgfV0KICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAidXBkYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGUodGltZSwgZGVsdGEpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLmxvYmJ5LnBsYXllcnMpICYmIHRoaXMubG9iYnkucGxheWVycy5sZW5ndGggPiAwKSB7CiAgICAgICAgdGhpcy5sb2JieS5wbGF5ZXJzLmZvckVhY2goZnVuY3Rpb24gKHBsYXllcikgewogICAgICAgICAgdmFyIHNoaXAgPSBfdGhpczQuc2hpcHNbcGxheWVyLmxvY2FsSWRdOwogICAgICAgICAgdmFyIF9zaGlwJGJvZHkkdmVsb2NpdHkgPSBzaGlwLmJvZHkudmVsb2NpdHksCiAgICAgICAgICAgICAgeCA9IF9zaGlwJGJvZHkkdmVsb2NpdHkueCwKICAgICAgICAgICAgICB5ID0gX3NoaXAkYm9keSR2ZWxvY2l0eS55OwogICAgICAgICAgc2hpcC5hbmdsZSA9IF90aGlzNC5nZXRBbmdsZSh4LCB5KTsKICAgICAgICAgIHNoaXAuYnVsbGV0c0xvYWRlZC5jaGlsZHJlbi5pdGVyYXRlKGZ1bmN0aW9uIChidWxsZXQsIGluZGV4KSB7CiAgICAgICAgICAgIHZhciB0b3BMZWZ0ID0gc2hpcC5nZXRUb3BMZWZ0KCk7CiAgICAgICAgICAgIHZhciBib3R0b21MZWZ0ID0gc2hpcC5nZXRCb3R0b21MZWZ0KCk7CiAgICAgICAgICAgIHZhciBjZW50ZXJMZWZ0ID0gewogICAgICAgICAgICAgIHg6ICh0b3BMZWZ0LnggKyBib3R0b21MZWZ0LngpIC8gMiwKICAgICAgICAgICAgICB5OiAodG9wTGVmdC55ICsgYm90dG9tTGVmdC55KSAvIDIKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHN3aXRjaCAoaW5kZXgpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBidWxsZXQueCA9IGJvdHRvbUxlZnQueCAtIHNoaXAud2lkdGggLyA0ICogTWF0aC5jb3Moc2hpcC5yb3RhdGlvbik7CiAgICAgICAgICAgICAgICBidWxsZXQueSA9IGJvdHRvbUxlZnQueSAtIHNoaXAuaGVpZ2h0IC8gNCAqIE1hdGguc2luKHNoaXAucm90YXRpb24pOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIGJ1bGxldC54ID0gdG9wTGVmdC54IC0gc2hpcC53aWR0aCAvIDQgKiBNYXRoLmNvcyhzaGlwLnJvdGF0aW9uKTsKICAgICAgICAgICAgICAgIGJ1bGxldC55ID0gdG9wTGVmdC55IC0gc2hpcC5oZWlnaHQgLyA0ICogTWF0aC5zaW4oc2hpcC5yb3RhdGlvbik7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgYnVsbGV0LnggPSBjZW50ZXJMZWZ0LnggLSBzaGlwLndpZHRoIC8gNCAqIE1hdGguY29zKHNoaXAucm90YXRpb24pOwogICAgICAgICAgICAgICAgYnVsbGV0LnkgPSBjZW50ZXJMZWZ0LnkgLSBzaGlwLmhlaWdodCAvIDQgKiBNYXRoLnNpbihzaGlwLnJvdGF0aW9uKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMubG9iYnkuY3VycmVudFBsYXllciAhPT0gbnVsbCAmJiAodGhpcy5rZXlTcGFjZS5pc0Rvd24gfHwgdGhpcy5yb3RhdGluZykpIHsKICAgICAgICB0aGlzLnNoaXBzW3RoaXMubG9iYnkuY3VycmVudFBsYXllcl0uYW5nbGUgKz0gdGhpcy5sb2JieS5zZXR0aW5ncy5hbmd1bGFyVmVsb2NpdHkgKiBub3JtYWxpemVycy5hbmd1bGFyVmVsb2NpdHkgKiBkZWx0YTsKCiAgICAgICAgdmFyIF90aGlzJHBoeXNpY3MkdmVsb2NpdCA9IHRoaXMucGh5c2ljcy52ZWxvY2l0eUZyb21BbmdsZSh0aGlzLnNoaXBzW3RoaXMubG9iYnkuY3VycmVudFBsYXllcl0uYW5nbGUsIHRoaXMubG9iYnkuc2V0dGluZ3MudmVsb2NpdHkgKiBub3JtYWxpemVycy52ZWxvY2l0eSksCiAgICAgICAgICAgIHggPSBfdGhpcyRwaHlzaWNzJHZlbG9jaXQueCwKICAgICAgICAgICAgeSA9IF90aGlzJHBoeXNpY3MkdmVsb2NpdC55OwoKICAgICAgICB0aGlzLnNoaXBzW3RoaXMubG9iYnkuY3VycmVudFBsYXllcl0uc2V0VmVsb2NpdHkoeCwgeSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRBbmdsZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0QW5nbGUoeCwgeSkgewogICAgICB2YXIgYW5nbGU7CgogICAgICBpZiAoeCAhPT0gMCkgewogICAgICAgIGFuZ2xlID0gTWF0aC5hdGFuKHkgLyB4KSAqIDE4MCAvIE1hdGguUEk7CiAgICAgICAgYW5nbGUgPSB4IDwgMCA/IGFuZ2xlICsgMTgwIDogYW5nbGU7CiAgICAgIH0gZWxzZSBpZiAoeSA+PSAwKSBhbmdsZSA9IDkwO2Vsc2UgaWYgKHkgPCAwKSBhbmdsZSA9IC05MDsKCiAgICAgIHJldHVybiBhbmdsZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjcmVhdGVOZXdTaGlwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVOZXdTaGlwKGNvbG9yKSB7CiAgICAgIHZhciBwb3NYID0gUGhhc2VyLk1hdGguQmV0d2VlbigwLCB0aGlzLndpZHRoKTsKICAgICAgdmFyIHBvc1kgPSBQaGFzZXIuTWF0aC5CZXR3ZWVuKDAsIHRoaXMuaGVpZ2h0KTsKICAgICAgdmFyIHNoaXAgPSB0aGlzLnBoeXNpY3MuYWRkLnNwcml0ZShwb3NYLCBwb3NZLCAic2hpcCIgKyBjb2xvcik7CiAgICAgIHZhciBhbmdsZSA9IFBoYXNlci5NYXRoLkJldHdlZW4oNDUsIDEzNSk7CgogICAgICB2YXIgX3RoaXMkcGh5c2ljcyR2ZWxvY2l0MiA9IHRoaXMucGh5c2ljcy52ZWxvY2l0eUZyb21BbmdsZShhbmdsZSwgdGhpcy5sb2JieS5zZXR0aW5ncy52ZWxvY2l0eSAqIG5vcm1hbGl6ZXJzLnZlbG9jaXR5KSwKICAgICAgICAgIHggPSBfdGhpcyRwaHlzaWNzJHZlbG9jaXQyLngsCiAgICAgICAgICB5ID0gX3RoaXMkcGh5c2ljcyR2ZWxvY2l0Mi55OwoKICAgICAgc2hpcC5zZXRWZWxvY2l0eSh4LCB5KTsKICAgICAgc2hpcC5hbmdsZSA9IGFuZ2xlOwogICAgICBzaGlwLnNldENvbGxpZGVXb3JsZEJvdW5kcyh0cnVlKTsKICAgICAgc2hpcC5zZXRCb3VuY2UoMSwgMSk7CiAgICAgIHNoaXAuYnVsbGV0c0xvYWRlZCA9IHRoaXMucGh5c2ljcy5hZGQuZ3JvdXAoewogICAgICAgIGNvbGxpZGVXb3JsZEJvdW5kczogZmFsc2UsCiAgICAgICAga2V5OiAiYnVsbGV0LWxvYWRlZCIsCiAgICAgICAgcXVhbnRpdHk6IDMsCiAgICAgICAgdmlzaWJsZTogdHJ1ZSwKICAgICAgICBhY3RpdmU6IHRydWUKICAgICAgfSk7CiAgICAgIHJldHVybiBzaGlwOwogICAgfQogIH0sIHsKICAgIGtleTogImZpbmRQbGF5ZXJCeUlkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmaW5kUGxheWVyQnlJZChpZCkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubG9iYnkucGxheWVycy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmxvYmJ5LnBsYXllcnNbaV0ubG9jYWxJZCA9PT0gaWQpIHJldHVybiB0aGlzLmxvYmJ5LnBsYXllcnNbaV07CiAgICAgIH0KCiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0sIHsKICAgIGtleTogIm9uTG9iYnlNb2RpZmllZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25Mb2JieU1vZGlmaWVkKGdhbWUpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICB2YXIgY3VycmVudGx5UGxheWluZ0lkcyA9IFtdOwogICAgICBnYW1lLnBsYXllcnMuZm9yRWFjaChmdW5jdGlvbiAocGxheWVyKSB7CiAgICAgICAgY3VycmVudGx5UGxheWluZ0lkcy5wdXNoKHBsYXllci5sb2NhbElkKTsKICAgICAgfSk7CiAgICAgIHZhciBwcmV2aW91c1BsYXlpbmdJZHMgPSBbXTsKICAgICAgdGhpcy5sb2JieS5wbGF5ZXJzLmZvckVhY2goZnVuY3Rpb24gKHBsYXllcikgewogICAgICAgIHByZXZpb3VzUGxheWluZ0lkcy5wdXNoKHBsYXllci5sb2NhbElkKTsKICAgICAgfSk7CiAgICAgIHRoaXMubG9iYnkgPSBfb2JqZWN0U3ByZWFkKHt9LCBnYW1lKTsKICAgICAgdmFyIG5ld1NoaXBzID0ge307CgogICAgICB2YXIgb2xkU2hpcHMgPSBfb2JqZWN0U3ByZWFkKHt9LCB0aGlzLnNoaXBzKTsKCiAgICAgIGN1cnJlbnRseVBsYXlpbmdJZHMuZm9yRWFjaChmdW5jdGlvbiAoaWQpIHsKICAgICAgICBpZiAocHJldmlvdXNQbGF5aW5nSWRzLmluY2x1ZGVzKGlkKSkgewogICAgICAgICAgbmV3U2hpcHNbaWRdID0gX3RoaXM1LnNoaXBzW2lkXTsKCiAgICAgICAgICB2YXIgX3RoaXM1JHBoeXNpY3MkdmVsb2NpID0gX3RoaXM1LnBoeXNpY3MudmVsb2NpdHlGcm9tQW5nbGUobmV3U2hpcHNbaWRdLmFuZ2xlLCBfdGhpczUubG9iYnkuc2V0dGluZ3MudmVsb2NpdHkgKiBub3JtYWxpemVycy52ZWxvY2l0eSksCiAgICAgICAgICAgICAgeCA9IF90aGlzNSRwaHlzaWNzJHZlbG9jaS54LAogICAgICAgICAgICAgIHkgPSBfdGhpczUkcGh5c2ljcyR2ZWxvY2kueTsKCiAgICAgICAgICBuZXdTaGlwc1tpZF0uc2V0VmVsb2NpdHkoeCwgeSk7CiAgICAgICAgICBuZXdTaGlwc1tpZF0uc2V0VGV4dHVyZSgic2hpcCIgKyBfdGhpczUuZmluZFBsYXllckJ5SWQoaWQpLmNvbG9yKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbmV3U2hpcHNbaWRdID0gX3RoaXM1LmNyZWF0ZU5ld1NoaXAoX3RoaXM1LmZpbmRQbGF5ZXJCeUlkKGlkKS5jb2xvcik7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdmFyIGlkc1RvUmVtb3ZlID0gcHJldmlvdXNQbGF5aW5nSWRzLmZpbHRlcihmdW5jdGlvbiAoeCkgewogICAgICAgIHJldHVybiAhY3VycmVudGx5UGxheWluZ0lkcy5pbmNsdWRlcyh4KTsKICAgICAgfSk7CiAgICAgIGlkc1RvUmVtb3ZlLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7CiAgICAgICAgb2xkU2hpcHMuYnVsbGV0c0xvYWRlZC5jaGlsZHJlbi5pdGVyYXRlKGZ1bmN0aW9uIChidWxsZXQpIHsKICAgICAgICAgIGJ1bGxldC5kZXN0cm95KCk7CiAgICAgICAgfSk7CiAgICAgICAgb2xkU2hpcHNbaWRdLmRlc3Ryb3koKTsKICAgICAgfSk7CiAgICAgIHRoaXMuc2hpcHMgPSBuZXdTaGlwczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjcmVhdGVCdWxsZXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZUJ1bGxldCgpIHsKICAgICAgdmFyIGJ1bGxldCA9IHRoaXMucGh5c2ljcy5hZGQuaW1hZ2UodGhpcy5zaGlwc1t0aGlzLmxvYmJ5LmN1cnJlbnRQbGF5ZXJdLngsIHRoaXMuc2hpcHNbdGhpcy5sb2JieS5jdXJyZW50UGxheWVyXS55LCAiYnVsbGV0Iik7CiAgICAgIGJ1bGxldC5hbmdsZSA9IHRoaXMuc2hpcHNbdGhpcy5sb2JieS5jdXJyZW50UGxheWVyXS5hbmdsZTsKCiAgICAgIHZhciBfdGhpcyRwaHlzaWNzJHZlbG9jaXQzID0gdGhpcy5waHlzaWNzLnZlbG9jaXR5RnJvbUFuZ2xlKGJ1bGxldC5hbmdsZSwgdGhpcy5sb2JieS5zZXR0aW5ncy5idWxsZXRWZWxvY2l0eSAqIG5vcm1hbGl6ZXJzLmJ1bGxldFZlbG9jaXR5KSwKICAgICAgICAgIHggPSBfdGhpcyRwaHlzaWNzJHZlbG9jaXQzLngsCiAgICAgICAgICB5ID0gX3RoaXMkcGh5c2ljcyR2ZWxvY2l0My55OwoKICAgICAgYnVsbGV0LnNldFZlbG9jaXR5KHgsIHkpOwogICAgICB0aGlzLnNoaXBzW3RoaXMubG9iYnkuY3VycmVudFBsYXllcl0uYnVsbGV0c0xvYWRlZC5nZXRGaXJzdEFsaXZlKCkuc2V0QWN0aXZlKGZhbHNlKS5zZXRWaXNpYmxlKGZhbHNlKTsKICAgICAgdGhpcy5hdmFpbGFibGVCdWxsZXRzLS07CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0UmVsb2FkSW50ZXJ2YWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFJlbG9hZEludGVydmFsKCkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIHZhciBoYW5kbGVyID0gZnVuY3Rpb24gaGFuZGxlcigpIHsKICAgICAgICBfdGhpczYuYXZhaWxhYmxlQnVsbGV0cyA9IF90aGlzNi5hdmFpbGFibGVCdWxsZXRzID49IDMgPyBfdGhpczYuYXZhaWxhYmxlQnVsbGV0cyA6IF90aGlzNi5hdmFpbGFibGVCdWxsZXRzICsgMTsKCiAgICAgICAgdmFyIGZpcnN0RGVhZCA9IF90aGlzNi5zaGlwc1tfdGhpczYubG9iYnkuY3VycmVudFBsYXllcl0uYnVsbGV0c0xvYWRlZC5nZXRGaXJzdERlYWQoKTsKCiAgICAgICAgaWYgKGZpcnN0RGVhZCkgewogICAgICAgICAgZmlyc3REZWFkLnNldEFjdGl2ZSh0cnVlKS5zZXRWaXNpYmxlKHRydWUpOwogICAgICAgIH0KCiAgICAgICAgY2xlYXJJbnRlcnZhbChfdGhpczYucmVsb2FkSW50ZXJ2YWwpOwogICAgICAgIF90aGlzNi5yZWxvYWRJbnRlcnZhbCA9IHNldEludGVydmFsKGhhbmRsZXIsIDEgLyAoX3RoaXM2LmxvYmJ5LnNldHRpbmdzLnJlbG9hZGluZ1ZlbG9jaXR5ICogbm9ybWFsaXplcnMucmVsb2FkaW5nVmVsb2NpdHkpKTsKICAgICAgfTsKCiAgICAgIHRoaXMucmVsb2FkSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChoYW5kbGVyLCAxIC8gKHRoaXMubG9iYnkuc2V0dGluZ3MucmVsb2FkaW5nVmVsb2NpdHkgKiBub3JtYWxpemVycy5yZWxvYWRpbmdWZWxvY2l0eSkpOwogICAgfQogIH0sIHsKICAgIGtleTogInNldFRvdWNoSW5wdXRIYW5kbGVycyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0VG91Y2hJbnB1dEhhbmRsZXJzKCkgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgIHRoaXMuaW5wdXQuYWRkUG9pbnRlcigxKTsKICAgICAgdGhpcy5pbnB1dC5vbigicG9pbnRlcnVwIiwgZnVuY3Rpb24gKHBvaW50ZXIpIHsKICAgICAgICBpZiAocG9pbnRlci54IDwgX3RoaXM3LndpZHRoIC8gMikgewogICAgICAgICAgX3RoaXM3LnJvdGF0aW5nID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5pbnB1dC5vbigicG9pbnRlcmRvd24iLCBmdW5jdGlvbiAocG9pbnRlcikgewogICAgICAgIGlmIChwb2ludGVyLnggPCBfdGhpczcud2lkdGggLyAyKSB7CiAgICAgICAgICBfdGhpczcucm90YXRpbmcgPSB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoX3RoaXM3LmF2YWlsYWJsZUJ1bGxldHMgPiAwKSBfdGhpczcuY3JlYXRlQnVsbGV0KCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRLZXlJbnB1dEhhbmRsZXJzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRLZXlJbnB1dEhhbmRsZXJzKCkgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKCiAgICAgIHRoaXMua2V5U3BhY2UgPSB0aGlzLmlucHV0LmtleWJvYXJkLmFkZEtleShQaGFzZXIuSW5wdXQuS2V5Ym9hcmQuS2V5Q29kZXMuU1BBQ0UpOwogICAgICB0aGlzLmlucHV0LmtleWJvYXJkLm9uKCJrZXl1cC1FTlRFUiIsIGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoX3RoaXM4LmF2YWlsYWJsZUJ1bGxldHMgPiAwKSBfdGhpczguY3JlYXRlQnVsbGV0KCk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogInNldE9uRGVzdHJveSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0T25EZXN0cm95KCkgewogICAgICB2YXIgX3RoaXM5ID0gdGhpczsKCiAgICAgIHRoaXMuZXZlbnRzLm9uKCJkZXN0cm95IiwgZnVuY3Rpb24gKCkgewogICAgICAgIGNsZWFySW50ZXJ2YWwoX3RoaXM5LnJlbG9hZEludGVydmFsKTsKICAgICAgfSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gTG9iYnlTY2VuZTsKfShQaGFzZXIuU2NlbmUpOwoKZXhwb3J0IHsgTG9iYnlTY2VuZSBhcyBkZWZhdWx0IH07"},{"version":3,"sources":["/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/LobbyScene.js"],"names":["Phaser","websocketEvents","defaultSettings","normalizers","sceneKeys","detectTouchScreen","LobbyScene","socket","key","lobby","players","currentPlayer","settings","touchScreen","ships","availableBullets","width","sys","game","canvas","height","load","image","onresize","parent","document","getElementById","Math","min","offsetWidth","offsetHeight","window","innerWidth","scale","resize","physics","world","setBounds","addEventListener","events","on","removeEventListener","emit","LOBBY_MODIFIED","onLobbyModified","setKeyInputHandlers","add","setOrigin","setTouchInputHandlers","setReloadInterval","setOnDestroy","localId","color","time","delta","Array","isArray","length","forEach","player","ship","body","velocity","x","y","angle","getAngle","bulletsLoaded","children","iterate","bullet","index","topLeft","getTopLeft","bottomLeft","getBottomLeft","centerLeft","cos","rotation","sin","keySpace","isDown","rotating","angularVelocity","velocityFromAngle","setVelocity","atan","PI","posX","Between","posY","sprite","setCollideWorldBounds","setBounce","group","collideWorldBounds","quantity","visible","active","id","i","currentlyPlayingIds","push","previousPlayingIds","newShips","oldShips","includes","setTexture","findPlayerById","createNewShip","idsToRemove","filter","destroy","bulletVelocity","getFirstAlive","setActive","setVisible","handler","firstDead","getFirstDead","clearInterval","reloadInterval","setInterval","reloadingVelocity","input","addPointer","pointer","createBullet","keyboard","addKey","Input","Keyboard","KeyCodes","SPACE","Scene"],"mappings":"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","sourcesContent":["import Phaser from \"phaser\";\nimport websocketEvents from \"../constants/websocketEvents\";\nimport {defaultSettings, normalizers, sceneKeys} from \"../constants/gameSettings\";\nimport {detectTouchScreen} from \"../constants/constants\";\n\nexport default class LobbyScene extends Phaser.Scene {\n\n    constructor(socket) {\n        super({key: sceneKeys.lobby});\n        this.socket = socket;\n        this.lobby = {\n            players: [],\n            currentPlayer: null,\n            settings: defaultSettings\n        }\n\n        this.touchScreen = detectTouchScreen();\n\n        this.ships = {};\n        this.availableBullets = 3;\n    }\n\n    preload(){\n\n        //load images\n        this.width = this.sys.game.canvas.width;\n        this.height = this.sys.game.canvas.height;\n\n        this.load.image(\"ship0\", \"./ships/ship0.png\");\n        this.load.image(\"ship1\", \"./ships/ship1.png\");\n        this.load.image(\"ship2\", \"./ships/ship2.png\");\n        this.load.image(\"ship3\", \"./ships/ship3.png\");\n        this.load.image(\"bullet\", \"./bullet.png\");\n        this.load.image(\"bullet-loaded\", \"./bullet-loaded.png\");\n\n        this.load.image(\"block1\", \"./block.png\");\n        this.load.image(\"block2\", \"./block.png\");\n\n        if(this.touchScreen) {\n            this.load.image(\"rotate-button\", \"./rotate-button.png\");\n            this.load.image(\"shoot-button\", \"./shoot-button.png\");\n        }\n\n        const onresize = () => {\n            const parent = document.getElementById(\"players-wrapper\");\n            const height = Math.min(parent.offsetWidth, parent.offsetHeight);\n            const width = window.innerWidth>750 ? height : window.innerWidth*0.8\n            this.game.scale.resize(width, height);\n            this.physics.world.setBounds(0, 0, width, height);\n        };\n        window.addEventListener(\"resize\", onresize);\n        this.events.on(\"destroy\", ()=>{\n            window.removeEventListener(\"resize\", onresize);\n        });\n\n    }\n\n    create(){\n        //Event lobby-modified\n        this.socket.emit(websocketEvents.LOBBY_MODIFIED);\n        this.socket.on(websocketEvents.LOBBY_MODIFIED, game => this.onLobbyModified(game));\n\n        //Setting up rotation and shooting\n        this.setKeyInputHandlers();\n\n        if(this.touchScreen) {\n            this.add.image(0, this.height/2, \"rotate-button\").setOrigin(0, 0.5);\n            this.add.image(this.width, this.height/2, \"shoot-button\").setOrigin(1, 0.5);\n\n            this.setTouchInputHandlers();\n        }\n\n        this.setReloadInterval();\n\n        this.setOnDestroy();\n\n        this.onLobbyModified({ //TODO: CHANGE HERE\n            settings: defaultSettings,\n            currentPlayer: 0,\n            players: [\n                {\n                    localId: 0,\n                    color: 0\n                },\n                {\n                    localId: 1,\n                    color: 1\n                }\n            ]\n        });\n    }\n\n    update(time, delta){\n        if(Array.isArray(this.lobby.players) && this.lobby.players.length>0) {\n            this.lobby.players.forEach(player => {\n                const ship = this.ships[player.localId];\n                const {x, y} = ship.body.velocity;\n                ship.angle = this.getAngle(x, y);\n\n                ship.bulletsLoaded.children.iterate((bullet, index) => {\n                    const topLeft = ship.getTopLeft();\n                    const bottomLeft = ship.getBottomLeft();\n                    const centerLeft = {\n                        x: (topLeft.x + bottomLeft.x) /2,\n                        y: (topLeft.y + bottomLeft.y) /2\n                    }\n                    switch (index){\n                        case 0:\n                            bullet.x = bottomLeft.x - (ship.width/4)*Math.cos(ship.rotation);\n                            bullet.y = bottomLeft.y - (ship.height/4)*Math.sin(ship.rotation);\n                            break;\n                        case 1:\n                            bullet.x = topLeft.x - (ship.width/4)*Math.cos(ship.rotation);\n                            bullet.y = topLeft.y - (ship.height/4)*Math.sin(ship.rotation);\n                            break;\n                        case 2:\n                            bullet.x = centerLeft.x - (ship.width/4)*Math.cos(ship.rotation);\n                            bullet.y = centerLeft.y - (ship.height/4)*Math.sin(ship.rotation);\n                            break;\n                    }\n                });\n            });\n        }\n        if(this.lobby.currentPlayer!==null && (this.keySpace.isDown || this.rotating)){\n            this.ships[this.lobby.currentPlayer].angle += this.lobby.settings.angularVelocity* normalizers.angularVelocity * delta;\n            const {x, y} = this.physics.velocityFromAngle(this.ships[this.lobby.currentPlayer].angle, this.lobby.settings.velocity* normalizers.velocity);\n            this.ships[this.lobby.currentPlayer].setVelocity(x, y);\n        }\n    }\n\n    getAngle(x, y){\n        let angle;\n        if(x!==0) {\n            angle = Math.atan(y / x) * 180 / Math.PI;\n            angle = x < 0 ? angle + 180 : angle;\n        } else if(y>=0) angle = 90;\n        else if(y<0) angle = -90;\n        return angle;\n    }\n\n    createNewShip(color){\n        const posX = Phaser.Math.Between(0, this.width);\n        const posY = Phaser.Math.Between(0, this.height);\n        const ship = this.physics.add.sprite(posX, posY, \"ship\"+color);\n        const angle = Phaser.Math.Between(45, 135);\n        const {x, y} = this.physics.velocityFromAngle(angle, this.lobby.settings.velocity*normalizers.velocity)\n        ship.setVelocity(x, y);\n        ship.angle = angle;\n        ship.setCollideWorldBounds(true);\n        ship.setBounce(1, 1);\n        ship.bulletsLoaded = this.physics.add.group({\n            collideWorldBounds: false,\n            key: \"bullet-loaded\",\n            quantity: 3,\n            visible: true,\n            active: true\n        });\n        return ship;\n    }\n\n    findPlayerById(id){\n        for(let i = 0; i < this.lobby.players.length; i++){\n            if(this.lobby.players[i].localId === id) return this.lobby.players[i];\n        }\n        return null;\n    }\n\n\n    onLobbyModified(game){\n        const currentlyPlayingIds = [];\n        game.players.forEach(player => {currentlyPlayingIds.push(player.localId)});\n\n        const previousPlayingIds = [];\n        this.lobby.players.forEach(player => {previousPlayingIds.push(player.localId)});\n\n        this.lobby = {...game};\n\n        const newShips = {};\n        const oldShips = {...this.ships};\n        currentlyPlayingIds.forEach(id => {\n            if(previousPlayingIds.includes(id)){\n                newShips[id] = this.ships[id];\n                const {x, y} = this.physics.velocityFromAngle(newShips[id].angle, this.lobby.settings.velocity * normalizers.velocity);\n                newShips[id].setVelocity(x, y);\n                newShips[id].setTexture(\"ship\"+this.findPlayerById(id).color);\n            } else {\n                newShips[id] = this.createNewShip(this.findPlayerById(id).color);\n            }\n        });\n        const idsToRemove = previousPlayingIds.filter(x => !currentlyPlayingIds.includes(x));\n        idsToRemove.forEach(id => {\n            oldShips.bulletsLoaded.children.iterate(bullet => {bullet.destroy()});\n            oldShips[id].destroy()\n        });\n\n        this.ships = newShips;\n    }\n\n    createBullet(){\n        const bullet = this.physics.add.image(\n            this.ships[this.lobby.currentPlayer].x,\n            this.ships[this.lobby.currentPlayer].y,\n            \"bullet\"\n        );\n        bullet.angle = this.ships[this.lobby.currentPlayer].angle;\n        const {x, y} = this.physics.velocityFromAngle(bullet.angle, this.lobby.settings.bulletVelocity*normalizers.bulletVelocity);\n        bullet.setVelocity(x, y);\n        this.ships[this.lobby.currentPlayer].bulletsLoaded.getFirstAlive().setActive(false).setVisible(false);\n        this.availableBullets--;\n    }\n\n    setReloadInterval(){\n        const handler = () => {\n            this.availableBullets = this.availableBullets>=3 ? this.availableBullets : this.availableBullets+1;\n            const firstDead = this.ships[this.lobby.currentPlayer].bulletsLoaded.getFirstDead();\n            if(firstDead) {\n                firstDead.setActive(true).setVisible(true)\n            }\n            clearInterval(this.reloadInterval)\n            this.reloadInterval = setInterval(handler, 1/(this.lobby.settings.reloadingVelocity*normalizers.reloadingVelocity));\n        }\n        this.reloadInterval = setInterval(handler, 1/(this.lobby.settings.reloadingVelocity*normalizers.reloadingVelocity));\n    }\n\n    setTouchInputHandlers(){\n        this.input.addPointer(1);\n        this.input.on(\"pointerup\", (pointer) => {\n            if(pointer.x<this.width/2){\n                this.rotating = false;\n            }\n        });\n        this.input.on(\"pointerdown\", (pointer) => {\n            if(pointer.x<this.width/2){\n                this.rotating = true;\n            } else {\n                if(this.availableBullets>0) this.createBullet();\n            }\n        });\n    }\n\n    setKeyInputHandlers(){\n        this.keySpace = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);\n        this.input.keyboard.on(\"keyup-ENTER\", ()=>{\n            if(this.availableBullets>0) this.createBullet();\n        });\n    }\n\n    setOnDestroy(){\n        this.events.on(\"destroy\", ()=>{\n            clearInterval(this.reloadInterval);\n        });\n    }\n}"]}]}