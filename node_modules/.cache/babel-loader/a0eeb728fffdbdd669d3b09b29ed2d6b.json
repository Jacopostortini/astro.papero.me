{"remainingRequest":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/thread-loader/dist/cjs.js!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/babel-loader/lib/index.js!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/eslint-loader/index.js??ref--13-0!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/LobbyScene.js","dependencies":[{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/LobbyScene.js","mtime":1617378442018},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/cache-loader/dist/cjs.js","mtime":1616495189815},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/thread-loader/dist/cjs.js","mtime":1616495190967},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/babel-loader/lib/index.js","mtime":1616495189787},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/eslint-loader/index.js","mtime":1616495190059}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL21lZGlhL2phY29wby9Wb2x1bWVEYXRpL0RvY3VtZW50aS9wYXBlcm8udGsvY29zbW9zLnBhcGVyby5tZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vb2JqZWN0U3ByZWFkMiI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiL21lZGlhL2phY29wby9Wb2x1bWVEYXRpL0RvY3VtZW50aS9wYXBlcm8udGsvY29zbW9zLnBhcGVyby5tZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY2xhc3NDYWxsQ2hlY2siOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIi9tZWRpYS9qYWNvcG8vVm9sdW1lRGF0aS9Eb2N1bWVudGkvcGFwZXJvLnRrL2Nvc21vcy5wYXBlcm8ubWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKaW1wb3J0IF9pbmhlcml0cyBmcm9tICIvbWVkaWEvamFjb3BvL1ZvbHVtZURhdGkvRG9jdW1lbnRpL3BhcGVyby50ay9jb3Ntb3MucGFwZXJvLm1lL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9pbmhlcml0cyI7CmltcG9ydCBfY3JlYXRlU3VwZXIgZnJvbSAiL21lZGlhL2phY29wby9Wb2x1bWVEYXRpL0RvY3VtZW50aS9wYXBlcm8udGsvY29zbW9zLnBhcGVyby5tZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlU3VwZXIiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIuanMiOwppbXBvcnQgUGhhc2VyIGZyb20gInBoYXNlciI7CmltcG9ydCB3ZWJzb2NrZXRFdmVudHMgZnJvbSAiLi4vY29uc3RhbnRzL3dlYnNvY2tldEV2ZW50cyI7CmltcG9ydCB7IGRlZmF1bHRTZXR0aW5ncywgbm9ybWFsaXplcnMsIHNjZW5lS2V5cyB9IGZyb20gIi4uL2NvbnN0YW50cy9nYW1lU2V0dGluZ3MiOwppbXBvcnQgeyBkZXRlY3RUb3VjaFNjcmVlbiB9IGZyb20gIi4uL2NvbnN0YW50cy9jb25zdGFudHMiOwoKdmFyIExvYmJ5U2NlbmUgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9QaGFzZXIkU2NlbmUpIHsKICBfaW5oZXJpdHMoTG9iYnlTY2VuZSwgX1BoYXNlciRTY2VuZSk7CgogIHZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIoTG9iYnlTY2VuZSk7CgogIGZ1bmN0aW9uIExvYmJ5U2NlbmUoc29ja2V0KSB7CiAgICB2YXIgX3RoaXM7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIExvYmJ5U2NlbmUpOwoKICAgIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgewogICAgICBrZXk6IHNjZW5lS2V5cy5sb2JieQogICAgfSk7CiAgICBfdGhpcy5zb2NrZXQgPSBzb2NrZXQ7CiAgICBfdGhpcy5sb2JieSA9IHsKICAgICAgcGxheWVyczogW10sCiAgICAgIGN1cnJlbnRQbGF5ZXI6IG51bGwsCiAgICAgIHNldHRpbmdzOiBkZWZhdWx0U2V0dGluZ3MKICAgIH07CiAgICBfdGhpcy50b3VjaFNjcmVlbiA9IGRldGVjdFRvdWNoU2NyZWVuKCk7CiAgICBfdGhpcy5zaGlwcyA9IHt9OwogICAgX3RoaXMuYXZhaWxhYmxlQnVsbGV0cyA9IDM7CiAgICB2YXIgaW50ZXJ2YWw7CgogICAgdmFyIGhhbmRsZXIgPSBmdW5jdGlvbiBoYW5kbGVyKCkgewogICAgICBfdGhpcy5hdmFpbGFibGVCdWxsZXRzID0gX3RoaXMuYXZhaWxhYmxlQnVsbGV0cyA+PSAzID8gX3RoaXMuYXZhaWxhYmxlQnVsbGV0cyA6IF90aGlzLmF2YWlsYWJsZUJ1bGxldHMgKyAxOwogICAgICBjbGVhckludGVydmFsKGludGVydmFsKTsKICAgICAgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChoYW5kbGVyLCAxIC8gKF90aGlzLmxvYmJ5LnNldHRpbmdzLnJlbG9hZGluZ1ZlbG9jaXR5ICogbm9ybWFsaXplcnMucmVsb2FkaW5nVmVsb2NpdHkpKTsKICAgIH07CgogICAgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChoYW5kbGVyLCAxIC8gKF90aGlzLmxvYmJ5LnNldHRpbmdzLnJlbG9hZGluZ1ZlbG9jaXR5ICogbm9ybWFsaXplcnMucmVsb2FkaW5nVmVsb2NpdHkpKTsKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhMb2JieVNjZW5lLCBbewogICAga2V5OiAicHJlbG9hZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcHJlbG9hZCgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICAvL2xvYWQgaW1hZ2VzCiAgICAgIHRoaXMud2lkdGggPSB0aGlzLnN5cy5nYW1lLmNhbnZhcy53aWR0aDsKICAgICAgdGhpcy5oZWlnaHQgPSB0aGlzLnN5cy5nYW1lLmNhbnZhcy5oZWlnaHQ7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgic2hpcDAiLCAiLi9zaGlwcy9zaGlwMC5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJzaGlwMSIsICIuL3NoaXBzL3NoaXAxLnBuZyIpOwogICAgICB0aGlzLmxvYWQuaW1hZ2UoInNoaXAyIiwgIi4vc2hpcHMvc2hpcDIucG5nIik7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgic2hpcDMiLCAiLi9zaGlwcy9zaGlwMy5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJidWxsZXQiLCAiLi9idWxsZXQucG5nIik7CgogICAgICBpZiAodGhpcy50b3VjaFNjcmVlbikgewogICAgICAgIHRoaXMubG9hZC5pbWFnZSgicm90YXRlLWJ1dHRvbiIsICIuL3JvdGF0ZS1idXR0b24ucG5nIik7CiAgICAgICAgdGhpcy5sb2FkLmltYWdlKCJzaG9vdC1idXR0b24iLCAiLi9zaG9vdC1idXR0b24ucG5nIik7CiAgICAgIH0KCiAgICAgIHZhciBvbnJlc2l6ZSA9IGZ1bmN0aW9uIG9ucmVzaXplKCkgewogICAgICAgIHZhciBwYXJlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGxheWVycy13cmFwcGVyIik7CiAgICAgICAgdmFyIGhlaWdodCA9IE1hdGgubWluKHBhcmVudC5vZmZzZXRXaWR0aCwgcGFyZW50Lm9mZnNldEhlaWdodCk7CiAgICAgICAgdmFyIHdpZHRoID0gd2luZG93LmlubmVyV2lkdGggPiA3NTAgPyBoZWlnaHQgOiB3aW5kb3cuaW5uZXJXaWR0aCAqIDAuODsKCiAgICAgICAgX3RoaXMyLmdhbWUuc2NhbGUucmVzaXplKHdpZHRoLCBoZWlnaHQpOwoKICAgICAgICBfdGhpczIucGh5c2ljcy53b3JsZC5zZXRCb3VuZHMoMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgIH07CgogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicmVzaXplIiwgb25yZXNpemUpOwogICAgICB0aGlzLmV2ZW50cy5vbigiZGVzdHJveSIsIGZ1bmN0aW9uICgpIHsKICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigicmVzaXplIiwgb25yZXNpemUpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjcmVhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZSgpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICAvL0V2ZW50IGxvYmJ5LW1vZGlmaWVkCiAgICAgIHRoaXMuc29ja2V0LmVtaXQod2Vic29ja2V0RXZlbnRzLkxPQkJZX01PRElGSUVEKTsKICAgICAgdGhpcy5zb2NrZXQub24od2Vic29ja2V0RXZlbnRzLkxPQkJZX01PRElGSUVELCBmdW5jdGlvbiAoZ2FtZSkgewogICAgICAgIHJldHVybiBfdGhpczMub25Mb2JieU1vZGlmaWVkKGdhbWUpOwogICAgICB9KTsgLy9TZXR0aW5nIHVwIHJvdGF0aW9uIGFuZCBzaG9vdGluZwoKICAgICAgdGhpcy5rZXlTcGFjZSA9IHRoaXMuaW5wdXQua2V5Ym9hcmQuYWRkS2V5KFBoYXNlci5JbnB1dC5LZXlib2FyZC5LZXlDb2Rlcy5TUEFDRSk7CiAgICAgIHRoaXMuaW5wdXQua2V5Ym9hcmQub24oImtleXVwLUVOVEVSIiwgZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChfdGhpczMuYXZhaWxhYmxlQnVsbGV0cyA+IDApIF90aGlzMy5jcmVhdGVCdWxsZXQoKTsKICAgICAgfSk7CgogICAgICBpZiAodGhpcy50b3VjaFNjcmVlbikgewogICAgICAgIHRoaXMucm90YXRlQnV0dG9uID0gdGhpcy5hZGQuaW1hZ2UoMCwgdGhpcy5oZWlnaHQsICJyb3RhdGUtYnV0dG9uIik7CiAgICAgICAgdGhpcy5yb3RhdGVCdXR0b24uc2V0T3JpZ2luKDAsIDEpOwogICAgICAgIHRoaXMuc2hvb3RCdXR0b24gPSB0aGlzLmFkZC5pbWFnZSh0aGlzLndpZHRoLCB0aGlzLmhlaWdodCwgInNob290LWJ1dHRvbiIpOwogICAgICAgIHRoaXMuc2hvb3RCdXR0b24uc2V0T3JpZ2luKDEsIDEpOwogICAgICAgIHRoaXMuc2hvb3RCdXR0b24uc2V0SW50ZXJhY3RpdmUoKTsKICAgICAgICB0aGlzLmlucHV0Lm9uKCJwb2ludGVydXAiLCBmdW5jdGlvbiAocG9pbnRlcikgewogICAgICAgICAgaWYgKHBvaW50ZXIueCA+IF90aGlzMy5zaG9vdEJ1dHRvbi54IC0gX3RoaXMzLnNob290QnV0dG9uLndpZHRoICYmIHBvaW50ZXIueCA8IF90aGlzMy5zaG9vdEJ1dHRvbi54ICYmIHBvaW50ZXIueSA8IF90aGlzMy5zaG9vdEJ1dHRvbi55ICYmIHBvaW50ZXIueSA8IF90aGlzMy5zaG9vdEJ1dHRvbi55IC0gX3RoaXMzLnNob290QnV0dG9uLmhlaWdodCkgewogICAgICAgICAgICBpZiAoX3RoaXMzLmF2YWlsYWJsZUJ1bGxldHMgPiAwKSBfdGhpczMuY3JlYXRlQnVsbGV0KCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHRoaXMub25Mb2JieU1vZGlmaWVkKHsKICAgICAgICAvL1RPRE86IENIQU5HRSBIRVJFCiAgICAgICAgc2V0dGluZ3M6IGRlZmF1bHRTZXR0aW5ncywKICAgICAgICBjdXJyZW50UGxheWVyOiAwLAogICAgICAgIHBsYXllcnM6IFt7CiAgICAgICAgICBsb2NhbElkOiAwLAogICAgICAgICAgY29sb3I6IDAKICAgICAgICB9XQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ1cGRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZSh0aW1lLCBkZWx0YSkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIGlmIChBcnJheS5pc0FycmF5KHRoaXMubG9iYnkucGxheWVycykgJiYgdGhpcy5sb2JieS5wbGF5ZXJzLmxlbmd0aCA+IDApIHsKICAgICAgICB0aGlzLmxvYmJ5LnBsYXllcnMuZm9yRWFjaChmdW5jdGlvbiAocGxheWVyKSB7CiAgICAgICAgICB2YXIgX3RoaXM0JHNoaXBzJHBsYXllciRsID0gX3RoaXM0LnNoaXBzW3BsYXllci5sb2NhbElkXS5ib2R5LnZlbG9jaXR5LAogICAgICAgICAgICAgIHggPSBfdGhpczQkc2hpcHMkcGxheWVyJGwueCwKICAgICAgICAgICAgICB5ID0gX3RoaXM0JHNoaXBzJHBsYXllciRsLnk7CiAgICAgICAgICBfdGhpczQuc2hpcHNbcGxheWVyLmxvY2FsSWRdLmFuZ2xlID0gX3RoaXM0LmdldEFuZ2xlKHgsIHkpOwogICAgICAgIH0pOwogICAgICB9CgogICAgICBpZiAodGhpcy5sb2JieS5jdXJyZW50UGxheWVyICE9PSBudWxsICYmICh0aGlzLmtleVNwYWNlLmlzRG93biB8fCB0aGlzLnBvaW50ZXJEb3duT25Sb3RhdGVCdXR0b24oKSkpIHsKICAgICAgICB0aGlzLnNoaXBzW3RoaXMubG9iYnkuY3VycmVudFBsYXllcl0uYW5nbGUgKz0gdGhpcy5sb2JieS5zZXR0aW5ncy5hbmd1bGFyVmVsb2NpdHkgKiBub3JtYWxpemVycy5hbmd1bGFyVmVsb2NpdHkgKiBkZWx0YTsKCiAgICAgICAgdmFyIF90aGlzJHBoeXNpY3MkdmVsb2NpdCA9IHRoaXMucGh5c2ljcy52ZWxvY2l0eUZyb21BbmdsZSh0aGlzLnNoaXBzW3RoaXMubG9iYnkuY3VycmVudFBsYXllcl0uYW5nbGUsIHRoaXMubG9iYnkuc2V0dGluZ3MudmVsb2NpdHkgKiBub3JtYWxpemVycy52ZWxvY2l0eSksCiAgICAgICAgICAgIHggPSBfdGhpcyRwaHlzaWNzJHZlbG9jaXQueCwKICAgICAgICAgICAgeSA9IF90aGlzJHBoeXNpY3MkdmVsb2NpdC55OwoKICAgICAgICB0aGlzLnNoaXBzW3RoaXMubG9iYnkuY3VycmVudFBsYXllcl0uc2V0VmVsb2NpdHkoeCwgeSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRBbmdsZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0QW5nbGUoeCwgeSkgewogICAgICB2YXIgYW5nbGU7CgogICAgICBpZiAoeCAhPT0gMCkgewogICAgICAgIGFuZ2xlID0gTWF0aC5hdGFuKHkgLyB4KSAqIDE4MCAvIE1hdGguUEk7CiAgICAgICAgYW5nbGUgPSB4IDwgMCA/IGFuZ2xlICsgMTgwIDogYW5nbGU7CiAgICAgIH0gZWxzZSBpZiAoeSA+PSAwKSBhbmdsZSA9IDkwO2Vsc2UgaWYgKHkgPCAwKSBhbmdsZSA9IC05MDsKCiAgICAgIHJldHVybiBhbmdsZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjcmVhdGVOZXdTaGlwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVOZXdTaGlwKGNvbG9yKSB7CiAgICAgIHZhciBwb3NYID0gUGhhc2VyLk1hdGguQmV0d2VlbigwLCB0aGlzLndpZHRoKTsKICAgICAgdmFyIHBvc1kgPSBQaGFzZXIuTWF0aC5CZXR3ZWVuKDAsIHRoaXMuaGVpZ2h0KTsKICAgICAgdmFyIHNoaXAgPSB0aGlzLnBoeXNpY3MuYWRkLmltYWdlKHBvc1gsIHBvc1ksICJzaGlwIiArIGNvbG9yKTsKICAgICAgdmFyIGFuZ2xlID0gUGhhc2VyLk1hdGguQmV0d2Vlbig0NSwgMTM1KTsKCiAgICAgIHZhciBfdGhpcyRwaHlzaWNzJHZlbG9jaXQyID0gdGhpcy5waHlzaWNzLnZlbG9jaXR5RnJvbUFuZ2xlKGFuZ2xlLCB0aGlzLmxvYmJ5LnNldHRpbmdzLnZlbG9jaXR5ICogbm9ybWFsaXplcnMudmVsb2NpdHkpLAogICAgICAgICAgeCA9IF90aGlzJHBoeXNpY3MkdmVsb2NpdDIueCwKICAgICAgICAgIHkgPSBfdGhpcyRwaHlzaWNzJHZlbG9jaXQyLnk7CgogICAgICBzaGlwLnNldFZlbG9jaXR5KHgsIHkpOwogICAgICBzaGlwLmFuZ2xlID0gYW5nbGU7CiAgICAgIHNoaXAuc2V0Q29sbGlkZVdvcmxkQm91bmRzKHRydWUpOwogICAgICBzaGlwLnNldEJvdW5jZSgxLCAxKTsKICAgICAgcmV0dXJuIHNoaXA7CiAgICB9CiAgfSwgewogICAga2V5OiAiZmluZFBsYXllckJ5SWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZpbmRQbGF5ZXJCeUlkKGlkKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sb2JieS5wbGF5ZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMubG9iYnkucGxheWVyc1tpXS5sb2NhbElkID09PSBpZCkgcmV0dXJuIHRoaXMubG9iYnkucGxheWVyc1tpXTsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfSwgewogICAga2V5OiAib25Mb2JieU1vZGlmaWVkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvbkxvYmJ5TW9kaWZpZWQoZ2FtZSkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIHZhciBjdXJyZW50bHlQbGF5aW5nSWRzID0gW107CiAgICAgIGdhbWUucGxheWVycy5mb3JFYWNoKGZ1bmN0aW9uIChwbGF5ZXIpIHsKICAgICAgICBjdXJyZW50bHlQbGF5aW5nSWRzLnB1c2gocGxheWVyLmxvY2FsSWQpOwogICAgICB9KTsKICAgICAgdmFyIHByZXZpb3VzUGxheWluZ0lkcyA9IFtdOwogICAgICB0aGlzLmxvYmJ5LnBsYXllcnMuZm9yRWFjaChmdW5jdGlvbiAocGxheWVyKSB7CiAgICAgICAgcHJldmlvdXNQbGF5aW5nSWRzLnB1c2gocGxheWVyLmxvY2FsSWQpOwogICAgICB9KTsKICAgICAgdGhpcy5sb2JieSA9IF9vYmplY3RTcHJlYWQoe30sIGdhbWUpOwogICAgICB2YXIgbmV3U2hpcHMgPSB7fTsKCiAgICAgIHZhciBvbGRTaGlwcyA9IF9vYmplY3RTcHJlYWQoe30sIHRoaXMuc2hpcHMpOwoKICAgICAgY3VycmVudGx5UGxheWluZ0lkcy5mb3JFYWNoKGZ1bmN0aW9uIChpZCkgewogICAgICAgIGlmIChwcmV2aW91c1BsYXlpbmdJZHMuaW5jbHVkZXMoaWQpKSB7CiAgICAgICAgICBuZXdTaGlwc1tpZF0gPSBfdGhpczUuc2hpcHNbaWRdOwoKICAgICAgICAgIHZhciBfdGhpczUkcGh5c2ljcyR2ZWxvY2kgPSBfdGhpczUucGh5c2ljcy52ZWxvY2l0eUZyb21BbmdsZShuZXdTaGlwc1tpZF0uYW5nbGUsIF90aGlzNS5sb2JieS5zZXR0aW5ncy52ZWxvY2l0eSAqIG5vcm1hbGl6ZXJzLnZlbG9jaXR5KSwKICAgICAgICAgICAgICB4ID0gX3RoaXM1JHBoeXNpY3MkdmVsb2NpLngsCiAgICAgICAgICAgICAgeSA9IF90aGlzNSRwaHlzaWNzJHZlbG9jaS55OwoKICAgICAgICAgIG5ld1NoaXBzW2lkXS5zZXRWZWxvY2l0eSh4LCB5KTsKICAgICAgICAgIG5ld1NoaXBzW2lkXS5zZXRUZXh0dXJlKCJzaGlwIiArIF90aGlzNS5maW5kUGxheWVyQnlJZChpZCkuY29sb3IpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBuZXdTaGlwc1tpZF0gPSBfdGhpczUuY3JlYXRlTmV3U2hpcChfdGhpczUuZmluZFBsYXllckJ5SWQoaWQpLmNvbG9yKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB2YXIgaWRzVG9SZW1vdmUgPSBwcmV2aW91c1BsYXlpbmdJZHMuZmlsdGVyKGZ1bmN0aW9uICh4KSB7CiAgICAgICAgcmV0dXJuICFjdXJyZW50bHlQbGF5aW5nSWRzLmluY2x1ZGVzKHgpOwogICAgICB9KTsKICAgICAgaWRzVG9SZW1vdmUuZm9yRWFjaChmdW5jdGlvbiAoaWQpIHsKICAgICAgICBvbGRTaGlwc1tpZF0uZGVzdHJveSgpOwogICAgICB9KTsKICAgICAgdGhpcy5zaGlwcyA9IG5ld1NoaXBzOwogICAgfQogIH0sIHsKICAgIGtleTogImNyZWF0ZUJ1bGxldCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlQnVsbGV0KCkgewogICAgICB2YXIgYnVsbGV0ID0gdGhpcy5waHlzaWNzLmFkZC5pbWFnZSh0aGlzLnNoaXBzW3RoaXMubG9iYnkuY3VycmVudFBsYXllcl0ueCwgdGhpcy5zaGlwc1t0aGlzLmxvYmJ5LmN1cnJlbnRQbGF5ZXJdLnksICJidWxsZXQiKTsKICAgICAgYnVsbGV0LmFuZ2xlID0gdGhpcy5zaGlwc1t0aGlzLmxvYmJ5LmN1cnJlbnRQbGF5ZXJdLmFuZ2xlOwoKICAgICAgdmFyIF90aGlzJHBoeXNpY3MkdmVsb2NpdDMgPSB0aGlzLnBoeXNpY3MudmVsb2NpdHlGcm9tQW5nbGUoYnVsbGV0LmFuZ2xlLCB0aGlzLmxvYmJ5LnNldHRpbmdzLmJ1bGxldFZlbG9jaXR5ICogbm9ybWFsaXplcnMuYnVsbGV0VmVsb2NpdHkpLAogICAgICAgICAgeCA9IF90aGlzJHBoeXNpY3MkdmVsb2NpdDMueCwKICAgICAgICAgIHkgPSBfdGhpcyRwaHlzaWNzJHZlbG9jaXQzLnk7CgogICAgICBidWxsZXQuc2V0VmVsb2NpdHkoeCwgeSk7CiAgICAgIHRoaXMuYXZhaWxhYmxlQnVsbGV0cy0tOwogICAgfQogIH0sIHsKICAgIGtleTogInBvaW50ZXJEb3duT25Sb3RhdGVCdXR0b24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHBvaW50ZXJEb3duT25Sb3RhdGVCdXR0b24oKSB7CiAgICAgIGlmICghdGhpcy5pbnB1dC5hY3RpdmVQb2ludGVyLmlzRG93bikgcmV0dXJuIGZhbHNlOwogICAgICByZXR1cm4gdGhpcy5pbnB1dC5hY3RpdmVQb2ludGVyLnggPiB0aGlzLnJvdGF0ZUJ1dHRvbi54ICYmIHRoaXMuaW5wdXQuYWN0aXZlUG9pbnRlci54IDwgdGhpcy5yb3RhdGVCdXR0b24ueCArIHRoaXMucm90YXRlQnV0dG9uLndpZHRoICYmIHRoaXMuaW5wdXQuYWN0aXZlUG9pbnRlci55ICsgdGhpcy5oZWlnaHQgLyAyIDwgdGhpcy5yb3RhdGVCdXR0b24ueSAmJiB0aGlzLmlucHV0LmFjdGl2ZVBvaW50ZXIueSArIHRoaXMuaGVpZ2h0IC8gMiA+IHRoaXMucm90YXRlQnV0dG9uLnkgLSB0aGlzLnJvdGF0ZUJ1dHRvbi5oZWlnaHQ7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gTG9iYnlTY2VuZTsKfShQaGFzZXIuU2NlbmUpOwoKZXhwb3J0IHsgTG9iYnlTY2VuZSBhcyBkZWZhdWx0IH07"},{"version":3,"sources":["/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/LobbyScene.js"],"names":["Phaser","websocketEvents","defaultSettings","normalizers","sceneKeys","detectTouchScreen","LobbyScene","socket","key","lobby","players","currentPlayer","settings","touchScreen","ships","availableBullets","interval","handler","clearInterval","setInterval","reloadingVelocity","width","sys","game","canvas","height","load","image","onresize","parent","document","getElementById","Math","min","offsetWidth","offsetHeight","window","innerWidth","scale","resize","physics","world","setBounds","addEventListener","events","on","removeEventListener","emit","LOBBY_MODIFIED","onLobbyModified","keySpace","input","keyboard","addKey","Input","Keyboard","KeyCodes","SPACE","createBullet","rotateButton","add","setOrigin","shootButton","setInteractive","pointer","x","y","localId","color","time","delta","Array","isArray","length","forEach","player","body","velocity","angle","getAngle","isDown","pointerDownOnRotateButton","angularVelocity","velocityFromAngle","setVelocity","atan","PI","posX","Between","posY","ship","setCollideWorldBounds","setBounce","id","i","currentlyPlayingIds","push","previousPlayingIds","newShips","oldShips","includes","setTexture","findPlayerById","createNewShip","idsToRemove","filter","destroy","bullet","bulletVelocity","activePointer","Scene"],"mappings":"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","sourcesContent":["import Phaser from \"phaser\";\nimport websocketEvents from \"../constants/websocketEvents\";\nimport {defaultSettings, normalizers, sceneKeys} from \"../constants/gameSettings\";\nimport {detectTouchScreen} from \"../constants/constants\";\n\nexport default class LobbyScene extends Phaser.Scene {\n\n    constructor(socket) {\n        super({key: sceneKeys.lobby});\n        this.socket = socket;\n        this.lobby = {\n            players: [],\n            currentPlayer: null,\n            settings: defaultSettings\n        }\n\n        this.touchScreen = detectTouchScreen();\n\n        this.ships = {};\n        this.availableBullets = 3;\n        let interval;\n        const handler = () => {\n            this.availableBullets = this.availableBullets>=3 ? this.availableBullets : this.availableBullets+1;\n            clearInterval(interval)\n            interval = setInterval(handler, 1/(this.lobby.settings.reloadingVelocity*normalizers.reloadingVelocity));\n        }\n        interval = setInterval(handler, 1/(this.lobby.settings.reloadingVelocity*normalizers.reloadingVelocity));\n    }\n\n    preload(){\n\n        //load images\n        this.width = this.sys.game.canvas.width;\n        this.height = this.sys.game.canvas.height;\n\n        this.load.image(\"ship0\", \"./ships/ship0.png\");\n        this.load.image(\"ship1\", \"./ships/ship1.png\");\n        this.load.image(\"ship2\", \"./ships/ship2.png\");\n        this.load.image(\"ship3\", \"./ships/ship3.png\");\n        this.load.image(\"bullet\", \"./bullet.png\");\n        if(this.touchScreen) {\n            this.load.image(\"rotate-button\", \"./rotate-button.png\");\n            this.load.image(\"shoot-button\", \"./shoot-button.png\");\n        }\n\n        const onresize = () => {\n            const parent = document.getElementById(\"players-wrapper\");\n            const height = Math.min(parent.offsetWidth, parent.offsetHeight);\n            const width = window.innerWidth>750 ? height : window.innerWidth*0.8\n            this.game.scale.resize(width, height);\n            this.physics.world.setBounds(0, 0, width, height);\n        };\n        window.addEventListener(\"resize\", onresize);\n        this.events.on(\"destroy\", ()=>{\n            window.removeEventListener(\"resize\", onresize);\n        });\n\n    }\n\n    create(){\n        //Event lobby-modified\n        this.socket.emit(websocketEvents.LOBBY_MODIFIED);\n        this.socket.on(websocketEvents.LOBBY_MODIFIED, game => this.onLobbyModified(game));\n\n        //Setting up rotation and shooting\n        this.keySpace = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);\n        this.input.keyboard.on(\"keyup-ENTER\", ()=>{\n            if(this.availableBullets>0) this.createBullet();\n        });\n\n        if(this.touchScreen) {\n            this.rotateButton = this.add.image(0, this.height, \"rotate-button\");\n            this.rotateButton.setOrigin(0, 1);\n\n            this.shootButton = this.add.image(this.width, this.height, \"shoot-button\");\n            this.shootButton.setOrigin(1, 1);\n            this.shootButton.setInteractive();\n            this.input.on(\"pointerup\", (pointer) => {\n                if(\n                    pointer.x>this.shootButton.x-this.shootButton.width &&\n                    pointer.x<this.shootButton.x &&\n                    pointer.y<this.shootButton.y &&\n                    pointer.y<this.shootButton.y-this.shootButton.height\n                ) {\n                    if(this.availableBullets>0) this.createBullet();\n                }\n            });\n        }\n\n        this.onLobbyModified({ //TODO: CHANGE HERE\n            settings: defaultSettings,\n            currentPlayer: 0,\n            players: [\n                {\n                    localId: 0,\n                    color: 0\n                }\n            ]\n        })\n    }\n\n    update(time, delta){\n        if(Array.isArray(this.lobby.players) && this.lobby.players.length>0) {\n            this.lobby.players.forEach(player => {\n                const {x, y} = this.ships[player.localId].body.velocity;\n                this.ships[player.localId].angle = this.getAngle(x, y);\n            });\n        }\n        if(this.lobby.currentPlayer!==null && (this.keySpace.isDown || this.pointerDownOnRotateButton())){\n            this.ships[this.lobby.currentPlayer].angle += this.lobby.settings.angularVelocity* normalizers.angularVelocity * delta;\n            const {x, y} = this.physics.velocityFromAngle(this.ships[this.lobby.currentPlayer].angle, this.lobby.settings.velocity* normalizers.velocity);\n            this.ships[this.lobby.currentPlayer].setVelocity(x, y);\n        }\n    }\n\n    getAngle(x, y){\n        let angle;\n        if(x!==0) {\n            angle = Math.atan(y / x) * 180 / Math.PI;\n            angle = x < 0 ? angle + 180 : angle;\n        } else if(y>=0) angle = 90;\n        else if(y<0) angle = -90;\n        return angle;\n    }\n\n    createNewShip(color){\n        const posX = Phaser.Math.Between(0, this.width);\n        const posY = Phaser.Math.Between(0, this.height);\n        const ship = this.physics.add.image(posX, posY, \"ship\"+color);\n        const angle = Phaser.Math.Between(45, 135);\n        const {x, y} = this.physics.velocityFromAngle(angle, this.lobby.settings.velocity*normalizers.velocity)\n        ship.setVelocity(x, y);\n        ship.angle = angle;\n        ship.setCollideWorldBounds(true);\n        ship.setBounce(1, 1);\n        return ship;\n    }\n\n    findPlayerById(id){\n        for(let i = 0; i < this.lobby.players.length; i++){\n            if(this.lobby.players[i].localId === id) return this.lobby.players[i];\n        }\n        return null;\n    }\n\n\n    onLobbyModified(game){\n        const currentlyPlayingIds = [];\n        game.players.forEach(player => {currentlyPlayingIds.push(player.localId)});\n\n        const previousPlayingIds = [];\n        this.lobby.players.forEach(player => {previousPlayingIds.push(player.localId)});\n\n        this.lobby = {...game};\n\n        const newShips = {};\n        const oldShips = {...this.ships};\n        currentlyPlayingIds.forEach(id => {\n            if(previousPlayingIds.includes(id)){\n                newShips[id] = this.ships[id];\n                const {x, y} = this.physics.velocityFromAngle(newShips[id].angle, this.lobby.settings.velocity * normalizers.velocity);\n                newShips[id].setVelocity(x, y);\n                newShips[id].setTexture(\"ship\"+this.findPlayerById(id).color);\n            } else {\n                newShips[id] = this.createNewShip(this.findPlayerById(id).color);\n            }\n        });\n        const idsToRemove = previousPlayingIds.filter(x => !currentlyPlayingIds.includes(x));\n        idsToRemove.forEach(id => {oldShips[id].destroy()});\n\n        this.ships = newShips;\n    }\n\n    createBullet(){\n        const bullet = this.physics.add.image(\n            this.ships[this.lobby.currentPlayer].x,\n            this.ships[this.lobby.currentPlayer].y,\n            \"bullet\"\n        );\n        bullet.angle = this.ships[this.lobby.currentPlayer].angle;\n        const {x, y} = this.physics.velocityFromAngle(bullet.angle, this.lobby.settings.bulletVelocity*normalizers.bulletVelocity);\n        bullet.setVelocity(x, y);\n        this.availableBullets--;\n    }\n\n    pointerDownOnRotateButton(){\n        if(!this.input.activePointer.isDown) return false;\n        return this.input.activePointer.x>this.rotateButton.x &&\n            this.input.activePointer.x<this.rotateButton.x+this.rotateButton.width &&\n            this.input.activePointer.y+this.height/2<this.rotateButton.y &&\n            this.input.activePointer.y+this.height/2>this.rotateButton.y-this.rotateButton.height;\n    }\n}"]}]}