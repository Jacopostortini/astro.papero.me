{"remainingRequest":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/thread-loader/dist/cjs.js!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/babel-loader/lib/index.js!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/eslint-loader/index.js??ref--13-0!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/LobbyScene.js","dependencies":[{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/LobbyScene.js","mtime":1617356230731},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/cache-loader/dist/cjs.js","mtime":1616495189815},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/thread-loader/dist/cjs.js","mtime":1616495190967},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/babel-loader/lib/index.js","mtime":1616495189787},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/eslint-loader/index.js","mtime":1616495190059}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL21lZGlhL2phY29wby9Wb2x1bWVEYXRpL0RvY3VtZW50aS9wYXBlcm8udGsvY29zbW9zLnBhcGVyby5tZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vb2JqZWN0U3ByZWFkMiI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiL21lZGlhL2phY29wby9Wb2x1bWVEYXRpL0RvY3VtZW50aS9wYXBlcm8udGsvY29zbW9zLnBhcGVyby5tZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY2xhc3NDYWxsQ2hlY2siOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIi9tZWRpYS9qYWNvcG8vVm9sdW1lRGF0aS9Eb2N1bWVudGkvcGFwZXJvLnRrL2Nvc21vcy5wYXBlcm8ubWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKaW1wb3J0IF9pbmhlcml0cyBmcm9tICIvbWVkaWEvamFjb3BvL1ZvbHVtZURhdGkvRG9jdW1lbnRpL3BhcGVyby50ay9jb3Ntb3MucGFwZXJvLm1lL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9pbmhlcml0cyI7CmltcG9ydCBfY3JlYXRlU3VwZXIgZnJvbSAiL21lZGlhL2phY29wby9Wb2x1bWVEYXRpL0RvY3VtZW50aS9wYXBlcm8udGsvY29zbW9zLnBhcGVyby5tZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlU3VwZXIiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMuanMiOwppbXBvcnQgUGhhc2VyIGZyb20gInBoYXNlciI7CmltcG9ydCB3ZWJzb2NrZXRFdmVudHMgZnJvbSAiLi4vY29uc3RhbnRzL3dlYnNvY2tldEV2ZW50cyI7CmltcG9ydCB7IGRlZmF1bHRTZXR0aW5ncywgbm9ybWFsaXplcnMsIHNjZW5lS2V5cyB9IGZyb20gIi4uL2NvbnN0YW50cy9nYW1lU2V0dGluZ3MiOwoKdmFyIExvYmJ5U2NlbmUgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9QaGFzZXIkU2NlbmUpIHsKICBfaW5oZXJpdHMoTG9iYnlTY2VuZSwgX1BoYXNlciRTY2VuZSk7CgogIHZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIoTG9iYnlTY2VuZSk7CgogIGZ1bmN0aW9uIExvYmJ5U2NlbmUoc29ja2V0KSB7CiAgICB2YXIgX3RoaXM7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIExvYmJ5U2NlbmUpOwoKICAgIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgewogICAgICBrZXk6IHNjZW5lS2V5cy5sb2JieQogICAgfSk7CiAgICBfdGhpcy5zb2NrZXQgPSBzb2NrZXQ7CiAgICBfdGhpcy5sb2JieSA9IHsKICAgICAgcGxheWVyczogW10sCiAgICAgIGN1cnJlbnRQbGF5ZXI6IG51bGwsCiAgICAgIHNldHRpbmdzOiBkZWZhdWx0U2V0dGluZ3MKICAgIH07CiAgICBfdGhpcy5zaGlwcyA9IHt9OwogICAgX3RoaXMuYXZhaWxhYmxlQnVsbGV0cyA9IDM7CiAgICB2YXIgaW50ZXJ2YWw7CgogICAgdmFyIGhhbmRsZXIgPSBmdW5jdGlvbiBoYW5kbGVyKCkgewogICAgICBfdGhpcy5hdmFpbGFibGVCdWxsZXRzID0gX3RoaXMuYXZhaWxhYmxlQnVsbGV0cyA+PSAzID8gX3RoaXMuYXZhaWxhYmxlQnVsbGV0cyA6IF90aGlzLmF2YWlsYWJsZUJ1bGxldHMgKyAxOwogICAgICBjbGVhckludGVydmFsKGludGVydmFsKTsKICAgICAgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChoYW5kbGVyLCAxIC8gKF90aGlzLmxvYmJ5LnNldHRpbmdzLnJlbG9hZGluZ1ZlbG9jaXR5ICogbm9ybWFsaXplcnMucmVsb2FkaW5nVmVsb2NpdHkpKTsKICAgIH07CgogICAgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChoYW5kbGVyLCAxIC8gKF90aGlzLmxvYmJ5LnNldHRpbmdzLnJlbG9hZGluZ1ZlbG9jaXR5ICogbm9ybWFsaXplcnMucmVsb2FkaW5nVmVsb2NpdHkpKTsKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhMb2JieVNjZW5lLCBbewogICAga2V5OiAicHJlbG9hZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcHJlbG9hZCgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICAvL2xvYWQgaW1hZ2VzCiAgICAgIHRoaXMud2lkdGggPSB0aGlzLnN5cy5nYW1lLmNhbnZhcy53aWR0aDsKICAgICAgdGhpcy5oZWlnaHQgPSB0aGlzLnN5cy5nYW1lLmNhbnZhcy5oZWlnaHQ7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgic2hpcDAiLCAiLi9zaGlwcy9zaGlwMC5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJzaGlwMSIsICIuL3NoaXBzL3NoaXAxLnBuZyIpOwogICAgICB0aGlzLmxvYWQuaW1hZ2UoInNoaXAyIiwgIi4vc2hpcHMvc2hpcDIucG5nIik7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgic2hpcDMiLCAiLi9zaGlwcy9zaGlwMy5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJidWxsZXQiLCAiLi9idWxsZXQucG5nIik7CgogICAgICB2YXIgb25yZXNpemUgPSBmdW5jdGlvbiBvbnJlc2l6ZSgpIHsKICAgICAgICB2YXIgcGFyZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBsYXllcnMtd3JhcHBlciIpOwogICAgICAgIHZhciBkaW0gPSBNYXRoLm1pbihwYXJlbnQub2Zmc2V0V2lkdGgsIHBhcmVudC5vZmZzZXRIZWlnaHQpOwoKICAgICAgICBfdGhpczIuZ2FtZS5zY2FsZS5yZXNpemUoZGltLCBkaW0pOwoKICAgICAgICBfdGhpczIucGh5c2ljcy53b3JsZC5zZXRCb3VuZHMoMCwgMCwgZGltLCBkaW0pOwogICAgICB9OwoKICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInJlc2l6ZSIsIG9ucmVzaXplKTsKICAgICAgdGhpcy5ldmVudHMub24oImRlc3Ryb3kiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInJlc2l6ZSIsIG9ucmVzaXplKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY3JlYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGUoKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgLy9FdmVudCBsb2JieS1tb2RpZmllZAogICAgICB0aGlzLnNvY2tldC5vbih3ZWJzb2NrZXRFdmVudHMuTE9CQllfTU9ESUZJRUQsIGZ1bmN0aW9uIChnYW1lKSB7CiAgICAgICAgcmV0dXJuIF90aGlzMy5vbkxvYmJ5TW9kaWZpZWQoZ2FtZSk7CiAgICAgIH0pOyAvL1NldHRpbmcgdXAgcm90YXRpb24gYW5kIHNob290aW5nCgogICAgICB0aGlzLmtleVNwYWNlID0gdGhpcy5pbnB1dC5rZXlib2FyZC5hZGRLZXkoUGhhc2VyLklucHV0LktleWJvYXJkLktleUNvZGVzLlNQQUNFKTsKICAgICAgdGhpcy5pbnB1dC5rZXlib2FyZC5vbigia2V5dXAtRU5URVIiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKF90aGlzMy5hdmFpbGFibGVCdWxsZXRzID4gMCkgX3RoaXMzLmNyZWF0ZUJ1bGxldCgpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ1cGRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZSh0aW1lLCBkZWx0YSkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIGlmIChBcnJheS5pc0FycmF5KHRoaXMubG9iYnkucGxheWVycykgJiYgdGhpcy5sb2JieS5wbGF5ZXJzLmxlbmd0aCA+IDApIHsKICAgICAgICB0aGlzLmxvYmJ5LnBsYXllcnMuZm9yRWFjaChmdW5jdGlvbiAocGxheWVyKSB7CiAgICAgICAgICB2YXIgX3RoaXM0JHNoaXBzJHBsYXllciRsID0gX3RoaXM0LnNoaXBzW3BsYXllci5sb2NhbElkXS5ib2R5LnZlbG9jaXR5LAogICAgICAgICAgICAgIHggPSBfdGhpczQkc2hpcHMkcGxheWVyJGwueCwKICAgICAgICAgICAgICB5ID0gX3RoaXM0JHNoaXBzJHBsYXllciRsLnk7CiAgICAgICAgICBfdGhpczQuc2hpcHNbcGxheWVyLmxvY2FsSWRdLmFuZ2xlID0gX3RoaXM0LmdldEFuZ2xlKHgsIHkpOwogICAgICAgIH0pOwogICAgICB9CgogICAgICBpZiAodGhpcy5sb2JieS5jdXJyZW50UGxheWVyICE9PSBudWxsICYmIHRoaXMua2V5U3BhY2UuaXNEb3duKSB7CiAgICAgICAgdGhpcy5zaGlwc1t0aGlzLmxvYmJ5LmN1cnJlbnRQbGF5ZXJdLmFuZ2xlICs9IHRoaXMubG9iYnkuc2V0dGluZ3MuYW5ndWxhclZlbG9jaXR5ICogbm9ybWFsaXplcnMuYW5ndWxhclZlbG9jaXR5ICogZGVsdGE7CgogICAgICAgIHZhciBfdGhpcyRwaHlzaWNzJHZlbG9jaXQgPSB0aGlzLnBoeXNpY3MudmVsb2NpdHlGcm9tQW5nbGUodGhpcy5zaGlwc1t0aGlzLmxvYmJ5LmN1cnJlbnRQbGF5ZXJdLmFuZ2xlLCB0aGlzLmxvYmJ5LnNldHRpbmdzLnZlbG9jaXR5ICogbm9ybWFsaXplcnMudmVsb2NpdHkpLAogICAgICAgICAgICB4ID0gX3RoaXMkcGh5c2ljcyR2ZWxvY2l0LngsCiAgICAgICAgICAgIHkgPSBfdGhpcyRwaHlzaWNzJHZlbG9jaXQueTsKCiAgICAgICAgdGhpcy5zaGlwc1t0aGlzLmxvYmJ5LmN1cnJlbnRQbGF5ZXJdLnNldFZlbG9jaXR5KHgsIHkpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0QW5nbGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEFuZ2xlKHgsIHkpIHsKICAgICAgdmFyIGFuZ2xlOwoKICAgICAgaWYgKHggIT09IDApIHsKICAgICAgICBhbmdsZSA9IE1hdGguYXRhbih5IC8geCkgKiAxODAgLyBNYXRoLlBJOwogICAgICAgIGFuZ2xlID0geCA8IDAgPyBhbmdsZSArIDE4MCA6IGFuZ2xlOwogICAgICB9IGVsc2UgaWYgKHkgPj0gMCkgYW5nbGUgPSA5MDtlbHNlIGlmICh5IDwgMCkgYW5nbGUgPSAtOTA7CgogICAgICByZXR1cm4gYW5nbGU7CiAgICB9CiAgfSwgewogICAga2V5OiAiY3JlYXRlTmV3U2hpcCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlTmV3U2hpcChjb2xvcikgewogICAgICB2YXIgcG9zWCA9IFBoYXNlci5NYXRoLkJldHdlZW4oMCwgdGhpcy53aWR0aCk7CiAgICAgIHZhciBwb3NZID0gUGhhc2VyLk1hdGguQmV0d2VlbigwLCB0aGlzLmhlaWdodCk7CiAgICAgIHZhciBzaGlwID0gdGhpcy5waHlzaWNzLmFkZC5pbWFnZShwb3NYLCBwb3NZLCAic2hpcCIgKyBjb2xvcik7CiAgICAgIHZhciBhbmdsZSA9IFBoYXNlci5NYXRoLkJldHdlZW4oNDUsIDEzNSk7CgogICAgICB2YXIgX3RoaXMkcGh5c2ljcyR2ZWxvY2l0MiA9IHRoaXMucGh5c2ljcy52ZWxvY2l0eUZyb21BbmdsZShhbmdsZSwgdGhpcy5sb2JieS5zZXR0aW5ncy52ZWxvY2l0eSAqIG5vcm1hbGl6ZXJzLnZlbG9jaXR5KSwKICAgICAgICAgIHggPSBfdGhpcyRwaHlzaWNzJHZlbG9jaXQyLngsCiAgICAgICAgICB5ID0gX3RoaXMkcGh5c2ljcyR2ZWxvY2l0Mi55OwoKICAgICAgc2hpcC5zZXRWZWxvY2l0eSh4LCB5KTsKICAgICAgc2hpcC5hbmdsZSA9IGFuZ2xlOwogICAgICBzaGlwLnNldENvbGxpZGVXb3JsZEJvdW5kcyh0cnVlKTsKICAgICAgc2hpcC5zZXRCb3VuY2UoMSwgMSk7CiAgICAgIHJldHVybiBzaGlwOwogICAgfQogIH0sIHsKICAgIGtleTogImZpbmRQbGF5ZXJCeUlkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmaW5kUGxheWVyQnlJZChpZCkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubG9iYnkucGxheWVycy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmxvYmJ5LnBsYXllcnNbaV0ubG9jYWxJZCA9PT0gaWQpIHJldHVybiB0aGlzLmxvYmJ5LnBsYXllcnNbaV07CiAgICAgIH0KCiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0sIHsKICAgIGtleTogIm9uTG9iYnlNb2RpZmllZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25Mb2JieU1vZGlmaWVkKGdhbWUpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICB2YXIgY3VycmVudGx5UGxheWluZ0lkcyA9IFtdOwogICAgICBnYW1lLnBsYXllcnMuZm9yRWFjaChmdW5jdGlvbiAocGxheWVyKSB7CiAgICAgICAgY3VycmVudGx5UGxheWluZ0lkcy5wdXNoKHBsYXllci5sb2NhbElkKTsKICAgICAgfSk7CiAgICAgIHZhciBwcmV2aW91c1BsYXlpbmdJZHMgPSBbXTsKICAgICAgdGhpcy5sb2JieS5wbGF5ZXJzLmZvckVhY2goZnVuY3Rpb24gKHBsYXllcikgewogICAgICAgIHByZXZpb3VzUGxheWluZ0lkcy5wdXNoKHBsYXllci5sb2NhbElkKTsKICAgICAgfSk7CiAgICAgIHRoaXMubG9iYnkgPSBfb2JqZWN0U3ByZWFkKHt9LCBnYW1lKTsKICAgICAgdmFyIG5ld1NoaXBzID0ge307CiAgICAgIGN1cnJlbnRseVBsYXlpbmdJZHMuZm9yRWFjaChmdW5jdGlvbiAoaWQpIHsKICAgICAgICBpZiAocHJldmlvdXNQbGF5aW5nSWRzLmluY2x1ZGVzKGlkKSkgewogICAgICAgICAgbmV3U2hpcHNbaWRdID0gX3RoaXM1LnNoaXBzW2lkXTsKCiAgICAgICAgICB2YXIgX3RoaXM1JHBoeXNpY3MkdmVsb2NpID0gX3RoaXM1LnBoeXNpY3MudmVsb2NpdHlGcm9tQW5nbGUobmV3U2hpcHNbaWRdLmFuZ2xlLCBfdGhpczUubG9iYnkuc2V0dGluZ3MudmVsb2NpdHkgKiBub3JtYWxpemVycy52ZWxvY2l0eSksCiAgICAgICAgICAgICAgeCA9IF90aGlzNSRwaHlzaWNzJHZlbG9jaS54LAogICAgICAgICAgICAgIHkgPSBfdGhpczUkcGh5c2ljcyR2ZWxvY2kueTsKCiAgICAgICAgICBuZXdTaGlwc1tpZF0uc2V0VmVsb2NpdHkoeCwgeSk7CiAgICAgICAgICBuZXdTaGlwc1tpZF0uc2V0VGV4dHVyZSgic2hpcCIgKyBfdGhpczUuZmluZFBsYXllckJ5SWQoaWQpLmNvbG9yKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbmV3U2hpcHNbaWRdID0gX3RoaXM1LmNyZWF0ZU5ld1NoaXAoX3RoaXM1LmZpbmRQbGF5ZXJCeUlkKGlkKS5jb2xvcik7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5zaGlwcyA9IG5ld1NoaXBzOwogICAgfQogIH0sIHsKICAgIGtleTogImNyZWF0ZUJ1bGxldCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlQnVsbGV0KCkgewogICAgICB2YXIgYnVsbGV0ID0gdGhpcy5waHlzaWNzLmFkZC5pbWFnZSh0aGlzLnNoaXBzW3RoaXMubG9iYnkuY3VycmVudFBsYXllcl0ueCwgdGhpcy5zaGlwc1t0aGlzLmxvYmJ5LmN1cnJlbnRQbGF5ZXJdLnksICJidWxsZXQiKTsKICAgICAgYnVsbGV0LmFuZ2xlID0gdGhpcy5zaGlwc1t0aGlzLmxvYmJ5LmN1cnJlbnRQbGF5ZXJdLmFuZ2xlOwoKICAgICAgdmFyIF90aGlzJHBoeXNpY3MkdmVsb2NpdDMgPSB0aGlzLnBoeXNpY3MudmVsb2NpdHlGcm9tQW5nbGUoYnVsbGV0LmFuZ2xlLCB0aGlzLmxvYmJ5LnNldHRpbmdzLmJ1bGxldFZlbG9jaXR5ICogbm9ybWFsaXplcnMuYnVsbGV0VmVsb2NpdHkpLAogICAgICAgICAgeCA9IF90aGlzJHBoeXNpY3MkdmVsb2NpdDMueCwKICAgICAgICAgIHkgPSBfdGhpcyRwaHlzaWNzJHZlbG9jaXQzLnk7CgogICAgICBidWxsZXQuc2V0VmVsb2NpdHkoeCwgeSk7CiAgICAgIHRoaXMuYXZhaWxhYmxlQnVsbGV0cy0tOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIExvYmJ5U2NlbmU7Cn0oUGhhc2VyLlNjZW5lKTsKCmV4cG9ydCB7IExvYmJ5U2NlbmUgYXMgZGVmYXVsdCB9Ow=="},{"version":3,"sources":["/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/LobbyScene.js"],"names":["Phaser","websocketEvents","defaultSettings","normalizers","sceneKeys","LobbyScene","socket","key","lobby","players","currentPlayer","settings","ships","availableBullets","interval","handler","clearInterval","setInterval","reloadingVelocity","width","sys","game","canvas","height","load","image","onresize","parent","document","getElementById","dim","Math","min","offsetWidth","offsetHeight","scale","resize","physics","world","setBounds","window","addEventListener","events","on","removeEventListener","LOBBY_MODIFIED","onLobbyModified","keySpace","input","keyboard","addKey","Input","Keyboard","KeyCodes","SPACE","createBullet","time","delta","Array","isArray","length","forEach","player","localId","body","velocity","x","y","angle","getAngle","isDown","angularVelocity","velocityFromAngle","setVelocity","atan","PI","color","posX","Between","posY","ship","add","setCollideWorldBounds","setBounce","id","i","currentlyPlayingIds","push","previousPlayingIds","newShips","includes","setTexture","findPlayerById","createNewShip","bullet","bulletVelocity","Scene"],"mappings":"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","sourcesContent":["import Phaser from \"phaser\";\nimport websocketEvents from \"../constants/websocketEvents\";\nimport {defaultSettings, normalizers, sceneKeys} from \"../constants/gameSettings\";\n\nexport default class LobbyScene extends Phaser.Scene {\n\n    constructor(socket) {\n        super({key: sceneKeys.lobby});\n        this.socket = socket;\n        this.lobby = {\n            players: [],\n            currentPlayer: null,\n            settings: defaultSettings\n        }\n\n        this.ships = {};\n        this.availableBullets = 3;\n        let interval;\n        const handler = () => {\n            this.availableBullets = this.availableBullets>=3 ? this.availableBullets : this.availableBullets+1;\n            clearInterval(interval)\n            interval = setInterval(handler, 1/(this.lobby.settings.reloadingVelocity*normalizers.reloadingVelocity));\n        }\n        interval = setInterval(handler, 1/(this.lobby.settings.reloadingVelocity*normalizers.reloadingVelocity));\n    }\n\n    preload(){\n\n        //load images\n        this.width = this.sys.game.canvas.width;\n        this.height = this.sys.game.canvas.height;\n\n        this.load.image(\"ship0\", \"./ships/ship0.png\");\n        this.load.image(\"ship1\", \"./ships/ship1.png\");\n        this.load.image(\"ship2\", \"./ships/ship2.png\");\n        this.load.image(\"ship3\", \"./ships/ship3.png\");\n        this.load.image(\"bullet\", \"./bullet.png\");\n\n        const onresize = () => {\n            const parent = document.getElementById(\"players-wrapper\");\n            const dim = Math.min(parent.offsetWidth, parent.offsetHeight);\n            this.game.scale.resize(dim, dim);\n            this.physics.world.setBounds(0, 0, dim, dim);\n        };\n        window.addEventListener(\"resize\", onresize);\n        this.events.on(\"destroy\", ()=>{\n            window.removeEventListener(\"resize\", onresize);\n        });\n\n    }\n\n    create(){\n        //Event lobby-modified\n        this.socket.on(websocketEvents.LOBBY_MODIFIED, game => this.onLobbyModified(game));\n\n        //Setting up rotation and shooting\n        this.keySpace = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);\n        this.input.keyboard.on(\"keyup-ENTER\", ()=>{\n            if(this.availableBullets>0) this.createBullet();\n        });\n    }\n\n    update(time, delta){\n        if(Array.isArray(this.lobby.players) && this.lobby.players.length>0) {\n            this.lobby.players.forEach(player => {\n                const {x, y} = this.ships[player.localId].body.velocity;\n                this.ships[player.localId].angle = this.getAngle(x, y);\n            });\n        }\n        if(this.lobby.currentPlayer!==null && this.keySpace.isDown){\n            this.ships[this.lobby.currentPlayer].angle += this.lobby.settings.angularVelocity* normalizers.angularVelocity * delta;\n            const {x, y} = this.physics.velocityFromAngle(this.ships[this.lobby.currentPlayer].angle, this.lobby.settings.velocity* normalizers.velocity);\n            this.ships[this.lobby.currentPlayer].setVelocity(x, y);\n        }\n    }\n\n    getAngle(x, y){\n        let angle;\n        if(x!==0) {\n            angle = Math.atan(y / x) * 180 / Math.PI;\n            angle = x < 0 ? angle + 180 : angle;\n        } else if(y>=0) angle = 90;\n        else if(y<0) angle = -90;\n        return angle;\n    }\n\n    createNewShip(color){\n        const posX = Phaser.Math.Between(0, this.width);\n        const posY = Phaser.Math.Between(0, this.height);\n        const ship = this.physics.add.image(posX, posY, \"ship\"+color);\n        const angle = Phaser.Math.Between(45, 135);\n        const {x, y} = this.physics.velocityFromAngle(angle, this.lobby.settings.velocity*normalizers.velocity)\n        ship.setVelocity(x, y);\n        ship.angle = angle;\n        ship.setCollideWorldBounds(true);\n        ship.setBounce(1, 1);\n        return ship;\n    }\n\n    findPlayerById(id){\n        for(let i = 0; i < this.lobby.players.length; i++){\n            if(this.lobby.players[i].localId === id) return this.lobby.players[i];\n        }\n        return null;\n    }\n\n\n    onLobbyModified(game){\n        const currentlyPlayingIds = [];\n        game.players.forEach(player => {currentlyPlayingIds.push(player.localId)});\n\n        const previousPlayingIds = [];\n        this.lobby.players.forEach(player => {previousPlayingIds.push(player.localId)});\n\n        this.lobby = {...game};\n\n        const newShips = {};\n        currentlyPlayingIds.forEach(id => {\n            if(previousPlayingIds.includes(id)){\n                newShips[id] = this.ships[id];\n                const {x, y} = this.physics.velocityFromAngle(newShips[id].angle, this.lobby.settings.velocity * normalizers.velocity);\n                newShips[id].setVelocity(x, y);\n                newShips[id].setTexture(\"ship\"+this.findPlayerById(id).color);\n            } else {\n                newShips[id] = this.createNewShip(this.findPlayerById(id).color);\n            }\n        });\n\n        this.ships = newShips;\n    }\n\n    createBullet(){\n        const bullet = this.physics.add.image(\n            this.ships[this.lobby.currentPlayer].x,\n            this.ships[this.lobby.currentPlayer].y,\n            \"bullet\"\n        );\n        bullet.angle = this.ships[this.lobby.currentPlayer].angle;\n        const {x, y} = this.physics.velocityFromAngle(bullet.angle, this.lobby.settings.bulletVelocity*normalizers.bulletVelocity);\n        bullet.setVelocity(x, y);\n        this.availableBullets--;\n    }\n}"]}]}