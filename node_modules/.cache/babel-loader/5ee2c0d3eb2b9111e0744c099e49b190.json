{"remainingRequest":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/thread-loader/dist/cjs.js!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/babel-loader/lib/index.js!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/eslint-loader/index.js??ref--13-0!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/GameScene.js","dependencies":[{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/GameScene.js","mtime":1617704345773},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/cache-loader/dist/cjs.js","mtime":1616495189815},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/thread-loader/dist/cjs.js","mtime":1616495190967},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/babel-loader/lib/index.js","mtime":1616495189787},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/eslint-loader/index.js","mtime":1616495190059}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICIvbWVkaWEvamFjb3BvL1ZvbHVtZURhdGkvRG9jdW1lbnRpL3BhcGVyby50ay9jb3Ntb3MucGFwZXJvLm1lL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiL21lZGlhL2phY29wby9Wb2x1bWVEYXRpL0RvY3VtZW50aS9wYXBlcm8udGsvY29zbW9zLnBhcGVyby5tZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgX2luaGVyaXRzIGZyb20gIi9tZWRpYS9qYWNvcG8vVm9sdW1lRGF0aS9Eb2N1bWVudGkvcGFwZXJvLnRrL2Nvc21vcy5wYXBlcm8ubWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2luaGVyaXRzIjsKaW1wb3J0IF9jcmVhdGVTdXBlciBmcm9tICIvbWVkaWEvamFjb3BvL1ZvbHVtZURhdGkvRG9jdW1lbnRpL3BhcGVyby50ay9jb3Ntb3MucGFwZXJvLm1lL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVTdXBlciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudmFsdWVzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLnBhcnNlLWludC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci5jb25zdHJ1Y3Rvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci5wYXJzZS1mbG9hdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci50by1maXhlZC5qcyI7CmltcG9ydCAqIGFzIFBoYXNlciBmcm9tICJwaGFzZXIiOwppbXBvcnQgd2Vic29ja2V0RXZlbnRzIGZyb20gIi4uL2NvbnN0YW50cy93ZWJzb2NrZXRFdmVudHMiOwppbXBvcnQgeyBnYW1lRGltZW5zaW9ucywgbm9ybWFsaXplcnMsIHNjZW5lS2V5cyB9IGZyb20gIi4uL2NvbnN0YW50cy9nYW1lU2V0dGluZ3MiOwppbXBvcnQgeyBkZXRlY3RUb3VjaFNjcmVlbiB9IGZyb20gIi4uL2NvbnN0YW50cy9jb25zdGFudHMiOwoKdmFyIEdhbWVTY2VuZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX1BoYXNlciRTY2VuZSkgewogIF9pbmhlcml0cyhHYW1lU2NlbmUsIF9QaGFzZXIkU2NlbmUpOwoKICB2YXIgX3N1cGVyID0gX2NyZWF0ZVN1cGVyKEdhbWVTY2VuZSk7CgogIGZ1bmN0aW9uIEdhbWVTY2VuZShzb2NrZXQsIGdhbWUpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgR2FtZVNjZW5lKTsKCiAgICBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHsKICAgICAga2V5OiBzY2VuZUtleXMuZ2FtZQogICAgfSk7CiAgICBfdGhpcy5zb2NrZXQgPSBzb2NrZXQ7CiAgICBfdGhpcy5zZXR0aW5ncyA9IGdhbWUuc2V0dGluZ3M7CiAgICBfdGhpcy5jdXJyZW50UGxheWVyID0gZ2FtZS5jdXJyZW50UGxheWVyOwogICAgX3RoaXMuc2V0dGluZ3MubWF4VmVsb2NpdHlMaXR0bGUgPSBnYW1lLnNldHRpbmdzLnZlbG9jaXR5ICsgMC4yOwogICAgX3RoaXMuc2V0dGluZ3MuYWNjZWxlcmF0aW9uTGl0dGxlID0gMC40OwogICAgX3RoaXMuc2V0dGluZ3MucmVzcGF3blRpbWUgPSA1MDAwOwogICAgX3RoaXMuc2V0dGluZ3MuZnJpY3Rpb25BaXIgPSAwLjE7CiAgICBfdGhpcy5wbGF5ZXJzID0ge307CiAgICBnYW1lLnBsYXllcnMuZm9yRWFjaChmdW5jdGlvbiAocGxheWVyKSB7CiAgICAgIF90aGlzLnBsYXllcnNbcGxheWVyLmxvY2FsSWRdID0gcGxheWVyOwogICAgICBfdGhpcy5wbGF5ZXJzW3BsYXllci5sb2NhbElkXS5hdmFpbGFibGVCdWxsZXRzID0gMzsKICAgICAgX3RoaXMucGxheWVyc1twbGF5ZXIubG9jYWxJZF0ubGFzdFRpbWVzdGFtcCA9IDA7CiAgICB9KTsKICAgIF90aGlzLnVwZGF0ZUZwcyA9IDE1OwogICAgX3RoaXMudG91Y2hTY3JlZW4gPSBkZXRlY3RUb3VjaFNjcmVlbigpOwogICAgcmV0dXJuIF90aGlzOwogIH0KCiAgX2NyZWF0ZUNsYXNzKEdhbWVTY2VuZSwgW3sKICAgIGtleTogInByZWxvYWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHByZWxvYWQoKSB7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgic2hpcDAiLCAiLi9zaGlwcy9zaGlwMC5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJzaGlwMSIsICIuL3NoaXBzL3NoaXAxLnBuZyIpOwogICAgICB0aGlzLmxvYWQuaW1hZ2UoInNoaXAyIiwgIi4vc2hpcHMvc2hpcDIucG5nIik7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgic2hpcDMiLCAiLi9zaGlwcy9zaGlwMy5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJsaXR0bGUwIiwgIi4vbGl0dGxlLnBuZyIpOwogICAgICB0aGlzLmxvYWQuaW1hZ2UoImxpdHRsZTEiLCAiLi9saXR0bGUucG5nIik7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgibGl0dGxlMiIsICIuL2xpdHRsZS5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJsaXR0bGUzIiwgIi4vbGl0dGxlLnBuZyIpOwogICAgICB0aGlzLmxvYWQuaW1hZ2UoImJ1bGxldCIsICIuL2J1bGxldC5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJidWxsZXQtbG9hZGVkIiwgIi4vYnVsbGV0LWxvYWRlZC5wbmciKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjcmVhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZSgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB0aGlzLmNyZWF0ZUdyb3VwcygpOwogICAgICB0aGlzLmNyZWF0ZVNoaXBzKCk7CiAgICAgIHRoaXMuc29ja2V0Lm9uKHdlYnNvY2tldEV2ZW50cy5VUERBVEVfU0hJUCwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICByZXR1cm4gX3RoaXMyLnVwZGF0ZVNoaXAoZGF0YSk7CiAgICAgIH0pOwogICAgICB0aGlzLnNvY2tldC5vbih3ZWJzb2NrZXRFdmVudHMuU0hPT1QsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgcmV0dXJuIF90aGlzMi5jcmVhdGVCdWxsZXQoZGF0YSk7CiAgICAgIH0pOwogICAgICB0aGlzLnNvY2tldC5vbih3ZWJzb2NrZXRFdmVudHMuQ0hBTkdFX1NUQVRFLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgIHJldHVybiBfdGhpczIudXBkYXRlU3RhdGUoZGF0YSk7CiAgICAgIH0pOwogICAgICB0aGlzLnNvY2tldC5vbih3ZWJzb2NrZXRFdmVudHMuUkVMT0FELCBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgIHJldHVybiBfdGhpczIucmVsb2FkKGRhdGEpOwogICAgICB9KTsKICAgICAgdGhpcy5zZXRLZXlJbnB1dEhhbmRsZXJzKCk7CiAgICAgIGlmICh0aGlzLnRvdWNoU2NyZWVuKSB0aGlzLnNldFRvdWNoSW5wdXRIYW5kbGVycygpOwogICAgICB0aGlzLnBoeXNpY3Mud29ybGQub24oIndvcmxkYm91bmRzIiwgZnVuY3Rpb24gKGJ1bGxldCkgewogICAgICAgIGJ1bGxldC5nYW1lT2JqZWN0LmRlc3Ryb3koKTsKICAgICAgfSk7CiAgICAgIHRoaXMuc2V0UmVsb2FkSW50ZXJ2YWwoKTsKICAgICAgdGhpcy5zZXRVcGRhdGVTaGlwSW50ZXJ2YWwoKTsKICAgICAgdGhpcy5zZXRPbkRlc3Ryb3koKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ1cGRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZSh0aW1lLCBkZWx0YSkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIGlmICh0aGlzLnJvdGF0aW9uS2V5LmlzRG93biB8fCB0aGlzLnJvdGF0aW5nKSB0aGlzLnJvdGF0ZShkZWx0YSk7CiAgICAgIGlmICh0aGlzLmFjY2VsZXJhdGVMaXR0bGVLZXkuaXNEb3duIHx8IHRoaXMuYWNjZWxlcmF0aW5nKSB0aGlzLm1vdmVMaXR0bGUoZGVsdGEpOwogICAgICB0aGlzLnNldEN1cnJlbnRQbGF5ZXJOZXdWZWxvY2l0eSgpOwogICAgICBpZiAodGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc3RhdGUgPT09IDEpIHRoaXMuZGVjZWxlcmF0ZUxpdHRsZShkZWx0YSk7CiAgICAgIE9iamVjdC52YWx1ZXModGhpcy5wbGF5ZXJzKS5mb3JFYWNoKGZ1bmN0aW9uIChwbGF5ZXIpIHsKICAgICAgICB2YXIgdG9wTGVmdCA9IHBsYXllci5zaGlwLmdldFRvcExlZnQoKTsKICAgICAgICB2YXIgYm90dG9tTGVmdCA9IHBsYXllci5zaGlwLmdldEJvdHRvbUxlZnQoKTsKICAgICAgICB2YXIgY2VudGVyTGVmdCA9IHsKICAgICAgICAgIHg6ICh0b3BMZWZ0LnggKyBib3R0b21MZWZ0LngpIC8gMiwKICAgICAgICAgIHk6ICh0b3BMZWZ0LnkgKyBib3R0b21MZWZ0LnkpIC8gMgogICAgICAgIH07CiAgICAgICAgcGxheWVyLmJ1bGxldHNMb2FkZWQuY2hpbGRyZW4uaXRlcmF0ZShmdW5jdGlvbiAoYnVsbGV0LCBpbmRleCkgewogICAgICAgICAgdmFyIF90aGlzMyRnZXRMb2FkZWRCdWxsZSA9IF90aGlzMy5nZXRMb2FkZWRCdWxsZXRQb3NpdGlvbihpbmRleCwgdG9wTGVmdCwgYm90dG9tTGVmdCwgY2VudGVyTGVmdCwgcGxheWVyKSwKICAgICAgICAgICAgICB4ID0gX3RoaXMzJGdldExvYWRlZEJ1bGxlLngsCiAgICAgICAgICAgICAgeSA9IF90aGlzMyRnZXRMb2FkZWRCdWxsZS55OwoKICAgICAgICAgIGJ1bGxldC54ID0geDsKICAgICAgICAgIGJ1bGxldC55ID0geTsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKHBsYXllci5sb2NhbElkICE9PSBfdGhpczMuY3VycmVudFBsYXllcikgewogICAgICAgICAgcGxheWVyLnNoaXAuYXV0b25vbXlUaW1lIC09IGRlbHRhOwoKICAgICAgICAgIGlmIChwbGF5ZXIuc2hpcC5hdXRvbm9teVRpbWUgPCAwKSB7CiAgICAgICAgICAgIHBsYXllci5zaGlwLnNldFZlbG9jaXR5KDApOwogICAgICAgICAgICBwbGF5ZXIuc2hpcC5zZXRBbmd1bGFyVmVsb2NpdHkoMCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0gLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy9DcmVhdGluZyB0aGluZ3MKCiAgfSwgewogICAga2V5OiAiY3JlYXRlR3JvdXBzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVHcm91cHMoKSB7CiAgICAgIHRoaXMuc2hpcHMgPSB0aGlzLnBoeXNpY3MuYWRkLmdyb3VwKCk7CiAgICAgIHRoaXMuYnVsbGV0cyA9IHRoaXMucGh5c2ljcy5hZGQuZ3JvdXAoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjcmVhdGVTaGlwcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlU2hpcHMoKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgdmFyIGluZGV4ID0gMDsKICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLnBsYXllcnMpLmZvckVhY2goZnVuY3Rpb24gKHBsYXllcikgewogICAgICAgIHBsYXllci5zaGlwID0gX3RoaXM0LnNoaXBzLmNyZWF0ZSgoaW5kZXggPCAyID8gMC4wNSA6IDAuOTUpICogZ2FtZURpbWVuc2lvbnMud2lkdGgsIChpbmRleCAlIDIgPT09IDAgPyAwLjA1IDogMC45NSkgKiBnYW1lRGltZW5zaW9ucy5oZWlnaHQsICJzaGlwIiArIHBsYXllci5jb2xvcik7CiAgICAgICAgcGxheWVyLmJ1bGxldHNMb2FkZWQgPSBfdGhpczQucGh5c2ljcy5hZGQuZ3JvdXAoewogICAgICAgICAgY29sbGlkZVdvcmxkQm91bmRzOiBmYWxzZSwKICAgICAgICAgIGtleTogImJ1bGxldC1sb2FkZWQiLAogICAgICAgICAgcXVhbnRpdHk6IDMsCiAgICAgICAgICB2aXNpYmxlOiB0cnVlLAogICAgICAgICAgYWN0aXZlOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgcGxheWVyLnNoaXAubG9jYWxJZCA9IHBsYXllci5sb2NhbElkOwogICAgICAgIHBsYXllci5zaGlwLnNldEFuZ2xlKC00NSAqIChpbmRleCA8IDIgPyAxIDogMykgKiAoaW5kZXggJSAyICogMiAtIDEpKTsKICAgICAgICBwbGF5ZXIuc2hpcC52ZWxvY2l0eU1hZ25pdHVkZSA9IF90aGlzNC5zZXR0aW5ncy52ZWxvY2l0eSAqIG5vcm1hbGl6ZXJzLnZlbG9jaXR5OwogICAgICAgIHBsYXllci5zaGlwLmF1dG9ub215VGltZSA9IDA7CiAgICAgICAgcGxheWVyLnNoaXAuc2V0Q29sbGlkZVdvcmxkQm91bmRzKHRydWUpOwoKICAgICAgICBpZiAocGxheWVyLmxvY2FsSWQgPT09IF90aGlzNC5jdXJyZW50UGxheWVyKSB7CiAgICAgICAgICBfdGhpczQucGh5c2ljcy5hZGQub3ZlcmxhcChwbGF5ZXIuc2hpcCwgX3RoaXM0LmJ1bGxldHMsIGZ1bmN0aW9uIChzaGlwLCBidWxsZXQpIHsKICAgICAgICAgICAgX3RoaXM0Lm9uQnVsbGV0Q29sbGlzaW9uKHNoaXAsIGJ1bGxldCk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBfdGhpczQucGh5c2ljcy5hZGQuY29sbGlkZXIocGxheWVyLnNoaXAsIF90aGlzNC5zaGlwcywgZnVuY3Rpb24gKGN1cnJlbnRTaGlwLCBzaGlwKSB7CiAgICAgICAgICAgIGlmIChfdGhpczQucGxheWVyc1tfdGhpczQuY3VycmVudFBsYXllcl0uc3RhdGUgPT09IDEgJiYgX3RoaXM0LnBsYXllcnNbc2hpcC5sb2NhbElkXS5zdGF0ZSA+PSAyKSB7CiAgICAgICAgICAgICAgX3RoaXM0LmtpbGxlZEJ5ID0gc2hpcC5sb2NhbElkOwogICAgICAgICAgICAgIHZhciBkYXRhID0gewogICAgICAgICAgICAgICAgbG9jYWxJZDogX3RoaXM0LmN1cnJlbnRQbGF5ZXIsCiAgICAgICAgICAgICAgICBzdGF0ZTogMAogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIF90aGlzNC5zb2NrZXQuZW1pdCh3ZWJzb2NrZXRFdmVudHMuQ0hBTkdFX1NUQVRFLCBkYXRhKTsKCiAgICAgICAgICAgICAgX3RoaXM0LnVwZGF0ZVN0YXRlKGRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGluZGV4Kys7CiAgICAgIH0pOwogICAgICB0aGlzLnBoeXNpY3MuYWRkLmNvbGxpZGVyKHRoaXMuc2hpcHMsIHRoaXMuc2hpcHMpOwogICAgfQogIH0sIHsKICAgIGtleTogImNyZWF0ZUJ1bGxldCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlQnVsbGV0KGRhdGEpIHsKICAgICAgY29uc29sZS5sb2coImNyZWF0aW5nIGJ1bGxldCIpOwoKICAgICAgdmFyIF90aGlzJHBoeXNpY3MkdmVsb2NpdCA9IHRoaXMucGh5c2ljcy52ZWxvY2l0eUZyb21BbmdsZShkYXRhLmFuZ2xlLCB0aGlzLnNldHRpbmdzLmJ1bGxldFZlbG9jaXR5ICogbm9ybWFsaXplcnMuYnVsbGV0VmVsb2NpdHkpLAogICAgICAgICAgeCA9IF90aGlzJHBoeXNpY3MkdmVsb2NpdC54LAogICAgICAgICAgeSA9IF90aGlzJHBoeXNpY3MkdmVsb2NpdC55OwoKICAgICAgdmFyIGRlbHRhVGltZSA9IERhdGUubm93KCkgLSBkYXRhLnRpbWVzdGFtcDsKICAgICAgdmFyIGJ1bGxldCA9IHRoaXMuYnVsbGV0cy5jcmVhdGUoZGF0YS5wb3NpdGlvbi54ICsgZGVsdGFUaW1lICogeCAvIDEwMDAsIGRhdGEucG9zaXRpb24ueSArIGRlbHRhVGltZSAqIHkgLyAxMDAwLCAiYnVsbGV0Iik7CiAgICAgIGJ1bGxldC5hbmdsZSA9IGRhdGEuYW5nbGU7CiAgICAgIGJ1bGxldC5zZXRWZWxvY2l0eSh4LCB5KTsKICAgICAgYnVsbGV0LnNob3RCeSA9IGRhdGEubG9jYWxJZDsKICAgICAgYnVsbGV0LnNldENvbGxpZGVXb3JsZEJvdW5kcyh0cnVlKTsKICAgICAgYnVsbGV0LmJvZHkub25Xb3JsZEJvdW5kcyA9IHRydWU7CiAgICAgIHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmF2YWlsYWJsZUJ1bGxldHMtLTsKICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uYnVsbGV0c0xvYWRlZC5nZXRGaXJzdEFsaXZlKCkuc2V0QWN0aXZlKGZhbHNlKS5zZXRWaXNpYmxlKGZhbHNlKTsKICAgIH0gLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy9PdGhlcnMgZG8gdGhpbmdzIHZpYSB0aGUgd2Vic29ja2V0CgogIH0sIHsKICAgIGtleTogInVwZGF0ZVNoaXAiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZVNoaXAoZGF0YSkgewogICAgICB2YXIgcGxheWVyID0gdGhpcy5wbGF5ZXJzW2RhdGFbMF1dOwogICAgICB2YXIgZGVsdGFUaW1lID0gKGRhdGFbM10gLSBwbGF5ZXIubGFzdFRpbWVzdGFtcCkgLyAxMDAwOwogICAgICBpZiAoZGVsdGFUaW1lIDw9IDApIHJldHVybjsKICAgICAgdmFyIGRlbHRhVGhldGEgPSBkYXRhWzFdIC0gTnVtYmVyLnBhcnNlSW50KHBsYXllci5zaGlwLmFuZ2xlKTsKICAgICAgaWYgKGRlbHRhVGhldGEgPCAtMTApIGRlbHRhVGhldGEgKz0gMzYwO2Vsc2UgaWYgKGRlbHRhVGhldGEgPCAwKSBkZWx0YVRoZXRhID0gMDsKICAgICAgdmFyIGFuZ3VsYXJWZWxvY2l0eSA9IGRlbHRhVGhldGEgLyBkZWx0YVRpbWU7CiAgICAgIHBsYXllci5zaGlwLnNldEFuZ3VsYXJWZWxvY2l0eShhbmd1bGFyVmVsb2NpdHkpOwogICAgICBwbGF5ZXIuc2hpcC5zZXRWZWxvY2l0eSgoZGF0YVsyXVswXSAtIHBsYXllci5zaGlwLngpIC8gZGVsdGFUaW1lLCAoZGF0YVsyXVsxXSAtIHBsYXllci5zaGlwLnkpIC8gZGVsdGFUaW1lKTsKICAgICAgcGxheWVyLmxhc3RUaW1lc3RhbXAgPSBkYXRhWzNdOwogICAgICBwbGF5ZXIuc2hpcC5hdXRvbm9teVRpbWUgPSBkZWx0YVRpbWUgKiAxMDAwOwogICAgfSAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAvL0N1cnJlbnQgcGxheWVycyBkb2VzIHRoaW5ncwoKICB9LCB7CiAgICBrZXk6ICJyb3RhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJvdGF0ZShkZWx0YSkgewogICAgICB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwLmFuZ2xlICs9IGRlbHRhICogdGhpcy5zZXR0aW5ncy5hbmd1bGFyVmVsb2NpdHkgKiBub3JtYWxpemVycy5hbmd1bGFyVmVsb2NpdHk7CiAgICB9CiAgfSwgewogICAga2V5OiAibW92ZUxpdHRsZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbW92ZUxpdHRsZShkZWx0YSkgewogICAgICBpZiAodGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc3RhdGUgPT09IDEpIHsKICAgICAgICB2YXIgc2hpcCA9IHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdLnNoaXA7CiAgICAgICAgdmFyIHByZXZpb3VzTWFnID0gc2hpcC52ZWxvY2l0eU1hZ25pdHVkZTsKCiAgICAgICAgaWYgKHByZXZpb3VzTWFnIDwgdGhpcy5zZXR0aW5ncy5tYXhWZWxvY2l0eUxpdHRsZSAqIG5vcm1hbGl6ZXJzLnZlbG9jaXR5KSB7CiAgICAgICAgICB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwLnZlbG9jaXR5TWFnbml0dWRlICs9IGRlbHRhICogdGhpcy5zZXR0aW5ncy5hY2NlbGVyYXRpb25MaXR0bGU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdLnNoaXAudmVsb2NpdHlNYWduaXR1ZGUgPSB0aGlzLnNldHRpbmdzLm1heFZlbG9jaXR5TGl0dGxlICogbm9ybWFsaXplcnMudmVsb2NpdHk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAic2hvb3QiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNob290KCkgewogICAgICBjb25zb2xlLmxvZyh0aGlzLnBsYXllcnMpOwoKICAgICAgaWYgKHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdLmF2YWlsYWJsZUJ1bGxldHMgPiAwKSB7CiAgICAgICAgdmFyIHNoaXAgPSB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwOwogICAgICAgIHZhciBhbmdsZSA9IHNoaXAuYW5nbGU7CiAgICAgICAgdmFyIGRhdGEgPSB7CiAgICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgICB4OiBzaGlwLnggKyBzaGlwLndpZHRoICogTWF0aC5jb3MoYW5nbGUgKiBNYXRoLlBJIC8gMTgwKSwKICAgICAgICAgICAgeTogc2hpcC55ICsgc2hpcC53aWR0aCAqIE1hdGguc2luKGFuZ2xlICogTWF0aC5QSSAvIDE4MCkKICAgICAgICAgIH0sCiAgICAgICAgICBhbmdsZTogYW5nbGUsCiAgICAgICAgICBsb2NhbElkOiB0aGlzLmN1cnJlbnRQbGF5ZXIsCiAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCkKICAgICAgICB9OwogICAgICAgIGNvbnNvbGUubG9nKCJiZWZvcmUgZW1pdHRpbmcgYW5kIGNyZWF0aW5nIik7CiAgICAgICAgdGhpcy5zb2NrZXQuZW1pdCh3ZWJzb2NrZXRFdmVudHMuU0hPT1QsIGRhdGEpOwogICAgICAgIHRoaXMuY3JlYXRlQnVsbGV0KGRhdGEpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAidXBkYXRlU3RhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZVN0YXRlKGRhdGEpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICBjb25zb2xlLmxvZyhkYXRhKTsKICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uc3RhdGUgPSBkYXRhLnN0YXRlOwogICAgICB2YXIgc2hpcCA9IHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLnNoaXA7CgogICAgICBzd2l0Y2ggKGRhdGEuc3RhdGUpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICB0aGlzLnNoaXBzLmtpbGxBbmRIaWRlKHNoaXApOwogICAgICAgICAgdGhpcy5zaGlwcy5yZW1vdmUoc2hpcCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAxOgogICAgICAgICAgc2hpcC5zZXRUZXh0dXJlKCJsaXR0bGUiICsgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uY29sb3IpOwoKICAgICAgICAgIGlmIChkYXRhLmxvY2FsSWQgPT09IHRoaXMuY3VycmVudFBsYXllcikgewogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBpZiAoX3RoaXM1LnBsYXllcnNbZGF0YS5sb2NhbElkXS5zdGF0ZSA9PT0gMSkgewogICAgICAgICAgICAgICAgdmFyIF9kYXRhID0gewogICAgICAgICAgICAgICAgICBsb2NhbElkOiBfdGhpczUuY3VycmVudFBsYXllciwKICAgICAgICAgICAgICAgICAgc3RhdGU6IDIKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgX3RoaXM1LnVwZGF0ZVN0YXRlKF9kYXRhKTsKCiAgICAgICAgICAgICAgICBfdGhpczUuc29ja2V0LmVtaXQod2Vic29ja2V0RXZlbnRzLkNIQU5HRV9TVEFURSwgX2RhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgdGhpcy5zZXR0aW5ncy5yZXNwYXduVGltZSk7CiAgICAgICAgICB9CgogICAgICAgICAgd2hpbGUgKHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmJ1bGxldHNMb2FkZWQuY291bnRBY3RpdmUoKSA+IDApIHsKICAgICAgICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uYnVsbGV0c0xvYWRlZC5nZXRGaXJzdEFsaXZlKCkuc2V0QWN0aXZlKGZhbHNlKS5zZXRWaXNpYmxlKGZhbHNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAyOgogICAgICAgICAgc2hpcC52ZWxvY2l0eU1hZ25pdHVkZSA9IHRoaXMuc2V0dGluZ3MudmVsb2NpdHkgKiBub3JtYWxpemVycy52ZWxvY2l0eTsKICAgICAgICAgIHNoaXAuc2V0VGV4dHVyZSgic2hpcCIgKyB0aGlzLnBsYXllcnNbZGF0YS5sb2NhbElkXS5jb2xvcik7CgogICAgICAgICAgd2hpbGUgKHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmJ1bGxldHNMb2FkZWQuY291bnRBY3RpdmUoKSA8IDMpIHsKICAgICAgICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uYnVsbGV0c0xvYWRlZC5nZXRGaXJzdERlYWQoKS5zZXRBY3RpdmUodHJ1ZSkuc2V0VmlzaWJsZSh0cnVlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogIm9uQnVsbGV0Q29sbGlzaW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvbkJ1bGxldENvbGxpc2lvbihzaGlwLCBidWxsZXQpIHsKICAgICAgYnVsbGV0LmRlc3Ryb3koKTsKICAgICAgdmFyIHN0YXRlID0gdGhpcy5wbGF5ZXJzW3NoaXAubG9jYWxJZF0uc3RhdGUgLSAxOwogICAgICB2YXIgZGF0YSA9IHsKICAgICAgICBsb2NhbElkOiBzaGlwLmxvY2FsSWQsCiAgICAgICAgc3RhdGU6IHN0YXRlCiAgICAgIH07CgogICAgICBpZiAoc3RhdGUgPT09IDApIHsKICAgICAgICBkYXRhLmtpbGxlZEJ5ID0gYnVsbGV0LnNob3RCeTsKICAgICAgICBjbGVhckludGVydmFsKHRoaXMucmVsb2FkSW50ZXJ2YWwpOwogICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy51cGRhdGVTaGlwSW50ZXJ2YWwpOwogICAgICB9CgogICAgICB0aGlzLnNvY2tldC5lbWl0KHdlYnNvY2tldEV2ZW50cy5DSEFOR0VfU1RBVEUsIGRhdGEpOwogICAgICB0aGlzLnVwZGF0ZVN0YXRlKGRhdGEpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbG9hZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVsb2FkKGRhdGEpIHsKICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uYXZhaWxhYmxlQnVsbGV0cyA9IGRhdGEuYXZhaWxhYmxlQnVsbGV0czsKCiAgICAgIHRyeSB7CiAgICAgICAgd2hpbGUgKHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmJ1bGxldHNMb2FkZWQuY291bnRBY3RpdmUoKSA8IGRhdGEuYXZhaWxhYmxlQnVsbGV0cykgewogICAgICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uYnVsbGV0c0xvYWRlZC5nZXRGaXJzdERlYWQoKS5zZXRBY3RpdmUodHJ1ZSkuc2V0VmlzaWJsZSh0cnVlKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgICB9CiAgICB9IC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vR2FtZSBsb29wIGZ1bmN0aW9ucwoKICB9LCB7CiAgICBrZXk6ICJzZXRDdXJyZW50UGxheWVyTmV3VmVsb2NpdHkiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldEN1cnJlbnRQbGF5ZXJOZXdWZWxvY2l0eSgpIHsKICAgICAgdmFyIF90aGlzJHBoeXNpY3MkdmVsb2NpdDIgPSB0aGlzLnBoeXNpY3MudmVsb2NpdHlGcm9tQW5nbGUodGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc2hpcC5hbmdsZSwgdGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc2hpcC52ZWxvY2l0eU1hZ25pdHVkZSksCiAgICAgICAgICB4ID0gX3RoaXMkcGh5c2ljcyR2ZWxvY2l0Mi54LAogICAgICAgICAgeSA9IF90aGlzJHBoeXNpY3MkdmVsb2NpdDIueTsKCiAgICAgIHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdLnNoaXAuc2V0VmVsb2NpdHkoeCwgeSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZGVjZWxlcmF0ZUxpdHRsZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGVjZWxlcmF0ZUxpdHRsZShkZWx0YSkgewogICAgICB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwLnZlbG9jaXR5TWFnbml0dWRlID0gTWF0aC5tYXgoMCwgdGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc2hpcC52ZWxvY2l0eU1hZ25pdHVkZSAtIHRoaXMuc2V0dGluZ3MuZnJpY3Rpb25BaXIgKiBkZWx0YSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0TG9hZGVkQnVsbGV0UG9zaXRpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldExvYWRlZEJ1bGxldFBvc2l0aW9uKGluZGV4LCB0b3BMZWZ0LCBib3R0b21MZWZ0LCBjZW50ZXJMZWZ0LCBwbGF5ZXIpIHsKICAgICAgc3dpdGNoIChpbmRleCkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHg6IGJvdHRvbUxlZnQueCAtIHBsYXllci5zaGlwLndpZHRoIC8gNCAqIE1hdGguY29zKHBsYXllci5zaGlwLnJvdGF0aW9uKSwKICAgICAgICAgICAgeTogYm90dG9tTGVmdC55IC0gcGxheWVyLnNoaXAuaGVpZ2h0IC8gNCAqIE1hdGguc2luKHBsYXllci5zaGlwLnJvdGF0aW9uKQogICAgICAgICAgfTsKCiAgICAgICAgY2FzZSAxOgogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgeDogdG9wTGVmdC54IC0gcGxheWVyLnNoaXAud2lkdGggLyA0ICogTWF0aC5jb3MocGxheWVyLnNoaXAucm90YXRpb24pLAogICAgICAgICAgICB5OiB0b3BMZWZ0LnkgLSBwbGF5ZXIuc2hpcC5oZWlnaHQgLyA0ICogTWF0aC5zaW4ocGxheWVyLnNoaXAucm90YXRpb24pCiAgICAgICAgICB9OwoKICAgICAgICBjYXNlIDI6CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB4OiBjZW50ZXJMZWZ0LnggLSBwbGF5ZXIuc2hpcC53aWR0aCAvIDQgKiBNYXRoLmNvcyhwbGF5ZXIuc2hpcC5yb3RhdGlvbiksCiAgICAgICAgICAgIHk6IGNlbnRlckxlZnQueSAtIHBsYXllci5zaGlwLmhlaWdodCAvIDQgKiBNYXRoLnNpbihwbGF5ZXIuc2hpcC5yb3RhdGlvbikKICAgICAgICAgIH07CiAgICAgIH0KICAgIH0gLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy9PbiBjcmVhdGUgc2V0dXAKCiAgfSwgewogICAga2V5OiAic2V0S2V5SW5wdXRIYW5kbGVycyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0S2V5SW5wdXRIYW5kbGVycygpIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CgogICAgICB0aGlzLnJvdGF0aW9uS2V5ID0gdGhpcy5pbnB1dC5rZXlib2FyZC5hZGRLZXkoUGhhc2VyLklucHV0LktleWJvYXJkLktleUNvZGVzLlNQQUNFKTsKICAgICAgdGhpcy5hY2NlbGVyYXRlTGl0dGxlS2V5ID0gdGhpcy5pbnB1dC5rZXlib2FyZC5hZGRLZXkoUGhhc2VyLklucHV0LktleWJvYXJkLktleUNvZGVzLkVOVEVSKTsKICAgICAgdGhpcy5pbnB1dC5rZXlib2FyZC5vbigia2V5ZG93bi1FTlRFUiIsIGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoX3RoaXM2LnBsYXllcnNbX3RoaXM2LmN1cnJlbnRQbGF5ZXJdLnN0YXRlID49IDIpIF90aGlzNi5zaG9vdCgpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRUb3VjaElucHV0SGFuZGxlcnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFRvdWNoSW5wdXRIYW5kbGVycygpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICB0aGlzLmlucHV0LmFkZFBvaW50ZXIoMSk7CiAgICAgIHRoaXMuaW5wdXQub24oInBvaW50ZXJ1cCIsIGZ1bmN0aW9uIChwb2ludGVyKSB7CiAgICAgICAgaWYgKHBvaW50ZXIueCA8IGdhbWVEaW1lbnNpb25zLndpZHRoIC8gMikgewogICAgICAgICAgX3RoaXM3LnJvdGF0aW5nID0gZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF90aGlzNy5hY2NlbGVyYXRpbmcgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLmlucHV0Lm9uKCJwb2ludGVyZG93biIsIGZ1bmN0aW9uIChwb2ludGVyKSB7CiAgICAgICAgaWYgKHBvaW50ZXIueCA8IGdhbWVEaW1lbnNpb25zLndpZHRoIC8gMikgewogICAgICAgICAgX3RoaXM3LnJvdGF0aW5nID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKF90aGlzNy5wbGF5ZXJzW190aGlzNy5jdXJyZW50UGxheWVyXS5zdGF0ZSA+PSAyKSBfdGhpczcuc2hvb3QoKTtlbHNlIHsKICAgICAgICAgICAgX3RoaXM3LmFjY2VsZXJhdGluZyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRVcGRhdGVTaGlwSW50ZXJ2YWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFVwZGF0ZVNoaXBJbnRlcnZhbCgpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CgogICAgICB0aGlzLnVwZGF0ZVNoaXBJbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczguc29ja2V0LmVtaXQod2Vic29ja2V0RXZlbnRzLlVQREFURV9TSElQLCBbX3RoaXM4LmN1cnJlbnRQbGF5ZXIsIE51bWJlci5wYXJzZUludChfdGhpczgucGxheWVyc1tfdGhpczguY3VycmVudFBsYXllcl0uc2hpcC5hbmdsZSksIFtOdW1iZXIucGFyc2VGbG9hdChfdGhpczgucGxheWVyc1tfdGhpczguY3VycmVudFBsYXllcl0uc2hpcC54LnRvRml4ZWQoMikpLCBOdW1iZXIucGFyc2VGbG9hdChfdGhpczgucGxheWVyc1tfdGhpczguY3VycmVudFBsYXllcl0uc2hpcC55LnRvRml4ZWQoMikpXSwgX3RoaXM4LnRpbWUubm93XSk7CiAgICAgIH0sIDEwMDAgLyB0aGlzLnVwZGF0ZUZwcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0UmVsb2FkSW50ZXJ2YWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFJlbG9hZEludGVydmFsKCkgewogICAgICB2YXIgX3RoaXM5ID0gdGhpczsKCiAgICAgIHRoaXMucmVsb2FkSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGF2YWlsYWJsZUJ1bGxldHMgPSBNYXRoLm1pbigzLCBfdGhpczkucGxheWVyc1tfdGhpczkuY3VycmVudFBsYXllcl0uYXZhaWxhYmxlQnVsbGV0cyArIDEpOwogICAgICAgIHZhciBkYXRhID0gewogICAgICAgICAgbG9jYWxJZDogX3RoaXM5LmN1cnJlbnRQbGF5ZXIsCiAgICAgICAgICBhdmFpbGFibGVCdWxsZXRzOiBhdmFpbGFibGVCdWxsZXRzCiAgICAgICAgfTsKCiAgICAgICAgX3RoaXM5LnNvY2tldC5lbWl0KHdlYnNvY2tldEV2ZW50cy5SRUxPQUQsIGRhdGEpOwoKICAgICAgICBfdGhpczkucmVsb2FkKGRhdGEpOwogICAgICB9LCAxIC8gKHRoaXMuc2V0dGluZ3MucmVsb2FkaW5nVmVsb2NpdHkgKiBub3JtYWxpemVycy5yZWxvYWRpbmdWZWxvY2l0eSkpOwogICAgfQogIH0sIHsKICAgIGtleTogInNldE9uRGVzdHJveSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0T25EZXN0cm95KCkgewogICAgICB2YXIgX3RoaXMxMCA9IHRoaXM7CgogICAgICB0aGlzLmV2ZW50cy5vbigiZGVzdHJveSIsIGZ1bmN0aW9uICgpIHsKICAgICAgICBjbGVhckludGVydmFsKF90aGlzMTAudXBkYXRlU2hpcEludGVydmFsKTsKICAgICAgICBjbGVhckludGVydmFsKF90aGlzMTAucmVsb2FkSW50ZXJ2YWwpOwogICAgICB9KTsKICAgIH0KICB9XSk7CgogIHJldHVybiBHYW1lU2NlbmU7Cn0oUGhhc2VyLlNjZW5lKTsKCmV4cG9ydCB7IEdhbWVTY2VuZSBhcyBkZWZhdWx0IH07"},{"version":3,"sources":["/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/GameScene.js"],"names":["Phaser","websocketEvents","gameDimensions","normalizers","sceneKeys","detectTouchScreen","GameScene","socket","game","key","settings","currentPlayer","maxVelocityLittle","velocity","accelerationLittle","respawnTime","frictionAir","players","forEach","player","localId","availableBullets","lastTimestamp","updateFps","touchScreen","load","image","createGroups","createShips","on","UPDATE_SHIP","data","updateShip","SHOOT","createBullet","CHANGE_STATE","updateState","RELOAD","reload","setKeyInputHandlers","setTouchInputHandlers","physics","world","bullet","gameObject","destroy","setReloadInterval","setUpdateShipInterval","setOnDestroy","time","delta","rotationKey","isDown","rotating","rotate","accelerateLittleKey","accelerating","moveLittle","setCurrentPlayerNewVelocity","state","decelerateLittle","Object","values","topLeft","ship","getTopLeft","bottomLeft","getBottomLeft","centerLeft","x","y","bulletsLoaded","children","iterate","index","getLoadedBulletPosition","autonomyTime","setVelocity","setAngularVelocity","ships","add","group","bullets","create","width","height","color","collideWorldBounds","quantity","visible","active","setAngle","velocityMagnitude","setCollideWorldBounds","overlap","onBulletCollision","collider","currentShip","killedBy","emit","console","log","velocityFromAngle","angle","bulletVelocity","deltaTime","Date","now","timestamp","position","shotBy","body","onWorldBounds","getFirstAlive","setActive","setVisible","deltaTheta","Number","parseInt","angularVelocity","previousMag","Math","cos","PI","sin","killAndHide","remove","setTexture","setTimeout","countActive","getFirstDead","clearInterval","reloadInterval","updateShipInterval","e","error","max","rotation","input","keyboard","addKey","Input","Keyboard","KeyCodes","SPACE","ENTER","shoot","addPointer","pointer","setInterval","parseFloat","toFixed","min","reloadingVelocity","events","Scene"],"mappings":"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","sourcesContent":["import * as Phaser from \"phaser\";\nimport websocketEvents from \"../constants/websocketEvents\";\nimport {gameDimensions, normalizers, sceneKeys} from \"../constants/gameSettings\";\nimport {detectTouchScreen} from \"../constants/constants\";\n\n\nexport default class GameScene extends Phaser.Scene {\n\n    constructor(socket, game) {\n        super({key: sceneKeys.game});\n\n        this.socket = socket;\n        this.settings = game.settings;\n        this.currentPlayer = game.currentPlayer;\n        this.settings.maxVelocityLittle = game.settings.velocity+0.2;\n        this.settings.accelerationLittle = 0.4;\n        this.settings.respawnTime = 5000;\n        this.settings.frictionAir = 0.1;\n        this.players = {};\n        game.players.forEach(player => {\n            this.players[player.localId] = player;\n            this.players[player.localId].availableBullets = 3;\n            this.players[player.localId].lastTimestamp = 0;\n        });\n\n        this.updateFps = 15;\n        this.touchScreen = detectTouchScreen();\n    }\n\n    preload(){\n\n        this.load.image(\"ship0\", \"./ships/ship0.png\");\n        this.load.image(\"ship1\", \"./ships/ship1.png\");\n        this.load.image(\"ship2\", \"./ships/ship2.png\");\n        this.load.image(\"ship3\", \"./ships/ship3.png\");\n        this.load.image(\"little0\", \"./little.png\");\n        this.load.image(\"little1\", \"./little.png\");\n        this.load.image(\"little2\", \"./little.png\");\n        this.load.image(\"little3\", \"./little.png\");\n        this.load.image(\"bullet\", \"./bullet.png\");\n        this.load.image(\"bullet-loaded\", \"./bullet-loaded.png\");\n\n    }\n\n    create(){\n        this.createGroups();\n        this.createShips();\n\n        this.socket.on(websocketEvents.UPDATE_SHIP, data => this.updateShip(data));\n        this.socket.on(websocketEvents.SHOOT, data => this.createBullet(data));\n        this.socket.on(websocketEvents.CHANGE_STATE, data => this.updateState(data));\n        this.socket.on(websocketEvents.RELOAD, data => this.reload(data));\n\n        this.setKeyInputHandlers();\n        if(this.touchScreen) this.setTouchInputHandlers();\n\n        this.physics.world.on(\"worldbounds\", (bullet)=>{bullet.gameObject.destroy()});\n\n        this.setReloadInterval();\n        this.setUpdateShipInterval();\n\n        this.setOnDestroy();\n    }\n\n    update(time, delta){\n        if(this.rotationKey.isDown || this.rotating) this.rotate(delta);\n        if(this.accelerateLittleKey.isDown || this.accelerating) this.moveLittle(delta);\n\n        this.setCurrentPlayerNewVelocity();\n        if (this.players[this.currentPlayer].state === 1) this.decelerateLittle(delta);\n\n\n        Object.values(this.players).forEach(player => {\n            const topLeft = player.ship.getTopLeft();\n            const bottomLeft = player.ship.getBottomLeft();\n            const centerLeft = {\n                x: (topLeft.x + bottomLeft.x) /2,\n                y: (topLeft.y + bottomLeft.y) /2\n            }\n            player.bulletsLoaded.children.iterate((bullet, index)=>{\n                const {x, y} = this.getLoadedBulletPosition(index, topLeft, bottomLeft, centerLeft, player);\n                bullet.x = x;\n                bullet.y = y;\n\n            });\n           if(player.localId!==this.currentPlayer){\n               player.ship.autonomyTime -= delta;\n               if(player.ship.autonomyTime<0) {\n                   player.ship.setVelocity(0);\n                   player.ship.setAngularVelocity(0);\n               }\n           }\n        });\n    }\n\n\n\n\n    //=============================================================================\n    //Creating things\n    createGroups(){\n        this.ships = this.physics.add.group();\n        this.bullets = this.physics.add.group();\n    }\n\n    createShips(){\n        let index = 0;\n        Object.values(this.players).forEach(player => {\n            player.ship = this.ships.create(\n                (index<2 ? 0.05 : 0.95) * gameDimensions.width,\n                ( index%2 === 0 ? 0.05 : 0.95 ) * gameDimensions.height,\n                \"ship\"+player.color\n            );\n\n            player.bulletsLoaded = this.physics.add.group({\n                collideWorldBounds: false,\n                key: \"bullet-loaded\",\n                quantity: 3,\n                visible: true,\n                active: true\n            });\n\n            player.ship.localId = player.localId;\n            player.ship.setAngle(-45  * ( index < 2 ? 1 : 3) * ( ( index % 2 ) * 2 - 1 ));\n            player.ship.velocityMagnitude = this.settings.velocity*normalizers.velocity;\n            player.ship.autonomyTime = 0;\n            player.ship.setCollideWorldBounds(true);\n\n            if(player.localId===this.currentPlayer){\n                this.physics.add.overlap(player.ship, this.bullets, (ship, bullet) => {\n                    this.onBulletCollision(ship, bullet);\n                });\n                this.physics.add.collider(player.ship, this.ships, (currentShip, ship)=>{\n                    if(this.players[this.currentPlayer].state === 1 && this.players[ship.localId].state >= 2){\n                        this.killedBy = ship.localId;\n                        const data = {\n                            localId: this.currentPlayer,\n                            state: 0\n                        };\n                        this.socket.emit(websocketEvents.CHANGE_STATE, data);\n                        this.updateState(data);\n                    }\n                });\n            }\n\n            index++;\n        });\n\n        this.physics.add.collider(this.ships, this.ships);\n    }\n\n    createBullet(data){\n        console.log(\"creating bullet\");\n        const {x, y} = this.physics.velocityFromAngle(data.angle, this.settings.bulletVelocity*normalizers.bulletVelocity);\n        const deltaTime = Date.now()-data.timestamp;\n        const bullet = this.bullets.create(data.position.x+deltaTime*x/1000, data.position.y+deltaTime*y/1000, \"bullet\");\n        bullet.angle = data.angle;\n        bullet.setVelocity(x, y);\n        bullet.shotBy = data.localId;\n        bullet.setCollideWorldBounds(true);\n        bullet.body.onWorldBounds = true;\n        this.players[data.localId].availableBullets--;\n        this.players[data.localId].bulletsLoaded.getFirstAlive().setActive(false).setVisible(false);\n    }\n\n\n\n\n\n\n    //=============================================================================\n    //Others do things via the websocket\n    updateShip(data){\n        const player = this.players[data[0]];\n        const deltaTime = (data[3]-player.lastTimestamp)/1000;\n        if(deltaTime<=0) return;\n\n        let deltaTheta = data[1] - Number.parseInt(player.ship.angle);\n\n        if(deltaTheta < -10) deltaTheta += 360;\n        else if(deltaTheta < 0) deltaTheta = 0;\n        const angularVelocity = deltaTheta / deltaTime;\n        player.ship.setAngularVelocity(angularVelocity);\n\n        player.ship.setVelocity( ( data[2][0]-player.ship.x ) / deltaTime, ( data[2][1]-player.ship.y ) / deltaTime );\n\n        player.lastTimestamp = data[3];\n        player.ship.autonomyTime = deltaTime*1000;\n    }\n\n\n\n    //=============================================================================\n    //Current players does things\n    rotate(delta){\n        this.players[this.currentPlayer].ship.angle += delta * this.settings.angularVelocity * normalizers.angularVelocity;\n    }\n\n    moveLittle(delta){\n        if(this.players[this.currentPlayer].state === 1){\n            const ship = this.players[this.currentPlayer].ship;\n            const previousMag = ship.velocityMagnitude;\n            if(previousMag < this.settings.maxVelocityLittle * normalizers.velocity){\n                this.players[this.currentPlayer].ship.velocityMagnitude += delta*this.settings.accelerationLittle;\n            } else {\n                this.players[this.currentPlayer].ship.velocityMagnitude = this.settings.maxVelocityLittle * normalizers.velocity;\n            }\n        }\n    }\n\n    shoot(){\n        console.log(this.players);\n        if(this.players[this.currentPlayer].availableBullets>0){\n            const ship = this.players[this.currentPlayer].ship;\n            const angle = ship.angle;\n            const data = {\n                position: {\n                    x: ship.x + ship.width*Math.cos(angle * Math.PI / 180),\n                    y: ship.y + ship.width*Math.sin(angle * Math.PI / 180)\n                },\n                angle: angle,\n                localId: this.currentPlayer,\n                timestamp: Date.now()\n            };\n            console.log(\"before emitting and creating\");\n            this.socket.emit(websocketEvents.SHOOT, data);\n            this.createBullet(data);\n        }\n    }\n\n\n    updateState(data){\n        console.log(data);\n        this.players[data.localId].state = data.state;\n        const ship = this.players[data.localId].ship;\n        switch (data.state) {\n            case 0:\n                this.ships.killAndHide(ship);\n                this.ships.remove(ship);\n                break;\n            case 1:\n                ship.setTexture(\"little\" + this.players[data.localId].color);\n                if(data.localId === this.currentPlayer) {\n                    setTimeout(() => {\n                        if (this.players[data.localId].state === 1) {\n                            const data = {\n                                localId: this.currentPlayer,\n                                state: 2\n                            };\n                            this.updateState(data);\n                            this.socket.emit(websocketEvents.CHANGE_STATE, data);\n                        }\n                    }, this.settings.respawnTime);\n                }\n                while(this.players[data.localId].bulletsLoaded.countActive()>0) {\n                    this.players[data.localId].bulletsLoaded.getFirstAlive().setActive(false).setVisible(false);\n                }\n                break;\n            case 2:\n                ship.velocityMagnitude = this.settings.velocity * normalizers.velocity;\n                ship.setTexture(\"ship\" + this.players[data.localId].color);\n                while(this.players[data.localId].bulletsLoaded.countActive()<3) {\n                    this.players[data.localId].bulletsLoaded.getFirstDead().setActive(true).setVisible(true);\n                }\n                break;\n        }\n    }\n\n    onBulletCollision(ship, bullet){\n        bullet.destroy();\n        const state = this.players[ship.localId].state-1;\n        const data = {\n            localId: ship.localId,\n            state\n        };\n        if(state === 0) {\n            data.killedBy = bullet.shotBy;\n            clearInterval(this.reloadInterval);\n            clearInterval(this.updateShipInterval);\n        }\n        this.socket.emit(websocketEvents.CHANGE_STATE, data);\n        this.updateState(data);\n    }\n\n\n    reload(data){\n        this.players[data.localId].availableBullets = data.availableBullets;\n        try{\n            while(this.players[data.localId].bulletsLoaded.countActive() < data.availableBullets){\n                this.players[data.localId].bulletsLoaded.getFirstDead().setActive(true).setVisible(true);\n            }\n        } catch (e) {\n            console.error(e);\n        }\n    }\n\n\n    //=============================================================================\n    //Game loop functions\n    setCurrentPlayerNewVelocity(){\n        const {x, y} = this.physics.velocityFromAngle(\n            this.players[this.currentPlayer].ship.angle,\n            this.players[this.currentPlayer].ship.velocityMagnitude\n        );\n        this.players[this.currentPlayer].ship.setVelocity(x, y);\n    }\n\n    decelerateLittle(delta){\n        this.players[this.currentPlayer].ship.velocityMagnitude = Math.max(\n            0, this.players[this.currentPlayer].ship.velocityMagnitude - this.settings.frictionAir * delta\n        );\n    }\n\n    getLoadedBulletPosition(index, topLeft, bottomLeft, centerLeft, player){\n        switch (index){\n            case 0:\n                return {\n                    x: bottomLeft.x - (player.ship.width/4)*Math.cos(player.ship.rotation),\n                    y: bottomLeft.y - (player.ship.height/4)*Math.sin(player.ship.rotation)\n                };\n            case 1:\n                return{\n                    x: topLeft.x - (player.ship.width/4)*Math.cos(player.ship.rotation),\n                    y: topLeft.y - (player.ship.height/4)*Math.sin(player.ship.rotation)\n                };\n            case 2:\n                return {\n                    x: centerLeft.x - (player.ship.width/4)*Math.cos(player.ship.rotation),\n                    y: centerLeft.y - (player.ship.height/4)*Math.sin(player.ship.rotation)\n                };\n        }\n    }\n\n\n\n    //=============================================================================\n    //On create setup\n\n    setKeyInputHandlers(){\n        this.rotationKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);\n        this.accelerateLittleKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ENTER);\n        this.input.keyboard.on(\"keydown-ENTER\", ()=>{\n            if(this.players[this.currentPlayer].state>=2) this.shoot();\n        });\n    }\n\n    setTouchInputHandlers(){\n        this.input.addPointer(1);\n        this.input.on(\"pointerup\", (pointer) => {\n            if(pointer.x<gameDimensions.width/2){\n                this.rotating = false;\n            } else {\n                this.accelerating = false;\n            }\n        });\n        this.input.on(\"pointerdown\", (pointer) => {\n            if(pointer.x<gameDimensions.width/2){\n                this.rotating = true;\n            } else {\n                if(this.players[this.currentPlayer].state>=2) this.shoot();\n                else {\n                    this.accelerating = true;\n                }\n            }\n        });\n    }\n\n    setUpdateShipInterval(){\n        this.updateShipInterval = setInterval(()=>{\n            this.socket.emit(websocketEvents.UPDATE_SHIP, [\n                this.currentPlayer,\n                Number.parseInt(this.players[this.currentPlayer].ship.angle),\n                [\n                    Number.parseFloat(this.players[this.currentPlayer].ship.x.toFixed(2)),\n                    Number.parseFloat(this.players[this.currentPlayer].ship.y.toFixed(2))\n                ],\n                this.time.now\n            ]);\n        }, 1000/this.updateFps);\n    }\n\n    setReloadInterval(){\n        this.reloadInterval = setInterval(() => {\n            const availableBullets = Math.min(3, this.players[this.currentPlayer].availableBullets + 1);\n            const data = {\n                localId: this.currentPlayer,\n                availableBullets\n            };\n            this.socket.emit(websocketEvents.RELOAD, data);\n            this.reload(data);\n        }, 1/(this.settings.reloadingVelocity * normalizers.reloadingVelocity));\n    }\n\n    setOnDestroy(){\n        this.events.on(\"destroy\", ()=>{\n            clearInterval(this.updateShipInterval);\n            clearInterval(this.reloadInterval);\n        });\n    }\n}"]}]}