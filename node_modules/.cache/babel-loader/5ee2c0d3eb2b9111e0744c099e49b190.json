{"remainingRequest":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/thread-loader/dist/cjs.js!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/babel-loader/lib/index.js!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/eslint-loader/index.js??ref--13-0!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/GameScene.js","dependencies":[{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/GameScene.js","mtime":1617361105076},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/cache-loader/dist/cjs.js","mtime":1616495189815},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/thread-loader/dist/cjs.js","mtime":1616495190967},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/babel-loader/lib/index.js","mtime":1616495189787},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/eslint-loader/index.js","mtime":1616495190059}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICIvbWVkaWEvamFjb3BvL1ZvbHVtZURhdGkvRG9jdW1lbnRpL3BhcGVyby50ay9jb3Ntb3MucGFwZXJvLm1lL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiL21lZGlhL2phY29wby9Wb2x1bWVEYXRpL0RvY3VtZW50aS9wYXBlcm8udGsvY29zbW9zLnBhcGVyby5tZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgX2luaGVyaXRzIGZyb20gIi9tZWRpYS9qYWNvcG8vVm9sdW1lRGF0aS9Eb2N1bWVudGkvcGFwZXJvLnRrL2Nvc21vcy5wYXBlcm8ubWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2luaGVyaXRzIjsKaW1wb3J0IF9jcmVhdGVTdXBlciBmcm9tICIvbWVkaWEvamFjb3BvL1ZvbHVtZURhdGkvRG9jdW1lbnRpL3BhcGVyby50ay9jb3Ntb3MucGFwZXJvLm1lL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVTdXBlciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIucGFyc2UtaW50LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLnBhcnNlLWZsb2F0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLnRvLWZpeGVkLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnZhbHVlcy5qcyI7CmltcG9ydCAqIGFzIFBoYXNlciBmcm9tICJwaGFzZXIiOwppbXBvcnQgd2Vic29ja2V0RXZlbnRzIGZyb20gIi4uL2NvbnN0YW50cy93ZWJzb2NrZXRFdmVudHMiOwppbXBvcnQgeyBnYW1lRGltZW5zaW9ucywgbm9ybWFsaXplcnMsIHNjZW5lS2V5cyB9IGZyb20gIi4uL2NvbnN0YW50cy9nYW1lU2V0dGluZ3MiOwoKdmFyIEdhbWVTY2VuZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX1BoYXNlciRTY2VuZSkgewogIF9pbmhlcml0cyhHYW1lU2NlbmUsIF9QaGFzZXIkU2NlbmUpOwoKICB2YXIgX3N1cGVyID0gX2NyZWF0ZVN1cGVyKEdhbWVTY2VuZSk7CgogIGZ1bmN0aW9uIEdhbWVTY2VuZShzb2NrZXQpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgR2FtZVNjZW5lKTsKCiAgICBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHsKICAgICAga2V5OiBzY2VuZUtleXMuZ2FtZQogICAgfSk7CiAgICBfdGhpcy5zb2NrZXQgPSBzb2NrZXQ7CiAgICBfdGhpcy5zZXR0ZWRVcCA9IGZhbHNlOwoKICAgIF90aGlzLnNvY2tldC5vbih3ZWJzb2NrZXRFdmVudHMuR0FNRV9NT0RJRklFRCwgZnVuY3Rpb24gKGdhbWUpIHsKICAgICAgX3RoaXMuc2V0dGVkVXAgPSB0cnVlOwogICAgICBfdGhpcy5zZXR0aW5ncyA9IGdhbWUuc2V0dGluZ3M7CiAgICAgIF90aGlzLmN1cnJlbnRQbGF5ZXIgPSBnYW1lLmN1cnJlbnRQbGF5ZXI7CiAgICAgIF90aGlzLnNldHRpbmdzLm1heFZlbG9jaXR5TGl0dGxlID0gZ2FtZS5zZXR0aW5ncy52ZWxvY2l0eSArIDAuNTsKICAgICAgX3RoaXMuc2V0dGluZ3MuYWNjZWxlcmF0aW9uTGl0dGxlID0gMC41OwogICAgICBfdGhpcy5zZXR0aW5ncy5yZXNwYXduVGltZSA9IDUwMDA7CiAgICAgIF90aGlzLnNldHRpbmdzLmZyaWN0aW9uQWlyID0gMC4xOwogICAgICBfdGhpcy5wbGF5ZXJzID0ge307CiAgICAgIGdhbWUucGxheWVycy5mb3JFYWNoKGZ1bmN0aW9uIChwbGF5ZXIpIHsKICAgICAgICBfdGhpcy5wbGF5ZXJzW3BsYXllci5sb2NhbElkXSA9IHBsYXllcjsKICAgICAgICBfdGhpcy5wbGF5ZXJzW3BsYXllci5sb2NhbElkXS5hdmFpbGFibGVCdWxsZXRzID0gMzsKICAgICAgICBfdGhpcy5wbGF5ZXJzW3BsYXllci5sb2NhbElkXS5zdGF0ZSA9IDI7CiAgICAgICAgX3RoaXMucGxheWVyc1twbGF5ZXIubG9jYWxJZF0ubGFzdFRpbWVzdGFtcCA9IDA7CiAgICAgIH0pOwogICAgfSk7CgogICAgX3RoaXMuc29ja2V0LmVtaXQod2Vic29ja2V0RXZlbnRzLkdBTUVfTU9ESUZJRUQpOwoKICAgIF90aGlzLnVwZGF0ZUZwcyA9IDE1OwoKICAgIHdoaWxlICghX3RoaXMuc2V0dGVkVXApIHsKICAgICAgY29udGludWU7CiAgICB9CgogICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewogICAgICB2YXIgYXZhaWxhYmxlQnVsbGV0cyA9IE1hdGgubWluKDMsIF90aGlzLnBsYXllcnNbX3RoaXMuY3VycmVudFBsYXllcl0uYXZhaWxhYmxlQnVsbGV0cyArIDEpOwogICAgICB2YXIgZGF0YSA9IHsKICAgICAgICBsb2NhbElkOiBfdGhpcy5jdXJyZW50UGxheWVyLAogICAgICAgIGF2YWlsYWJsZUJ1bGxldHM6IGF2YWlsYWJsZUJ1bGxldHMKICAgICAgfTsKCiAgICAgIF90aGlzLnNvY2tldC5lbWl0KHdlYnNvY2tldEV2ZW50cy5SRUxPQUQsIGRhdGEpOwoKICAgICAgX3RoaXMucmVsb2FkKGRhdGEpOwogICAgfSwgMSAvIChfdGhpcy5zZXR0aW5ncy5yZWxvYWRpbmdWZWxvY2l0eSAqIG5vcm1hbGl6ZXJzLnJlbG9hZGluZ1ZlbG9jaXR5KSk7CiAgICByZXR1cm4gX3RoaXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoR2FtZVNjZW5lLCBbewogICAga2V5OiAicHJlbG9hZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcHJlbG9hZCgpIHsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJzaGlwMCIsICIuL3NoaXBzL3NoaXAwLnBuZyIpOwogICAgICB0aGlzLmxvYWQuaW1hZ2UoInNoaXAxIiwgIi4vc2hpcHMvc2hpcDEucG5nIik7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgic2hpcDIiLCAiLi9zaGlwcy9zaGlwMi5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJzaGlwMyIsICIuL3NoaXBzL3NoaXAzLnBuZyIpOwogICAgICB0aGlzLmxvYWQuaW1hZ2UoImxpdHRsZTAiLCAiLi9saXR0bGUucG5nIik7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgibGl0dGxlMSIsICIuL2xpdHRsZS5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJsaXR0bGUyIiwgIi4vbGl0dGxlLnBuZyIpOwogICAgICB0aGlzLmxvYWQuaW1hZ2UoImxpdHRsZTMiLCAiLi9saXR0bGUucG5nIik7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgiYnVsbGV0IiwgIi4vYnVsbGV0LnBuZyIpOwogICAgfQogIH0sIHsKICAgIGtleTogImNyZWF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHRoaXMuY3JlYXRlR3JvdXBzKCk7CiAgICAgIHRoaXMuY3JlYXRlU2hpcHMoKTsKICAgICAgdGhpcy5zb2NrZXQub24od2Vic29ja2V0RXZlbnRzLlVQREFURV9TSElQLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgIHJldHVybiBfdGhpczIudXBkYXRlU2hpcChkYXRhKTsKICAgICAgfSk7CiAgICAgIHRoaXMuc29ja2V0Lm9uKHdlYnNvY2tldEV2ZW50cy5TSE9PVCwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICByZXR1cm4gX3RoaXMyLmNyZWF0ZUJ1bGxldChkYXRhKTsKICAgICAgfSk7CiAgICAgIHRoaXMuc29ja2V0Lm9uKHdlYnNvY2tldEV2ZW50cy5DSEFOR0VfU1RBVEUsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgcmV0dXJuIF90aGlzMi51cGRhdGVTdGF0ZShkYXRhKTsKICAgICAgfSk7CiAgICAgIHRoaXMuc29ja2V0Lm9uKHdlYnNvY2tldEV2ZW50cy5SRUxPQUQsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgcmV0dXJuIF90aGlzMi5yZWxvYWQoZGF0YSk7CiAgICAgIH0pOwogICAgICB0aGlzLnJvdGF0aW9uS2V5ID0gdGhpcy5pbnB1dC5rZXlib2FyZC5hZGRLZXkoUGhhc2VyLklucHV0LktleWJvYXJkLktleUNvZGVzLlNQQUNFKTsKICAgICAgdGhpcy5hY2NlbGVyYXRlTGl0dGxlS2V5ID0gdGhpcy5pbnB1dC5rZXlib2FyZC5hZGRLZXkoUGhhc2VyLklucHV0LktleWJvYXJkLktleUNvZGVzLkVOVEVSKTsKICAgICAgdGhpcy5pbnB1dC5rZXlib2FyZC5vbigia2V5dXAtRU5URVIiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKF90aGlzMi5wbGF5ZXJzW190aGlzMi5jdXJyZW50UGxheWVyXS5zdGF0ZSA+PSAyKSBfdGhpczIuc2hvb3QoKTsKICAgICAgfSk7CiAgICAgIHRoaXMucGh5c2ljcy53b3JsZC5vbigid29ybGRib3VuZHMiLCBmdW5jdGlvbiAoYnVsbGV0KSB7CiAgICAgICAgYnVsbGV0LmdhbWVPYmplY3QuZGVzdHJveSgpOwogICAgICB9KTsKICAgICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMi5zb2NrZXQuZW1pdCh3ZWJzb2NrZXRFdmVudHMuVVBEQVRFX1NISVAsIFtfdGhpczIuY3VycmVudFBsYXllciwgTnVtYmVyLnBhcnNlSW50KF90aGlzMi5wbGF5ZXJzW190aGlzMi5jdXJyZW50UGxheWVyXS5zaGlwLmFuZ2xlKSwgW051bWJlci5wYXJzZUZsb2F0KF90aGlzMi5wbGF5ZXJzW190aGlzMi5jdXJyZW50UGxheWVyXS5zaGlwLngudG9GaXhlZCgyKSksIE51bWJlci5wYXJzZUZsb2F0KF90aGlzMi5wbGF5ZXJzW190aGlzMi5jdXJyZW50UGxheWVyXS5zaGlwLnkudG9GaXhlZCgyKSldLCBfdGhpczIudGltZS5ub3ddKTsKICAgICAgfSwgMTAwMCAvIHRoaXMudXBkYXRlRnBzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ1cGRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZSh0aW1lLCBkZWx0YSkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIGlmICh0aGlzLnJvdGF0aW9uS2V5LmlzRG93bikgdGhpcy5yb3RhdGUoZGVsdGEpOwogICAgICBpZiAodGhpcy5hY2NlbGVyYXRlTGl0dGxlS2V5LmlzRG93bikgdGhpcy5tb3ZlTGl0dGxlKGRlbHRhKTsKCiAgICAgIHZhciBfdGhpcyRwaHlzaWNzJHZlbG9jaXQgPSB0aGlzLnBoeXNpY3MudmVsb2NpdHlGcm9tQW5nbGUodGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc2hpcC5hbmdsZSwgdGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc2hpcC52ZWxvY2l0eU1hZ25pdHVkZSksCiAgICAgICAgICB4ID0gX3RoaXMkcGh5c2ljcyR2ZWxvY2l0LngsCiAgICAgICAgICB5ID0gX3RoaXMkcGh5c2ljcyR2ZWxvY2l0Lnk7CgogICAgICB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwLnNldFZlbG9jaXR5KHgsIHkpOwoKICAgICAgaWYgKHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdLnN0YXRlID09PSAxKSB7CiAgICAgICAgdGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc2hpcC52ZWxvY2l0eU1hZ25pdHVkZSA9IE1hdGgubWF4KDAsIHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdLnNoaXAudmVsb2NpdHlNYWduaXR1ZGUgLSB0aGlzLnNldHRpbmdzLmZyaWN0aW9uQWlyICogZGVsdGEpOwogICAgICB9CgogICAgICBPYmplY3QudmFsdWVzKHRoaXMucGxheWVycykuZm9yRWFjaChmdW5jdGlvbiAocGxheWVyKSB7CiAgICAgICAgaWYgKHBsYXllci5sb2NhbElkICE9PSBfdGhpczMuY3VycmVudFBsYXllcikgewogICAgICAgICAgcGxheWVyLnNoaXAuYXV0b25vbXlUaW1lIC09IGRlbHRhOwoKICAgICAgICAgIGlmIChwbGF5ZXIuc2hpcC5hdXRvbm9teVRpbWUgPCAwKSB7CiAgICAgICAgICAgIHBsYXllci5zaGlwLnNldFZlbG9jaXR5KDApOwogICAgICAgICAgICBwbGF5ZXIuc2hpcC5zZXRBbmd1bGFyVmVsb2NpdHkoMCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsgLy9pZih0aGlzLnNoaXBzLmNvdW50QWN0aXZlKCkgPD0gMSkgY29uc29sZS5sb2coImdhbWUgb3ZlciIpIC8vVE9ETzogU0VUVVAgRU5EIE9GIFRIRSBUVVJOCiAgICB9IC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vQ3JlYXRpbmcgdGhpbmdzCgogIH0sIHsKICAgIGtleTogImNyZWF0ZUdyb3VwcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlR3JvdXBzKCkgewogICAgICB0aGlzLnNoaXBzID0gdGhpcy5waHlzaWNzLmFkZC5ncm91cCgpOwogICAgICB0aGlzLmJ1bGxldHMgPSB0aGlzLnBoeXNpY3MuYWRkLmdyb3VwKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY3JlYXRlU2hpcHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZVNoaXBzKCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIHZhciBpbmRleCA9IDA7CiAgICAgIE9iamVjdC52YWx1ZXModGhpcy5wbGF5ZXJzKS5mb3JFYWNoKGZ1bmN0aW9uIChwbGF5ZXIpIHsKICAgICAgICBwbGF5ZXIuc2hpcCA9IF90aGlzNC5zaGlwcy5jcmVhdGUoKGluZGV4IDwgMiA/IDAuMDUgOiAwLjk1KSAqIGdhbWVEaW1lbnNpb25zLndpZHRoLCAoaW5kZXggJSAyID09PSAwID8gMC4wNSA6IDAuOTUpICogZ2FtZURpbWVuc2lvbnMuaGVpZ2h0LCAic2hpcCIgKyBwbGF5ZXIuY29sb3IpOwogICAgICAgIHBsYXllci5zaGlwLmxvY2FsSWQgPSBwbGF5ZXIubG9jYWxJZDsKICAgICAgICBwbGF5ZXIuc2hpcC5zZXRBbmdsZSgtNDUgKiAoaW5kZXggPCAyID8gMSA6IDMpICogKGluZGV4ICUgMiAqIDIgLSAxKSk7CiAgICAgICAgcGxheWVyLnNoaXAudmVsb2NpdHlNYWduaXR1ZGUgPSBfdGhpczQuc2V0dGluZ3MudmVsb2NpdHkgKiBub3JtYWxpemVycy52ZWxvY2l0eTsKICAgICAgICBwbGF5ZXIuc2hpcC5hdXRvbm9teVRpbWUgPSAwOwoKICAgICAgICBpZiAocGxheWVyLmxvY2FsSWQgPT09IF90aGlzNC5jdXJyZW50UGxheWVyKSB7CiAgICAgICAgICBwbGF5ZXIuc2hpcC5zZXRDb2xsaWRlV29ybGRCb3VuZHModHJ1ZSk7CgogICAgICAgICAgX3RoaXM0LnBoeXNpY3MuYWRkLm92ZXJsYXAocGxheWVyLnNoaXAsIF90aGlzNC5idWxsZXRzLCBmdW5jdGlvbiAoc2hpcCwgYnVsbGV0KSB7CiAgICAgICAgICAgIF90aGlzNC5vbkJ1bGxldENvbGxpc2lvbihzaGlwLCBidWxsZXQpOwogICAgICAgICAgfSk7CgogICAgICAgICAgX3RoaXM0LnBoeXNpY3MuYWRkLmNvbGxpZGVyKHBsYXllci5zaGlwLCBfdGhpczQuc2hpcHMsIGZ1bmN0aW9uIChjdXJyZW50U2hpcCwgc2hpcCkgewogICAgICAgICAgICBpZiAoX3RoaXM0LnBsYXllcnNbX3RoaXM0LmN1cnJlbnRQbGF5ZXJdLnN0YXRlID09PSAxICYmIF90aGlzNC5wbGF5ZXJzW3NoaXAubG9jYWxJZF0uc3RhdGUgPj0gMikgewogICAgICAgICAgICAgIF90aGlzNC5raWxsZWRCeSA9IHNoaXAubG9jYWxJZDsKICAgICAgICAgICAgICB2YXIgZGF0YSA9IHsKICAgICAgICAgICAgICAgIGxvY2FsSWQ6IF90aGlzNC5jdXJyZW50UGxheWVyLAogICAgICAgICAgICAgICAgc3RhdGU6IDAKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBfdGhpczQuc29ja2V0LmVtaXQod2Vic29ja2V0RXZlbnRzLkNIQU5HRV9TVEFURSwgZGF0YSk7CgogICAgICAgICAgICAgIF90aGlzNC51cGRhdGVTdGF0ZShkYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpbmRleCsrOwogICAgICB9KTsKICAgICAgdGhpcy5waHlzaWNzLmFkZC5jb2xsaWRlcih0aGlzLnNoaXBzLCB0aGlzLnNoaXBzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjcmVhdGVCdWxsZXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZUJ1bGxldChkYXRhKSB7CiAgICAgIHZhciBfdGhpcyRwaHlzaWNzJHZlbG9jaXQyID0gdGhpcy5waHlzaWNzLnZlbG9jaXR5RnJvbUFuZ2xlKGRhdGEuYW5nbGUsIHRoaXMuc2V0dGluZ3MuYnVsbGV0VmVsb2NpdHkgKiBub3JtYWxpemVycy5idWxsZXRWZWxvY2l0eSksCiAgICAgICAgICB4ID0gX3RoaXMkcGh5c2ljcyR2ZWxvY2l0Mi54LAogICAgICAgICAgeSA9IF90aGlzJHBoeXNpY3MkdmVsb2NpdDIueTsKCiAgICAgIHZhciBkZWx0YVRpbWUgPSBEYXRlLm5vdygpIC0gZGF0YS50aW1lc3RhbXA7CiAgICAgIHZhciBidWxsZXQgPSB0aGlzLmJ1bGxldHMuY3JlYXRlKGRhdGEucG9zaXRpb24ueCArIGRlbHRhVGltZSAqIHggLyAxMDAwLCBkYXRhLnBvc2l0aW9uLnkgKyBkZWx0YVRpbWUgKiB5IC8gMTAwMCwgImJ1bGxldCIpOwogICAgICBidWxsZXQuYW5nbGUgPSBkYXRhLmFuZ2xlOwogICAgICBidWxsZXQuc2V0VmVsb2NpdHkoeCwgeSk7CiAgICAgIGJ1bGxldC5zaG90QnkgPSBkYXRhLmxvY2FsSWQ7CiAgICAgIGJ1bGxldC5zZXRDb2xsaWRlV29ybGRCb3VuZHModHJ1ZSk7CiAgICAgIGJ1bGxldC5ib2R5Lm9uV29ybGRCb3VuZHMgPSB0cnVlOwogICAgICB0aGlzLnBsYXllcnNbZGF0YS5sb2NhbElkXS5hdmFpbGFibGVCdWxsZXRzLS07CiAgICB9IC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vT3RoZXJzIGRvIHRoaW5ncyB2aWEgdGhlIHdlYnNvY2tldAoKICB9LCB7CiAgICBrZXk6ICJ1cGRhdGVTaGlwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVTaGlwKGRhdGEpIHsKICAgICAgdmFyIHBsYXllciA9IHRoaXMucGxheWVyc1tkYXRhWzBdXTsKICAgICAgdmFyIGRlbHRhVGltZSA9IChkYXRhWzNdIC0gcGxheWVyLmxhc3RUaW1lc3RhbXApIC8gMTAwMDsKICAgICAgaWYgKGRlbHRhVGltZSA8PSAwKSByZXR1cm47CiAgICAgIHZhciBkZWx0YVRoZXRhID0gZGF0YVsxXSAtIE51bWJlci5wYXJzZUludChwbGF5ZXIuc2hpcC5hbmdsZSk7CiAgICAgIGlmIChkZWx0YVRoZXRhIDwgLTEwKSBkZWx0YVRoZXRhICs9IDM2MDtlbHNlIGlmIChkZWx0YVRoZXRhIDwgMCkgZGVsdGFUaGV0YSA9IDA7CiAgICAgIHZhciBhbmd1bGFyVmVsb2NpdHkgPSBkZWx0YVRoZXRhIC8gZGVsdGFUaW1lOwogICAgICBwbGF5ZXIuc2hpcC5zZXRBbmd1bGFyVmVsb2NpdHkoYW5ndWxhclZlbG9jaXR5KTsKICAgICAgcGxheWVyLnNoaXAuc2V0VmVsb2NpdHkoKGRhdGFbMl1bMF0gLSBwbGF5ZXIuc2hpcC54KSAvIGRlbHRhVGltZSwgKGRhdGFbMl1bMV0gLSBwbGF5ZXIuc2hpcC55KSAvIGRlbHRhVGltZSk7CiAgICAgIHBsYXllci5sYXN0VGltZXN0YW1wID0gZGF0YVszXTsKICAgICAgcGxheWVyLnNoaXAuYXV0b25vbXlUaW1lID0gZGVsdGFUaW1lICogMTAwMDsKICAgIH0gLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy9DdXJyZW50IHBsYXllcnMgZG9lcyB0aGluZ3MKCiAgfSwgewogICAga2V5OiAicm90YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByb3RhdGUoZGVsdGEpIHsKICAgICAgdGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc2hpcC5hbmdsZSArPSBkZWx0YSAqIHRoaXMuc2V0dGluZ3MuYW5ndWxhclZlbG9jaXR5ICogbm9ybWFsaXplcnMuYW5ndWxhclZlbG9jaXR5OwogICAgfQogIH0sIHsKICAgIGtleTogIm1vdmVMaXR0bGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG1vdmVMaXR0bGUoZGVsdGEpIHsKICAgICAgaWYgKHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdLnN0YXRlID09PSAxKSB7CiAgICAgICAgdmFyIHNoaXAgPSB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwOwogICAgICAgIHZhciBwcmV2aW91c01hZyA9IHNoaXAudmVsb2NpdHlNYWduaXR1ZGU7CgogICAgICAgIGlmIChwcmV2aW91c01hZyA8IHRoaXMuc2V0dGluZ3MubWF4VmVsb2NpdHlMaXR0bGUgKiBub3JtYWxpemVycy52ZWxvY2l0eSkgewogICAgICAgICAgdGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc2hpcC52ZWxvY2l0eU1hZ25pdHVkZSArPSBkZWx0YSAqIHRoaXMuc2V0dGluZ3MuYWNjZWxlcmF0aW9uTGl0dGxlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwLnZlbG9jaXR5TWFnbml0dWRlID0gdGhpcy5zZXR0aW5ncy5tYXhWZWxvY2l0eUxpdHRsZSAqIG5vcm1hbGl6ZXJzLnZlbG9jaXR5OwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogInNob290IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzaG9vdCgpIHsKICAgICAgaWYgKHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdLmF2YWlsYWJsZUJ1bGxldHMgPiAwKSB7CiAgICAgICAgdmFyIHNoaXAgPSB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwOwogICAgICAgIHZhciBhbmdsZSA9IHNoaXAuYW5nbGU7CiAgICAgICAgdmFyIGRhdGEgPSB7CiAgICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgICB4OiBzaGlwLnggKyBzaGlwLndpZHRoICogTWF0aC5jb3MoYW5nbGUgKiBNYXRoLlBJIC8gMTgwKSwKICAgICAgICAgICAgeTogc2hpcC55ICsgc2hpcC53aWR0aCAqIE1hdGguc2luKGFuZ2xlICogTWF0aC5QSSAvIDE4MCkKICAgICAgICAgIH0sCiAgICAgICAgICBhbmdsZTogYW5nbGUsCiAgICAgICAgICBsb2NhbElkOiB0aGlzLmN1cnJlbnRQbGF5ZXIsCiAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCkKICAgICAgICB9OwogICAgICAgIHRoaXMuc29ja2V0LmVtaXQod2Vic29ja2V0RXZlbnRzLlNIT09ULCBkYXRhKTsKICAgICAgICB0aGlzLmNyZWF0ZUJ1bGxldChkYXRhKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogInVwZGF0ZVN0YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVTdGF0ZShkYXRhKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uc3RhdGUgPSBkYXRhLnN0YXRlOwogICAgICB2YXIgc2hpcCA9IHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLnNoaXA7CgogICAgICBzd2l0Y2ggKGRhdGEuc3RhdGUpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICB0aGlzLnNoaXBzLmtpbGxBbmRIaWRlKHNoaXApOwogICAgICAgICAgdGhpcy5zaGlwcy5yZW1vdmUoc2hpcCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAxOgogICAgICAgICAgc2hpcC5zZXRUZXh0dXJlKCJsaXR0bGUiICsgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uY29sb3IpOwoKICAgICAgICAgIGlmIChkYXRhLmxvY2FsSWQgPT09IHRoaXMuY3VycmVudFBsYXllcikgewogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBpZiAoX3RoaXM1LnBsYXllcnNbZGF0YS5sb2NhbElkXS5zdGF0ZSA9PT0gMSkgewogICAgICAgICAgICAgICAgdmFyIF9kYXRhID0gewogICAgICAgICAgICAgICAgICBsb2NhbElkOiBfdGhpczUuY3VycmVudFBsYXllciwKICAgICAgICAgICAgICAgICAgc3RhdGU6IDIKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgX3RoaXM1LnVwZGF0ZVN0YXRlKF9kYXRhKTsKCiAgICAgICAgICAgICAgICBfdGhpczUuc29ja2V0LmVtaXQod2Vic29ja2V0RXZlbnRzLkNIQU5HRV9TVEFURSwgX2RhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgdGhpcy5zZXR0aW5ncy5yZXNwYXduVGltZSk7CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgMjoKICAgICAgICAgIHNoaXAudmVsb2NpdHlNYWduaXR1ZGUgPSB0aGlzLnNldHRpbmdzLnZlbG9jaXR5ICogbm9ybWFsaXplcnMudmVsb2NpdHk7CiAgICAgICAgICBzaGlwLnNldFRleHR1cmUoInNoaXAiICsgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uY29sb3IpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJvbkJ1bGxldENvbGxpc2lvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25CdWxsZXRDb2xsaXNpb24oc2hpcCwgYnVsbGV0KSB7CiAgICAgIGJ1bGxldC5kZXN0cm95KCk7CiAgICAgIHZhciBzdGF0ZSA9IHRoaXMucGxheWVyc1tzaGlwLmxvY2FsSWRdLnN0YXRlIC0gMTsKICAgICAgaWYgKHN0YXRlID09PSAwKSB0aGlzLmtpbGxlZEJ5ID0gYnVsbGV0LnNob3RCeTsKICAgICAgdmFyIGRhdGEgPSB7CiAgICAgICAgbG9jYWxJZDogc2hpcC5sb2NhbElkLAogICAgICAgIHN0YXRlOiBzdGF0ZQogICAgICB9OwogICAgICB0aGlzLnNvY2tldC5lbWl0KHdlYnNvY2tldEV2ZW50cy5DSEFOR0VfU1RBVEUsIGRhdGEpOwogICAgICB0aGlzLnVwZGF0ZVN0YXRlKGRhdGEpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbG9hZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVsb2FkKGRhdGEpIHsKICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uYXZhaWxhYmxlQnVsbGV0cyA9IGRhdGEuYXZhaWxhYmxlQnVsbGV0czsKICAgIH0KICB9XSk7CgogIHJldHVybiBHYW1lU2NlbmU7Cn0oUGhhc2VyLlNjZW5lKTsKCmV4cG9ydCB7IEdhbWVTY2VuZSBhcyBkZWZhdWx0IH07"},{"version":3,"sources":["/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/GameScene.js"],"names":["Phaser","websocketEvents","gameDimensions","normalizers","sceneKeys","GameScene","socket","key","game","settedUp","on","GAME_MODIFIED","settings","currentPlayer","maxVelocityLittle","velocity","accelerationLittle","respawnTime","frictionAir","players","forEach","player","localId","availableBullets","state","lastTimestamp","emit","updateFps","setInterval","Math","min","data","RELOAD","reload","reloadingVelocity","load","image","createGroups","createShips","UPDATE_SHIP","updateShip","SHOOT","createBullet","CHANGE_STATE","updateState","rotationKey","input","keyboard","addKey","Input","Keyboard","KeyCodes","SPACE","accelerateLittleKey","ENTER","shoot","physics","world","bullet","gameObject","destroy","Number","parseInt","ship","angle","parseFloat","x","toFixed","y","time","now","delta","isDown","rotate","moveLittle","velocityFromAngle","velocityMagnitude","setVelocity","max","Object","values","autonomyTime","setAngularVelocity","ships","add","group","bullets","index","create","width","height","color","setAngle","setCollideWorldBounds","overlap","onBulletCollision","collider","currentShip","killedBy","bulletVelocity","deltaTime","Date","timestamp","position","shotBy","body","onWorldBounds","deltaTheta","angularVelocity","previousMag","cos","PI","sin","killAndHide","remove","setTexture","setTimeout","Scene"],"mappings":"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","sourcesContent":["import * as Phaser from \"phaser\";\nimport websocketEvents from \"../constants/websocketEvents\";\nimport {gameDimensions, normalizers, sceneKeys} from \"../constants/gameSettings\";\n\n\nexport default class GameScene extends Phaser.Scene {\n\n    constructor(socket) {\n        super({key: sceneKeys.game});\n\n        this.socket = socket;\n        this.settedUp = false;\n\n        this.socket.on(websocketEvents.GAME_MODIFIED, game => {\n            this.settedUp = true;\n            this.settings = game.settings;\n            this.currentPlayer = game.currentPlayer;\n            this.settings.maxVelocityLittle = game.settings.velocity+0.5;\n            this.settings.accelerationLittle = 0.5;\n            this.settings.respawnTime = 5000;\n            this.settings.frictionAir = 0.1;\n            this.players = {};\n            game.players.forEach(player => {\n                this.players[player.localId] = player;\n                this.players[player.localId].availableBullets = 3;\n                this.players[player.localId].state = 2;\n                this.players[player.localId].lastTimestamp = 0;\n            });\n        });\n        this.socket.emit(websocketEvents.GAME_MODIFIED);\n\n        this.updateFps = 15;\n\n        while(!this.settedUp){\n            continue;\n        }\n\n        setInterval(() => {\n            const availableBullets = Math.min(3, this.players[this.currentPlayer].availableBullets + 1);\n            const data = {\n                localId: this.currentPlayer,\n                availableBullets\n            };\n            this.socket.emit(websocketEvents.RELOAD, data);\n            this.reload(data);\n        }, 1/(this.settings.reloadingVelocity * normalizers.reloadingVelocity));\n    }\n\n    preload(){\n\n        this.load.image(\"ship0\", \"./ships/ship0.png\");\n        this.load.image(\"ship1\", \"./ships/ship1.png\");\n        this.load.image(\"ship2\", \"./ships/ship2.png\");\n        this.load.image(\"ship3\", \"./ships/ship3.png\");\n        this.load.image(\"little0\", \"./little.png\");\n        this.load.image(\"little1\", \"./little.png\");\n        this.load.image(\"little2\", \"./little.png\");\n        this.load.image(\"little3\", \"./little.png\");\n        this.load.image(\"bullet\", \"./bullet.png\");\n\n    }\n\n    create(){\n        this.createGroups();\n        this.createShips();\n\n        this.socket.on(websocketEvents.UPDATE_SHIP, data => this.updateShip(data));\n        this.socket.on(websocketEvents.SHOOT, data => this.createBullet(data));\n        this.socket.on(websocketEvents.CHANGE_STATE, data => this.updateState(data));\n        this.socket.on(websocketEvents.RELOAD, data => this.reload(data));\n\n        this.rotationKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);\n        this.accelerateLittleKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ENTER);\n        this.input.keyboard.on(\"keyup-ENTER\", ()=>{\n            if(this.players[this.currentPlayer].state>=2) this.shoot();\n        });\n        this.physics.world.on(\"worldbounds\", (bullet)=>{bullet.gameObject.destroy()});\n\n        setInterval(()=>{\n            this.socket.emit(websocketEvents.UPDATE_SHIP, [\n                this.currentPlayer,\n                Number.parseInt(this.players[this.currentPlayer].ship.angle),\n                [\n                    Number.parseFloat(this.players[this.currentPlayer].ship.x.toFixed(2)),\n                    Number.parseFloat(this.players[this.currentPlayer].ship.y.toFixed(2))\n                ],\n                this.time.now\n            ]);\n        }, 1000/this.updateFps);\n    }\n\n    update(time, delta){\n        if(this.rotationKey.isDown) this.rotate(delta);\n        if(this.accelerateLittleKey.isDown) this.moveLittle(delta);\n        const {x, y} = this.physics.velocityFromAngle(\n            this.players[this.currentPlayer].ship.angle,\n            this.players[this.currentPlayer].ship.velocityMagnitude\n        );\n        this.players[this.currentPlayer].ship.setVelocity(x, y);\n        if (this.players[this.currentPlayer].state === 1) {\n            this.players[this.currentPlayer].ship.velocityMagnitude = Math.max(\n                0, this.players[this.currentPlayer].ship.velocityMagnitude - this.settings.frictionAir * delta\n            );\n        }\n        Object.values(this.players).forEach(player => {\n           if(player.localId!==this.currentPlayer){\n               player.ship.autonomyTime -= delta;\n               if(player.ship.autonomyTime<0) {\n                   player.ship.setVelocity(0);\n                   player.ship.setAngularVelocity(0);\n               }\n           }\n        });\n        //if(this.ships.countActive() <= 1) console.log(\"game over\") //TODO: SETUP END OF THE TURN\n    }\n\n\n\n\n    //=============================================================================\n    //Creating things\n    createGroups(){\n        this.ships = this.physics.add.group();\n        this.bullets = this.physics.add.group();\n    }\n\n    createShips(){\n        let index = 0;\n        Object.values(this.players).forEach(player => {\n            player.ship = this.ships.create(\n                (index<2 ? 0.05 : 0.95) * gameDimensions.width,\n                ( index%2 === 0 ? 0.05 : 0.95 ) * gameDimensions.height,\n                \"ship\"+player.color\n            )\n\n            player.ship.localId = player.localId;\n            player.ship.setAngle(-45  * ( index < 2 ? 1 : 3) * ( ( index % 2 ) * 2 - 1 ));\n            player.ship.velocityMagnitude = this.settings.velocity*normalizers.velocity;\n            player.ship.autonomyTime = 0;\n\n            if(player.localId===this.currentPlayer){\n                player.ship.setCollideWorldBounds(true);\n                this.physics.add.overlap(player.ship, this.bullets, (ship, bullet) => {\n                    this.onBulletCollision(ship, bullet);\n                });\n                this.physics.add.collider(player.ship, this.ships, (currentShip, ship)=>{\n                    if(this.players[this.currentPlayer].state === 1 && this.players[ship.localId].state >= 2){\n                        this.killedBy = ship.localId;\n                        const data = {\n                            localId: this.currentPlayer,\n                            state: 0\n                        };\n                        this.socket.emit(websocketEvents.CHANGE_STATE, data);\n                        this.updateState(data);\n                    }\n                });\n            }\n\n            index++;\n        });\n\n        this.physics.add.collider(this.ships, this.ships);\n    }\n\n    createBullet(data){\n        const {x, y} = this.physics.velocityFromAngle(data.angle, this.settings.bulletVelocity*normalizers.bulletVelocity);\n        const deltaTime = Date.now()-data.timestamp;\n        const bullet = this.bullets.create(data.position.x+deltaTime*x/1000, data.position.y+deltaTime*y/1000, \"bullet\");\n        bullet.angle = data.angle;\n        bullet.setVelocity(x, y);\n        bullet.shotBy = data.localId;\n        bullet.setCollideWorldBounds(true);\n        bullet.body.onWorldBounds = true;\n        this.players[data.localId].availableBullets--;\n    }\n\n\n\n\n\n\n    //=============================================================================\n    //Others do things via the websocket\n    updateShip(data){\n        const player = this.players[data[0]];\n        const deltaTime = (data[3]-player.lastTimestamp)/1000;\n        if(deltaTime<=0) return;\n\n        let deltaTheta = data[1] - Number.parseInt(player.ship.angle);\n\n        if(deltaTheta < -10) deltaTheta += 360;\n        else if(deltaTheta < 0) deltaTheta = 0;\n        const angularVelocity = deltaTheta / deltaTime;\n        player.ship.setAngularVelocity(angularVelocity);\n\n        player.ship.setVelocity( ( data[2][0]-player.ship.x ) / deltaTime, ( data[2][1]-player.ship.y ) / deltaTime );\n\n        player.lastTimestamp = data[3];\n        player.ship.autonomyTime = deltaTime*1000;\n    }\n\n\n\n    //=============================================================================\n    //Current players does things\n    rotate(delta){\n        this.players[this.currentPlayer].ship.angle += delta * this.settings.angularVelocity * normalizers.angularVelocity;\n    }\n\n    moveLittle(delta){\n        if(this.players[this.currentPlayer].state === 1){\n            const ship = this.players[this.currentPlayer].ship;\n            const previousMag = ship.velocityMagnitude;\n            if(previousMag < this.settings.maxVelocityLittle * normalizers.velocity){\n                this.players[this.currentPlayer].ship.velocityMagnitude += delta*this.settings.accelerationLittle;\n            } else {\n                this.players[this.currentPlayer].ship.velocityMagnitude = this.settings.maxVelocityLittle * normalizers.velocity;\n            }\n        }\n    }\n\n    shoot(){\n        if(this.players[this.currentPlayer].availableBullets>0){\n            const ship = this.players[this.currentPlayer].ship;\n            const angle = ship.angle;\n            const data = {\n                position: {\n                    x: ship.x + ship.width*Math.cos(angle * Math.PI / 180),\n                    y: ship.y + ship.width*Math.sin(angle * Math.PI / 180)\n                },\n                angle: angle,\n                localId: this.currentPlayer,\n                timestamp: Date.now()\n            };\n            this.socket.emit(websocketEvents.SHOOT, data);\n            this.createBullet(data);\n        }\n    }\n\n\n    updateState(data){\n        this.players[data.localId].state = data.state;\n        const ship = this.players[data.localId].ship;\n        switch (data.state) {\n            case 0:\n                this.ships.killAndHide(ship);\n                this.ships.remove(ship);\n                break;\n            case 1:\n                ship.setTexture(\"little\" + this.players[data.localId].color);\n                if(data.localId === this.currentPlayer) {\n                    setTimeout(() => {\n                        if (this.players[data.localId].state === 1) {\n                            const data = {\n                                localId: this.currentPlayer,\n                                state: 2\n                            };\n                            this.updateState(data);\n                            this.socket.emit(websocketEvents.CHANGE_STATE, data);\n                        }\n                    }, this.settings.respawnTime);\n                }\n                break;\n            case 2:\n                ship.velocityMagnitude = this.settings.velocity * normalizers.velocity;\n                ship.setTexture(\"ship\" + this.players[data.localId].color);\n                break;\n        }\n    }\n\n    onBulletCollision(ship, bullet){\n        bullet.destroy();\n        const state = this.players[ship.localId].state-1;\n        if(state === 0) this.killedBy = bullet.shotBy;\n        const data = {\n            localId: ship.localId,\n            state\n        };\n        this.socket.emit(websocketEvents.CHANGE_STATE, data);\n        this.updateState(data);\n    }\n\n\n    reload(data){\n        this.players[data.localId].availableBullets = data.availableBullets;\n    }\n}"]}]}