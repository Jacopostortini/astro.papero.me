{"remainingRequest":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/thread-loader/dist/cjs.js!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/babel-loader/lib/index.js!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/eslint-loader/index.js??ref--13-0!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/GameScene.js","dependencies":[{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/GameScene.js","mtime":1617187720609},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/cache-loader/dist/cjs.js","mtime":1616495189815},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/thread-loader/dist/cjs.js","mtime":1616495190967},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/babel-loader/lib/index.js","mtime":1616495189787},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/eslint-loader/index.js","mtime":1616495190059}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICIvbWVkaWEvamFjb3BvL1ZvbHVtZURhdGkvRG9jdW1lbnRpL3BhcGVyby50ay9jb3Ntb3MucGFwZXJvLm1lL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiL21lZGlhL2phY29wby9Wb2x1bWVEYXRpL0RvY3VtZW50aS9wYXBlcm8udGsvY29zbW9zLnBhcGVyby5tZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgX2luaGVyaXRzIGZyb20gIi9tZWRpYS9qYWNvcG8vVm9sdW1lRGF0aS9Eb2N1bWVudGkvcGFwZXJvLnRrL2Nvc21vcy5wYXBlcm8ubWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2luaGVyaXRzIjsKaW1wb3J0IF9jcmVhdGVTdXBlciBmcm9tICIvbWVkaWEvamFjb3BvL1ZvbHVtZURhdGkvRG9jdW1lbnRpL3BhcGVyby50ay9jb3Ntb3MucGFwZXJvLm1lL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVTdXBlciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudmFsdWVzLmpzIjsKaW1wb3J0ICogYXMgUGhhc2VyIGZyb20gInBoYXNlciI7CmltcG9ydCB3ZWJzb2NrZXRFdmVudHMgZnJvbSAiLi4vY29uc3RhbnRzL3dlYnNvY2tldEV2ZW50cyI7CmltcG9ydCB7IGdhbWVEaW1lbnNpb25zLCBub3JtYWxpemVycywgc2NlbmVLZXlzIH0gZnJvbSAiLi4vY29uc3RhbnRzL2dhbWVTZXR0aW5ncyI7Cgp2YXIgR2FtZVNjZW5lID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfUGhhc2VyJFNjZW5lKSB7CiAgX2luaGVyaXRzKEdhbWVTY2VuZSwgX1BoYXNlciRTY2VuZSk7CgogIHZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIoR2FtZVNjZW5lKTsKCiAgZnVuY3Rpb24gR2FtZVNjZW5lKHNvY2tldCwgZ2FtZSkgewogICAgdmFyIF90aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBHYW1lU2NlbmUpOwoKICAgIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgewogICAgICBrZXk6IHNjZW5lS2V5cy5nYW1lCiAgICB9KTsKICAgIF90aGlzLnNvY2tldCA9IHNvY2tldDsKICAgIF90aGlzLnNldHRpbmdzID0gZ2FtZS5zZXR0aW5nczsKICAgIF90aGlzLmN1cnJlbnRQbGF5ZXIgPSBnYW1lLmN1cnJlbnRQbGF5ZXI7CiAgICBfdGhpcy5zZXR0aW5ncy5tYXhWZWxvY2l0eUxpdHRsZSA9IGdhbWUuc2V0dGluZ3MudmVsb2NpdHkgKyAwLjU7CiAgICBfdGhpcy5zZXR0aW5ncy5hY2NlbGVyYXRpb25MaXR0bGUgPSAwLjU7CiAgICBfdGhpcy5zZXR0aW5ncy5yZXNwYXduVGltZSA9IDUwMDA7CiAgICBfdGhpcy5zZXR0aW5ncy5mcmljdGlvbkFpciA9IDAuMTsKICAgIF90aGlzLnBsYXllcnMgPSB7fTsKICAgIGdhbWUucGxheWVycy5mb3JFYWNoKGZ1bmN0aW9uIChwbGF5ZXIpIHsKICAgICAgX3RoaXMucGxheWVyc1twbGF5ZXIubG9jYWxJZF0gPSBwbGF5ZXI7CiAgICAgIF90aGlzLnBsYXllcnNbcGxheWVyLmxvY2FsSWRdLmF2YWlsYWJsZUJ1bGxldHMgPSAzOwogICAgICBfdGhpcy5wbGF5ZXJzW3BsYXllci5sb2NhbElkXS5zdGF0ZSA9IDI7CiAgICAgIF90aGlzLnBsYXllcnNbcGxheWVyLmxvY2FsSWRdLmxhc3RJbmRleCA9IC0xOwogICAgfSk7CiAgICBfdGhpcy51cGRhdGVGcHMgPSAxMDsKICAgIF90aGlzLnRpbWVzdGFtcCA9IDA7CiAgICBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBhdmFpbGFibGVCdWxsZXRzID0gTWF0aC5taW4oMywgX3RoaXMucGxheWVyc1tfdGhpcy5jdXJyZW50UGxheWVyXS5hdmFpbGFibGVCdWxsZXRzICsgMSk7CiAgICAgIHZhciBkYXRhID0gewogICAgICAgIGxvY2FsSWQ6IF90aGlzLmN1cnJlbnRQbGF5ZXIsCiAgICAgICAgYXZhaWxhYmxlQnVsbGV0czogYXZhaWxhYmxlQnVsbGV0cwogICAgICB9OwoKICAgICAgX3RoaXMuc29ja2V0LmVtaXQod2Vic29ja2V0RXZlbnRzLlJFTE9BRCwgZGF0YSk7CgogICAgICBfdGhpcy5yZWxvYWQoZGF0YSk7CiAgICB9LCAxIC8gKF90aGlzLnNldHRpbmdzLnJlbG9hZGluZ1ZlbG9jaXR5ICogbm9ybWFsaXplcnMucmVsb2FkaW5nVmVsb2NpdHkpKTsKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhHYW1lU2NlbmUsIFt7CiAgICBrZXk6ICJwcmVsb2FkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwcmVsb2FkKCkgewogICAgICB0aGlzLmxvYWQuaW1hZ2UoInNoaXAwIiwgIi4vc2hpcHMvc2hpcDAucG5nIik7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgic2hpcDEiLCAiLi9zaGlwcy9zaGlwMS5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJzaGlwMiIsICIuL3NoaXBzL3NoaXAyLnBuZyIpOwogICAgICB0aGlzLmxvYWQuaW1hZ2UoInNoaXAzIiwgIi4vc2hpcHMvc2hpcDMucG5nIik7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgibGl0dGxlMCIsICIuL2xpdHRsZS5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJsaXR0bGUxIiwgIi4vbGl0dGxlLnBuZyIpOwogICAgICB0aGlzLmxvYWQuaW1hZ2UoImxpdHRsZTIiLCAiLi9saXR0bGUucG5nIik7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgibGl0dGxlMyIsICIuL2xpdHRsZS5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJidWxsZXQiLCAiLi9idWxsZXQucG5nIik7CiAgICB9CiAgfSwgewogICAga2V5OiAiY3JlYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGUoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdGhpcy5jcmVhdGVHcm91cHMoKTsKICAgICAgdGhpcy5jcmVhdGVTaGlwcygpOwogICAgICB0aGlzLnNvY2tldC5vbih3ZWJzb2NrZXRFdmVudHMuUk9UQVRFX1NISVAsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgcmV0dXJuIF90aGlzMi5vblNoaXBSb3RhdGVkKGRhdGEpOwogICAgICB9KTsKICAgICAgdGhpcy5zb2NrZXQub24od2Vic29ja2V0RXZlbnRzLlNIT09ULCBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgIHJldHVybiBfdGhpczIuY3JlYXRlQnVsbGV0KGRhdGEpOwogICAgICB9KTsKICAgICAgdGhpcy5zb2NrZXQub24od2Vic29ja2V0RXZlbnRzLkNIQU5HRV9TVEFURSwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICByZXR1cm4gX3RoaXMyLnVwZGF0ZVN0YXRlKGRhdGEpOwogICAgICB9KTsKICAgICAgdGhpcy5zb2NrZXQub24od2Vic29ja2V0RXZlbnRzLlJFTE9BRCwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICByZXR1cm4gX3RoaXMyLnJlbG9hZChkYXRhKTsKICAgICAgfSk7CiAgICAgIHRoaXMucm90YXRpb25LZXkgPSB0aGlzLmlucHV0LmtleWJvYXJkLmFkZEtleShQaGFzZXIuSW5wdXQuS2V5Ym9hcmQuS2V5Q29kZXMuU1BBQ0UpOwogICAgICB0aGlzLmFjY2VsZXJhdGVMaXR0bGVLZXkgPSB0aGlzLmlucHV0LmtleWJvYXJkLmFkZEtleShQaGFzZXIuSW5wdXQuS2V5Ym9hcmQuS2V5Q29kZXMuRU5URVIpOwogICAgICB0aGlzLmlucHV0LmtleWJvYXJkLm9uKCJrZXl1cC1FTlRFUiIsIGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoX3RoaXMyLnBsYXllcnNbX3RoaXMyLmN1cnJlbnRQbGF5ZXJdLnN0YXRlID49IDIpIF90aGlzMi5zaG9vdCgpOwogICAgICB9KTsKICAgICAgdGhpcy5waHlzaWNzLndvcmxkLm9uKCJ3b3JsZGJvdW5kcyIsIGZ1bmN0aW9uIChidWxsZXQpIHsKICAgICAgICBidWxsZXQuZ2FtZU9iamVjdC5kZXN0cm95KCk7CiAgICAgIH0pOwogICAgICB2YXIgaW5kZXggPSAwOwogICAgICBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMyLnNvY2tldC5lbWl0KHdlYnNvY2tldEV2ZW50cy5ST1RBVEVfU0hJUCwgW190aGlzMi5jdXJyZW50UGxheWVyLCBfdGhpczIucGxheWVyc1tfdGhpczIuY3VycmVudFBsYXllcl0uc2hpcC5yb3RhdGlvbiwgW190aGlzMi5wbGF5ZXJzW190aGlzMi5jdXJyZW50UGxheWVyXS5zaGlwLngsIF90aGlzMi5wbGF5ZXJzW190aGlzMi5jdXJyZW50UGxheWVyXS5zaGlwLnldLCBfdGhpczIucGxheWVyc1tfdGhpczIuY3VycmVudFBsYXllcl0uc2hpcC52ZWxvY2l0eU1hZ25pdHVkZSwgaW5kZXhdKTsKCiAgICAgICAgaW5kZXgrKzsKICAgICAgfSwgMTAwMCAvIHRoaXMudXBkYXRlRnBzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ1cGRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZSh0aW1lLCBkZWx0YSkgewogICAgICBpZiAodGhpcy5yb3RhdGlvbktleS5pc0Rvd24pIHRoaXMucm90YXRlKGRlbHRhKTsKICAgICAgaWYgKHRoaXMuYWNjZWxlcmF0ZUxpdHRsZUtleS5pc0Rvd24pIHRoaXMubW92ZUxpdHRsZShkZWx0YSk7CgogICAgICB2YXIgX3RoaXMkcGh5c2ljcyR2ZWxvY2l0ID0gdGhpcy5waHlzaWNzLnZlbG9jaXR5RnJvbVJvdGF0aW9uKHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdLnNoaXAucm90YXRpb24sIHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdLnNoaXAudmVsb2NpdHlNYWduaXR1ZGUpLAogICAgICAgICAgeCA9IF90aGlzJHBoeXNpY3MkdmVsb2NpdC54LAogICAgICAgICAgeSA9IF90aGlzJHBoeXNpY3MkdmVsb2NpdC55OwoKICAgICAgdGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc2hpcC5zZXRWZWxvY2l0eSh4LCB5KTsKCiAgICAgIGlmICh0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zdGF0ZSA9PT0gMSkgewogICAgICAgIHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdLnNoaXAudmVsb2NpdHlNYWduaXR1ZGUgPSBNYXRoLm1heCgwLCB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwLnZlbG9jaXR5TWFnbml0dWRlIC0gdGhpcy5zZXR0aW5ncy5mcmljdGlvbkFpciAqIGRlbHRhKTsKICAgICAgfSAvL2lmKHRoaXMuc2hpcHMuY291bnRBY3RpdmUoKSA8PSAxKSBjb25zb2xlLmxvZygiZ2FtZSBvdmVyIikgLy9UT0RPOiBTRVRVUCBFTkQgT0YgVEhFIFRVUk4KCiAgICB9IC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vQ3JlYXRpbmcgdGhpbmdzCgogIH0sIHsKICAgIGtleTogImNyZWF0ZUdyb3VwcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlR3JvdXBzKCkgewogICAgICB0aGlzLnNoaXBzID0gdGhpcy5waHlzaWNzLmFkZC5ncm91cCgpOwogICAgICB0aGlzLmJ1bGxldHMgPSB0aGlzLnBoeXNpY3MuYWRkLmdyb3VwKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY3JlYXRlU2hpcHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZVNoaXBzKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHZhciBpbmRleCA9IDA7CiAgICAgIE9iamVjdC52YWx1ZXModGhpcy5wbGF5ZXJzKS5mb3JFYWNoKGZ1bmN0aW9uIChwbGF5ZXIpIHsKICAgICAgICBwbGF5ZXIuc2hpcCA9IF90aGlzMy5zaGlwcy5jcmVhdGUoKGluZGV4IDwgMiA/IDAuMDUgOiAwLjk1KSAqIGdhbWVEaW1lbnNpb25zLndpZHRoLCAoaW5kZXggJSAyID09PSAwID8gMC4wNSA6IDAuOTUpICogZ2FtZURpbWVuc2lvbnMuaGVpZ2h0LCAic2hpcCIgKyBwbGF5ZXIuY29sb3IpOwogICAgICAgIHBsYXllci5zaGlwLmxvY2FsSWQgPSBwbGF5ZXIubG9jYWxJZDsKICAgICAgICBwbGF5ZXIuc2hpcC5zZXRSb3RhdGlvbigtTWF0aC5QSSAvIDQgKiAoaW5kZXggPCAyID8gMSA6IDMpICogKGluZGV4ICUgMiAqIDIgLSAxKSk7CiAgICAgICAgcGxheWVyLnNoaXAudmVsb2NpdHlNYWduaXR1ZGUgPSBfdGhpczMuc2V0dGluZ3MudmVsb2NpdHkgKiBub3JtYWxpemVycy52ZWxvY2l0eTsKCiAgICAgICAgaWYgKHBsYXllci5sb2NhbElkID09PSBfdGhpczMuY3VycmVudFBsYXllcikgewogICAgICAgICAgcGxheWVyLnNoaXAuc2V0Q29sbGlkZVdvcmxkQm91bmRzKHRydWUpOwoKICAgICAgICAgIF90aGlzMy5waHlzaWNzLmFkZC5vdmVybGFwKHBsYXllci5zaGlwLCBfdGhpczMuYnVsbGV0cywgZnVuY3Rpb24gKHNoaXAsIGJ1bGxldCkgewogICAgICAgICAgICBfdGhpczMub25CdWxsZXRDb2xsaXNpb24oc2hpcCwgYnVsbGV0KTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIF90aGlzMy5waHlzaWNzLmFkZC5jb2xsaWRlcihwbGF5ZXIuc2hpcCwgX3RoaXMzLnNoaXBzLCBmdW5jdGlvbiAoY3VycmVudFNoaXAsIHNoaXApIHsKICAgICAgICAgICAgaWYgKF90aGlzMy5wbGF5ZXJzW190aGlzMy5jdXJyZW50UGxheWVyXS5zdGF0ZSA9PT0gMSAmJiBfdGhpczMucGxheWVyc1tzaGlwLmxvY2FsSWRdLnN0YXRlID49IDIpIHsKICAgICAgICAgICAgICBfdGhpczMua2lsbGVkQnkgPSBzaGlwLmxvY2FsSWQ7CgogICAgICAgICAgICAgIF90aGlzMy5zb2NrZXQuZW1pdCh3ZWJzb2NrZXRFdmVudHMuQ0hBTkdFX1NUQVRFLCB7CiAgICAgICAgICAgICAgICBsb2NhbElkOiBfdGhpczMuY3VycmVudFBsYXllciwKICAgICAgICAgICAgICAgIHN0YXRlOiAwCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIF90aGlzMy51cGRhdGVTdGF0ZSh7CiAgICAgICAgICAgICAgICBsb2NhbElkOiBfdGhpczMuY3VycmVudFBsYXllciwKICAgICAgICAgICAgICAgIHN0YXRlOiAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaW5kZXgrKzsKICAgICAgfSk7CiAgICAgIHRoaXMucGh5c2ljcy5hZGQuY29sbGlkZXIodGhpcy5zaGlwcywgdGhpcy5zaGlwcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY3JlYXRlQnVsbGV0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVCdWxsZXQoZGF0YSkgewogICAgICB2YXIgX3RoaXMkcGh5c2ljcyR2ZWxvY2l0MiA9IHRoaXMucGh5c2ljcy52ZWxvY2l0eUZyb21Sb3RhdGlvbihkYXRhLnJvdGF0aW9uLCB0aGlzLnNldHRpbmdzLmJ1bGxldFZlbG9jaXR5ICogbm9ybWFsaXplcnMuYnVsbGV0VmVsb2NpdHkpLAogICAgICAgICAgeCA9IF90aGlzJHBoeXNpY3MkdmVsb2NpdDIueCwKICAgICAgICAgIHkgPSBfdGhpcyRwaHlzaWNzJHZlbG9jaXQyLnk7CgogICAgICB2YXIgZGVsdGFUaW1lID0gRGF0ZS5ub3coKSAtIGRhdGEudGltZXN0YW1wOwogICAgICB2YXIgYnVsbGV0ID0gdGhpcy5idWxsZXRzLmNyZWF0ZShkYXRhLnBvc2l0aW9uLnggKyBkZWx0YVRpbWUgKiB4IC8gMTAwMCwgZGF0YS5wb3NpdGlvbi55ICsgZGVsdGFUaW1lICogeSAvIDEwMDAsICJidWxsZXQiKTsKICAgICAgYnVsbGV0LnJvdGF0aW9uID0gZGF0YS5yb3RhdGlvbjsKICAgICAgYnVsbGV0LnNldFZlbG9jaXR5KHgsIHkpOwogICAgICBidWxsZXQuc2hvdEJ5ID0gZGF0YS5sb2NhbElkOwogICAgICBidWxsZXQuc2V0Q29sbGlkZVdvcmxkQm91bmRzKHRydWUpOwogICAgICBidWxsZXQuYm9keS5vbldvcmxkQm91bmRzID0gdHJ1ZTsKICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uYXZhaWxhYmxlQnVsbGV0cy0tOwogICAgfSAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAvL090aGVycyBkbyB0aGluZ3MgdmlhIHRoZSB3ZWJzb2NrZXQKCiAgfSwgewogICAga2V5OiAib25TaGlwUm90YXRlZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25TaGlwUm90YXRlZChkYXRhKSB7CiAgICAgIHZhciBwbGF5ZXIgPSB0aGlzLnBsYXllcnNbZGF0YVswXV07CiAgICAgIGlmIChkYXRhWzNdIDwgcGxheWVyLmxhc3RJbmRleCkgcmV0dXJuOwogICAgICBwbGF5ZXIuaW5kZXggPSBkYXRhWzNdOwogICAgICBwbGF5ZXIuc2hpcC5zZXRSb3RhdGlvbihkYXRhWzFdKTsKICAgICAgcGxheWVyLnNoaXAuc2V0UG9zaXRpb24oZGF0YVsyXVswXSwgZGF0YVsyXVsxXSk7CiAgICAgIGNvbnNvbGUubG9nKERhdGUubm93KCkgLSB0aGlzLnRpbWVzdGFtcCk7CiAgICAgIHRoaXMudGltZXN0YW1wID0gRGF0ZS5ub3coKTsKICAgICAgLyppZihwbGF5ZXIuc2hpcC5leHBlY3RlZFBvc2l0aW9uKXsKICAgICAgICAgIHBsYXllci5zaGlwLnNldFBvc2l0aW9uKHBsYXllci5zaGlwLmV4cGVjdGVkUG9zaXRpb24ueCwgcGxheWVyLnNoaXAuZXhwZWN0ZWRQb3NpdGlvbi55KTsKICAgICAgfQogICAgICAgY29uc3QgZXhwZWN0ZWREZWx0YVRpbWUgPSAxMDAwL3RoaXMudXBkYXRlRnBzOwogICAgICBjb25zdCB7eCwgeX0gPSB0aGlzLnBsYXllcnNbZGF0YVswXV0uc2hpcDsKICAgICAgcGxheWVyLnNoaXAuc2V0VmVsb2NpdHkoICggZGF0YVsyXVswXS14ICkgLyBleHBlY3RlZERlbHRhVGltZSwgKCBkYXRhWzJdWzFdLXkgKSAvIGV4cGVjdGVkRGVsdGFUaW1lICk7CiAgICAgIHBsYXllci5zaGlwLmV4cGVjdGVkUG9zaXRpb24gPSB7CiAgICAgICAgICB4OiBkYXRhWzJdWzBdLAogICAgICAgICAgeTogZGF0YVsyXVsxXQogICAgICB9Ki8KICAgIH0gLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy9DdXJyZW50IHBsYXllcnMgZG9lcyB0aGluZ3MKCiAgfSwgewogICAga2V5OiAicm90YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByb3RhdGUoZGVsdGEpIHsKICAgICAgdGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc2hpcC5yb3RhdGlvbiArPSBkZWx0YSAqIHRoaXMuc2V0dGluZ3MuYW5ndWxhclZlbG9jaXR5ICogbm9ybWFsaXplcnMuYW5ndWxhclZlbG9jaXR5OwogICAgfQogIH0sIHsKICAgIGtleTogIm1vdmVMaXR0bGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG1vdmVMaXR0bGUoZGVsdGEpIHsKICAgICAgaWYgKHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdLnN0YXRlID09PSAxKSB7CiAgICAgICAgdmFyIHNoaXAgPSB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwOwogICAgICAgIHZhciBwcmV2aW91c01hZyA9IHNoaXAudmVsb2NpdHlNYWduaXR1ZGU7CgogICAgICAgIGlmIChwcmV2aW91c01hZyA8IHRoaXMuc2V0dGluZ3MubWF4VmVsb2NpdHlMaXR0bGUgKiBub3JtYWxpemVycy52ZWxvY2l0eSkgewogICAgICAgICAgdGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc2hpcC52ZWxvY2l0eU1hZ25pdHVkZSArPSBkZWx0YSAqIHRoaXMuc2V0dGluZ3MuYWNjZWxlcmF0aW9uTGl0dGxlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwLnZlbG9jaXR5TWFnbml0dWRlID0gdGhpcy5zZXR0aW5ncy5tYXhWZWxvY2l0eUxpdHRsZSAqIG5vcm1hbGl6ZXJzLnZlbG9jaXR5OwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogInNob290IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzaG9vdCgpIHsKICAgICAgaWYgKHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdLmF2YWlsYWJsZUJ1bGxldHMgPiAwKSB7CiAgICAgICAgdmFyIHNoaXAgPSB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwOwogICAgICAgIHZhciBhbmdsZSA9IHNoaXAucm90YXRpb247CiAgICAgICAgdmFyIGRhdGEgPSB7CiAgICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgICB4OiBzaGlwLnggKyBzaGlwLndpZHRoICogTWF0aC5jb3MoYW5nbGUpLAogICAgICAgICAgICB5OiBzaGlwLnkgKyBzaGlwLndpZHRoICogTWF0aC5zaW4oYW5nbGUpCiAgICAgICAgICB9LAogICAgICAgICAgcm90YXRpb246IGFuZ2xlLAogICAgICAgICAgbG9jYWxJZDogdGhpcy5jdXJyZW50UGxheWVyLAogICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpCiAgICAgICAgfTsKICAgICAgICB0aGlzLnNvY2tldC5lbWl0KHdlYnNvY2tldEV2ZW50cy5TSE9PVCwgZGF0YSk7CiAgICAgICAgdGhpcy5jcmVhdGVCdWxsZXQoZGF0YSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJ1cGRhdGVTdGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlU3RhdGUoZGF0YSkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLnN0YXRlID0gZGF0YS5zdGF0ZTsKICAgICAgdmFyIHNoaXAgPSB0aGlzLnBsYXllcnNbZGF0YS5sb2NhbElkXS5zaGlwOwoKICAgICAgc3dpdGNoIChkYXRhLnN0YXRlKSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgdGhpcy5zaGlwcy5raWxsQW5kSGlkZShzaGlwKTsKICAgICAgICAgIHRoaXMuc2hpcHMucmVtb3ZlKHNoaXApOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgMToKICAgICAgICAgIHNoaXAuc2V0VGV4dHVyZSgibGl0dGxlIiArIHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmNvbG9yKTsKCiAgICAgICAgICBpZiAoZGF0YS5sb2NhbElkID09PSB0aGlzLmN1cnJlbnRQbGF5ZXIpIHsKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgaWYgKF90aGlzNC5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uc3RhdGUgPT09IDEpIHsKICAgICAgICAgICAgICAgIF90aGlzNC51cGRhdGVTdGF0ZSh7CiAgICAgICAgICAgICAgICAgIGxvY2FsSWQ6IF90aGlzNC5jdXJyZW50UGxheWVyLAogICAgICAgICAgICAgICAgICBzdGF0ZTogMgogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgX3RoaXM0LnNvY2tldC5lbWl0KHdlYnNvY2tldEV2ZW50cy5DSEFOR0VfU1RBVEUsIHsKICAgICAgICAgICAgICAgICAgbG9jYWxJZDogX3RoaXM0LmN1cnJlbnRQbGF5ZXIsCiAgICAgICAgICAgICAgICAgIHN0YXRlOiAyCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHRoaXMuc2V0dGluZ3MucmVzcGF3blRpbWUpOwogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIDI6CiAgICAgICAgICBzaGlwLnZlbG9jaXR5TWFnbml0dWRlID0gdGhpcy5zZXR0aW5ncy52ZWxvY2l0eSAqIG5vcm1hbGl6ZXJzLnZlbG9jaXR5OwogICAgICAgICAgc2hpcC5zZXRUZXh0dXJlKCJzaGlwIiArIHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmNvbG9yKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAib25CdWxsZXRDb2xsaXNpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uQnVsbGV0Q29sbGlzaW9uKHNoaXAsIGJ1bGxldCkgewogICAgICBidWxsZXQuZGVzdHJveSgpOwogICAgICB2YXIgc3RhdGUgPSB0aGlzLnBsYXllcnNbc2hpcC5sb2NhbElkXS5zdGF0ZSAtIDE7CiAgICAgIGlmIChzdGF0ZSA9PT0gMCkgdGhpcy5raWxsZWRCeSA9IGJ1bGxldC5zaG90Qnk7CiAgICAgIHRoaXMuc29ja2V0LmVtaXQod2Vic29ja2V0RXZlbnRzLkNIQU5HRV9TVEFURSwgewogICAgICAgIGxvY2FsSWQ6IHNoaXAubG9jYWxJZCwKICAgICAgICBzdGF0ZTogc3RhdGUKICAgICAgfSk7CiAgICAgIHRoaXMudXBkYXRlU3RhdGUoewogICAgICAgIGxvY2FsSWQ6IHNoaXAubG9jYWxJZCwKICAgICAgICBzdGF0ZTogc3RhdGUKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVsb2FkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZWxvYWQoZGF0YSkgewogICAgICB0aGlzLnBsYXllcnNbZGF0YS5sb2NhbElkXS5hdmFpbGFibGVCdWxsZXRzID0gZGF0YS5hdmFpbGFibGVCdWxsZXRzOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIEdhbWVTY2VuZTsKfShQaGFzZXIuU2NlbmUpOwoKZXhwb3J0IHsgR2FtZVNjZW5lIGFzIGRlZmF1bHQgfTs="},{"version":3,"sources":["/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/GameScene.js"],"names":["Phaser","websocketEvents","gameDimensions","normalizers","sceneKeys","GameScene","socket","game","key","settings","currentPlayer","maxVelocityLittle","velocity","accelerationLittle","respawnTime","frictionAir","players","forEach","player","localId","availableBullets","state","lastIndex","updateFps","timestamp","setInterval","Math","min","data","emit","RELOAD","reload","reloadingVelocity","load","image","createGroups","createShips","on","ROTATE_SHIP","onShipRotated","SHOOT","createBullet","CHANGE_STATE","updateState","rotationKey","input","keyboard","addKey","Input","Keyboard","KeyCodes","SPACE","accelerateLittleKey","ENTER","shoot","physics","world","bullet","gameObject","destroy","index","ship","rotation","x","y","velocityMagnitude","time","delta","isDown","rotate","moveLittle","velocityFromRotation","setVelocity","max","ships","add","group","bullets","Object","values","create","width","height","color","setRotation","PI","setCollideWorldBounds","overlap","onBulletCollision","collider","currentShip","killedBy","bulletVelocity","deltaTime","Date","now","position","shotBy","body","onWorldBounds","setPosition","console","log","angularVelocity","previousMag","angle","cos","sin","killAndHide","remove","setTexture","setTimeout","Scene"],"mappings":"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","sourcesContent":["import * as Phaser from \"phaser\";\nimport websocketEvents from \"../constants/websocketEvents\";\nimport {gameDimensions, normalizers, sceneKeys} from \"../constants/gameSettings\";\n\n\nexport default class GameScene extends Phaser.Scene {\n\n    constructor(socket, game) {\n        super({key: sceneKeys.game});\n\n        this.socket = socket;\n        this.settings = game.settings;\n        this.currentPlayer = game.currentPlayer;\n        this.settings.maxVelocityLittle = game.settings.velocity+0.5;\n        this.settings.accelerationLittle = 0.5;\n        this.settings.respawnTime = 5000;\n        this.settings.frictionAir = 0.1;\n        this.players = {};\n        game.players.forEach(player => {\n            this.players[player.localId] = player;\n            this.players[player.localId].availableBullets = 3;\n            this.players[player.localId].state = 2;\n            this.players[player.localId].lastIndex = -1;\n        });\n        this.updateFps = 10;\n        this.timestamp = 0;\n\n        setInterval(() => {\n            const availableBullets = Math.min(3, this.players[this.currentPlayer].availableBullets + 1);\n            const data = {\n                localId: this.currentPlayer,\n                availableBullets\n            };\n            this.socket.emit(websocketEvents.RELOAD, data);\n            this.reload(data);\n        }, 1/(this.settings.reloadingVelocity * normalizers.reloadingVelocity));\n    }\n\n    preload(){\n\n        this.load.image(\"ship0\", \"./ships/ship0.png\");\n        this.load.image(\"ship1\", \"./ships/ship1.png\");\n        this.load.image(\"ship2\", \"./ships/ship2.png\");\n        this.load.image(\"ship3\", \"./ships/ship3.png\");\n        this.load.image(\"little0\", \"./little.png\");\n        this.load.image(\"little1\", \"./little.png\");\n        this.load.image(\"little2\", \"./little.png\");\n        this.load.image(\"little3\", \"./little.png\");\n        this.load.image(\"bullet\", \"./bullet.png\");\n\n    }\n\n    create(){\n        this.createGroups();\n        this.createShips();\n\n        this.socket.on(websocketEvents.ROTATE_SHIP, data => this.onShipRotated(data));\n        this.socket.on(websocketEvents.SHOOT, data => this.createBullet(data));\n        this.socket.on(websocketEvents.CHANGE_STATE, data => this.updateState(data));\n        this.socket.on(websocketEvents.RELOAD, data => this.reload(data));\n\n        this.rotationKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);\n        this.accelerateLittleKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ENTER);\n        this.input.keyboard.on(\"keyup-ENTER\", ()=>{\n            if(this.players[this.currentPlayer].state>=2) this.shoot();\n        });\n        this.physics.world.on(\"worldbounds\", (bullet)=>{bullet.gameObject.destroy()});\n\n        let index = 0;\n        setInterval(()=>{\n            this.socket.emit(websocketEvents.ROTATE_SHIP, [\n                this.currentPlayer,\n                this.players[this.currentPlayer].ship.rotation,\n                [this.players[this.currentPlayer].ship.x, this.players[this.currentPlayer].ship.y],\n                this.players[this.currentPlayer].ship.velocityMagnitude,\n                index\n            ]);\n            index++;\n        }, 1000/this.updateFps);\n    }\n\n    update(time, delta){\n        if(this.rotationKey.isDown) this.rotate(delta);\n        if(this.accelerateLittleKey.isDown) this.moveLittle(delta);\n        const {x, y} = this.physics.velocityFromRotation(\n            this.players[this.currentPlayer].ship.rotation,\n            this.players[this.currentPlayer].ship.velocityMagnitude\n        );\n        this.players[this.currentPlayer].ship.setVelocity(x, y);\n        if (this.players[this.currentPlayer].state === 1) {\n            this.players[this.currentPlayer].ship.velocityMagnitude = Math.max(\n                0, this.players[this.currentPlayer].ship.velocityMagnitude - this.settings.frictionAir * delta\n            );\n        }\n        //if(this.ships.countActive() <= 1) console.log(\"game over\") //TODO: SETUP END OF THE TURN\n    }\n\n\n\n\n    //=============================================================================\n    //Creating things\n    createGroups(){\n        this.ships = this.physics.add.group();\n        this.bullets = this.physics.add.group();\n    }\n\n    createShips(){\n        let index = 0;\n        Object.values(this.players).forEach(player => {\n            player.ship = this.ships.create(\n                (index<2 ? 0.05 : 0.95) * gameDimensions.width,\n                ( index%2 === 0 ? 0.05 : 0.95 ) * gameDimensions.height,\n                \"ship\"+player.color\n            )\n\n            player.ship.localId = player.localId;\n            player.ship.setRotation(-Math.PI / 4  * ( index < 2 ? 1 : 3) * ( ( index % 2 ) * 2 - 1 ));\n            player.ship.velocityMagnitude = this.settings.velocity*normalizers.velocity;\n\n            if(player.localId===this.currentPlayer){\n                player.ship.setCollideWorldBounds(true);\n                this.physics.add.overlap(player.ship, this.bullets, (ship, bullet) => {\n                    this.onBulletCollision(ship, bullet);\n                });\n                this.physics.add.collider(player.ship, this.ships, (currentShip, ship)=>{\n                    if(this.players[this.currentPlayer].state === 1 && this.players[ship.localId].state >= 2){\n                        this.killedBy = ship.localId;\n                        this.socket.emit(websocketEvents.CHANGE_STATE, {\n                            localId: this.currentPlayer,\n                            state: 0\n                        });\n                        this.updateState({\n                            localId: this.currentPlayer,\n                            state: 0\n                        });\n                    }\n                })\n            }\n\n            index++;\n        });\n\n        this.physics.add.collider(this.ships, this.ships);\n    }\n\n    createBullet(data){\n        const {x, y} = this.physics.velocityFromRotation(data.rotation, this.settings.bulletVelocity*normalizers.bulletVelocity);\n        const deltaTime = Date.now()-data.timestamp;\n        const bullet = this.bullets.create(data.position.x+deltaTime*x/1000, data.position.y+deltaTime*y/1000, \"bullet\");\n        bullet.rotation = data.rotation;\n        bullet.setVelocity(x, y);\n        bullet.shotBy = data.localId;\n        bullet.setCollideWorldBounds(true);\n        bullet.body.onWorldBounds = true;\n        this.players[data.localId].availableBullets--;\n    }\n\n\n\n\n\n\n    //=============================================================================\n    //Others do things via the websocket\n    onShipRotated(data){\n        const player = this.players[data[0]];\n\n        if(data[3]<player.lastIndex) return;\n        player.index = data[3];\n\n        player.ship.setRotation(data[1]);\n        player.ship.setPosition(data[2][0], data[2][1]);\n        console.log(Date.now()-this.timestamp);\n        this.timestamp = Date.now();\n        /*if(player.ship.expectedPosition){\n            player.ship.setPosition(player.ship.expectedPosition.x, player.ship.expectedPosition.y);\n        }\n\n        const expectedDeltaTime = 1000/this.updateFps;\n        const {x, y} = this.players[data[0]].ship;\n        player.ship.setVelocity( ( data[2][0]-x ) / expectedDeltaTime, ( data[2][1]-y ) / expectedDeltaTime );\n        player.ship.expectedPosition = {\n            x: data[2][0],\n            y: data[2][1]\n        }*/\n    }\n\n\n\n    //=============================================================================\n    //Current players does things\n    rotate(delta){\n        this.players[this.currentPlayer].ship.rotation += delta * this.settings.angularVelocity * normalizers.angularVelocity;\n    }\n\n    moveLittle(delta){\n        if(this.players[this.currentPlayer].state === 1){\n            const ship = this.players[this.currentPlayer].ship;\n            const previousMag = ship.velocityMagnitude;\n            if(previousMag < this.settings.maxVelocityLittle * normalizers.velocity){\n                this.players[this.currentPlayer].ship.velocityMagnitude += delta*this.settings.accelerationLittle;\n            } else {\n                this.players[this.currentPlayer].ship.velocityMagnitude = this.settings.maxVelocityLittle * normalizers.velocity;\n            }\n        }\n    }\n\n    shoot(){\n        if(this.players[this.currentPlayer].availableBullets>0){\n            const ship = this.players[this.currentPlayer].ship;\n            const angle = ship.rotation;\n            const data = {\n                position: {\n                    x: ship.x + ship.width*Math.cos(angle),\n                    y: ship.y + ship.width*Math.sin(angle)\n                },\n                rotation: angle,\n                localId: this.currentPlayer,\n                timestamp: Date.now()\n            };\n            this.socket.emit(websocketEvents.SHOOT, data);\n            this.createBullet(data);\n        }\n    }\n\n\n    updateState(data){\n        this.players[data.localId].state = data.state;\n        const ship = this.players[data.localId].ship;\n        switch (data.state) {\n            case 0:\n                this.ships.killAndHide(ship);\n                this.ships.remove(ship);\n                break;\n            case 1:\n                ship.setTexture(\"little\" + this.players[data.localId].color);\n                if(data.localId === this.currentPlayer) {\n                    setTimeout(() => {\n                        if (this.players[data.localId].state === 1) {\n                            this.updateState({\n                                localId: this.currentPlayer,\n                                state: 2\n                            });\n                            this.socket.emit(websocketEvents.CHANGE_STATE, {\n                                localId: this.currentPlayer,\n                                state: 2\n                            });\n                        }\n                    }, this.settings.respawnTime);\n                }\n                break;\n            case 2:\n                ship.velocityMagnitude = this.settings.velocity * normalizers.velocity;\n                ship.setTexture(\"ship\" + this.players[data.localId].color);\n                break;\n        }\n    }\n\n    onBulletCollision(ship, bullet){\n        bullet.destroy();\n        const state = this.players[ship.localId].state-1;\n        if(state === 0) this.killedBy = bullet.shotBy;\n        this.socket.emit(websocketEvents.CHANGE_STATE, {\n            localId: ship.localId,\n            state\n        });\n        this.updateState({\n            localId: ship.localId,\n            state\n        });\n    }\n\n\n    reload(data){\n        this.players[data.localId].availableBullets = data.availableBullets;\n    }\n\n\n}"]}]}