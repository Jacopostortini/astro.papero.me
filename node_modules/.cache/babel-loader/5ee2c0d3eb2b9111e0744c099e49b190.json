{"remainingRequest":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/thread-loader/dist/cjs.js!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/babel-loader/lib/index.js!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/eslint-loader/index.js??ref--13-0!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/GameScene.js","dependencies":[{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/GameScene.js","mtime":1617701476452},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/cache-loader/dist/cjs.js","mtime":1616495189815},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/thread-loader/dist/cjs.js","mtime":1616495190967},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/babel-loader/lib/index.js","mtime":1616495189787},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/eslint-loader/index.js","mtime":1616495190059}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICIvbWVkaWEvamFjb3BvL1ZvbHVtZURhdGkvRG9jdW1lbnRpL3BhcGVyby50ay9jb3Ntb3MucGFwZXJvLm1lL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiL21lZGlhL2phY29wby9Wb2x1bWVEYXRpL0RvY3VtZW50aS9wYXBlcm8udGsvY29zbW9zLnBhcGVyby5tZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgX2luaGVyaXRzIGZyb20gIi9tZWRpYS9qYWNvcG8vVm9sdW1lRGF0aS9Eb2N1bWVudGkvcGFwZXJvLnRrL2Nvc21vcy5wYXBlcm8ubWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2luaGVyaXRzIjsKaW1wb3J0IF9jcmVhdGVTdXBlciBmcm9tICIvbWVkaWEvamFjb3BvL1ZvbHVtZURhdGkvRG9jdW1lbnRpL3BhcGVyby50ay9jb3Ntb3MucGFwZXJvLm1lL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVTdXBlciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIucGFyc2UtaW50LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLnBhcnNlLWZsb2F0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLnRvLWZpeGVkLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnZhbHVlcy5qcyI7CmltcG9ydCAqIGFzIFBoYXNlciBmcm9tICJwaGFzZXIiOwppbXBvcnQgd2Vic29ja2V0RXZlbnRzIGZyb20gIi4uL2NvbnN0YW50cy93ZWJzb2NrZXRFdmVudHMiOwppbXBvcnQgeyBnYW1lRGltZW5zaW9ucywgbm9ybWFsaXplcnMsIHNjZW5lS2V5cyB9IGZyb20gIi4uL2NvbnN0YW50cy9nYW1lU2V0dGluZ3MiOwppbXBvcnQgeyBkZXRlY3RUb3VjaFNjcmVlbiB9IGZyb20gIi4uL2NvbnN0YW50cy9jb25zdGFudHMiOwoKdmFyIEdhbWVTY2VuZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX1BoYXNlciRTY2VuZSkgewogIF9pbmhlcml0cyhHYW1lU2NlbmUsIF9QaGFzZXIkU2NlbmUpOwoKICB2YXIgX3N1cGVyID0gX2NyZWF0ZVN1cGVyKEdhbWVTY2VuZSk7CgogIGZ1bmN0aW9uIEdhbWVTY2VuZShzb2NrZXQsIGdhbWUpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgR2FtZVNjZW5lKTsKCiAgICBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHsKICAgICAga2V5OiBzY2VuZUtleXMuZ2FtZQogICAgfSk7CiAgICBfdGhpcy5zb2NrZXQgPSBzb2NrZXQ7CiAgICBfdGhpcy5zZXR0aW5ncyA9IGdhbWUuc2V0dGluZ3M7CiAgICBfdGhpcy5jdXJyZW50UGxheWVyID0gZ2FtZS5jdXJyZW50UGxheWVyOwogICAgX3RoaXMuc2V0dGluZ3MubWF4VmVsb2NpdHlMaXR0bGUgPSBnYW1lLnNldHRpbmdzLnZlbG9jaXR5ICsgMC4yOwogICAgX3RoaXMuc2V0dGluZ3MuYWNjZWxlcmF0aW9uTGl0dGxlID0gMC40OwogICAgX3RoaXMuc2V0dGluZ3MucmVzcGF3blRpbWUgPSA1MDAwOwogICAgX3RoaXMuc2V0dGluZ3MuZnJpY3Rpb25BaXIgPSAwLjE7CiAgICBfdGhpcy5wbGF5ZXJzID0ge307CiAgICBnYW1lLnBsYXllcnMuZm9yRWFjaChmdW5jdGlvbiAocGxheWVyKSB7CiAgICAgIF90aGlzLnBsYXllcnNbcGxheWVyLmxvY2FsSWRdID0gcGxheWVyOwogICAgICBfdGhpcy5wbGF5ZXJzW3BsYXllci5sb2NhbElkXS5hdmFpbGFibGVCdWxsZXRzID0gMzsKICAgICAgX3RoaXMucGxheWVyc1twbGF5ZXIubG9jYWxJZF0ubGFzdFRpbWVzdGFtcCA9IDA7CiAgICB9KTsKICAgIF90aGlzLnVwZGF0ZUZwcyA9IDE1OwogICAgX3RoaXMudG91Y2hTY3JlZW4gPSBkZXRlY3RUb3VjaFNjcmVlbigpOwogICAgcmV0dXJuIF90aGlzOwogIH0KCiAgX2NyZWF0ZUNsYXNzKEdhbWVTY2VuZSwgW3sKICAgIGtleTogInByZWxvYWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHByZWxvYWQoKSB7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgic2hpcDAiLCAiLi9zaGlwcy9zaGlwMC5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJzaGlwMSIsICIuL3NoaXBzL3NoaXAxLnBuZyIpOwogICAgICB0aGlzLmxvYWQuaW1hZ2UoInNoaXAyIiwgIi4vc2hpcHMvc2hpcDIucG5nIik7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgic2hpcDMiLCAiLi9zaGlwcy9zaGlwMy5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJsaXR0bGUwIiwgIi4vbGl0dGxlLnBuZyIpOwogICAgICB0aGlzLmxvYWQuaW1hZ2UoImxpdHRsZTEiLCAiLi9saXR0bGUucG5nIik7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgibGl0dGxlMiIsICIuL2xpdHRsZS5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJsaXR0bGUzIiwgIi4vbGl0dGxlLnBuZyIpOwogICAgICB0aGlzLmxvYWQuaW1hZ2UoImJ1bGxldCIsICIuL2J1bGxldC5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJidWxsZXQtbG9hZGVkIiwgIi4vYnVsbGV0LWxvYWRlZC5wbmciKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjcmVhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZSgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB0aGlzLmNyZWF0ZUdyb3VwcygpOwogICAgICB0aGlzLmNyZWF0ZVNoaXBzKCk7CiAgICAgIHRoaXMuc29ja2V0Lm9uKHdlYnNvY2tldEV2ZW50cy5VUERBVEVfU0hJUCwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICByZXR1cm4gX3RoaXMyLnVwZGF0ZVNoaXAoZGF0YSk7CiAgICAgIH0pOwogICAgICB0aGlzLnNvY2tldC5vbih3ZWJzb2NrZXRFdmVudHMuU0hPT1QsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgcmV0dXJuIF90aGlzMi5jcmVhdGVCdWxsZXQoZGF0YSk7CiAgICAgIH0pOwogICAgICB0aGlzLnNvY2tldC5vbih3ZWJzb2NrZXRFdmVudHMuQ0hBTkdFX1NUQVRFLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgIHJldHVybiBfdGhpczIudXBkYXRlU3RhdGUoZGF0YSk7CiAgICAgIH0pOwogICAgICB0aGlzLnNvY2tldC5vbih3ZWJzb2NrZXRFdmVudHMuUkVMT0FELCBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgIHJldHVybiBfdGhpczIucmVsb2FkKGRhdGEpOwogICAgICB9KTsKICAgICAgdGhpcy5zZXRLZXlJbnB1dEhhbmRsZXJzKCk7CiAgICAgIHRoaXMucGh5c2ljcy53b3JsZC5vbigid29ybGRib3VuZHMiLCBmdW5jdGlvbiAoYnVsbGV0KSB7CiAgICAgICAgYnVsbGV0LmdhbWVPYmplY3QuZGVzdHJveSgpOwogICAgICB9KTsKICAgICAgaWYgKHRoaXMudG91Y2hTY3JlZW4pIHRoaXMuc2V0VG91Y2hJbnB1dEhhbmRsZXJzKCk7CiAgICAgIHRoaXMucmVsb2FkSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGF2YWlsYWJsZUJ1bGxldHMgPSBNYXRoLm1pbigzLCBfdGhpczIucGxheWVyc1tfdGhpczIuY3VycmVudFBsYXllcl0uYXZhaWxhYmxlQnVsbGV0cyArIDEpOwogICAgICAgIHZhciBkYXRhID0gewogICAgICAgICAgbG9jYWxJZDogX3RoaXMyLmN1cnJlbnRQbGF5ZXIsCiAgICAgICAgICBhdmFpbGFibGVCdWxsZXRzOiBhdmFpbGFibGVCdWxsZXRzCiAgICAgICAgfTsKCiAgICAgICAgX3RoaXMyLnNvY2tldC5lbWl0KHdlYnNvY2tldEV2ZW50cy5SRUxPQUQsIGRhdGEpOwoKICAgICAgICBfdGhpczIucmVsb2FkKGRhdGEpOwogICAgICB9LCAxIC8gKHRoaXMuc2V0dGluZ3MucmVsb2FkaW5nVmVsb2NpdHkgKiBub3JtYWxpemVycy5yZWxvYWRpbmdWZWxvY2l0eSkpOwogICAgICB0aGlzLnVwZGF0ZVNoaXBJbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczIuc29ja2V0LmVtaXQod2Vic29ja2V0RXZlbnRzLlVQREFURV9TSElQLCBbX3RoaXMyLmN1cnJlbnRQbGF5ZXIsIE51bWJlci5wYXJzZUludChfdGhpczIucGxheWVyc1tfdGhpczIuY3VycmVudFBsYXllcl0uc2hpcC5hbmdsZSksIFtOdW1iZXIucGFyc2VGbG9hdChfdGhpczIucGxheWVyc1tfdGhpczIuY3VycmVudFBsYXllcl0uc2hpcC54LnRvRml4ZWQoMikpLCBOdW1iZXIucGFyc2VGbG9hdChfdGhpczIucGxheWVyc1tfdGhpczIuY3VycmVudFBsYXllcl0uc2hpcC55LnRvRml4ZWQoMikpXSwgX3RoaXMyLnRpbWUubm93XSk7CiAgICAgIH0sIDEwMDAgLyB0aGlzLnVwZGF0ZUZwcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAidXBkYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGUodGltZSwgZGVsdGEpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICBpZiAodGhpcy5yb3RhdGlvbktleS5pc0Rvd24gfHwgdGhpcy5yb3RhdGluZykgdGhpcy5yb3RhdGUoZGVsdGEpOwogICAgICBpZiAodGhpcy5hY2NlbGVyYXRlTGl0dGxlS2V5LmlzRG93biB8fCB0aGlzLmFjY2VsZXJhdGluZykgdGhpcy5tb3ZlTGl0dGxlKGRlbHRhKTsKCiAgICAgIHZhciBfdGhpcyRwaHlzaWNzJHZlbG9jaXQgPSB0aGlzLnBoeXNpY3MudmVsb2NpdHlGcm9tQW5nbGUodGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc2hpcC5hbmdsZSwgdGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc2hpcC52ZWxvY2l0eU1hZ25pdHVkZSksCiAgICAgICAgICB4ID0gX3RoaXMkcGh5c2ljcyR2ZWxvY2l0LngsCiAgICAgICAgICB5ID0gX3RoaXMkcGh5c2ljcyR2ZWxvY2l0Lnk7CgogICAgICB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwLnNldFZlbG9jaXR5KHgsIHkpOwoKICAgICAgaWYgKHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdLnN0YXRlID09PSAxKSB7CiAgICAgICAgdGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc2hpcC52ZWxvY2l0eU1hZ25pdHVkZSA9IE1hdGgubWF4KDAsIHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdLnNoaXAudmVsb2NpdHlNYWduaXR1ZGUgLSB0aGlzLnNldHRpbmdzLmZyaWN0aW9uQWlyICogZGVsdGEpOwogICAgICB9CgogICAgICBPYmplY3QudmFsdWVzKHRoaXMucGxheWVycykuZm9yRWFjaChmdW5jdGlvbiAocGxheWVyKSB7CiAgICAgICAgcGxheWVyLmJ1bGxldHNMb2FkZWQuY2hpbGRyZW4uaXRlcmF0ZShmdW5jdGlvbiAoYnVsbGV0LCBpbmRleCkgewogICAgICAgICAgdmFyIHRvcExlZnQgPSBwbGF5ZXIuc2hpcC5nZXRUb3BMZWZ0KCk7CiAgICAgICAgICB2YXIgYm90dG9tTGVmdCA9IHBsYXllci5zaGlwLmdldEJvdHRvbUxlZnQoKTsKICAgICAgICAgIHZhciBjZW50ZXJMZWZ0ID0gewogICAgICAgICAgICB4OiAodG9wTGVmdC54ICsgYm90dG9tTGVmdC54KSAvIDIsCiAgICAgICAgICAgIHk6ICh0b3BMZWZ0LnkgKyBib3R0b21MZWZ0LnkpIC8gMgogICAgICAgICAgfTsKCiAgICAgICAgICBzd2l0Y2ggKGluZGV4KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBidWxsZXQueCA9IGJvdHRvbUxlZnQueCAtIHBsYXllci5zaGlwLndpZHRoIC8gNCAqIE1hdGguY29zKHBsYXllci5zaGlwLnJvdGF0aW9uKTsKICAgICAgICAgICAgICBidWxsZXQueSA9IGJvdHRvbUxlZnQueSAtIHBsYXllci5zaGlwLmhlaWdodCAvIDQgKiBNYXRoLnNpbihwbGF5ZXIuc2hpcC5yb3RhdGlvbik7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgYnVsbGV0LnggPSB0b3BMZWZ0LnggLSBwbGF5ZXIuc2hpcC53aWR0aCAvIDQgKiBNYXRoLmNvcyhwbGF5ZXIuc2hpcC5yb3RhdGlvbik7CiAgICAgICAgICAgICAgYnVsbGV0LnkgPSB0b3BMZWZ0LnkgLSBwbGF5ZXIuc2hpcC5oZWlnaHQgLyA0ICogTWF0aC5zaW4ocGxheWVyLnNoaXAucm90YXRpb24pOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIGJ1bGxldC54ID0gY2VudGVyTGVmdC54IC0gcGxheWVyLnNoaXAud2lkdGggLyA0ICogTWF0aC5jb3MocGxheWVyLnNoaXAucm90YXRpb24pOwogICAgICAgICAgICAgIGJ1bGxldC55ID0gY2VudGVyTGVmdC55IC0gcGxheWVyLnNoaXAuaGVpZ2h0IC8gNCAqIE1hdGguc2luKHBsYXllci5zaGlwLnJvdGF0aW9uKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgaWYgKHBsYXllci5sb2NhbElkICE9PSBfdGhpczMuY3VycmVudFBsYXllcikgewogICAgICAgICAgcGxheWVyLnNoaXAuYXV0b25vbXlUaW1lIC09IGRlbHRhOwoKICAgICAgICAgIGlmIChwbGF5ZXIuc2hpcC5hdXRvbm9teVRpbWUgPCAwKSB7CiAgICAgICAgICAgIHBsYXllci5zaGlwLnNldFZlbG9jaXR5KDApOwogICAgICAgICAgICBwbGF5ZXIuc2hpcC5zZXRBbmd1bGFyVmVsb2NpdHkoMCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsgLy9pZih0aGlzLnNoaXBzLmNvdW50QWN0aXZlKCkgPD0gMSkgY29uc29sZS5sb2coImdhbWUgb3ZlciIpIC8vVE9ETzogU0VUVVAgRU5EIE9GIFRIRSBUVVJOCiAgICB9IC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vQ3JlYXRpbmcgdGhpbmdzCgogIH0sIHsKICAgIGtleTogImNyZWF0ZUdyb3VwcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlR3JvdXBzKCkgewogICAgICB0aGlzLnNoaXBzID0gdGhpcy5waHlzaWNzLmFkZC5ncm91cCgpOwogICAgICB0aGlzLmJ1bGxldHMgPSB0aGlzLnBoeXNpY3MuYWRkLmdyb3VwKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY3JlYXRlU2hpcHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZVNoaXBzKCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIHZhciBpbmRleCA9IDA7CiAgICAgIE9iamVjdC52YWx1ZXModGhpcy5wbGF5ZXJzKS5mb3JFYWNoKGZ1bmN0aW9uIChwbGF5ZXIpIHsKICAgICAgICBwbGF5ZXIuc2hpcCA9IF90aGlzNC5zaGlwcy5jcmVhdGUoKGluZGV4IDwgMiA/IDAuMDUgOiAwLjk1KSAqIGdhbWVEaW1lbnNpb25zLndpZHRoLCAoaW5kZXggJSAyID09PSAwID8gMC4wNSA6IDAuOTUpICogZ2FtZURpbWVuc2lvbnMuaGVpZ2h0LCAic2hpcCIgKyBwbGF5ZXIuY29sb3IpOwogICAgICAgIHBsYXllci5idWxsZXRzTG9hZGVkID0gX3RoaXM0LnBoeXNpY3MuYWRkLmdyb3VwKHsKICAgICAgICAgIGNvbGxpZGVXb3JsZEJvdW5kczogZmFsc2UsCiAgICAgICAgICBrZXk6ICJidWxsZXQtbG9hZGVkIiwKICAgICAgICAgIHF1YW50aXR5OiAzLAogICAgICAgICAgdmlzaWJsZTogdHJ1ZSwKICAgICAgICAgIGFjdGl2ZTogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIHBsYXllci5zaGlwLmxvY2FsSWQgPSBwbGF5ZXIubG9jYWxJZDsKICAgICAgICBwbGF5ZXIuc2hpcC5zZXRBbmdsZSgtNDUgKiAoaW5kZXggPCAyID8gMSA6IDMpICogKGluZGV4ICUgMiAqIDIgLSAxKSk7CiAgICAgICAgcGxheWVyLnNoaXAudmVsb2NpdHlNYWduaXR1ZGUgPSBfdGhpczQuc2V0dGluZ3MudmVsb2NpdHkgKiBub3JtYWxpemVycy52ZWxvY2l0eTsKICAgICAgICBwbGF5ZXIuc2hpcC5hdXRvbm9teVRpbWUgPSAwOwoKICAgICAgICBpZiAocGxheWVyLmxvY2FsSWQgPT09IF90aGlzNC5jdXJyZW50UGxheWVyKSB7CiAgICAgICAgICBwbGF5ZXIuc2hpcC5zZXRDb2xsaWRlV29ybGRCb3VuZHModHJ1ZSk7CgogICAgICAgICAgX3RoaXM0LnBoeXNpY3MuYWRkLm92ZXJsYXAocGxheWVyLnNoaXAsIF90aGlzNC5idWxsZXRzLCBmdW5jdGlvbiAoc2hpcCwgYnVsbGV0KSB7CiAgICAgICAgICAgIF90aGlzNC5vbkJ1bGxldENvbGxpc2lvbihzaGlwLCBidWxsZXQpOwogICAgICAgICAgfSk7CgogICAgICAgICAgX3RoaXM0LnBoeXNpY3MuYWRkLmNvbGxpZGVyKHBsYXllci5zaGlwLCBfdGhpczQuc2hpcHMsIGZ1bmN0aW9uIChjdXJyZW50U2hpcCwgc2hpcCkgewogICAgICAgICAgICBpZiAoX3RoaXM0LnBsYXllcnNbX3RoaXM0LmN1cnJlbnRQbGF5ZXJdLnN0YXRlID09PSAxICYmIF90aGlzNC5wbGF5ZXJzW3NoaXAubG9jYWxJZF0uc3RhdGUgPj0gMikgewogICAgICAgICAgICAgIF90aGlzNC5raWxsZWRCeSA9IHNoaXAubG9jYWxJZDsKICAgICAgICAgICAgICB2YXIgZGF0YSA9IHsKICAgICAgICAgICAgICAgIGxvY2FsSWQ6IF90aGlzNC5jdXJyZW50UGxheWVyLAogICAgICAgICAgICAgICAgc3RhdGU6IDAKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBfdGhpczQuc29ja2V0LmVtaXQod2Vic29ja2V0RXZlbnRzLkNIQU5HRV9TVEFURSwgZGF0YSk7CgogICAgICAgICAgICAgIF90aGlzNC51cGRhdGVTdGF0ZShkYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpbmRleCsrOwogICAgICB9KTsKICAgICAgdGhpcy5waHlzaWNzLmFkZC5jb2xsaWRlcih0aGlzLnNoaXBzLCB0aGlzLnNoaXBzKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjcmVhdGVCdWxsZXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZUJ1bGxldChkYXRhKSB7CiAgICAgIHZhciBfdGhpcyRwaHlzaWNzJHZlbG9jaXQyID0gdGhpcy5waHlzaWNzLnZlbG9jaXR5RnJvbUFuZ2xlKGRhdGEuYW5nbGUsIHRoaXMuc2V0dGluZ3MuYnVsbGV0VmVsb2NpdHkgKiBub3JtYWxpemVycy5idWxsZXRWZWxvY2l0eSksCiAgICAgICAgICB4ID0gX3RoaXMkcGh5c2ljcyR2ZWxvY2l0Mi54LAogICAgICAgICAgeSA9IF90aGlzJHBoeXNpY3MkdmVsb2NpdDIueTsKCiAgICAgIHZhciBkZWx0YVRpbWUgPSBEYXRlLm5vdygpIC0gZGF0YS50aW1lc3RhbXA7CiAgICAgIHZhciBidWxsZXQgPSB0aGlzLmJ1bGxldHMuY3JlYXRlKGRhdGEucG9zaXRpb24ueCArIGRlbHRhVGltZSAqIHggLyAxMDAwLCBkYXRhLnBvc2l0aW9uLnkgKyBkZWx0YVRpbWUgKiB5IC8gMTAwMCwgImJ1bGxldCIpOwogICAgICBidWxsZXQuYW5nbGUgPSBkYXRhLmFuZ2xlOwogICAgICBidWxsZXQuc2V0VmVsb2NpdHkoeCwgeSk7CiAgICAgIGJ1bGxldC5zaG90QnkgPSBkYXRhLmxvY2FsSWQ7CiAgICAgIGJ1bGxldC5zZXRDb2xsaWRlV29ybGRCb3VuZHModHJ1ZSk7CiAgICAgIGJ1bGxldC5ib2R5Lm9uV29ybGRCb3VuZHMgPSB0cnVlOwogICAgICB0aGlzLnBsYXllcnNbZGF0YS5sb2NhbElkXS5hdmFpbGFibGVCdWxsZXRzLS07CiAgICAgIHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmJ1bGxldHNMb2FkZWQuZ2V0Rmlyc3RBbGl2ZSgpLnNldEFjdGl2ZShmYWxzZSkuc2V0VmlzaWJsZShmYWxzZSk7CiAgICB9IC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vT3RoZXJzIGRvIHRoaW5ncyB2aWEgdGhlIHdlYnNvY2tldAoKICB9LCB7CiAgICBrZXk6ICJ1cGRhdGVTaGlwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVTaGlwKGRhdGEpIHsKICAgICAgdmFyIHBsYXllciA9IHRoaXMucGxheWVyc1tkYXRhWzBdXTsKICAgICAgdmFyIGRlbHRhVGltZSA9IChkYXRhWzNdIC0gcGxheWVyLmxhc3RUaW1lc3RhbXApIC8gMTAwMDsKICAgICAgaWYgKGRlbHRhVGltZSA8PSAwKSByZXR1cm47CiAgICAgIHZhciBkZWx0YVRoZXRhID0gZGF0YVsxXSAtIE51bWJlci5wYXJzZUludChwbGF5ZXIuc2hpcC5hbmdsZSk7CiAgICAgIGlmIChkZWx0YVRoZXRhIDwgLTEwKSBkZWx0YVRoZXRhICs9IDM2MDtlbHNlIGlmIChkZWx0YVRoZXRhIDwgMCkgZGVsdGFUaGV0YSA9IDA7CiAgICAgIHZhciBhbmd1bGFyVmVsb2NpdHkgPSBkZWx0YVRoZXRhIC8gZGVsdGFUaW1lOwogICAgICBwbGF5ZXIuc2hpcC5zZXRBbmd1bGFyVmVsb2NpdHkoYW5ndWxhclZlbG9jaXR5KTsKICAgICAgcGxheWVyLnNoaXAuc2V0VmVsb2NpdHkoKGRhdGFbMl1bMF0gLSBwbGF5ZXIuc2hpcC54KSAvIGRlbHRhVGltZSwgKGRhdGFbMl1bMV0gLSBwbGF5ZXIuc2hpcC55KSAvIGRlbHRhVGltZSk7CiAgICAgIHBsYXllci5sYXN0VGltZXN0YW1wID0gZGF0YVszXTsKICAgICAgcGxheWVyLnNoaXAuYXV0b25vbXlUaW1lID0gZGVsdGFUaW1lICogMTAwMDsKICAgIH0gLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy9DdXJyZW50IHBsYXllcnMgZG9lcyB0aGluZ3MKCiAgfSwgewogICAga2V5OiAicm90YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByb3RhdGUoZGVsdGEpIHsKICAgICAgdGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc2hpcC5hbmdsZSArPSBkZWx0YSAqIHRoaXMuc2V0dGluZ3MuYW5ndWxhclZlbG9jaXR5ICogbm9ybWFsaXplcnMuYW5ndWxhclZlbG9jaXR5OwogICAgfQogIH0sIHsKICAgIGtleTogIm1vdmVMaXR0bGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG1vdmVMaXR0bGUoZGVsdGEpIHsKICAgICAgaWYgKHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdLnN0YXRlID09PSAxKSB7CiAgICAgICAgdmFyIHNoaXAgPSB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwOwogICAgICAgIHZhciBwcmV2aW91c01hZyA9IHNoaXAudmVsb2NpdHlNYWduaXR1ZGU7CgogICAgICAgIGlmIChwcmV2aW91c01hZyA8IHRoaXMuc2V0dGluZ3MubWF4VmVsb2NpdHlMaXR0bGUgKiBub3JtYWxpemVycy52ZWxvY2l0eSkgewogICAgICAgICAgdGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc2hpcC52ZWxvY2l0eU1hZ25pdHVkZSArPSBkZWx0YSAqIHRoaXMuc2V0dGluZ3MuYWNjZWxlcmF0aW9uTGl0dGxlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwLnZlbG9jaXR5TWFnbml0dWRlID0gdGhpcy5zZXR0aW5ncy5tYXhWZWxvY2l0eUxpdHRsZSAqIG5vcm1hbGl6ZXJzLnZlbG9jaXR5OwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogInNob290IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzaG9vdCgpIHsKICAgICAgaWYgKHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdLmF2YWlsYWJsZUJ1bGxldHMgPiAwKSB7CiAgICAgICAgdmFyIHNoaXAgPSB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwOwogICAgICAgIHZhciBhbmdsZSA9IHNoaXAuYW5nbGU7CiAgICAgICAgdmFyIGRhdGEgPSB7CiAgICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgICB4OiBzaGlwLnggKyBzaGlwLndpZHRoICogTWF0aC5jb3MoYW5nbGUgKiBNYXRoLlBJIC8gMTgwKSwKICAgICAgICAgICAgeTogc2hpcC55ICsgc2hpcC53aWR0aCAqIE1hdGguc2luKGFuZ2xlICogTWF0aC5QSSAvIDE4MCkKICAgICAgICAgIH0sCiAgICAgICAgICBhbmdsZTogYW5nbGUsCiAgICAgICAgICBsb2NhbElkOiB0aGlzLmN1cnJlbnRQbGF5ZXIsCiAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCkKICAgICAgICB9OwogICAgICAgIHRoaXMuc29ja2V0LmVtaXQod2Vic29ja2V0RXZlbnRzLlNIT09ULCBkYXRhKTsKICAgICAgICB0aGlzLmNyZWF0ZUJ1bGxldChkYXRhKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogInVwZGF0ZVN0YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVTdGF0ZShkYXRhKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uc3RhdGUgPSBkYXRhLnN0YXRlOwogICAgICB2YXIgc2hpcCA9IHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLnNoaXA7CgogICAgICBzd2l0Y2ggKGRhdGEuc3RhdGUpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICB0aGlzLnNoaXBzLmtpbGxBbmRIaWRlKHNoaXApOwogICAgICAgICAgdGhpcy5zaGlwcy5yZW1vdmUoc2hpcCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAxOgogICAgICAgICAgc2hpcC5zZXRUZXh0dXJlKCJsaXR0bGUiICsgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uY29sb3IpOwoKICAgICAgICAgIGlmIChkYXRhLmxvY2FsSWQgPT09IHRoaXMuY3VycmVudFBsYXllcikgewogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBpZiAoX3RoaXM1LnBsYXllcnNbZGF0YS5sb2NhbElkXS5zdGF0ZSA9PT0gMSkgewogICAgICAgICAgICAgICAgdmFyIF9kYXRhID0gewogICAgICAgICAgICAgICAgICBsb2NhbElkOiBfdGhpczUuY3VycmVudFBsYXllciwKICAgICAgICAgICAgICAgICAgc3RhdGU6IDIKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgX3RoaXM1LnVwZGF0ZVN0YXRlKF9kYXRhKTsKCiAgICAgICAgICAgICAgICBfdGhpczUuc29ja2V0LmVtaXQod2Vic29ja2V0RXZlbnRzLkNIQU5HRV9TVEFURSwgX2RhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgdGhpcy5zZXR0aW5ncy5yZXNwYXduVGltZSk7CiAgICAgICAgICB9CgogICAgICAgICAgd2hpbGUgKHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmJ1bGxldHNMb2FkZWQuY291bnRBY3RpdmUoKSA+IDApIHsKICAgICAgICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uYnVsbGV0c0xvYWRlZC5nZXRGaXJzdEFsaXZlKCkuc2V0QWN0aXZlKGZhbHNlKS5zZXRWaXNpYmxlKGZhbHNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAyOgogICAgICAgICAgc2hpcC52ZWxvY2l0eU1hZ25pdHVkZSA9IHRoaXMuc2V0dGluZ3MudmVsb2NpdHkgKiBub3JtYWxpemVycy52ZWxvY2l0eTsKICAgICAgICAgIHNoaXAuc2V0VGV4dHVyZSgic2hpcCIgKyB0aGlzLnBsYXllcnNbZGF0YS5sb2NhbElkXS5jb2xvcik7CgogICAgICAgICAgd2hpbGUgKHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmJ1bGxldHNMb2FkZWQuY291bnRBY3RpdmUoKSA8IDMpIHsKICAgICAgICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uYnVsbGV0c0xvYWRlZC5nZXRGaXJzdERlYWQoKS5zZXRBY3RpdmUodHJ1ZSkuc2V0VmlzaWJsZSh0cnVlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogIm9uQnVsbGV0Q29sbGlzaW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvbkJ1bGxldENvbGxpc2lvbihzaGlwLCBidWxsZXQpIHsKICAgICAgYnVsbGV0LmRlc3Ryb3koKTsKICAgICAgdmFyIHN0YXRlID0gdGhpcy5wbGF5ZXJzW3NoaXAubG9jYWxJZF0uc3RhdGUgLSAxOwogICAgICB2YXIgZGF0YSA9IHsKICAgICAgICBsb2NhbElkOiBzaGlwLmxvY2FsSWQsCiAgICAgICAgc3RhdGU6IHN0YXRlCiAgICAgIH07CgogICAgICBpZiAoc3RhdGUgPT09IDApIHsKICAgICAgICBkYXRhLmtpbGxlZEJ5ID0gYnVsbGV0LnNob3RCeTsKICAgICAgICBjbGVhckludGVydmFsKHRoaXMucmVsb2FkSW50ZXJ2YWwpOwogICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy51cGRhdGVTaGlwSW50ZXJ2YWwpOwogICAgICB9CgogICAgICB0aGlzLnNvY2tldC5lbWl0KHdlYnNvY2tldEV2ZW50cy5DSEFOR0VfU1RBVEUsIGRhdGEpOwogICAgICB0aGlzLnVwZGF0ZVN0YXRlKGRhdGEpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbG9hZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVsb2FkKGRhdGEpIHsKICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uYXZhaWxhYmxlQnVsbGV0cyA9IGRhdGEuYXZhaWxhYmxlQnVsbGV0czsKCiAgICAgIHRyeSB7CiAgICAgICAgd2hpbGUgKHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmJ1bGxldHNMb2FkZWQuY291bnRBY3RpdmUoKSA8IGRhdGEuYXZhaWxhYmxlQnVsbGV0cykgewogICAgICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uYnVsbGV0c0xvYWRlZC5nZXRGaXJzdERlYWQoKS5zZXRBY3RpdmUodHJ1ZSkuc2V0VmlzaWJsZSh0cnVlKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgICB9CiAgICB9IC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vT24gY3JlYXRlIHNldHVwCgogIH0sIHsKICAgIGtleTogInNldEtleUlucHV0SGFuZGxlcnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldEtleUlucHV0SGFuZGxlcnMoKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgdGhpcy5yb3RhdGlvbktleSA9IHRoaXMuaW5wdXQua2V5Ym9hcmQuYWRkS2V5KFBoYXNlci5JbnB1dC5LZXlib2FyZC5LZXlDb2Rlcy5TUEFDRSk7CiAgICAgIHRoaXMuYWNjZWxlcmF0ZUxpdHRsZUtleSA9IHRoaXMuaW5wdXQua2V5Ym9hcmQuYWRkS2V5KFBoYXNlci5JbnB1dC5LZXlib2FyZC5LZXlDb2Rlcy5FTlRFUik7CiAgICAgIHRoaXMuaW5wdXQua2V5Ym9hcmQub24oImtleWRvd24tRU5URVIiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKF90aGlzNi5wbGF5ZXJzW190aGlzNi5jdXJyZW50UGxheWVyXS5zdGF0ZSA+PSAyKSBfdGhpczYuc2hvb3QoKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0VG91Y2hJbnB1dEhhbmRsZXJzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRUb3VjaElucHV0SGFuZGxlcnMoKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwoKICAgICAgdGhpcy5pbnB1dC5hZGRQb2ludGVyKDEpOwogICAgICB0aGlzLmlucHV0Lm9uKCJwb2ludGVydXAiLCBmdW5jdGlvbiAocG9pbnRlcikgewogICAgICAgIGlmIChwb2ludGVyLnggPCBnYW1lRGltZW5zaW9ucy53aWR0aCAvIDIpIHsKICAgICAgICAgIF90aGlzNy5yb3RhdGluZyA9IGZhbHNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBfdGhpczcuYWNjZWxlcmF0aW5nID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5pbnB1dC5vbigicG9pbnRlcmRvd24iLCBmdW5jdGlvbiAocG9pbnRlcikgewogICAgICAgIGlmIChwb2ludGVyLnggPCBnYW1lRGltZW5zaW9ucy53aWR0aCAvIDIpIHsKICAgICAgICAgIF90aGlzNy5yb3RhdGluZyA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChfdGhpczcucGxheWVyc1tfdGhpczcuY3VycmVudFBsYXllcl0uc3RhdGUgPj0gMikgX3RoaXM3LnNob290KCk7ZWxzZSB7CiAgICAgICAgICAgIF90aGlzNy5hY2NlbGVyYXRpbmcgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gR2FtZVNjZW5lOwp9KFBoYXNlci5TY2VuZSk7CgpleHBvcnQgeyBHYW1lU2NlbmUgYXMgZGVmYXVsdCB9Ow=="},{"version":3,"sources":["/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/GameScene.js"],"names":["Phaser","websocketEvents","gameDimensions","normalizers","sceneKeys","detectTouchScreen","GameScene","socket","game","key","settings","currentPlayer","maxVelocityLittle","velocity","accelerationLittle","respawnTime","frictionAir","players","forEach","player","localId","availableBullets","lastTimestamp","updateFps","touchScreen","load","image","createGroups","createShips","on","UPDATE_SHIP","data","updateShip","SHOOT","createBullet","CHANGE_STATE","updateState","RELOAD","reload","setKeyInputHandlers","physics","world","bullet","gameObject","destroy","setTouchInputHandlers","reloadInterval","setInterval","Math","min","emit","reloadingVelocity","updateShipInterval","Number","parseInt","ship","angle","parseFloat","x","toFixed","y","time","now","delta","rotationKey","isDown","rotating","rotate","accelerateLittleKey","accelerating","moveLittle","velocityFromAngle","velocityMagnitude","setVelocity","state","max","Object","values","bulletsLoaded","children","iterate","index","topLeft","getTopLeft","bottomLeft","getBottomLeft","centerLeft","width","cos","rotation","height","sin","autonomyTime","setAngularVelocity","ships","add","group","bullets","create","color","collideWorldBounds","quantity","visible","active","setAngle","setCollideWorldBounds","overlap","onBulletCollision","collider","currentShip","killedBy","bulletVelocity","deltaTime","Date","timestamp","position","shotBy","body","onWorldBounds","getFirstAlive","setActive","setVisible","deltaTheta","angularVelocity","previousMag","PI","killAndHide","remove","setTexture","setTimeout","countActive","getFirstDead","clearInterval","e","console","error","input","keyboard","addKey","Input","Keyboard","KeyCodes","SPACE","ENTER","shoot","addPointer","pointer","Scene"],"mappings":"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","sourcesContent":["import * as Phaser from \"phaser\";\nimport websocketEvents from \"../constants/websocketEvents\";\nimport {gameDimensions, normalizers, sceneKeys} from \"../constants/gameSettings\";\nimport {detectTouchScreen} from \"../constants/constants\";\n\n\nexport default class GameScene extends Phaser.Scene {\n\n    constructor(socket, game) {\n        super({key: sceneKeys.game});\n\n        this.socket = socket;\n        this.settings = game.settings;\n        this.currentPlayer = game.currentPlayer;\n        this.settings.maxVelocityLittle = game.settings.velocity+0.2;\n        this.settings.accelerationLittle = 0.4;\n        this.settings.respawnTime = 5000;\n        this.settings.frictionAir = 0.1;\n        this.players = {};\n        game.players.forEach(player => {\n            this.players[player.localId] = player;\n            this.players[player.localId].availableBullets = 3;\n            this.players[player.localId].lastTimestamp = 0;\n        });\n\n        this.updateFps = 15;\n        this.touchScreen = detectTouchScreen();\n    }\n\n    preload(){\n\n        this.load.image(\"ship0\", \"./ships/ship0.png\");\n        this.load.image(\"ship1\", \"./ships/ship1.png\");\n        this.load.image(\"ship2\", \"./ships/ship2.png\");\n        this.load.image(\"ship3\", \"./ships/ship3.png\");\n        this.load.image(\"little0\", \"./little.png\");\n        this.load.image(\"little1\", \"./little.png\");\n        this.load.image(\"little2\", \"./little.png\");\n        this.load.image(\"little3\", \"./little.png\");\n        this.load.image(\"bullet\", \"./bullet.png\");\n        this.load.image(\"bullet-loaded\", \"./bullet-loaded.png\");\n\n    }\n\n    create(){\n        this.createGroups();\n        this.createShips();\n\n        this.socket.on(websocketEvents.UPDATE_SHIP, data => this.updateShip(data));\n        this.socket.on(websocketEvents.SHOOT, data => this.createBullet(data));\n        this.socket.on(websocketEvents.CHANGE_STATE, data => this.updateState(data));\n        this.socket.on(websocketEvents.RELOAD, data => this.reload(data));\n\n        this.setKeyInputHandlers();\n\n        this.physics.world.on(\"worldbounds\", (bullet)=>{bullet.gameObject.destroy()});\n\n        if(this.touchScreen) this.setTouchInputHandlers();\n\n        this.reloadInterval = setInterval(() => {\n            const availableBullets = Math.min(3, this.players[this.currentPlayer].availableBullets + 1);\n            const data = {\n                localId: this.currentPlayer,\n                availableBullets\n            };\n            this.socket.emit(websocketEvents.RELOAD, data);\n            this.reload(data);\n        }, 1/(this.settings.reloadingVelocity * normalizers.reloadingVelocity));\n\n\n        this.updateShipInterval = setInterval(()=>{\n            this.socket.emit(websocketEvents.UPDATE_SHIP, [\n                this.currentPlayer,\n                Number.parseInt(this.players[this.currentPlayer].ship.angle),\n                [\n                    Number.parseFloat(this.players[this.currentPlayer].ship.x.toFixed(2)),\n                    Number.parseFloat(this.players[this.currentPlayer].ship.y.toFixed(2))\n                ],\n                this.time.now\n            ]);\n        }, 1000/this.updateFps);\n    }\n\n    update(time, delta){\n        if(this.rotationKey.isDown || this.rotating) this.rotate(delta);\n        if(this.accelerateLittleKey.isDown || this.accelerating) this.moveLittle(delta);\n        const {x, y} = this.physics.velocityFromAngle(\n            this.players[this.currentPlayer].ship.angle,\n            this.players[this.currentPlayer].ship.velocityMagnitude\n        );\n        this.players[this.currentPlayer].ship.setVelocity(x, y);\n        if (this.players[this.currentPlayer].state === 1) {\n            this.players[this.currentPlayer].ship.velocityMagnitude = Math.max(\n                0, this.players[this.currentPlayer].ship.velocityMagnitude - this.settings.frictionAir * delta\n            );\n        }\n        Object.values(this.players).forEach(player => {\n            player.bulletsLoaded.children.iterate((bullet, index)=>{\n                const topLeft = player.ship.getTopLeft();\n                const bottomLeft = player.ship.getBottomLeft();\n                const centerLeft = {\n                    x: (topLeft.x + bottomLeft.x) /2,\n                    y: (topLeft.y + bottomLeft.y) /2\n                }\n                switch (index){\n                    case 0:\n                        bullet.x = bottomLeft.x - (player.ship.width/4)*Math.cos(player.ship.rotation);\n                        bullet.y = bottomLeft.y - (player.ship.height/4)*Math.sin(player.ship.rotation);\n                        break;\n                    case 1:\n                        bullet.x = topLeft.x - (player.ship.width/4)*Math.cos(player.ship.rotation);\n                        bullet.y = topLeft.y - (player.ship.height/4)*Math.sin(player.ship.rotation);\n                        break;\n                    case 2:\n                        bullet.x = centerLeft.x - (player.ship.width/4)*Math.cos(player.ship.rotation);\n                        bullet.y = centerLeft.y - (player.ship.height/4)*Math.sin(player.ship.rotation);\n                        break;\n                }\n            });\n           if(player.localId!==this.currentPlayer){\n               player.ship.autonomyTime -= delta;\n               if(player.ship.autonomyTime<0) {\n                   player.ship.setVelocity(0);\n                   player.ship.setAngularVelocity(0);\n               }\n           }\n        });\n        //if(this.ships.countActive() <= 1) console.log(\"game over\") //TODO: SETUP END OF THE TURN\n    }\n\n\n\n\n    //=============================================================================\n    //Creating things\n    createGroups(){\n        this.ships = this.physics.add.group();\n        this.bullets = this.physics.add.group();\n    }\n\n    createShips(){\n        let index = 0;\n        Object.values(this.players).forEach(player => {\n            player.ship = this.ships.create(\n                (index<2 ? 0.05 : 0.95) * gameDimensions.width,\n                ( index%2 === 0 ? 0.05 : 0.95 ) * gameDimensions.height,\n                \"ship\"+player.color\n            );\n\n            player.bulletsLoaded = this.physics.add.group({\n                collideWorldBounds: false,\n                key: \"bullet-loaded\",\n                quantity: 3,\n                visible: true,\n                active: true\n            });\n\n            player.ship.localId = player.localId;\n            player.ship.setAngle(-45  * ( index < 2 ? 1 : 3) * ( ( index % 2 ) * 2 - 1 ));\n            player.ship.velocityMagnitude = this.settings.velocity*normalizers.velocity;\n            player.ship.autonomyTime = 0;\n\n            if(player.localId===this.currentPlayer){\n                player.ship.setCollideWorldBounds(true);\n                this.physics.add.overlap(player.ship, this.bullets, (ship, bullet) => {\n                    this.onBulletCollision(ship, bullet);\n                });\n                this.physics.add.collider(player.ship, this.ships, (currentShip, ship)=>{\n                    if(this.players[this.currentPlayer].state === 1 && this.players[ship.localId].state >= 2){\n                        this.killedBy = ship.localId;\n                        const data = {\n                            localId: this.currentPlayer,\n                            state: 0\n                        };\n                        this.socket.emit(websocketEvents.CHANGE_STATE, data);\n                        this.updateState(data);\n                    }\n                });\n            }\n\n            index++;\n        });\n\n        this.physics.add.collider(this.ships, this.ships);\n    }\n\n    createBullet(data){\n        const {x, y} = this.physics.velocityFromAngle(data.angle, this.settings.bulletVelocity*normalizers.bulletVelocity);\n        const deltaTime = Date.now()-data.timestamp;\n        const bullet = this.bullets.create(data.position.x+deltaTime*x/1000, data.position.y+deltaTime*y/1000, \"bullet\");\n        bullet.angle = data.angle;\n        bullet.setVelocity(x, y);\n        bullet.shotBy = data.localId;\n        bullet.setCollideWorldBounds(true);\n        bullet.body.onWorldBounds = true;\n        this.players[data.localId].availableBullets--;\n        this.players[data.localId].bulletsLoaded.getFirstAlive().setActive(false).setVisible(false);\n    }\n\n\n\n\n\n\n    //=============================================================================\n    //Others do things via the websocket\n    updateShip(data){\n        const player = this.players[data[0]];\n        const deltaTime = (data[3]-player.lastTimestamp)/1000;\n        if(deltaTime<=0) return;\n\n        let deltaTheta = data[1] - Number.parseInt(player.ship.angle);\n\n        if(deltaTheta < -10) deltaTheta += 360;\n        else if(deltaTheta < 0) deltaTheta = 0;\n        const angularVelocity = deltaTheta / deltaTime;\n        player.ship.setAngularVelocity(angularVelocity);\n\n        player.ship.setVelocity( ( data[2][0]-player.ship.x ) / deltaTime, ( data[2][1]-player.ship.y ) / deltaTime );\n\n        player.lastTimestamp = data[3];\n        player.ship.autonomyTime = deltaTime*1000;\n    }\n\n\n\n    //=============================================================================\n    //Current players does things\n    rotate(delta){\n        this.players[this.currentPlayer].ship.angle += delta * this.settings.angularVelocity * normalizers.angularVelocity;\n    }\n\n    moveLittle(delta){\n        if(this.players[this.currentPlayer].state === 1){\n            const ship = this.players[this.currentPlayer].ship;\n            const previousMag = ship.velocityMagnitude;\n            if(previousMag < this.settings.maxVelocityLittle * normalizers.velocity){\n                this.players[this.currentPlayer].ship.velocityMagnitude += delta*this.settings.accelerationLittle;\n            } else {\n                this.players[this.currentPlayer].ship.velocityMagnitude = this.settings.maxVelocityLittle * normalizers.velocity;\n            }\n        }\n    }\n\n    shoot(){\n        if(this.players[this.currentPlayer].availableBullets>0){\n            const ship = this.players[this.currentPlayer].ship;\n            const angle = ship.angle;\n            const data = {\n                position: {\n                    x: ship.x + ship.width*Math.cos(angle * Math.PI / 180),\n                    y: ship.y + ship.width*Math.sin(angle * Math.PI / 180)\n                },\n                angle: angle,\n                localId: this.currentPlayer,\n                timestamp: Date.now()\n            };\n            this.socket.emit(websocketEvents.SHOOT, data);\n            this.createBullet(data);\n        }\n    }\n\n\n    updateState(data){\n        this.players[data.localId].state = data.state;\n        const ship = this.players[data.localId].ship;\n        switch (data.state) {\n            case 0:\n                this.ships.killAndHide(ship);\n                this.ships.remove(ship);\n                break;\n            case 1:\n                ship.setTexture(\"little\" + this.players[data.localId].color);\n                if(data.localId === this.currentPlayer) {\n                    setTimeout(() => {\n                        if (this.players[data.localId].state === 1) {\n                            const data = {\n                                localId: this.currentPlayer,\n                                state: 2\n                            };\n                            this.updateState(data);\n                            this.socket.emit(websocketEvents.CHANGE_STATE, data);\n                        }\n                    }, this.settings.respawnTime);\n                }\n                while(this.players[data.localId].bulletsLoaded.countActive()>0) {\n                    this.players[data.localId].bulletsLoaded.getFirstAlive().setActive(false).setVisible(false);\n                }\n                break;\n            case 2:\n                ship.velocityMagnitude = this.settings.velocity * normalizers.velocity;\n                ship.setTexture(\"ship\" + this.players[data.localId].color);\n                while(this.players[data.localId].bulletsLoaded.countActive()<3) {\n                    this.players[data.localId].bulletsLoaded.getFirstDead().setActive(true).setVisible(true);\n                }\n                break;\n        }\n    }\n\n    onBulletCollision(ship, bullet){\n        bullet.destroy();\n        const state = this.players[ship.localId].state-1;\n        const data = {\n            localId: ship.localId,\n            state\n        };\n        if(state === 0) {\n            data.killedBy = bullet.shotBy;\n            clearInterval(this.reloadInterval);\n            clearInterval(this.updateShipInterval);\n        }\n        this.socket.emit(websocketEvents.CHANGE_STATE, data);\n        this.updateState(data);\n    }\n\n\n    reload(data){\n        this.players[data.localId].availableBullets = data.availableBullets;\n        try{\n            while(this.players[data.localId].bulletsLoaded.countActive() < data.availableBullets){\n                this.players[data.localId].bulletsLoaded.getFirstDead().setActive(true).setVisible(true);\n            }\n        } catch (e) {\n            console.error(e);\n        }\n    }\n\n\n\n    //=============================================================================\n    //On create setup\n\n    setKeyInputHandlers(){\n        this.rotationKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);\n        this.accelerateLittleKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ENTER);\n        this.input.keyboard.on(\"keydown-ENTER\", ()=>{\n            if(this.players[this.currentPlayer].state>=2) this.shoot();\n        });\n    }\n\n    setTouchInputHandlers(){\n        this.input.addPointer(1);\n        this.input.on(\"pointerup\", (pointer) => {\n            if(pointer.x<gameDimensions.width/2){\n                this.rotating = false;\n            } else {\n                this.accelerating = false;\n            }\n        });\n        this.input.on(\"pointerdown\", (pointer) => {\n            if(pointer.x<gameDimensions.width/2){\n                this.rotating = true;\n            } else {\n                if(this.players[this.currentPlayer].state>=2) this.shoot();\n                else {\n                    this.accelerating = true;\n                }\n            }\n        });\n    }\n}"]}]}