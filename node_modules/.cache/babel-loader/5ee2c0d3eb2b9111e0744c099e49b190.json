{"remainingRequest":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/thread-loader/dist/cjs.js!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/babel-loader/lib/index.js!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/eslint-loader/index.js??ref--13-0!/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/GameScene.js","dependencies":[{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/GameScene.js","mtime":1617784231291},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/cache-loader/dist/cjs.js","mtime":1616495189815},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/thread-loader/dist/cjs.js","mtime":1616495190967},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/babel-loader/lib/index.js","mtime":1616495189787},{"path":"/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/node_modules/eslint-loader/index.js","mtime":1616495190059}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICIvbWVkaWEvamFjb3BvL1ZvbHVtZURhdGkvRG9jdW1lbnRpL3BhcGVyby50ay9jb3Ntb3MucGFwZXJvLm1lL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiL21lZGlhL2phY29wby9Wb2x1bWVEYXRpL0RvY3VtZW50aS9wYXBlcm8udGsvY29zbW9zLnBhcGVyby5tZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgX2luaGVyaXRzIGZyb20gIi9tZWRpYS9qYWNvcG8vVm9sdW1lRGF0aS9Eb2N1bWVudGkvcGFwZXJvLnRrL2Nvc21vcy5wYXBlcm8ubWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2luaGVyaXRzIjsKaW1wb3J0IF9jcmVhdGVTdXBlciBmcm9tICIvbWVkaWEvamFjb3BvL1ZvbHVtZURhdGkvRG9jdW1lbnRpL3BhcGVyby50ay9jb3Ntb3MucGFwZXJvLm1lL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVTdXBlciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudmFsdWVzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLnBhcnNlLWludC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci5jb25zdHJ1Y3Rvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci5wYXJzZS1mbG9hdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci50by1maXhlZC5qcyI7CmltcG9ydCAqIGFzIFBoYXNlciBmcm9tICJwaGFzZXIiOwppbXBvcnQgd2Vic29ja2V0RXZlbnRzIGZyb20gIi4uL2NvbnN0YW50cy93ZWJzb2NrZXRFdmVudHMiOwppbXBvcnQgeyBnYW1lRGltZW5zaW9ucywgbm9ybWFsaXplcnMsIHNjZW5lS2V5cyB9IGZyb20gIi4uL2NvbnN0YW50cy9nYW1lU2V0dGluZ3MiOwppbXBvcnQgeyBkZXRlY3RUb3VjaFNjcmVlbiB9IGZyb20gIi4uL2NvbnN0YW50cy9jb25zdGFudHMiOwoKdmFyIEdhbWVTY2VuZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX1BoYXNlciRTY2VuZSkgewogIF9pbmhlcml0cyhHYW1lU2NlbmUsIF9QaGFzZXIkU2NlbmUpOwoKICB2YXIgX3N1cGVyID0gX2NyZWF0ZVN1cGVyKEdhbWVTY2VuZSk7CgogIGZ1bmN0aW9uIEdhbWVTY2VuZShzb2NrZXQsIGdhbWUpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgR2FtZVNjZW5lKTsKCiAgICBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHsKICAgICAga2V5OiBzY2VuZUtleXMuZ2FtZQogICAgfSk7CiAgICBjb25zb2xlLmxvZyhnYW1lKTsKICAgIF90aGlzLnNvY2tldCA9IHNvY2tldDsKCiAgICBfdGhpcy5zZXRVcEdhbWUoZ2FtZSk7CgogICAgX3RoaXMudXBkYXRlRnBzID0gMTU7CiAgICBfdGhpcy50b3VjaFNjcmVlbiA9IGRldGVjdFRvdWNoU2NyZWVuKCk7CgogICAgUGhhc2VyLlBoeXNpY3MuQXJjYWRlLkdyb3VwLnByb3RvdHlwZS5raWxsQWxsID0gZnVuY3Rpb24gKCkgewogICAgICB3aGlsZSAodGhpcy5jb3VudEFjdGl2ZSgpID4gMCkgewogICAgICAgIHRoaXMuZ2V0Rmlyc3RBbGl2ZSgpLnNldEFjdGl2ZShmYWxzZSkuc2V0VmlzaWJsZShmYWxzZSk7CiAgICAgIH0KICAgIH07CgogICAgUGhhc2VyLlBoeXNpY3MuQXJjYWRlLkdyb3VwLnByb3RvdHlwZS5lbmFibGVBbGwgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHdoaWxlICh0aGlzLmNvdW50QWN0aXZlKCkgPCAzKSB7CiAgICAgICAgdGhpcy5nZXRGaXJzdERlYWQoKS5zZXRBY3RpdmUodHJ1ZSkuc2V0VmlzaWJsZSh0cnVlKTsKICAgICAgfQogICAgfTsKCiAgICByZXR1cm4gX3RoaXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoR2FtZVNjZW5lLCBbewogICAga2V5OiAic2V0VXBHYW1lIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRVcEdhbWUoZ2FtZSkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHRoaXMudGltZXIgPSBnYW1lLnRpbWVyOwogICAgICB0aGlzLnNldHRpbmdzID0gZ2FtZS5zZXR0aW5nczsKICAgICAgdGhpcy5jdXJyZW50UGxheWVyID0gZ2FtZS5jdXJyZW50UGxheWVyOwogICAgICB0aGlzLnNldHRpbmdzLm1heFZlbG9jaXR5TGl0dGxlID0gZ2FtZS5zZXR0aW5ncy52ZWxvY2l0eSArIDAuMjsKICAgICAgdGhpcy5zZXR0aW5ncy5hY2NlbGVyYXRpb25MaXR0bGUgPSAwLjQ7CiAgICAgIHRoaXMuc2V0dGluZ3MucmVzcGF3blRpbWUgPSA4MDAwOwogICAgICB0aGlzLnNldHRpbmdzLmZyaWN0aW9uQWlyID0gMC4xOwogICAgICB0aGlzLnBsYXllcnMgPSB7fTsKICAgICAgZ2FtZS5wbGF5ZXJzLmZvckVhY2goZnVuY3Rpb24gKHBsYXllcikgewogICAgICAgIF90aGlzMi5wbGF5ZXJzW3BsYXllci5sb2NhbElkXSA9IHBsYXllcjsKICAgICAgICBfdGhpczIucGxheWVyc1twbGF5ZXIubG9jYWxJZF0uYXZhaWxhYmxlQnVsbGV0cyA9IDM7CiAgICAgICAgX3RoaXMyLnBsYXllcnNbcGxheWVyLmxvY2FsSWRdLmxhc3RUaW1lc3RhbXAgPSAwOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJpbml0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0KGdhbWUpIHsKICAgICAgaWYgKEpTT04uc3RyaW5naWZ5KGdhbWUpICE9PSAie30iKSB7CiAgICAgICAgdGhpcy5zZXRVcEdhbWUoZ2FtZSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJwcmVsb2FkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwcmVsb2FkKCkgewogICAgICB0aGlzLmxvYWQuaW1hZ2UoInNoaXAwIiwgIi4vc2hpcHMvc2hpcDAucG5nIik7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgic2hpcDEiLCAiLi9zaGlwcy9zaGlwMS5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJzaGlwMiIsICIuL3NoaXBzL3NoaXAyLnBuZyIpOwogICAgICB0aGlzLmxvYWQuaW1hZ2UoInNoaXAzIiwgIi4vc2hpcHMvc2hpcDMucG5nIik7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgibGl0dGxlMCIsICIuL2xpdHRsZXMvbGl0dGxlMC5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJsaXR0bGUxIiwgIi4vbGl0dGxlcy9saXR0bGUxLnBuZyIpOwogICAgICB0aGlzLmxvYWQuaW1hZ2UoImxpdHRsZTIiLCAiLi9saXR0bGVzL2xpdHRsZTIucG5nIik7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgibGl0dGxlMyIsICIuL2xpdHRsZXMvbGl0dGxlMy5wbmciKTsKICAgICAgdGhpcy5sb2FkLmltYWdlKCJidWxsZXQiLCAiLi9idWxsZXQucG5nIik7CiAgICAgIHRoaXMubG9hZC5pbWFnZSgiYnVsbGV0LWxvYWRlZCIsICIuL2J1bGxldC1sb2FkZWQucG5nIik7CiAgICB9CiAgfSwgewogICAga2V5OiAiY3JlYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGUoKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMudGltZXIgPiBEYXRlLm5vdygpKSB0aGlzLnNjZW5lLnN0YXJ0KHNjZW5lS2V5cy5yYW5raW5nLCB7CiAgICAgICAgcGxheWVyczogdGhpcy5wbGF5ZXJzLAogICAgICAgIHRpbWVyOiB0aGlzLnRpbWVyCiAgICAgIH0pOwogICAgICB0aGlzLmNyZWF0ZUdyb3VwcygpOwogICAgICB0aGlzLmNyZWF0ZVNoaXBzKCk7CiAgICAgIHRoaXMuc29ja2V0Lm9uKHdlYnNvY2tldEV2ZW50cy5VUERBVEVfU0hJUCwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICByZXR1cm4gX3RoaXMzLnVwZGF0ZVNoaXAoZGF0YSk7CiAgICAgIH0pOwogICAgICB0aGlzLnNvY2tldC5vbih3ZWJzb2NrZXRFdmVudHMuU0hPT1QsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgcmV0dXJuIF90aGlzMy5jcmVhdGVCdWxsZXQoZGF0YSk7CiAgICAgIH0pOwogICAgICB0aGlzLnNvY2tldC5vbih3ZWJzb2NrZXRFdmVudHMuQ0hBTkdFX1NUQVRFLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgIHJldHVybiBfdGhpczMudXBkYXRlU3RhdGUoZGF0YSk7CiAgICAgIH0pOwogICAgICB0aGlzLnNvY2tldC5vbih3ZWJzb2NrZXRFdmVudHMuUkVMT0FELCBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgIHJldHVybiBfdGhpczMucmVsb2FkKGRhdGEpOwogICAgICB9KTsKICAgICAgdGhpcy5zb2NrZXQub24od2Vic29ja2V0RXZlbnRzLkVORF9UVVJOLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgIGNvbnNvbGUubG9nKGRhdGEpOwogICAgICAgIGNsZWFySW50ZXJ2YWwoX3RoaXMzLnVwZGF0ZVNoaXBJbnRlcnZhbCk7CiAgICAgICAgY2xlYXJJbnRlcnZhbChfdGhpczMucmVsb2FkSW50ZXJ2YWwpOwogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXMzLnNjZW5lLnBhdXNlKCk7CgogICAgICAgICAgX3RoaXMzLnNjZW5lLnN0YXJ0KHNjZW5lS2V5cy5yYW5raW5nLCBkYXRhKTsKICAgICAgICB9LCAxMDAwKTsKICAgICAgfSk7CiAgICAgIHRoaXMuc2V0S2V5SW5wdXRIYW5kbGVycygpOwogICAgICBpZiAodGhpcy50b3VjaFNjcmVlbikgdGhpcy5zZXRUb3VjaElucHV0SGFuZGxlcnMoKTsKICAgICAgdGhpcy5waHlzaWNzLndvcmxkLm9uKCJ3b3JsZGJvdW5kcyIsIGZ1bmN0aW9uIChidWxsZXQpIHsKICAgICAgICBidWxsZXQuZ2FtZU9iamVjdC5kZXN0cm95KCk7CiAgICAgIH0pOwogICAgICB0aGlzLnNldFJlbG9hZEludGVydmFsKCk7CiAgICAgIHRoaXMuc2V0VXBkYXRlU2hpcEludGVydmFsKCk7CiAgICAgIHRoaXMuc2V0T25EZXN0cm95KCk7CiAgICB9CiAgfSwgewogICAga2V5OiAidXBkYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGUodGltZSwgZGVsdGEpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICBpZiAodGhpcy5jdXJyZW50UGxheWVyICE9PSBudWxsKSB7CiAgICAgICAgaWYgKHRoaXMucm90YXRpb25LZXkuaXNEb3duIHx8IHRoaXMucm90YXRpbmcpIHRoaXMucm90YXRlKGRlbHRhKTsKICAgICAgICBpZiAodGhpcy5hY2NlbGVyYXRlTGl0dGxlS2V5LmlzRG93biB8fCB0aGlzLmFjY2VsZXJhdGluZykgdGhpcy5tb3ZlTGl0dGxlKGRlbHRhKTsKICAgICAgICB0aGlzLnNldEN1cnJlbnRQbGF5ZXJOZXdWZWxvY2l0eSgpOwogICAgICAgIGlmICh0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zdGF0ZSA9PT0gMSkgdGhpcy5kZWNlbGVyYXRlTGl0dGxlKGRlbHRhKTsKICAgICAgfQoKICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLnBsYXllcnMpLmZvckVhY2goZnVuY3Rpb24gKHBsYXllcikgewogICAgICAgIHZhciB0b3BMZWZ0ID0gcGxheWVyLnNoaXAuZ2V0VG9wTGVmdCgpOwogICAgICAgIHZhciBib3R0b21MZWZ0ID0gcGxheWVyLnNoaXAuZ2V0Qm90dG9tTGVmdCgpOwogICAgICAgIHZhciBjZW50ZXJMZWZ0ID0gewogICAgICAgICAgeDogKHRvcExlZnQueCArIGJvdHRvbUxlZnQueCkgLyAyLAogICAgICAgICAgeTogKHRvcExlZnQueSArIGJvdHRvbUxlZnQueSkgLyAyCiAgICAgICAgfTsKICAgICAgICBwbGF5ZXIuYnVsbGV0c0xvYWRlZC5jaGlsZHJlbi5pdGVyYXRlKGZ1bmN0aW9uIChidWxsZXQsIGluZGV4KSB7CiAgICAgICAgICB2YXIgX3RoaXM0JGdldExvYWRlZEJ1bGxlID0gX3RoaXM0LmdldExvYWRlZEJ1bGxldFBvc2l0aW9uKGluZGV4LCB0b3BMZWZ0LCBib3R0b21MZWZ0LCBjZW50ZXJMZWZ0LCBwbGF5ZXIpLAogICAgICAgICAgICAgIHggPSBfdGhpczQkZ2V0TG9hZGVkQnVsbGUueCwKICAgICAgICAgICAgICB5ID0gX3RoaXM0JGdldExvYWRlZEJ1bGxlLnk7CgogICAgICAgICAgYnVsbGV0LnggPSB4OwogICAgICAgICAgYnVsbGV0LnkgPSB5OwogICAgICAgIH0pOwoKICAgICAgICBpZiAocGxheWVyLmxvY2FsSWQgIT09IF90aGlzNC5jdXJyZW50UGxheWVyKSB7CiAgICAgICAgICBwbGF5ZXIuc2hpcC5hdXRvbm9teVRpbWUgLT0gZGVsdGE7CgogICAgICAgICAgaWYgKHBsYXllci5zaGlwLmF1dG9ub215VGltZSA8IDApIHsKICAgICAgICAgICAgcGxheWVyLnNoaXAuc2V0VmVsb2NpdHkoMCk7CiAgICAgICAgICAgIHBsYXllci5zaGlwLnNldEFuZ3VsYXJWZWxvY2l0eSgwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfSAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAvL0NyZWF0aW5nIHRoaW5ncwoKICB9LCB7CiAgICBrZXk6ICJjcmVhdGVHcm91cHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZUdyb3VwcygpIHsKICAgICAgdGhpcy5zaGlwcyA9IHRoaXMucGh5c2ljcy5hZGQuZ3JvdXAoKTsKICAgICAgdGhpcy5idWxsZXRzID0gdGhpcy5waHlzaWNzLmFkZC5ncm91cCgpOwogICAgfQogIH0sIHsKICAgIGtleTogImNyZWF0ZVNoaXBzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVTaGlwcygpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICB2YXIgaW5kZXggPSAwOwogICAgICB2YXIgdGV4dHVyZXMgPSBbIiIsICJsaXR0bGUiLCAic2hpcCJdOwogICAgICBPYmplY3QudmFsdWVzKHRoaXMucGxheWVycykuZm9yRWFjaChmdW5jdGlvbiAocGxheWVyKSB7CiAgICAgICAgcGxheWVyLnNoaXAgPSBfdGhpczUuc2hpcHMuY3JlYXRlKChpbmRleCA8IDIgPyAwLjA1IDogMC45NSkgKiBnYW1lRGltZW5zaW9ucy53aWR0aCwgKGluZGV4ICUgMiA9PT0gMCA/IDAuMDUgOiAwLjk1KSAqIGdhbWVEaW1lbnNpb25zLmhlaWdodCwgdGV4dHVyZXNbcGxheWVyLnN0YXRlXSArIHBsYXllci5jb2xvcik7CgogICAgICAgIGlmIChwbGF5ZXIuc3RhdGUgPT09IDApIHsKICAgICAgICAgIF90aGlzNS5zaGlwcy5raWxsQW5kSGlkZShwbGF5ZXIuc2hpcCk7CgogICAgICAgICAgX3RoaXM1LnNoaXBzLnJlbW92ZShwbGF5ZXIuc2hpcCk7CiAgICAgICAgfQoKICAgICAgICBwbGF5ZXIuYnVsbGV0c0xvYWRlZCA9IF90aGlzNS5waHlzaWNzLmFkZC5ncm91cCh7CiAgICAgICAgICBrZXk6ICJidWxsZXQtbG9hZGVkIiwKICAgICAgICAgIHF1YW50aXR5OiAzLAogICAgICAgICAgdmlzaWJsZTogcGxheWVyLnN0YXRlICE9PSAwLAogICAgICAgICAgYWN0aXZlOiBwbGF5ZXIuc3RhdGUgIT09IDAKICAgICAgICB9KTsKICAgICAgICBwbGF5ZXIuc2hpcC5sb2NhbElkID0gcGxheWVyLmxvY2FsSWQ7CiAgICAgICAgcGxheWVyLnNoaXAuc2V0QW5nbGUoLTQ1ICogKGluZGV4IDwgMiA/IDEgOiAzKSAqIChpbmRleCAlIDIgKiAyIC0gMSkpOwogICAgICAgIHBsYXllci5zaGlwLnZlbG9jaXR5TWFnbml0dWRlID0gX3RoaXM1LnNldHRpbmdzLnZlbG9jaXR5ICogbm9ybWFsaXplcnMudmVsb2NpdHk7CiAgICAgICAgcGxheWVyLnNoaXAuYXV0b25vbXlUaW1lID0gMDsKICAgICAgICBwbGF5ZXIuc2hpcC5zZXRDb2xsaWRlV29ybGRCb3VuZHModHJ1ZSk7CgogICAgICAgIGlmIChwbGF5ZXIubG9jYWxJZCA9PT0gX3RoaXM1LmN1cnJlbnRQbGF5ZXIpIHsKICAgICAgICAgIF90aGlzNS5waHlzaWNzLmFkZC5vdmVybGFwKHBsYXllci5zaGlwLCBfdGhpczUuYnVsbGV0cywgZnVuY3Rpb24gKHNoaXAsIGJ1bGxldCkgewogICAgICAgICAgICBfdGhpczUub25CdWxsZXRDb2xsaXNpb24oc2hpcCwgYnVsbGV0KTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIF90aGlzNS5waHlzaWNzLmFkZC5jb2xsaWRlcihwbGF5ZXIuc2hpcCwgX3RoaXM1LnNoaXBzLCBmdW5jdGlvbiAoY3VycmVudFNoaXAsIHNoaXApIHsKICAgICAgICAgICAgaWYgKF90aGlzNS5wbGF5ZXJzW190aGlzNS5jdXJyZW50UGxheWVyXS5zdGF0ZSA9PT0gMSAmJiBfdGhpczUucGxheWVyc1tzaGlwLmxvY2FsSWRdLnN0YXRlID49IDIpIHsKICAgICAgICAgICAgICB2YXIgZGF0YSA9IHsKICAgICAgICAgICAgICAgIGxvY2FsSWQ6IF90aGlzNS5jdXJyZW50UGxheWVyLAogICAgICAgICAgICAgICAgc3RhdGU6IDAsCiAgICAgICAgICAgICAgICBraWxsZWRCeTogc2hpcC5sb2NhbElkCiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgX3RoaXM1LnNvY2tldC5lbWl0KHdlYnNvY2tldEV2ZW50cy5DSEFOR0VfU1RBVEUsIGRhdGEpOwoKICAgICAgICAgICAgICBfdGhpczUudXBkYXRlU3RhdGUoZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaW5kZXgrKzsKICAgICAgfSk7CiAgICAgIHRoaXMucGh5c2ljcy5hZGQuY29sbGlkZXIodGhpcy5zaGlwcywgdGhpcy5zaGlwcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY3JlYXRlQnVsbGV0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVCdWxsZXQoZGF0YSkgewogICAgICB2YXIgX3RoaXMkcGh5c2ljcyR2ZWxvY2l0ID0gdGhpcy5waHlzaWNzLnZlbG9jaXR5RnJvbUFuZ2xlKGRhdGEuYW5nbGUsIHRoaXMuc2V0dGluZ3MuYnVsbGV0VmVsb2NpdHkgKiBub3JtYWxpemVycy5idWxsZXRWZWxvY2l0eSksCiAgICAgICAgICB4ID0gX3RoaXMkcGh5c2ljcyR2ZWxvY2l0LngsCiAgICAgICAgICB5ID0gX3RoaXMkcGh5c2ljcyR2ZWxvY2l0Lnk7CgogICAgICB2YXIgYnVsbGV0ID0gdGhpcy5idWxsZXRzLmNyZWF0ZShkYXRhLnBvc2l0aW9uLngsIGRhdGEucG9zaXRpb24ueSwgImJ1bGxldCIpOwogICAgICBidWxsZXQuYW5nbGUgPSBkYXRhLmFuZ2xlOwogICAgICBidWxsZXQuc2V0VmVsb2NpdHkoeCwgeSk7CiAgICAgIGJ1bGxldC5zaG90QnkgPSBkYXRhLmxvY2FsSWQ7CiAgICAgIGJ1bGxldC5zZXRDb2xsaWRlV29ybGRCb3VuZHModHJ1ZSk7CiAgICAgIGJ1bGxldC5ib2R5Lm9uV29ybGRCb3VuZHMgPSB0cnVlOwogICAgICB0aGlzLnBsYXllcnNbZGF0YS5sb2NhbElkXS5hdmFpbGFibGVCdWxsZXRzLS07CiAgICAgIHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmJ1bGxldHNMb2FkZWQuZ2V0Rmlyc3RBbGl2ZSgpLnNldEFjdGl2ZShmYWxzZSkuc2V0VmlzaWJsZShmYWxzZSk7CiAgICB9IC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vT3RoZXJzIGRvIHRoaW5ncyB2aWEgdGhlIHdlYnNvY2tldAoKICB9LCB7CiAgICBrZXk6ICJ1cGRhdGVTaGlwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVTaGlwKGRhdGEpIHsKICAgICAgdmFyIHBsYXllciA9IHRoaXMucGxheWVyc1tkYXRhWzBdXTsKICAgICAgdmFyIGRlbHRhVGltZSA9IChkYXRhWzNdIC0gcGxheWVyLmxhc3RUaW1lc3RhbXApIC8gMTAwMDsKICAgICAgaWYgKGRlbHRhVGltZSA8PSAwKSByZXR1cm47CiAgICAgIHZhciBkZWx0YVRoZXRhID0gZGF0YVsxXSAtIE51bWJlci5wYXJzZUludChwbGF5ZXIuc2hpcC5hbmdsZSk7CiAgICAgIGlmIChkZWx0YVRoZXRhIDwgLTEwKSBkZWx0YVRoZXRhICs9IDM2MDtlbHNlIGlmIChkZWx0YVRoZXRhIDwgMCkgZGVsdGFUaGV0YSA9IDA7CiAgICAgIHZhciBhbmd1bGFyVmVsb2NpdHkgPSBkZWx0YVRoZXRhIC8gZGVsdGFUaW1lOwogICAgICBwbGF5ZXIuc2hpcC5zZXRBbmd1bGFyVmVsb2NpdHkoYW5ndWxhclZlbG9jaXR5KTsKICAgICAgcGxheWVyLnNoaXAuc2V0VmVsb2NpdHkoKGRhdGFbMl1bMF0gLSBwbGF5ZXIuc2hpcC54KSAvIGRlbHRhVGltZSwgKGRhdGFbMl1bMV0gLSBwbGF5ZXIuc2hpcC55KSAvIGRlbHRhVGltZSk7CiAgICAgIHBsYXllci5sYXN0VGltZXN0YW1wID0gZGF0YVszXTsKICAgICAgcGxheWVyLnNoaXAuYXV0b25vbXlUaW1lID0gZGVsdGFUaW1lICogMTAwMDsKICAgIH0gLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy9DdXJyZW50IHBsYXllcnMgZG9lcyB0aGluZ3MKCiAgfSwgewogICAga2V5OiAicm90YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByb3RhdGUoZGVsdGEpIHsKICAgICAgdGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc2hpcC5hbmdsZSArPSBkZWx0YSAqIHRoaXMuc2V0dGluZ3MuYW5ndWxhclZlbG9jaXR5ICogbm9ybWFsaXplcnMuYW5ndWxhclZlbG9jaXR5OwogICAgfQogIH0sIHsKICAgIGtleTogIm1vdmVMaXR0bGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG1vdmVMaXR0bGUoZGVsdGEpIHsKICAgICAgdmFyIGN1cnJlbnRQbGF5ZXIgPSB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXTsKCiAgICAgIGlmIChjdXJyZW50UGxheWVyLnN0YXRlID09PSAxKSB7CiAgICAgICAgdmFyIHNoaXAgPSBjdXJyZW50UGxheWVyLnNoaXA7CiAgICAgICAgdmFyIHByZXZpb3VzTWFnID0gc2hpcC52ZWxvY2l0eU1hZ25pdHVkZTsKCiAgICAgICAgaWYgKHByZXZpb3VzTWFnIDwgdGhpcy5zZXR0aW5ncy5tYXhWZWxvY2l0eUxpdHRsZSAqIG5vcm1hbGl6ZXJzLnZlbG9jaXR5KSB7CiAgICAgICAgICBjdXJyZW50UGxheWVyLnNoaXAudmVsb2NpdHlNYWduaXR1ZGUgKz0gZGVsdGEgKiB0aGlzLnNldHRpbmdzLmFjY2VsZXJhdGlvbkxpdHRsZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY3VycmVudFBsYXllci5zaGlwLnZlbG9jaXR5TWFnbml0dWRlID0gdGhpcy5zZXR0aW5ncy5tYXhWZWxvY2l0eUxpdHRsZSAqIG5vcm1hbGl6ZXJzLnZlbG9jaXR5OwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogInNob290IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzaG9vdCgpIHsKICAgICAgdmFyIGN1cnJlbnRQbGF5ZXIgPSB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXTsKCiAgICAgIGlmIChjdXJyZW50UGxheWVyLmF2YWlsYWJsZUJ1bGxldHMgPiAwKSB7CiAgICAgICAgdmFyIHNoaXAgPSBjdXJyZW50UGxheWVyLnNoaXA7CiAgICAgICAgdmFyIGFuZ2xlID0gc2hpcC5hbmdsZTsKICAgICAgICB2YXIgZGF0YSA9IHsKICAgICAgICAgIHBvc2l0aW9uOiB7CiAgICAgICAgICAgIHg6IHNoaXAueCArIHNoaXAud2lkdGggKiBNYXRoLmNvcyhhbmdsZSAqIE1hdGguUEkgLyAxODApLAogICAgICAgICAgICB5OiBzaGlwLnkgKyBzaGlwLmhlaWdodCAqIE1hdGguc2luKGFuZ2xlICogTWF0aC5QSSAvIDE4MCkKICAgICAgICAgIH0sCiAgICAgICAgICBhbmdsZTogYW5nbGUsCiAgICAgICAgICBsb2NhbElkOiB0aGlzLmN1cnJlbnRQbGF5ZXIKICAgICAgICB9OwogICAgICAgIHRoaXMuc29ja2V0LmVtaXQod2Vic29ja2V0RXZlbnRzLlNIT09ULCBkYXRhKTsKICAgICAgICB0aGlzLmNyZWF0ZUJ1bGxldChkYXRhKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogInVwZGF0ZVN0YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVTdGF0ZShkYXRhKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uc3RhdGUgPSBkYXRhLnN0YXRlOwogICAgICB2YXIgcGxheWVyID0gdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF07CgogICAgICBzd2l0Y2ggKGRhdGEuc3RhdGUpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICB0aGlzLnNoaXBzLmtpbGxBbmRIaWRlKHBsYXllci5zaGlwKTsKICAgICAgICAgIHRoaXMuc2hpcHMucmVtb3ZlKHBsYXllci5zaGlwKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIDE6CiAgICAgICAgICBwbGF5ZXIuc2hpcC5zZXRUZXh0dXJlKCJsaXR0bGUiICsgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uY29sb3IpOwogICAgICAgICAgdGhpcy5wbGF5ZXJzW2RhdGEubG9jYWxJZF0uYnVsbGV0c0xvYWRlZC5raWxsQWxsKCk7CgogICAgICAgICAgaWYgKGRhdGEubG9jYWxJZCA9PT0gdGhpcy5jdXJyZW50UGxheWVyKSB7CiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIGlmIChfdGhpczYucGxheWVyc1tkYXRhLmxvY2FsSWRdLnN0YXRlID09PSAxKSB7CiAgICAgICAgICAgICAgICB2YXIgX2RhdGEgPSB7CiAgICAgICAgICAgICAgICAgIGxvY2FsSWQ6IF90aGlzNi5jdXJyZW50UGxheWVyLAogICAgICAgICAgICAgICAgICBzdGF0ZTogMgogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBfdGhpczYudXBkYXRlU3RhdGUoX2RhdGEpOwoKICAgICAgICAgICAgICAgIF90aGlzNi5zb2NrZXQuZW1pdCh3ZWJzb2NrZXRFdmVudHMuQ0hBTkdFX1NUQVRFLCBfZGF0YSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB0aGlzLnNldHRpbmdzLnJlc3Bhd25UaW1lKTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAyOgogICAgICAgICAgcGxheWVyLnNoaXAudmVsb2NpdHlNYWduaXR1ZGUgPSB0aGlzLnNldHRpbmdzLnZlbG9jaXR5ICogbm9ybWFsaXplcnMudmVsb2NpdHk7CiAgICAgICAgICBwbGF5ZXIuc2hpcC5zZXRUZXh0dXJlKCJzaGlwIiArIHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmNvbG9yKTsKICAgICAgICAgIHBsYXllci5idWxsZXRzTG9hZGVkLmVuYWJsZUFsbCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJvbkJ1bGxldENvbGxpc2lvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25CdWxsZXRDb2xsaXNpb24oc2hpcCwgYnVsbGV0KSB7CiAgICAgIGJ1bGxldC5kZXN0cm95KCk7CiAgICAgIHZhciBzdGF0ZSA9IHRoaXMucGxheWVyc1tzaGlwLmxvY2FsSWRdLnN0YXRlIC0gMTsKICAgICAgdmFyIGRhdGEgPSB7CiAgICAgICAgbG9jYWxJZDogc2hpcC5sb2NhbElkLAogICAgICAgIHN0YXRlOiBzdGF0ZQogICAgICB9OwoKICAgICAgaWYgKHN0YXRlID09PSAwKSB7CiAgICAgICAgZGF0YS5raWxsZWRCeSA9IGJ1bGxldC5zaG90Qnk7CiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnJlbG9hZEludGVydmFsKTsKICAgICAgICBjbGVhckludGVydmFsKHRoaXMudXBkYXRlU2hpcEludGVydmFsKTsKICAgICAgfQoKICAgICAgdGhpcy5zb2NrZXQuZW1pdCh3ZWJzb2NrZXRFdmVudHMuQ0hBTkdFX1NUQVRFLCBkYXRhKTsKICAgICAgdGhpcy51cGRhdGVTdGF0ZShkYXRhKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZWxvYWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbG9hZChkYXRhKSB7CiAgICAgIHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmF2YWlsYWJsZUJ1bGxldHMgPSBkYXRhLmF2YWlsYWJsZUJ1bGxldHM7CgogICAgICB0cnkgewogICAgICAgIHdoaWxlICh0aGlzLnBsYXllcnNbZGF0YS5sb2NhbElkXS5idWxsZXRzTG9hZGVkLmNvdW50QWN0aXZlKCkgPCBkYXRhLmF2YWlsYWJsZUJ1bGxldHMpIHsKICAgICAgICAgIHRoaXMucGxheWVyc1tkYXRhLmxvY2FsSWRdLmJ1bGxldHNMb2FkZWQuZ2V0Rmlyc3REZWFkKCkuc2V0QWN0aXZlKHRydWUpLnNldFZpc2libGUodHJ1ZSk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgIH0KICAgIH0gLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy9HYW1lIGxvb3AgZnVuY3Rpb25zCgogIH0sIHsKICAgIGtleTogInNldEN1cnJlbnRQbGF5ZXJOZXdWZWxvY2l0eSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Q3VycmVudFBsYXllck5ld1ZlbG9jaXR5KCkgewogICAgICB2YXIgX3RoaXMkcGh5c2ljcyR2ZWxvY2l0MiA9IHRoaXMucGh5c2ljcy52ZWxvY2l0eUZyb21BbmdsZSh0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwLmFuZ2xlLCB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwLnZlbG9jaXR5TWFnbml0dWRlKSwKICAgICAgICAgIHggPSBfdGhpcyRwaHlzaWNzJHZlbG9jaXQyLngsCiAgICAgICAgICB5ID0gX3RoaXMkcGh5c2ljcyR2ZWxvY2l0Mi55OwoKICAgICAgdGhpcy5wbGF5ZXJzW3RoaXMuY3VycmVudFBsYXllcl0uc2hpcC5zZXRWZWxvY2l0eSh4LCB5KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJkZWNlbGVyYXRlTGl0dGxlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZWNlbGVyYXRlTGl0dGxlKGRlbHRhKSB7CiAgICAgIHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdLnNoaXAudmVsb2NpdHlNYWduaXR1ZGUgPSBNYXRoLm1heCgwLCB0aGlzLnBsYXllcnNbdGhpcy5jdXJyZW50UGxheWVyXS5zaGlwLnZlbG9jaXR5TWFnbml0dWRlIC0gdGhpcy5zZXR0aW5ncy5mcmljdGlvbkFpciAqIGRlbHRhKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRMb2FkZWRCdWxsZXRQb3NpdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TG9hZGVkQnVsbGV0UG9zaXRpb24oaW5kZXgsIHRvcExlZnQsIGJvdHRvbUxlZnQsIGNlbnRlckxlZnQsIHBsYXllcikgewogICAgICBzd2l0Y2ggKGluZGV4KSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgeDogYm90dG9tTGVmdC54IC0gcGxheWVyLnNoaXAud2lkdGggLyA0ICogTWF0aC5jb3MocGxheWVyLnNoaXAucm90YXRpb24pLAogICAgICAgICAgICB5OiBib3R0b21MZWZ0LnkgLSBwbGF5ZXIuc2hpcC5oZWlnaHQgLyA0ICogTWF0aC5zaW4ocGxheWVyLnNoaXAucm90YXRpb24pCiAgICAgICAgICB9OwoKICAgICAgICBjYXNlIDE6CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB4OiB0b3BMZWZ0LnggLSBwbGF5ZXIuc2hpcC53aWR0aCAvIDQgKiBNYXRoLmNvcyhwbGF5ZXIuc2hpcC5yb3RhdGlvbiksCiAgICAgICAgICAgIHk6IHRvcExlZnQueSAtIHBsYXllci5zaGlwLmhlaWdodCAvIDQgKiBNYXRoLnNpbihwbGF5ZXIuc2hpcC5yb3RhdGlvbikKICAgICAgICAgIH07CgogICAgICAgIGNhc2UgMjoKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHg6IGNlbnRlckxlZnQueCAtIHBsYXllci5zaGlwLndpZHRoIC8gNCAqIE1hdGguY29zKHBsYXllci5zaGlwLnJvdGF0aW9uKSwKICAgICAgICAgICAgeTogY2VudGVyTGVmdC55IC0gcGxheWVyLnNoaXAuaGVpZ2h0IC8gNCAqIE1hdGguc2luKHBsYXllci5zaGlwLnJvdGF0aW9uKQogICAgICAgICAgfTsKICAgICAgfQogICAgfSAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAvL09uIGNyZWF0ZSBzZXR1cAoKICB9LCB7CiAgICBrZXk6ICJzZXRLZXlJbnB1dEhhbmRsZXJzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRLZXlJbnB1dEhhbmRsZXJzKCkgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmN1cnJlbnRQbGF5ZXIgPT09IG51bGwpIHJldHVybjsKICAgICAgdGhpcy5yb3RhdGlvbktleSA9IHRoaXMuaW5wdXQua2V5Ym9hcmQuYWRkS2V5KFBoYXNlci5JbnB1dC5LZXlib2FyZC5LZXlDb2Rlcy5TUEFDRSk7CiAgICAgIHRoaXMuYWNjZWxlcmF0ZUxpdHRsZUtleSA9IHRoaXMuaW5wdXQua2V5Ym9hcmQuYWRkS2V5KFBoYXNlci5JbnB1dC5LZXlib2FyZC5LZXlDb2Rlcy5FTlRFUik7CiAgICAgIHRoaXMuaW5wdXQua2V5Ym9hcmQub24oImtleXVwLUVOVEVSIiwgZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChfdGhpczcucGxheWVyc1tfdGhpczcuY3VycmVudFBsYXllcl0uc3RhdGUgPj0gMikgX3RoaXM3LnNob290KCk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogInNldFRvdWNoSW5wdXRIYW5kbGVycyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0VG91Y2hJbnB1dEhhbmRsZXJzKCkgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmN1cnJlbnRQbGF5ZXIgPT09IG51bGwpIHJldHVybjsKICAgICAgdGhpcy5pbnB1dC5hZGRQb2ludGVyKDEpOwogICAgICB0aGlzLmlucHV0Lm9uKCJwb2ludGVyZG93biIsIGZ1bmN0aW9uIChwb2ludGVyKSB7CiAgICAgICAgaWYgKHBvaW50ZXIueCA8IGdhbWVEaW1lbnNpb25zLndpZHRoIC8gMikgewogICAgICAgICAgX3RoaXM4LnJvdGF0aW5nID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKF90aGlzOC5wbGF5ZXJzW190aGlzOC5jdXJyZW50UGxheWVyXS5zdGF0ZSA+PSAyKSBfdGhpczguc2hvb3QoKTtlbHNlIHsKICAgICAgICAgICAgX3RoaXM4LmFjY2VsZXJhdGluZyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5pbnB1dC5vbigicG9pbnRlcnVwIiwgZnVuY3Rpb24gKHBvaW50ZXIpIHsKICAgICAgICBpZiAocG9pbnRlci54IDwgZ2FtZURpbWVuc2lvbnMud2lkdGggLyAyKSB7CiAgICAgICAgICBfdGhpczgucm90YXRpbmcgPSBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXM4LmFjY2VsZXJhdGluZyA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0VXBkYXRlU2hpcEludGVydmFsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRVcGRhdGVTaGlwSW50ZXJ2YWwoKSB7CiAgICAgIHZhciBfdGhpczkgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuY3VycmVudFBsYXllciA9PT0gbnVsbCkgcmV0dXJuOwogICAgICB2YXIgY3VycmVudFBsYXllciA9IHRoaXMucGxheWVyc1t0aGlzLmN1cnJlbnRQbGF5ZXJdOwogICAgICB0aGlzLnVwZGF0ZVNoaXBJbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczkuc29ja2V0LmVtaXQod2Vic29ja2V0RXZlbnRzLlVQREFURV9TSElQLCBbX3RoaXM5LmN1cnJlbnRQbGF5ZXIsIE51bWJlci5wYXJzZUludChjdXJyZW50UGxheWVyLnNoaXAuYW5nbGUpLCBbTnVtYmVyLnBhcnNlRmxvYXQoY3VycmVudFBsYXllci5zaGlwLngudG9GaXhlZCgyKSksIE51bWJlci5wYXJzZUZsb2F0KGN1cnJlbnRQbGF5ZXIuc2hpcC55LnRvRml4ZWQoMikpXSwgX3RoaXM5LnRpbWUubm93XSk7CiAgICAgIH0sIDEwMDAgLyB0aGlzLnVwZGF0ZUZwcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0UmVsb2FkSW50ZXJ2YWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFJlbG9hZEludGVydmFsKCkgewogICAgICB2YXIgX3RoaXMxMCA9IHRoaXM7CgogICAgICBpZiAodGhpcy5jdXJyZW50UGxheWVyID09PSBudWxsKSByZXR1cm47CiAgICAgIHRoaXMucmVsb2FkSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKF90aGlzMTAucGxheWVyc1tfdGhpczEwLmN1cnJlbnRQbGF5ZXJdLnN0YXRlIDwgMikgcmV0dXJuOwogICAgICAgIHZhciBhdmFpbGFibGVCdWxsZXRzID0gTWF0aC5taW4oMywgX3RoaXMxMC5wbGF5ZXJzW190aGlzMTAuY3VycmVudFBsYXllcl0uYXZhaWxhYmxlQnVsbGV0cyArIDEpOwogICAgICAgIHZhciBkYXRhID0gewogICAgICAgICAgbG9jYWxJZDogX3RoaXMxMC5jdXJyZW50UGxheWVyLAogICAgICAgICAgYXZhaWxhYmxlQnVsbGV0czogYXZhaWxhYmxlQnVsbGV0cwogICAgICAgIH07CgogICAgICAgIF90aGlzMTAuc29ja2V0LmVtaXQod2Vic29ja2V0RXZlbnRzLlJFTE9BRCwgZGF0YSk7CgogICAgICAgIF90aGlzMTAucmVsb2FkKGRhdGEpOwogICAgICB9LCAxIC8gKHRoaXMuc2V0dGluZ3MucmVsb2FkaW5nVmVsb2NpdHkgKiBub3JtYWxpemVycy5yZWxvYWRpbmdWZWxvY2l0eSkpOwogICAgfQogIH0sIHsKICAgIGtleTogInNldE9uRGVzdHJveSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0T25EZXN0cm95KCkgewogICAgICB2YXIgX3RoaXMxMSA9IHRoaXM7CgogICAgICBpZiAodGhpcy5jdXJyZW50UGxheWVyID09PSBudWxsKSByZXR1cm47CiAgICAgIHRoaXMuZXZlbnRzLm9uKCJkZXN0cm95IiwgZnVuY3Rpb24gKCkgewogICAgICAgIGNsZWFySW50ZXJ2YWwoX3RoaXMxMS51cGRhdGVTaGlwSW50ZXJ2YWwpOwogICAgICAgIGNsZWFySW50ZXJ2YWwoX3RoaXMxMS5yZWxvYWRJbnRlcnZhbCk7CiAgICAgIH0pOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIEdhbWVTY2VuZTsKfShQaGFzZXIuU2NlbmUpOwoKZXhwb3J0IHsgR2FtZVNjZW5lIGFzIGRlZmF1bHQgfTs="},{"version":3,"sources":["/media/jacopo/VolumeDati/Documenti/papero.tk/cosmos.papero.me/src/phaser/GameScene.js"],"names":["Phaser","websocketEvents","gameDimensions","normalizers","sceneKeys","detectTouchScreen","GameScene","socket","game","key","console","log","setUpGame","updateFps","touchScreen","Physics","Arcade","Group","prototype","killAll","countActive","getFirstAlive","setActive","setVisible","enableAll","getFirstDead","timer","settings","currentPlayer","maxVelocityLittle","velocity","accelerationLittle","respawnTime","frictionAir","players","forEach","player","localId","availableBullets","lastTimestamp","JSON","stringify","load","image","Date","now","scene","start","ranking","createGroups","createShips","on","UPDATE_SHIP","data","updateShip","SHOOT","createBullet","CHANGE_STATE","updateState","RELOAD","reload","END_TURN","clearInterval","updateShipInterval","reloadInterval","setTimeout","pause","setKeyInputHandlers","setTouchInputHandlers","physics","world","bullet","gameObject","destroy","setReloadInterval","setUpdateShipInterval","setOnDestroy","time","delta","rotationKey","isDown","rotating","rotate","accelerateLittleKey","accelerating","moveLittle","setCurrentPlayerNewVelocity","state","decelerateLittle","Object","values","topLeft","ship","getTopLeft","bottomLeft","getBottomLeft","centerLeft","x","y","bulletsLoaded","children","iterate","index","getLoadedBulletPosition","autonomyTime","setVelocity","setAngularVelocity","ships","add","group","bullets","textures","create","width","height","color","killAndHide","remove","quantity","visible","active","setAngle","velocityMagnitude","setCollideWorldBounds","overlap","onBulletCollision","collider","currentShip","killedBy","emit","velocityFromAngle","angle","bulletVelocity","position","shotBy","body","onWorldBounds","deltaTime","deltaTheta","Number","parseInt","angularVelocity","previousMag","Math","cos","PI","sin","setTexture","e","max","rotation","input","keyboard","addKey","Input","Keyboard","KeyCodes","SPACE","ENTER","shoot","addPointer","pointer","setInterval","parseFloat","toFixed","min","reloadingVelocity","events","Scene"],"mappings":"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","sourcesContent":["import * as Phaser from \"phaser\";\nimport websocketEvents from \"../constants/websocketEvents\";\nimport {gameDimensions, normalizers, sceneKeys} from \"../constants/gameSettings\";\nimport {detectTouchScreen} from \"../constants/constants\";\n\n\nexport default class GameScene extends Phaser.Scene {\n\n    setUpGame(game){\n        this.timer = game.timer;\n        this.settings = game.settings;\n        this.currentPlayer = game.currentPlayer;\n        this.settings.maxVelocityLittle = game.settings.velocity+0.2;\n        this.settings.accelerationLittle = 0.4;\n        this.settings.respawnTime = 8000;\n        this.settings.frictionAir = 0.1;\n        this.players = {};\n        game.players.forEach(player => {\n            this.players[player.localId] = player;\n            this.players[player.localId].availableBullets = 3;\n            this.players[player.localId].lastTimestamp = 0;\n        });\n    }\n\n    constructor(socket, game) {\n        super({key: sceneKeys.game});\n        console.log(game);\n\n        this.socket = socket;\n        this.setUpGame(game);\n\n        this.updateFps = 15;\n        this.touchScreen = detectTouchScreen();\n        \n        Phaser.Physics.Arcade.Group.prototype.killAll = function () {\n            while(this.countActive()>0){\n                this.getFirstAlive().setActive(false).setVisible(false);\n            }\n        }\n\n        Phaser.Physics.Arcade.Group.prototype.enableAll = function () {\n            while(this.countActive()<3){\n                this.getFirstDead().setActive(true).setVisible(true);\n            }\n        }\n    }\n\n    init(game){\n        if(JSON.stringify(game)!==\"{}\"){\n            this.setUpGame(game);\n        }\n    }\n\n    preload(){\n\n        this.load.image(\"ship0\", \"./ships/ship0.png\");\n        this.load.image(\"ship1\", \"./ships/ship1.png\");\n        this.load.image(\"ship2\", \"./ships/ship2.png\");\n        this.load.image(\"ship3\", \"./ships/ship3.png\");\n        this.load.image(\"little0\", \"./littles/little0.png\");\n        this.load.image(\"little1\", \"./littles/little1.png\");\n        this.load.image(\"little2\", \"./littles/little2.png\");\n        this.load.image(\"little3\", \"./littles/little3.png\");\n        this.load.image(\"bullet\", \"./bullet.png\");\n        this.load.image(\"bullet-loaded\", \"./bullet-loaded.png\");\n\n    }\n\n    create(){\n        if(this.timer > Date.now()) this.scene.start(sceneKeys.ranking, {\n            players: this.players,\n            timer: this.timer\n        });\n\n        this.createGroups();\n        this.createShips();\n\n        this.socket.on(websocketEvents.UPDATE_SHIP, data => this.updateShip(data));\n        this.socket.on(websocketEvents.SHOOT, data => this.createBullet(data));\n        this.socket.on(websocketEvents.CHANGE_STATE, data => this.updateState(data));\n        this.socket.on(websocketEvents.RELOAD, data => this.reload(data));\n        this.socket.on(websocketEvents.END_TURN, data => {\n            console.log(data);\n            clearInterval(this.updateShipInterval);\n            clearInterval(this.reloadInterval);\n            setTimeout(()=>{\n                this.scene.pause();\n                this.scene.start(sceneKeys.ranking, data);\n            }, 1000);\n        });\n\n        this.setKeyInputHandlers();\n        if(this.touchScreen) this.setTouchInputHandlers();\n\n        this.physics.world.on(\"worldbounds\", (bullet)=>{bullet.gameObject.destroy()});\n\n        this.setReloadInterval();\n        this.setUpdateShipInterval();\n\n        this.setOnDestroy();\n    }\n\n    update(time, delta){\n        if(this.currentPlayer !== null) {\n            if (this.rotationKey.isDown || this.rotating) this.rotate(delta);\n            if (this.accelerateLittleKey.isDown || this.accelerating) this.moveLittle(delta);\n\n            this.setCurrentPlayerNewVelocity();\n            if (this.players[this.currentPlayer].state === 1) this.decelerateLittle(delta);\n        }\n\n        Object.values(this.players).forEach(player => {\n            const topLeft = player.ship.getTopLeft();\n            const bottomLeft = player.ship.getBottomLeft();\n            const centerLeft = {\n                x: (topLeft.x + bottomLeft.x) / 2,\n                y: (topLeft.y + bottomLeft.y) / 2\n            }\n            player.bulletsLoaded.children.iterate((bullet, index)=>{\n                const {x, y} = this.getLoadedBulletPosition(index, topLeft, bottomLeft, centerLeft, player);\n                bullet.x = x;\n                bullet.y = y;\n\n            });\n           if(player.localId!==this.currentPlayer){\n               player.ship.autonomyTime -= delta;\n               if(player.ship.autonomyTime<0) {\n                   player.ship.setVelocity(0);\n                   player.ship.setAngularVelocity(0);\n               }\n           }\n        });\n    }\n\n\n\n\n    //=============================================================================\n    //Creating things\n    createGroups(){\n        this.ships = this.physics.add.group();\n        this.bullets = this.physics.add.group();\n    }\n\n    createShips(){\n        let index = 0;\n        const textures = [\"\", \"little\", \"ship\"];\n        Object.values(this.players).forEach(player => {\n            player.ship = this.ships.create(\n                (index<2 ? 0.05 : 0.95) * gameDimensions.width,\n                ( index%2 === 0 ? 0.05 : 0.95 ) * gameDimensions.height,\n                textures[player.state]+player.color\n            );\n            \n            if(player.state === 0) {\n                this.ships.killAndHide(player.ship);\n                this.ships.remove(player.ship);\n            }\n\n            player.bulletsLoaded = this.physics.add.group({\n                key: \"bullet-loaded\",\n                quantity: 3,\n                visible: player.state!==0,\n                active: player.state!==0\n            });\n\n            player.ship.localId = player.localId;\n            player.ship.setAngle(-45  * ( index < 2 ? 1 : 3) * ( ( index % 2 ) * 2 - 1 ));\n            player.ship.velocityMagnitude = this.settings.velocity*normalizers.velocity;\n            player.ship.autonomyTime = 0;\n            player.ship.setCollideWorldBounds(true);\n\n            if(player.localId===this.currentPlayer){\n                this.physics.add.overlap(player.ship, this.bullets, (ship, bullet) => {\n                    this.onBulletCollision(ship, bullet);\n                });\n                this.physics.add.collider(player.ship, this.ships, (currentShip, ship)=>{\n                    if(this.players[this.currentPlayer].state === 1 && this.players[ship.localId].state >= 2){\n                        const data = {\n                            localId: this.currentPlayer,\n                            state: 0,\n                            killedBy: ship.localId\n                        };\n                        this.socket.emit(websocketEvents.CHANGE_STATE, data);\n                        this.updateState(data);\n                    }\n                });\n            }\n\n            index++;\n        });\n\n        this.physics.add.collider(this.ships, this.ships);\n    }\n\n    createBullet(data){\n        const {x, y} = this.physics.velocityFromAngle(data.angle, this.settings.bulletVelocity*normalizers.bulletVelocity);\n        const bullet = this.bullets.create(data.position.x, data.position.y, \"bullet\");\n        bullet.angle = data.angle;\n        bullet.setVelocity(x, y);\n        bullet.shotBy = data.localId;\n        bullet.setCollideWorldBounds(true);\n        bullet.body.onWorldBounds = true;\n        this.players[data.localId].availableBullets--;\n        this.players[data.localId].bulletsLoaded.getFirstAlive().setActive(false).setVisible(false);\n    }\n\n\n\n\n\n\n    //=============================================================================\n    //Others do things via the websocket\n    updateShip(data){\n        const player = this.players[data[0]];\n        const deltaTime = (data[3]-player.lastTimestamp)/1000;\n        if(deltaTime<=0) return;\n\n        let deltaTheta = data[1] - Number.parseInt(player.ship.angle);\n\n        if(deltaTheta < -10) deltaTheta += 360;\n        else if(deltaTheta < 0) deltaTheta = 0;\n        const angularVelocity = deltaTheta / deltaTime;\n        player.ship.setAngularVelocity(angularVelocity);\n\n        player.ship.setVelocity( ( data[2][0]-player.ship.x ) / deltaTime, ( data[2][1]-player.ship.y ) / deltaTime );\n\n        player.lastTimestamp = data[3];\n        player.ship.autonomyTime = deltaTime*1000;\n    }\n\n\n\n    //=============================================================================\n    //Current players does things\n    rotate(delta){\n        this.players[this.currentPlayer].ship.angle += delta * this.settings.angularVelocity * normalizers.angularVelocity;\n    }\n\n    moveLittle(delta){\n        const currentPlayer = this.players[this.currentPlayer];\n        if(currentPlayer.state === 1){\n            const ship = currentPlayer.ship;\n            const previousMag = ship.velocityMagnitude;\n            if(previousMag < this.settings.maxVelocityLittle * normalizers.velocity){\n                currentPlayer.ship.velocityMagnitude += delta*this.settings.accelerationLittle;\n            } else {\n                currentPlayer.ship.velocityMagnitude = this.settings.maxVelocityLittle * normalizers.velocity;\n            }\n        }\n    }\n\n    shoot(){\n        const currentPlayer = this.players[this.currentPlayer];\n        if(currentPlayer.availableBullets>0){\n            const ship = currentPlayer.ship;\n            const angle = ship.angle;\n            const data = {\n                position: {\n                    x: ship.x + ship.width*Math.cos(angle * Math.PI / 180),\n                    y: ship.y + ship.height*Math.sin(angle * Math.PI / 180)\n                },\n                angle: angle,\n                localId: this.currentPlayer\n            };\n            this.socket.emit(websocketEvents.SHOOT, data);\n            this.createBullet(data);\n        }\n    }\n\n\n    updateState(data){\n        this.players[data.localId].state = data.state;\n        const player = this.players[data.localId];\n        switch (data.state) {\n            case 0:\n                this.ships.killAndHide(player.ship);\n                this.ships.remove(player.ship);\n                break;\n            case 1:\n                player.ship.setTexture(\"little\" + this.players[data.localId].color);\n                this.players[data.localId].bulletsLoaded.killAll();\n                if(data.localId === this.currentPlayer) {\n                    setTimeout(() => {\n                        if (this.players[data.localId].state === 1) {\n                            const data = {\n                                localId: this.currentPlayer,\n                                state: 2\n                            };\n                            this.updateState(data);\n                            this.socket.emit(websocketEvents.CHANGE_STATE, data);\n                        }\n                    }, this.settings.respawnTime);\n                }\n                break;\n            case 2:\n                player.ship.velocityMagnitude = this.settings.velocity * normalizers.velocity;\n                player.ship.setTexture(\"ship\" + this.players[data.localId].color);\n                player.bulletsLoaded.enableAll();\n                break;\n        }\n    }\n\n    onBulletCollision(ship, bullet){\n        bullet.destroy();\n        const state = this.players[ship.localId].state-1;\n        const data = {\n            localId: ship.localId,\n            state\n        };\n        if(state === 0) {\n            data.killedBy = bullet.shotBy;\n            clearInterval(this.reloadInterval);\n            clearInterval(this.updateShipInterval);\n        }\n        this.socket.emit(websocketEvents.CHANGE_STATE, data);\n        this.updateState(data);\n    }\n\n\n    reload(data){\n        this.players[data.localId].availableBullets = data.availableBullets;\n        try{\n            while(this.players[data.localId].bulletsLoaded.countActive() < data.availableBullets){\n                this.players[data.localId].bulletsLoaded.getFirstDead().setActive(true).setVisible(true);\n            }\n        } catch (e) {\n            console.log(e);\n        }\n    }\n\n\n    //=============================================================================\n    //Game loop functions\n    setCurrentPlayerNewVelocity(){\n        const {x, y} = this.physics.velocityFromAngle(\n            this.players[this.currentPlayer].ship.angle,\n            this.players[this.currentPlayer].ship.velocityMagnitude\n        );\n        this.players[this.currentPlayer].ship.setVelocity(x, y);\n    }\n\n    decelerateLittle(delta){\n        this.players[this.currentPlayer].ship.velocityMagnitude = Math.max(\n            0, this.players[this.currentPlayer].ship.velocityMagnitude - this.settings.frictionAir * delta\n        );\n    }\n\n    getLoadedBulletPosition(index, topLeft, bottomLeft, centerLeft, player){\n        switch (index){\n            case 0:\n                return {\n                    x: bottomLeft.x - (player.ship.width/4)*Math.cos(player.ship.rotation),\n                    y: bottomLeft.y - (player.ship.height/4)*Math.sin(player.ship.rotation)\n                };\n            case 1:\n                return{\n                    x: topLeft.x - (player.ship.width/4)*Math.cos(player.ship.rotation),\n                    y: topLeft.y - (player.ship.height/4)*Math.sin(player.ship.rotation)\n                };\n            case 2:\n                return {\n                    x: centerLeft.x - (player.ship.width/4)*Math.cos(player.ship.rotation),\n                    y: centerLeft.y - (player.ship.height/4)*Math.sin(player.ship.rotation)\n                };\n        }\n    }\n\n\n\n    //=============================================================================\n    //On create setup\n\n    setKeyInputHandlers(){\n        if(this.currentPlayer === null) return;\n\n        this.rotationKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);\n        this.accelerateLittleKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ENTER);\n        this.input.keyboard.on(\"keyup-ENTER\", ()=>{\n            if(this.players[this.currentPlayer].state>=2) this.shoot();\n        });\n    }\n\n    setTouchInputHandlers(){\n        if(this.currentPlayer === null) return;\n\n        this.input.addPointer(1);\n\n        this.input.on(\"pointerdown\", (pointer) => {\n            if (pointer.x < gameDimensions.width / 2) {\n                this.rotating = true;\n            } else {\n                if (this.players[this.currentPlayer].state >= 2) this.shoot();\n                else {\n                    this.accelerating = true;\n                }\n            }\n        });\n\n        this.input.on(\"pointerup\", (pointer) => {\n            if (pointer.x < gameDimensions.width / 2) {\n                this.rotating = false;\n            } else {\n                this.accelerating = false;\n            }\n        });\n    }\n\n    setUpdateShipInterval(){\n        if(this.currentPlayer === null) return;\n\n        const currentPlayer = this.players[this.currentPlayer];\n        this.updateShipInterval = setInterval(()=>{\n            this.socket.emit(websocketEvents.UPDATE_SHIP, [\n                this.currentPlayer,\n                Number.parseInt(currentPlayer.ship.angle),\n                [\n                    Number.parseFloat(currentPlayer.ship.x.toFixed(2)),\n                    Number.parseFloat(currentPlayer.ship.y.toFixed(2))\n                ],\n                this.time.now\n            ]);\n        }, 1000/this.updateFps);\n    }\n\n    setReloadInterval(){\n        if(this.currentPlayer === null) return;\n\n        this.reloadInterval = setInterval(() => {\n            if(this.players[this.currentPlayer].state<2) return;\n            const availableBullets = Math.min(3, this.players[this.currentPlayer].availableBullets + 1);\n            const data = {\n                localId: this.currentPlayer,\n                availableBullets\n            };\n            this.socket.emit(websocketEvents.RELOAD, data);\n            this.reload(data);\n        }, 1/(this.settings.reloadingVelocity * normalizers.reloadingVelocity));\n    }\n\n    setOnDestroy(){\n        if(this.currentPlayer === null) return;\n\n        this.events.on(\"destroy\", ()=>{\n            clearInterval(this.updateShipInterval);\n            clearInterval(this.reloadInterval);\n        });\n    }\n}"]}]}